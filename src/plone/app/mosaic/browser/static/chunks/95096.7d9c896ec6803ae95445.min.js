"use strict";(self.webpackChunkplone_mosaic=self.webpackChunkplone_mosaic||[]).push([[95096],{95096:function(){!function(e){var a;e.tools=e.tools||{version:"@VERSION"};var n={};(a=e.tools.recurrenceinput={conf:{lang:"en",readOnly:!1,firstDay:0,startField:null,startFieldYear:null,startFieldMonth:null,startFieldDay:null,ajaxURL:null,ajaxContentType:"application/json; charset=utf8",ributtonExtraClass:"",hasRepeatForeverButton:!0,formOverlay:{speed:"fast",fixed:!1},template:{form:"#jquery-recurrenceinput-form-tmpl",display:"#jquery-recurrenceinput-display-tmpl"},rtemplate:{daily:{rrule:"FREQ=DAILY",fields:["ridailyinterval","rirangeoptions"]},mondayfriday:{rrule:"FREQ=WEEKLY;BYDAY=MO,FR",fields:["rirangeoptions"]},weekdays:{rrule:"FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR",fields:["rirangeoptions"]},weekly:{rrule:"FREQ=WEEKLY",fields:["riweeklyinterval","riweeklyweekdays","rirangeoptions"]},monthly:{rrule:"FREQ=MONTHLY",fields:["rimonthlyinterval","rimonthlyoptions","rirangeoptions"]},yearly:{rrule:"FREQ=YEARLY",fields:["riyearlyinterval","riyearlyoptions","rirangeoptions"]}}},localize:function(e,a){n[e]=a},setTemplates:function(e,t){var i,r;for(i in a.conf.rtemplate=e,t)if(t.hasOwnProperty(i))for(r in t[i])t[i].hasOwnProperty(r)&&(n[i].rtemplate[r]=t[i][r])}}).localize("en",{displayUnactivate:"Does not repeat",displayActivate:"Repeats every",add_rules:"Add",edit_rules:"Edit",delete_rules:"Delete",add:"Add",refresh:"Refresh",title:"Repeat",preview:"Selected dates",addDate:"Add date",recurrenceType:"Repeats:",dailyInterval1:"Repeat every:",dailyInterval2:"days",weeklyInterval1:"Repeat every:",weeklyInterval2:"week(s)",weeklyWeekdays:"Repeat on:",weeklyWeekdaysHuman:"on:",monthlyInterval1:"Repeat every:",monthlyInterval2:"month(s)",monthlyDayOfMonth1:"Day",monthlyDayOfMonth1Human:"on day",monthlyDayOfMonth2:"of the month",monthlyDayOfMonth3:"month(s)",monthlyWeekdayOfMonth1:"The",monthlyWeekdayOfMonth1Human:"on the",monthlyWeekdayOfMonth2:"",monthlyWeekdayOfMonth3:"of the month",monthlyRepeatOn:"Repeat on:",yearlyInterval1:"Repeat every:",yearlyInterval2:"year(s)",yearlyDayOfMonth1:"Every",yearlyDayOfMonth1Human:"on",yearlyDayOfMonth2:"",yearlyDayOfMonth3:"",yearlyWeekdayOfMonth1:"The",yearlyWeekdayOfMonth1Human:"on the",yearlyWeekdayOfMonth2:"",yearlyWeekdayOfMonth3:"of",yearlyWeekdayOfMonth4:"",yearlyRepeatOn:"Repeat on:",range:"End recurrence:",rangeNoEnd:"Never",rangeByOccurrences1:"After",rangeByOccurrences1Human:"ends after",rangeByOccurrences2:"occurrence(s)",rangeByEndDate:"On",rangeByEndDateHuman:"ends on",including:", and also",except:", except for",cancel:"Cancel",save:"Save",recurrenceStart:"Start of the recurrence",additionalDate:"Additional date",include:"Include",exclude:"Exclude",remove:"Remove",orderIndexes:["first","second","third","fourth","last"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortWeekdays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longDateFormat:"mmmm dd, yyyy",shortDateFormat:"mm/dd/yyyy",unsupportedFeatures:"Warning: This event uses recurrence features not supported by this widget. Saving the recurrence may change the recurrence in unintended ways:",noTemplateMatch:"No matching recurrence template",multipleDayOfMonth:"This widget does not support multiple days in monthly or yearly recurrence",bysetpos:"BYSETPOS is not supported",noRule:"No RRULE in RRULE data",noRepeatEvery:'Error: The "Repeat every"-field must be between 1 and 1000',noEndDate:"Error: End date is not set. Please set a correct value",noRepeatOn:'Error: "Repeat on"-value must be selected',pastEndDate:"Error: End date cannot be before start date",noEndAfterNOccurrences:'Error: The "After N occurrences"-field must be between 1 and 1000',alreadyAdded:"This date was already added",rtemplate:{daily:"Daily",mondayfriday:"Monday and Friday",weekdays:"Weekday",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly"}});var t=['<div class="rioccurrences">',"{{each occurrences}}",'<div class="occurrence ${occurrences[$index].type}">',"<span>","${occurrences[$index].formattedDate}",'{{if occurrences[$index].type === "start"}}','<span class="rlabel">${i18n.recurrenceStart}</span>',"{{/if}}",'{{if occurrences[$index].type === "rdate"}}','<span class="rlabel">${i18n.additionalDate}</span>',"{{/if}}","</span>","{{if !readOnly}}",'<span class="action">','{{if occurrences[$index].type === "rrule"}}','<a date="${occurrences[$index].date}" href="#"','class="${occurrences[$index].type}" title="${i18n.exclude}">',"${i18n.exclude}","</a>","{{/if}}",'{{if occurrences[$index].type === "rdate"}}','<a date="${occurrences[$index].date}" href="#"','class="${occurrences[$index].type}" title="${i18n.remove}" >',"${i18n.remove}","</a>","{{/if}}",'{{if occurrences[$index].type === "exdate"}}','<a date="${occurrences[$index].date}" href="#"','class="${occurrences[$index].type}" title="${i18n.include}">',"${i18n.include}","</a>","{{/if}}","</span>","{{/if}}","</div>","{{/each}}",'<div class="batching">',"{{each batch.batches}}",'{{if $index === batch.currentBatch}}<span class="current">{{/if}}','<a href="#" start="${batch.batches[$index][0]}">[${batch.batches[$index][0]} - ${batch.batches[$index][1]}]</a>',"{{if $index === batch.currentBatch}}</span>{{/if}}","{{/each}}","</div></div>"].join("\n");e.template("occurrenceTmpl",t);var i=['<div class="ridisplay">','<div class="rimain">',"{{if !readOnly}}",'<button name="riedit">${i18n.add_rules}</button>','<button name="ridelete" style="display:none">${i18n.delete_rules}</button>',"{{/if}}",'<label class="ridisplay">${i18n.displayUnactivate}</label>',"</div>",'<div class="rioccurrences" style="display:none" /></div>'].join("\n");e.template("displayTmpl",i);var r=['<div class="riform">',"<form>","<h1>${i18n.title}</h1>",'<div id="messagearea" style="display: none;">',"</div>",'<div id="rirtemplate">','<label for="${name}rtemplate" class="label">',"${i18n.recurrenceType}","</label>",'<select id="rirtemplate" name="rirtemplate" class="field">',"{{each rtemplate}}",'<option value="${$index}">${i18n.rtemplate[$index]}</value>',"{{/each}}","</select>","<div>",'<div id="riformfields">','<div id="ridailyinterval" class="rifield">','<label for="${name}dailyinterval" class="label">',"${i18n.dailyInterval1}","</label>",'<div class="field">','<input type="text" size="2"','value="1"','name="ridailyinterval"','id="${name}dailyinterval" />',"${i18n.dailyInterval2}","</div>","</div>",'<div id="riweeklyinterval" class="rifield">','<label for="${name}weeklyinterval" class="label">',"${i18n.weeklyInterval1}","</label>",'<div class="field">','<input type="text" size="2"','value="1"','name="riweeklyinterval"','id="${name}weeklyinterval"/>',"${i18n.weeklyInterval2}","</div>","</div>",'<div id="riweeklyweekdays" class="rifield">','<label for="${name}weeklyinterval" class="label">${i18n.weeklyWeekdays}</label>','<div class="field">',"{{each orderedWeekdays}}",'<div class="riweeklyweekday">','<input type="checkbox"','name="riweeklyweekdays${weekdays[$value]}"','id="${name}weeklyWeekdays${weekdays[$value]}"','value="${weekdays[$value]}" />','<label for="${name}weeklyWeekdays${weekdays[$value]}">${i18n.shortWeekdays[$value]}</label>',"</div>","{{/each}}","</div>","</div>",'<div id="rimonthlyinterval" class="rifield">','<label for="rimonthlyinterval" class="label">${i18n.monthlyInterval1}</label>','<div class="field">','<input type="text" size="2"','value="1" ','name="rimonthlyinterval"/>',"${i18n.monthlyInterval2}","</div>","</div>",'<div id="rimonthlyoptions" class="rifield">','<label for="rimonthlytype" class="label">${i18n.monthlyRepeatOn}</label>','<div class="field">',"<div>","<input",'type="radio"','value="DAYOFMONTH"','name="rimonthlytype"','id="${name}monthlytype:DAYOFMONTH" />','<label for="${name}monthlytype:DAYOFMONTH">',"${i18n.monthlyDayOfMonth1}","</label>",'<select name="rimonthlydayofmonthday"','id="${name}monthlydayofmonthday">',"{{each [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,","18,19,20,21,22,23,24,25,26,27,28,29,30,31]}}",'<option value="${$value}">${$value}</option>',"{{/each}}","</select>","${i18n.monthlyDayOfMonth2}","</div>","<div>","<input",'type="radio"','value="WEEKDAYOFMONTH"','name="rimonthlytype"','id="${name}monthlytype:WEEKDAYOFMONTH" />','<label for="${name}monthlytype:WEEKDAYOFMONTH">',"${i18n.monthlyWeekdayOfMonth1}","</label>",'<select name="rimonthlyweekdayofmonthindex">',"{{each i18n.orderIndexes}}",'<option value="${orderIndexes[$index]}">${$value}</option>',"{{/each}}","</select>","${i18n.monthlyWeekdayOfMonth2}",'<select name="rimonthlyweekdayofmonth">',"{{each orderedWeekdays}}",'<option value="${weekdays[$value]}">${i18n.weekdays[$value]}</option>',"{{/each}}","</select>","${i18n.monthlyWeekdayOfMonth3}","</div>","</div>","</div>",'<div id="riyearlyinterval" class="rifield">','<label for="riyearlyinterval" class="label">${i18n.yearlyInterval1}</label>','<div class="field">','<input type="text" size="2"','value="1" ','name="riyearlyinterval"/>',"${i18n.yearlyInterval2}","</div>","</div>",'<div id="riyearlyoptions" class="rifield">','<label for="riyearlyType" class="label">${i18n.yearlyRepeatOn}</label>','<div class="field">',"<div>","<input",'type="radio"','value="DAYOFMONTH"','name="riyearlyType"','id="${name}yearlytype:DAYOFMONTH" />','<label for="${name}yearlytype:DAYOFMONTH">',"${i18n.yearlyDayOfMonth1}","</label>",'<select name="riyearlydayofmonthmonth">',"{{each i18n.months}}",'<option value="${$index+1}">${$value}</option>',"{{/each}}","</select>","${i18n.yearlyDayOfMonth2}",'<select name="riyearlydayofmonthday">',"{{each [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,","18,19,20,21,22,23,24,25,26,27,28,29,30,31]}}",'<option value="${$value}">${$value}</option>',"{{/each}}","</select>","${i18n.yearlyDayOfMonth3}","</div>","<div>","<input",'type="radio"','value="WEEKDAYOFMONTH"','name="riyearlyType"','id="${name}yearlytype:WEEKDAYOFMONTH"/>','<label for="${name}yearlytype:WEEKDAYOFMONTH">',"${i18n.yearlyWeekdayOfMonth1}","</label>",'<select name="riyearlyweekdayofmonthindex">',"{{each i18n.orderIndexes}}",'<option value="${orderIndexes[$index]}">${$value}</option>',"{{/each}}","</select>",'<label for="${name}yearlytype:WEEKDAYOFMONTH">',"${i18n.yearlyWeekdayOfMonth2}","</label>",'<select name="riyearlyweekdayofmonthday">',"{{each orderedWeekdays}}",'<option value="${weekdays[$value]}">${i18n.weekdays[$value]}</option>',"{{/each}}","</select>","${i18n.yearlyWeekdayOfMonth3}",'<select name="riyearlyweekdayofmonthmonth">',"{{each i18n.months}}",'<option value="${$index+1}">${$value}</option>',"{{/each}}","</select>","${i18n.yearlyWeekdayOfMonth4}","</div>","</div>","</div>",'<div id="rirangeoptions" class="rifield">','<label class="label">${i18n.range}</label>','<div class="field">',"{{if hasRepeatForeverButton}}","<div>","<input",'type="radio"','value="NOENDDATE"','name="rirangetype"','id="${name}rangetype:NOENDDATE"/>','<label for="${name}rangetype:NOENDDATE">',"${i18n.rangeNoEnd}","</label>","</div>","{{/if}}","<div>","<input",'type="radio"','checked="checked"','value="BYOCCURRENCES"','name="rirangetype"','id="${name}rangetype:BYOCCURRENCES"/>','<label for="${name}rangetype:BYOCCURRENCES">',"${i18n.rangeByOccurrences1}","</label>","<input",'type="text" size="3"','value="7"','name="rirangebyoccurrencesvalue" />',"${i18n.rangeByOccurrences2}","</div>","<div>","<input",'type="radio"','value="BYENDDATE"','name="rirangetype"','id="${name}rangetype:BYENDDATE"/>','<label for="${name}rangetype:BYENDDATE">',"${i18n.rangeByEndDate}","</label>","<input",'type="date"','name="rirangebyenddatecalendar" />',"</div>","</div>","</div>","</div>",'<div class="rioccurrencesactions">','<div class="rioccurancesheader">',"<h2>${i18n.preview}</h2>",'<span class="refreshbutton action">','<a class="rirefreshbutton" href="#" title="${i18n.refresh}">',"${i18n.refresh}","</a>","</span>","</div>","</div>",'<div class="rioccurrences">',"</div>",'<div class="rioccurrencesactions">','<div class="rioccurancesheader">',"<h2>${i18n.addDate}</h2>","</div>",'<div class="riaddoccurrence">','<div class="errorarea"></div>','<input type="date" name="adddate" id="adddate" />','<input type="button" name="addaction" id="addaction" value="${i18n.add}">',"</div>","</div>",'<div class="ributtons">',"<input",'type="submit"','class="ricancelbutton ${ributtonExtraClass}"','value="${i18n.cancel}" />',"<input",'type="submit"','class="risavebutton ${ributtonExtraClass}"','value="${i18n.save}" />',"</div>","</form></div>"].join("\n");e.template("formTmpl",r);var l=/d{1,4}|m{1,4}|yy(?:yy)?|"[^"]*"|'[^']*'/g;function d(e,a){for(e=e.toString(),a=a||2;e.length<a;)e="0"+e;return e}function s(e,a,n){var t=e.getDate(),i=e.getDay(),r=e.getMonth(),s=e.getFullYear(),o={d:t,dd:d(t),ddd:n.i18n.shortWeekdays[i],dddd:n.i18n.weekdays[i],m:r+1,mm:d(r+1),mmm:n.i18n.shortMonths[r],mmmm:n.i18n.months[r],yy:String(s).slice(2),yyyy:s};return a.replace(l,(function(e){return o.hasOwnProperty(e)?o[e]:e.slice(1,e.length-1)}))}function o(a,n,t){var i,r,l,d,o,c,y,u,h,p,f,v,m=a.find("select[name=rirtemplate]").val(),k=n.rtemplate[m],D=k.rrule,E=n.i18n.rtemplate[m];for(d=0;d<k.fields.length;d++)switch((i=a.find("#"+k.fields[d])).attr("id")){case"ridailyinterval":"1"!==(f=i.find("input[name=ridailyinterval]").val())&&(D+=";INTERVAL="+f),E=f+" "+n.i18n.dailyInterval2;break;case"riweeklyinterval":"1"!==(f=i.find("input[name=riweeklyinterval]").val())&&(D+=";INTERVAL="+f),E=f+" "+n.i18n.weeklyInterval2;break;case"riweeklyweekdays":for(r="",l="",o=0;o<n.weekdays.length;o++)i.find("input[name=riweeklyweekdays"+n.weekdays[o]+"]").is(":checked")&&(r&&(r+=",",l+=", "),r+=n.weekdays[o],l+=n.i18n.weekdays[o]);r&&(D+=";BYDAY="+r,E+=" "+n.i18n.weeklyWeekdaysHuman+" "+l);break;case"rimonthlyinterval":"1"!==(f=i.find("input[name=rimonthlyinterval]").val())&&(D+=";INTERVAL="+f),E=f+" "+n.i18n.monthlyInterval2;break;case"rimonthlyoptions":switch(e("input[name=rimonthlytype]:checked",a).val()){case"DAYOFMONTH":D+=";BYMONTHDAY="+(u=e("select[name=rimonthlydayofmonthday]",a).val()),E+=", "+n.i18n.monthlyDayOfMonth1Human+" "+u+" "+n.i18n.monthlyDayOfMonth2;break;case"WEEKDAYOFMONTH":c=e("select[name=rimonthlyweekdayofmonthindex]",a).val(),u=e("select[name=rimonthlyweekdayofmonth]",a).val(),e.inArray(u,["MO","TU","WE","TH","FR","SA","SU"])>-1&&(D+=";BYDAY="+c+u,E+=", "+n.i18n.monthlyWeekdayOfMonth1Human+" ",E+=" "+n.i18n.orderIndexes[e.inArray(c,n.orderIndexes)],E+=" "+n.i18n.monthlyWeekdayOfMonth2,E+=" "+n.i18n.weekdays[e.inArray(u,n.weekdays)],E+=" "+n.i18n.monthlyDayOfMonth2)}break;case"riyearlyinterval":"1"!==(f=i.find("input[name=riyearlyinterval]").val())&&(D+=";INTERVAL="+f),E=f+" "+n.i18n.yearlyInterval2;break;case"riyearlyoptions":switch(e("input[name=riyearlyType]:checked",a).val()){case"DAYOFMONTH":D+=";BYMONTH="+(h=e("select[name=riyearlydayofmonthmonth]",a).val()),D+=";BYMONTHDAY="+(u=e("select[name=riyearlydayofmonthday]",a).val()),E+=", "+n.i18n.yearlyDayOfMonth1Human+" "+n.i18n.months[h-1]+" "+u;break;case"WEEKDAYOFMONTH":c=e("select[name=riyearlyweekdayofmonthindex]",a).val(),u=e("select[name=riyearlyweekdayofmonthday]",a).val(),D+=";BYMONTH="+(h=e("select[name=riyearlyweekdayofmonthmonth]",a).val()),e.inArray(u,["MO","TU","WE","TH","FR","SA","SU"])>-1&&(D+=";BYDAY="+c+u,E+=", "+n.i18n.yearlyWeekdayOfMonth1Human,E+=" "+n.i18n.orderIndexes[e.inArray(c,n.orderIndexes)],E+=" "+n.i18n.yearlyWeekdayOfMonth2,E+=" "+n.i18n.weekdays[e.inArray(u,n.weekdays)],E+=" "+n.i18n.yearlyWeekdayOfMonth3,E+=" "+n.i18n.months[h-1],E+=" "+n.i18n.yearlyWeekdayOfMonth4)}break;case"rirangeoptions":switch(a.find("input[name=rirangetype]:checked").val()){case"BYOCCURRENCES":D+=";COUNT="+(v=a.find("input[name=rirangebyoccurrencesvalue]").val()),E+=", "+n.i18n.rangeByOccurrences1Human,E+=" "+v,E+=" "+n.i18n.rangeByOccurrences2;break;case"BYENDDATE":D+=";UNTIL="+(i=a.find("input[name=rirangebyenddatecalendar]")).data("dateinput").getValue("yyyymmdd")+"T000000",!0===t&&(D+="Z"),E+=", "+n.i18n.rangeByEndDateHuman,E+=" "+i.data("dateinput").getValue(n.i18n.longDateFormat)}}if(void 0!==a.ical.RDATE&&a.ical.RDATE.length>0){for(a.ical.RDATE.sort(),y=[],d=0;d<a.ical.RDATE.length;d++)""!==a.ical.RDATE[d]&&(p=parseInt(a.ical.RDATE[d].substring(0,4),10),h=parseInt(a.ical.RDATE[d].substring(4,6),10)-1,u=parseInt(a.ical.RDATE[d].substring(6,8),10),y.push(s(new Date(p,h,u),n.i18n.longDateFormat,n)));0!==y.length&&(E=E+n.i18n.including+" "+y.join("; "))}if(void 0!==a.ical.EXDATE&&a.ical.EXDATE.length>0){for(a.ical.EXDATE.sort(),y=[],d=0;d<a.ical.EXDATE.length;d++)""!==a.ical.EXDATE[d]&&(p=parseInt(a.ical.EXDATE[d].substring(0,4),10),h=parseInt(a.ical.EXDATE[d].substring(4,6),10)-1,u=parseInt(a.ical.EXDATE[d].substring(6,8),10),y.push(s(new Date(p,h,u),n.i18n.longDateFormat,n)));0!==y.length&&(E=E+n.i18n.except+" "+y.join("; "))}return D="RRULE:"+D,void 0!==a.ical.EXDATE&&""!==a.ical.EXDATE.join()&&(D=D+"\nEXDATE:"+(y=e.map(a.ical.EXDATE,(function(e){return 8===e.length&&(e+="T000000"),!0===t&&(e+="Z"),e})))),void 0!==a.ical.RDATE&&""!==a.ical.RDATE.join()&&(D=D+"\nRDATE:"+(y=e.map(a.ical.RDATE,(function(e){return 8===e.length&&(e+="T000000"),!0===t&&(e+="Z"),e})))),{result:D,description:E}}function c(e){var a={},n=e.indexOf(":"),t=e.substring(0,n);return a.value=e.substring(n+1),-1!==t.indexOf(";")?(n=t.indexOf(";"),a.parameters=t.substring(n+1),a.property=t.substring(0,n)):(a.parameters=null,a.property=t),a}function y(e){var a,n=[],t=e.split(",");for(a in t)t.hasOwnProperty(a)&&(-1!==t[a].indexOf("Z")?n.push(t[a].substring(0,15)):n.push(t[a]));return n}function u(a,n,t,i){var r,l,d,s,o,u,h,p,f,v,m,k,D,E,b,g,O,$,w,T,A,R=[];if(a.ical=function(e){var a,n=[],t={},i=null;for((n=e.split("\n")).reverse();;){if(n.length>0){if(" "===(a=n.pop()).charAt(0)||"\t"===a.charAt(0)){i+=a;continue}}else a="";if(null!==i&&("RDATE"===(i=c(i)).property||"EXDATE"===i.property?t[i.property]=y(i.value):t[i.property]=i.value),""===(i=a))break}return t}(t),void 0===a.ical.RRULE){if(R.push(n.i18n.noRule),!i)return-1}else{for(r in k=(l=/INTERVAL=([0-9]+);?/.exec(a.ical.RRULE))?l[1]:"1",D=(l=/BYDAY=([^;]+);?/.exec(a.ical.RRULE))?l[1]:"",b=(l=/BYMONTHDAY=([^;]+);?/.exec(a.ical.RRULE))?l[1].split(","):null,E=(l=/BYMONTH=([^;]+);?/.exec(a.ical.RRULE))?l[1].split(","):null,g=(l=/COUNT=([0-9]+);?/.exec(a.ical.RRULE))?l[1]:null,O=(l=/UNTIL=([0-9T]+);?/.exec(a.ical.RRULE))?l[1]:null,(l=/BYSETPOS=([^;]+);?/.exec(a.ical.RRULE))&&R.push(n.i18n.bysetpos),d="",s=null,n.rtemplate)n.rtemplate.hasOwnProperty(r)&&(o=n.rtemplate[r],0===a.ical.RRULE.indexOf(o.rrule)&&a.ical.RRULE.length>d.length&&(d=a.ical.RRULE,s=r));if(d)o=n.rtemplate[s],a.find("select[name=rirtemplate]").val(s);else{for(o in n.rtemplate)if(n.rtemplate.hasOwnProperty(o)){o=n.rtemplate[o];break}R.push(n.i18n.noTemplateMatch)}for(r=0;r<o.fields.length;r++)switch((v=a.find("#"+o.fields[r])).attr("id")){case"ridailyinterval":v.find("input[name=ridailyinterval]").val(k);break;case"riweeklyinterval":v.find("input[name=riweeklyinterval]").val(k);break;case"riweeklyweekdays":for(D=D.split(","),u=0;u<n.weekdays.length;u++)$=n.weekdays[u],(h=v.find("input[name=riweeklyweekdays"+$+"]")).attr("checked",-1!==e.inArray($,D));break;case"rimonthlyinterval":v.find("input[name=rimonthlyinterval]").val(k);break;case"rimonthlyoptions":var x="DAYOFMONTH";for(b&&(x="DAYOFMONTH",b.length>1&&(R.push(n.i18n.multipleDayOfMonth),b=b[0]),v.find("select[name=rimonthlydayofmonthday]").val(b)),D&&(x="WEEKDAYOFMONTH",-1!==D.indexOf(",")&&(R.push(n.i18n.multipleDayOfMonth),D=D.split(",")[0]),"+"!==(p=D.slice(0,-2)).charAt(0)&&"-"!==p.charAt(0)&&(p="+"+p),A=D.slice(-2),v.find("select[name=rimonthlyweekdayofmonthindex]").val(p),v.find("select[name=rimonthlyweekdayofmonth]").val(A)),f=v.find("input[name=rimonthlytype]"),p=0;p<f.length;p++)m=f[p],e(m).attr("checked",m.value===x);break;case"riyearlyinterval":v.find("input[name=riyearlyinterval]").val(k);break;case"riyearlyoptions":var M="DAYOFMONTH";for(b&&(M="DAYOFMONTH",b.length>1&&(R.push(n.i18n.multipleDayOfMonth),b=b[0]),v.find("select[name=riyearlydayofmonthmonth]").val(E),v.find("select[name=riyearlydayofmonthday]").val(b)),D&&(M="WEEKDAYOFMONTH",-1!==D.indexOf(",")&&(R.push(n.i18n.multipleDayOfMonth),D=D.split(",")[0]),"+"!==(p=D.slice(0,-2)).charAt(0)&&"-"!==p.charAt(0)&&(p="+"+p),A=D.slice(-2),v.find("select[name=riyearlyweekdayofmonthindex]").val(p),v.find("select[name=riyearlyweekdayofmonthday]").val(A),v.find("select[name=riyearlyweekdayofmonthmonth]").val(E)),f=v.find("input[name=riyearlyType]"),p=0;p<f.length;p++)m=f[p],e(m).attr("checked",m.value===M);break;case"rirangeoptions":var N="NOENDDATE";for(g&&(N="BYOCCURRENCES",v.find("input[name=rirangebyoccurrencesvalue]").val(g)),O&&(N="BYENDDATE",h=v.find("input[name=rirangebyenddatecalendar]"),T=O.slice(0,4),w=O.slice(4,6),w=parseInt(w,10)-1,$=O.slice(6,8),h.data("dateinput").setValue(new Date(T,w,$))),f=v.find("input[name=rirangetype]"),p=0;p<f.length;p++)m=f[p],e(m).attr("checked",m.value===N)}}var Y=a.find("#messagearea");return 0!==R.length?(Y.text(n.i18n.unsupportedFeatures+" "+R.join("; ")),Y.show(),1):(Y.text(""),Y.hide(),0)}function h(a,t){var i,r,l,d,c=[];for(d=0;d<7;d++)(l=d+a.firstDay)>6&&(l-=7),c.push(l);function y(e){var n;i.find(".rifield").hide();var t=e.val();if(t){var r=a.rtemplate[t];for(n=0;n<r.fields.length;n++)i.find("#"+r.fields[n]).show()}}function h(a){a.preventDefault(),void 0===i.ical.EXDATE&&(i.ical.EXDATE=[]),i.ical.EXDATE.push(this.attributes.date.value);var n=e(this);n.attr("class","exdate"),n.parent().parent().addClass("exdate"),n.unbind(a),n.click(p)}function p(a){a.preventDefault(),i.ical.EXDATE.splice(e.inArray(this.attributes.date.value,i.ical.EXDATE),1);var n=e(this);n.attr("class","rrule"),n.parent().parent().removeClass("exdate"),n.unbind(a),n.click(h)}function f(a){a.preventDefault(),i.ical.RDATE.splice(e.inArray(this.attributes.date.value,i.ical.RDATE),1),e(this).parent().parent().hide("slow",(function(){e(this).remove()}))}function v(n,t,l,d){(d?r:i).find(".rioccurrences").hide();var o={year:n.getFullYear(),month:n.getMonth()+1,day:n.getDate(),rrule:t,format:a.i18n.longDateFormat,start:l},c={url:a.ajaxURL,async:!1,type:"post",dataType:"json",contentType:a.ajaxContentType,cache:!1,data:o,success:function(l,o,c){var y,u,m,k,D,E,b,g;for(g in u=d?r:i,l.readOnly=d,l.i18n=a.i18n,l.occurrences)l.occurrences.hasOwnProperty(g)&&(k=(m=l.occurrences[g]).date,D=parseInt(k.substring(0,4),10),E=parseInt(k.substring(4,6),10)-1,b=parseInt(k.substring(6,8),10),m.formattedDate=s(new Date(D,E,b),a.i18n.longDateFormat,a));y=e.tmpl("occurrenceTmpl",l),u.find(".rioccurrences").replaceWith(y),u.find(".rioccurrences .batching a").click((function(e){e.preventDefault(),v(n,t,this.attributes.start.value,d)})),d||(u.find(".rioccurrences .action a.rrule").click(h),u.find(".rioccurrences .action a.exdate").click(p),u.find(".rioccurrences .action a.rdate").click(f)),u.find(".rioccurrences").show()},error:function(e,a,n){alert(a)}};e.ajax(c)}function m(a){var n=e(a);return n.length||(n=e("#"+a)),n.length||(n=e("input[name='"+a+"']")),n}function k(){var e,n,t,i,r=null;if(a.startField){if(!(e=m(a.startField)).length)return null;(r=e.data("dateinput"))?r=r.getValue():""===(r=e.val())&&(r=e.text()),"string"==typeof r&&(r=r.replace(" ","T")),r=new Date(r)}else if(a.startFieldYear&&a.startFieldMonth&&a.startFieldDay){if(n=m(a.startFieldYear),t=m(a.startFieldMonth),i=m(a.startFieldDay),!n.length&&!t.length&&!i.length)return null;r=new Date(n.val(),t.val()-1,i.val())}return null===r||isNaN(r)?null:r}function D(e,a){var n,t;return t=(n=a.find("input[name="+e+"]")).val(),isNaN(t)||-1!==t.toString().indexOf(".")||""===n.val()?null:t}function E(e){var n,t,r;e&&u(i,a,e,!0),null!==(n=k())?(i.find("select[name=rimonthlydayofmonthday]").val(n.getDate()),t=a.orderIndexes[Math.floor((n.getDate()-1)/7)],r=a.weekdays[n.getDay()],i.find("select[name=rimonthlyweekdayofmonthindex]").val(t),i.find("select[name=rimonthlyweekdayofmonth]").val(r),i.find("select[name=riyearlydayofmonthmonth]").val(n.getMonth()+1),i.find("select[name=riyearlydayofmonthday]").val(n.getDate()),i.find("select[name=riyearlyweekdayofmonthindex]").val(t),i.find("select[name=riyearlyweekdayofmonthday]").val(r),i.find("select[name=riyearlyweekdayofmonthmonth]").val(n.getMonth()+1),v(n,o(i,a,!1).result,0,!1),i.find("div.rioccurrencesactions").show()):i.find("div.rioccurrencesactions").hide(),y(i.find("select[name=rirtemplate]"))}function b(){var e=o(i,a,!1);r.find("label[class=ridisplay]").text(a.i18n.displayActivate+" "+e.description),t.val(e.result).change();var n=k();null!==n&&v(n,o(i,a,!1).result,0,!0),r.find('button[name="riedit"]').text(a.i18n.edit_rules),r.find('button[name="ridelete"]').show()}function g(e){var n,t,i,r;if(n=k(),(r=e.find("#messagearea")).text(""),r.hide(),e.find(".riaddoccurrence div.errorarea").text("").hide(),"block"===e.find("#ridailyinterval").css("display")&&(!(i=D("ridailyinterval",e))||i<1||i>1e3))return r.text(a.i18n.noRepeatEvery).show(),!1;if("block"===e.find("#riweeklyinterval").css("display")&&(!(i=D("riweeklyinterval",e))||i<1||i>1e3))return r.text(a.i18n.noRepeatEvery).show(),!1;if("block"===e.find("#rimonthlyinterval").css("display")){if(!(i=D("rimonthlyinterval",e))||i<1||i>1e3)return r.text(a.i18n.noRepeatEvery).show(),!1;if(0===e.find("#rimonthlyoptions input:checked").length)return r.text(a.i18n.noRepeatOn).show(),!1}if("block"===e.find("#riyearlyinterval").css("display")){if(!(i=D("riyearlyinterval",e))||i<1||i>1e3)return r.text(a.i18n.noRepeatEvery).show(),!1;if(0===e.find("#riyearlyoptions input:checked").length)return r.text(a.i18n.noRepeatOn).show(),!1}if(e.find('input[value="BYOCCURRENCES"]:visible:checked').length>0&&(!(i=D("rirangebyoccurrencesvalue",e))||i<1||i>1e3))return r.text(a.i18n.noEndAfterNOccurrences).show(),!1;if(e.find('input[value="BYENDDATE"]:visible:checked').length>0){if(t=function(e){var a,n;return n=(n=(a=e.find("input[name=rirangebyenddatecalendar]")).data("dateinput"))?n.getValue():a.val(),n=new Date(n),isNaN(n)||""===a.val()?null:n}(e),!t)return r.text(a.i18n.noEndDate).show(),!1;if(t<n)return r.text(a.i18n.pastEndDate).show(),!1}return!0}function O(e){e.preventDefault(),g(i)&&(i.overlay().close(),b())}function $(){var e;e=k(),g(i)&&v(e,o(i,a,!1).result,0,!1)}(e.extend(a,{orderIndexes:["+1","+2","+3","+4","-1"],weekdays:["SU","MO","TU","WE","TH","FR","SA"],orderedWeekdays:c}),r=e.tmpl("displayTmpl",a),(i=e.tmpl("formTmpl",a)).overlay(a.formOverlay).hide(),i.ical={RDATE:[],EXDATE:[]},e.tools.dateinput.localize(a.lang,{months:n[a.lang].months.join(),shortMonths:n[a.lang].shortMonths.join(),days:n[a.lang].weekdays.join(),shortDays:n[a.lang].shortWeekdays.join()}),i.find("input[name=rirangebyenddatecalendar]").dateinput({selectors:!0,lang:a.lang,format:a.i18n.shortDateFormat,firstDay:a.firstDay,yearRange:[-5,10]}).data("dateinput").setValue(new Date),t.val())&&(-1===u(i,a,t.val(),!1)?r.find("label[class=ridisplay]").text(a.i18n.noRule):b());r.find("button[name=ridelete]").click((function(e){e.preventDefault(),r.find("label[class=ridisplay]").text(a.i18n.displayUnactivate),t.val("").change(),r.find(".rioccurrences").hide(),r.find('button[name="riedit"]').text(a.i18n.add_rules),r.find('button[name="ridelete"]').hide()})),r.find("button[name=riedit]").click((function(e){E(t.val()),e.preventDefault(),i.overlay().load()})),i.find("div.riaddoccurrence input#adddate").dateinput({selectors:!0,lang:a.lang,format:a.i18n.shortDateFormat,firstDay:a.firstDay,yearRange:[-5,10]}).data("dateinput").setValue(new Date),i.find("input#addaction").click((function(n){n.preventDefault();var t=i.find(".riaddoccurrence input#adddate").data("dateinput"),r=t.getValue("yyyymmddT000000");void 0===i.ical.RDATE&&(i.ical.RDATE=[]);var l=i.find(".riaddoccurrence div.errorarea");if(l.text(""),l.hide(),-1===e.inArray(r,i.ical.RDATE)){i.ical.RDATE.push(r);var d=['<div class="occurrence rdate" style="display: none;">','<span class="rdate">',t.getValue(a.i18n.longDateFormat),'<span class="rlabel">'+a.i18n.additionalDate+"</span>","</span>",'<span class="action">','<a date="'+r+'" href="#" class="rdate" >',"Include","</a>","</span>","</div>"].join("\n");i.find("div.rioccurrences").prepend(d),e(i.find("div.rioccurrences div")[0]).slideDown(),e(i.find("div.rioccurrences .action a.rdate")[0]).click(f)}else l.text(a.i18n.alreadyAdded).show()})),i.find("a.rirefreshbutton").click((function(e){e.preventDefault(),$()})),i.find("select[name=rirtemplate]").change((function(a){y(e(this))})),i.find("select").change((function(a){e(this).parent().find("> input").click().change()})),i.find("input[name=rirangebyoccurrencesvalue]").change((function(a){e(this).parent().find("input[name=rirangetype]").click().change()})),i.find("input[name=rirangebyenddatecalendar]").change((function(){e(this).parent().find("input[name=rirangetype]").click(),0!==i.find(".rioccurrencesactions:visible").length&&$()})),i.find("input:radio, .riweeklyweekday > input, input[name=ridailyinterval], input[name=riweeklyinterval], input[name=rimonthlyinterval], input[name=riyearlyinterval]").change((function(e){0!==i.find(".rioccurrencesactions:visible").length&&$()})),i.find(".ricancelbutton").click((function(e){e.preventDefault(),i.overlay().close()})),i.find(".risavebutton").click(O),e.extend(this,{display:r,form:i,loadData:E,save:O})}e.fn.recurrenceinput=function(t){if(this.data("recurrenceinput"))return this.data("recurrenceinput");var i=e.extend({},a.conf);e.extend(i,t),e.extend(i,{i18n:n[i.lang],name:this.attr("name")});var r=new h(i,this);return r.form.appendTo("body"),this.after(r.display),this.hide(),this.data("recurrenceinput",r),r}}(jQuery)}}]);