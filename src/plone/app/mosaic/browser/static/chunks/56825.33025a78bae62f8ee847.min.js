"use strict";(self.webpackChunkplone_mosaic=self.webpackChunkplone_mosaic||[]).push([[56825],{56825:function(t,e,a){a.r(e),a.d(e,{default:function(){return n}});var i=a(10878),r=a.n(i);function o(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var n=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.el=e}var e,a,i;return e=t,(a=[{key:"init",value:function(){r()("#form fieldset",this.el).length>=2?r()("#form .autotoc-nav > a",this.el).length?this.init_schemaeditor():r()(window).on("init.autotoc.patterns",this.init_schemaeditor):init_schemaeditor()}},{key:"init_add_field",value:function(t){if(t){var e=r()("a#add-field",this.el),a=e.attr("href").split("?")[0];e.attr("href",a+"?fieldset_id="+t)}}},{key:"init_schemaeditor",value:function(){r()("a.schemaeditor-delete-field",this.el).click((function(t){var e=r()(this);t.preventDefault(),window.confirm(e.attr("data-confirm_msg"))&&r().post(e.attr("href"),{_authenticator:r()('input[name="_authenticator"]',this.el).val()},(function(t){e.closest(".fieldPreview").detach()}),"text")})),r()("body").on("focusout","#form-widgets-title, #form-widgets-label",(function(){var t=r().plone_schemaeditor_normalize_string(r()(this).val());r()("#form-widgets-__name__",this.el).val(t)})),r()(".fieldPreview.orderable",this.el).plone_schemaeditor_html5_sortable((function(t,e){var a=[location.protocol,"//",location.host,location.pathname.replace("/@@fields",""),"/",this.attr("data-field_id"),"/@@order"].join("");r().post(a,{_authenticator:r()('input[name="_authenticator"]',this.el).val(),pos:t,fieldset_index:e})}),(function(t){var e=[location.protocol,"//",location.host,location.pathname.replace("/@@fields",""),"/",this.attr("data-field_id"),"/@@changefieldset"].join("");r().post(e,{_authenticator:r()('input[name="_authenticator"]',this.el).val(),fieldset_index:t})})),r()("#form .autotoc-nav > a",this.el).each((function(){r()(this).on("click",(function(t){t.preventDefault();var e=r()(this).attr("data-fieldset_drag_id");this.init_add_field(e)}))}));var t=r()("#form .autotoc-nav > a.active",this.el).attr("data-fieldset_drag_id");this.init_add_field(t)}}])&&o(e.prototype,a),i&&o(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();r().plone_schemaeditor_normalize_string=function(t){t=t.toLowerCase();var e={a:/[àáâãäå]/g,ae:/[æ]/g,c:/[ç]/g,e:/[èéêë]/g,i:/[ìíîï]/g,n:/[ñ]/g,o:/[òóôõö]/g,oe:/[œ]/g,u:/[ùúûü]/g,y:/[ýÿ]/g,th:/[ðþ]/g,ss:/[ß]/g,_:/[\s\\]+/g};for(var a in e)t=t.replace(e[a],a);return t.replace(/[^a-z0-9_]/g,"_")},r().fn.plone_schemaeditor_html5_sortable=function(t,e){this.attr("draggable","true").css("-webkit-user-drag","element").each((function(e){r()(this).attr("data-drag_id",e),this.ondragstart=function(t){t.dataTransfer.setData("Text",r()(this).attr("data-drag_id")),t.dataTransfer.setData("draggable",!0),r()('<div id="drop-marker" style="position: absolute; width: 100%;"></div>').insertBefore(this)},this.ondragenter=function(t){return!1},this.ondragleave=function(t){return!1},this.ondragover=function(t){var e=r()(this).position(),a=r()(this).height(),i=r()("#drop-marker");return i.css("border-bottom","5px dotted red"),t.pageY<r()(this).offset().top+a/2?(i.css("top",e.top+1+"px"),r()(this).attr("draghalf","top")):(i.css("top",e.top+a+21+"px"),r()(this).attr("draghalf","bottom")),r()("html,body").is(":animated")||(r()(window).scrollTop()+r()(window).height()-t.pageY<30?r()("html,body").animate({scrollTop:r()(window).scrollTop()+50},200):t.pageY-r()(window).scrollTop()<30&&r()("html,body").animate({scrollTop:r()(window).scrollTop()-50},200)),!1},this.ondrop=function(e){e.preventDefault();var a=e.dataTransfer.getData("Text"),i=r()("[data-drag_id="+a+"]");if(r()(this).attr("data-drag_id")!==a){"top"===r()(this).attr("draghalf")?i.insertBefore(this):i.insertAfter(this);var o=r()(this).parents("fieldset").first().find("legend").attr("data-fieldset_drag_id"),n=i.parent().children("[data-drag_id]").index(i);t.apply(i,[n,o])}},this.ondragend=function(t){r()("#drop-marker").remove()}})),r()("#form .autotoc-nav > a").attr("droppable","true").each((function(t){r()(this).attr("data-fieldset_drag_id",t)})),r()("#form fieldset legend").attr("droppable","true").each((function(t){r()(this).attr("data-fieldset_drag_id",t)})),r()("#form .autotoc-nav > a, #form fieldset legend").attr("droppable","true").each((function(){this.ondrop=function(t){t.preventDefault();var a=t.dataTransfer.getData("Text"),i=r()("[data-drag_id="+a+"]"),o=i.parents("fieldset").attr("id").split("-")[1],n=r()(this).attr("data-fieldset_drag_id");if(o!=n){var s=r()("#fieldset-"+n),d=(r()(this).height(),r()(this).width(),r()(this).position());i.animate({top:d.top-i.position().top,left:d.left-i.position().left,width:"50%",opacity:"0"},1e3,(function(){i.appendTo(s),i.css("left",""),i.css("top",""),i.css("width",""),i.css("opacity","")})),e.apply(i,[n])}r()(this).css("border","")},this.ondragover=function(t){return t.preventDefault(),t.dataTransfer.getData("draggable")&&(r()(this).css("border","3px dotted red"),r()("#drop-marker").hide()),!1},this.ondragleave=function(t){t.preventDefault(),r()(this).css("border",""),r()("#drop-marker").show()}})),r()('<span class="draghandle">&#x28FF;</span>').css("cursor","ns-resize").prependTo(".fieldPreview.orderable .fieldLabel")}}}]);