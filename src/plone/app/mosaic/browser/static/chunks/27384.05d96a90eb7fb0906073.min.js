(self.webpackChunkplone_mosaic=self.webpackChunkplone_mosaic||[]).push([[27384],{27384:function(){!function(){"use strict";var n,t,e,r=tinymce.util.Tools.resolve("tinymce.PluginManager"),o=tinymce.util.Tools.resolve("tinymce.util.VK"),i=function(n){return function(t){return r=typeof(e=t),(null===e?"null":"object"===r&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"===r&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":r)===n;var e,r}},u=function(n){return function(t){return typeof t===n}},a=i("string"),c=i("array"),l=(n=null,function(t){return n===t}),f=u("boolean"),s=u("function"),m=function(){},g=function(n){return function(){return n}},d=function(n){return n},h=function(n,t){return n===t},v=g(!1),p=g(!0),k=function(){return y},y={fold:function(n,t){return n()},isSome:v,isNone:p,getOr:e=d,getOrThunk:t=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:g(null),getOrUndefined:g(void 0),or:e,orThunk:t,map:k,each:m,bind:k,exists:v,forall:p,filter:function(){return k()},toArray:function(){return[]},toString:g("none()")},x=function(n){var t=g(n),e=function(){return o},r=function(t){return t(n)},o={fold:function(t,e){return e(n)},isSome:p,isNone:v,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:e,orThunk:e,map:function(t){return x(t(n))},each:function(t){t(n)},bind:r,exists:r,forall:r,filter:function(t){return t(n)?o:y},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o},b={some:x,none:k,from:function(n){return null==n?y:x(n)}},O=Array.prototype.indexOf,w=Array.prototype.push,C=function(n,t){return function(n,t){return O.call(n,t)}(n,t)>-1},N=function(n){for(var t=[],e=0,r=n.length;e<r;++e){if(!c(n[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+n);w.apply(t,n[e])}return t},A=function(n,t){return N(function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var i=n[o];r[o]=t(i,o)}return r}(n,t))},T=function(n,t){for(var e=0;e<n.length;e++){var r=t(n[e],e);if(r.isSome())return r}return b.none()},P=function(n,t,e){return void 0===e&&(e=h),n.exists((function(n){return e(n,t)}))},S=function(n){for(var t=[],e=function(n){t.push(n)},r=0;r<n.length;r++)n[r].each(e);return t},_=function(n,t){return n?b.some(t):b.none()},R=function(n){var t=n.getParam("link_assume_external_targets",!1);return f(t)&&t?1:!a(t)||"http"!==t&&"https"!==t?0:t},D=function(n){return n.getParam("default_link_target")},L=function(n){return n.getParam("target_list",!0)},E=function(n){return n.getParam("rel_list",[],"array")},M=function(n){return n.getParam("link_title",!0,"boolean")},U=function(n){return n.getParam("allow_unsafe_link_target",!1,"boolean")},B=function(n){return n.getParam("link_default_protocol","http","string")},I=tinymce.util.Tools.resolve("tinymce.util.Tools"),K=function(n){return a(n.value)?n.value:""},z=function(n,t){var e=[];return I.each(n,(function(n){var r=function(n){return a(n.text)?n.text:a(n.title)?n.title:""}(n);if(void 0!==n.menu){var o=z(n.menu,t);e.push({text:r,items:o})}else{var i=t(n);e.push({text:r,value:i})}})),e},j=function(n){return void 0===n&&(n=K),function(t){return b.from(t).map((function(t){return z(t,n)}))}},V={sanitize:function(n){return j(K)(n)},sanitizeWith:j,createUi:function(n,t){return function(e){return{name:n,type:"listbox",label:t,items:e}}},getValue:K},q=function(){return q=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},q.apply(this,arguments)},F=Object.keys,W=Object.hasOwnProperty,H=function(n,t,e,r){return function(n,t){for(var e=F(n),r=0,o=e.length;r<o;r++){var i=e[r];t(n[i],i)}}(n,(function(n,o){(t(n,o)?e:r)(n,o)})),{}},G=function(n,t){return W.call(n,t)},J=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),X=tinymce.util.Tools.resolve("tinymce.util.URI"),$=function(n){return n&&"a"===n.nodeName.toLowerCase()},Q=function(n){return $(n)&&!!nn(n)},Y=function(n,t){if(n.collapsed)return[];var e=n.cloneContents(),r=new J(e.firstChild,e),o=[],i=e.firstChild;do{t(i)&&o.push(i)}while(i=r.next());return o},Z=function(n){return/^\w+:/i.test(n)},nn=function(n){var t=n.getAttribute("data-mce-href");return t||n.getAttribute("href")},tn=function(n,t){var e=["noopener"],r=n?n.split(/\s+/):[],o=function(n){return n.filter((function(n){return-1===I.inArray(e,n)}))},i=t?function(n){return(n=o(n)).length>0?n.concat(e):e}(r):o(r);return i.length>0?function(n){return I.trim(n.sort().join(" "))}(i):""},en=function(n,t){return t=t||n.selection.getNode(),an(t)?n.dom.select("a[href]",t)[0]:n.dom.getParent(t,"a[href]")},rn=function(n,t){return function(n){return n.replace(/\uFEFF/g,"")}(t?t.innerText||t.textContent:n.getContent({format:"text"}))},on=function(n){return I.grep(n,Q).length>0},un=function(n){var t=n.schema.getTextInlineElements();return 0===Y(n.selection.getRng(),(function(n){return 1===n.nodeType&&!$(n)&&!G(t,n.nodeName.toLowerCase())})).length},an=function(n){return n&&"FIGURE"===n.nodeName&&/\bimage\b/i.test(n.className)},cn=function(n,t){var e=q({},t);if(!(E(n).length>0)&&!1===U(n)){var r=tn(e.rel,"_blank"===e.target);e.rel=r||null}return b.from(e.target).isNone()&&!1===L(n)&&(e.target=D(n)),e.href=function(n,t){return"http"!==t&&"https"!==t||Z(n)?n:t+"://"+n}(e.href,R(n)),e},ln=function(n,t,e){var r=n.selection.getNode(),o=en(n,r),i=cn(n,function(n){var t,e,r;return t=["title","rel","class","target"],e=function(t,e){return n[e].each((function(n){t[e]=n.length>0?n:null})),t},r={href:n.href},function(n,t){for(var e=0,r=n.length;e<r;e++)t(n[e],e)}(t,(function(n,t){r=e(r,n,t)})),r}(e));n.undoManager.transact((function(){e.href===t.href&&t.attach(),o?(n.focus(),function(n,t,e,r){e.each((function(n){G(t,"innerText")?t.innerText=n:t.textContent=n})),n.dom.setAttribs(t,r),n.selection.select(t)}(n,o,e.text,i)):function(n,t,e,r){an(t)?dn(n,t,r):e.fold((function(){n.execCommand("mceInsertLink",!1,r)}),(function(t){n.insertContent(n.dom.createHTML("a",r,n.dom.encode(t)))}))}(n,r,e.text,i)}))},fn=function(n){var t=n.class,e=n.href,r=n.rel,o=n.target,i=n.text,u=n.title;return function(n,t){var e,r={};return H(n,t,(e=r,function(n,t){e[t]=n}),m),r}({class:t.getOrNull(),href:e,rel:r.getOrNull(),target:o.getOrNull(),text:i.getOrNull(),title:u.getOrNull()},(function(n,t){return!1===l(n)}))},sn=function(n,t,e){var r=function(n,t){var e=t.href;return q(q({},t),{href:X.isDomSafe(e,"a",n.settings)?e:""})}(n,e);n.hasPlugin("rtc",!0)?n.execCommand("createlink",!1,fn(r)):ln(n,t,r)},mn=function(n){n.hasPlugin("rtc",!0)?n.execCommand("unlink"):function(n){n.undoManager.transact((function(){var t=n.selection.getNode();an(t)?gn(n,t):function(n){var t=n.dom,e=n.selection,r=e.getBookmark(),o=e.getRng().cloneRange(),i=t.getParent(o.startContainer,"a[href]",n.getBody()),u=t.getParent(o.endContainer,"a[href]",n.getBody());i&&o.setStartBefore(i),u&&o.setEndAfter(u),e.setRng(o),n.execCommand("unlink"),e.moveToBookmark(r)}(n),n.focus()}))}(n)},gn=function(n,t){var e=n.dom.select("img",t)[0];if(e){var r=n.dom.getParents(e,"a[href]",t)[0];r&&(r.parentNode.insertBefore(e,r),n.dom.remove(r))}},dn=function(n,t,e){var r=n.dom.select("img",t)[0];if(r){var o=n.dom.create("a",e);r.parentNode.insertBefore(o,r),o.appendChild(r)}},hn=function(n){return G(t=n,e="items")&&void 0!==t[e]&&null!==t[e];var t,e},vn=function(n,t){return T(t,(function(t){return hn(t)?vn(n,t.items):_(t.value===n,t)}))},pn=function(n,t,e,r){var o=r[t],i=n.length>0;return void 0!==o?vn(o,e).map((function(t){return{url:{value:t.value,meta:{text:i?n:t.text,attach:m}},text:i?n:t.text}})):b.none()},kn=function(n,t){var e={text:n.text,title:n.title},r=function(n){var t,r=(t=n.url,_(e.text.length<=0,b.from(t.meta.text).getOr(t.value))),o=function(n){return _(e.title.length<=0,b.from(n.meta.title).getOr(""))}(n.url);return r.isSome()||o.isSome()?b.some(q(q({},r.map((function(n){return{text:n}})).getOr({})),o.map((function(n){return{title:n}})).getOr({}))):b.none()},o=function(n,r){var o,i,u=(o=t,i=r.name,"link"===i?o.link:"anchor"===i?o.anchor:b.none()).getOr([]);return pn(e.text,r.name,u,n)};return{onChange:function(n,t){var i=t.name;return"url"===i?r(n()):C(["anchor","link"],i)?o(n(),t):"text"===i||"title"===i?(e[i]=n()[i],b.none()):b.none()}}},yn=tinymce.util.Tools.resolve("tinymce.util.Delay"),xn=tinymce.util.Tools.resolve("tinymce.util.Promise"),bn=function(n){var t=n.href;return t.indexOf("@")>0&&-1===t.indexOf("/")&&-1===t.indexOf("mailto:")?b.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(n){return q(q({},n),{href:"mailto:"+t})}}):b.none()},On=function(n,t){return function(e){var r=e.href;return 1===n&&!Z(r)||0===n&&/^\s*www(\.|\d\.)/i.test(r)?b.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+t+":// prefix?",preprocess:function(n){return q(q({},n),{href:t+"://"+r})}}):b.none()}},wn=function(n,t){return T([bn,On(R(n),B(n))],(function(n){return n(t)})).fold((function(){return xn.resolve(t)}),(function(e){return new xn((function(r){!function(n,t,e){var r=n.selection.getRng();yn.setEditorTimeout(n,(function(){n.windowManager.confirm(t,(function(t){n.selection.setRng(r),e(t)}))}))}(n,e.message,(function(n){r(n?e.preprocess(t):t)}))}))}))},Cn=function(n){var t=n.dom.select("a:not([href])"),e=A(t,(function(n){var t=n.name||n.id;return t?[{text:t,value:"#"+t}]:[]}));return e.length>0?b.some([{text:"None",value:""}].concat(e)):b.none()},Nn=function(n){var t=function(n){return n.getParam("link_class_list",[],"array")}(n);return t.length>0?V.sanitize(t):b.none()},An=tinymce.util.Tools.resolve("tinymce.util.XHR"),Tn=function(n){var t=function(t){return n.convertURL(t.value||t.url,"href")},e=function(n){return n.getParam("link_list")}(n);return new xn((function(n){a(e)?An.send({url:e,success:function(t){return n(function(n){try{return b.some(JSON.parse(n))}catch(n){return b.none()}}(t))},error:function(t){return n(b.none())}}):s(e)?e((function(t){return n(b.some(t))})):n(b.from(e))})).then((function(n){return n.bind(V.sanitizeWith(t)).map((function(n){if(n.length>0){return[{text:"None",value:""}].concat(n)}return n}))}))},Pn=function(n,t){var e=E(n);if(e.length>0){var r=P(t,"_blank");return(!1===U(n)?V.sanitizeWith((function(n){return tn(V.getValue(n),r)})):V.sanitize)(e)}return b.none()},Sn=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],_n=function(n){var t=L(n);return c(t)?V.sanitize(t).orThunk((function(){return b.some(Sn)})):!1===t?b.none():b.some(Sn)},Rn=function(n,t,e){var r=n.getAttrib(t,e);return null!==r&&r.length>0?b.some(r):b.none()},Dn=function(n,t){return Tn(n).then((function(e){var r=function(n,t){var e=n.dom,r=un(n)?b.some(rn(n.selection,t)):b.none(),o=t?b.some(e.getAttrib(t,"href")):b.none(),i=t?b.from(e.getAttrib(t,"target")):b.none(),u=Rn(e,t,"rel"),a=Rn(e,t,"class");return{url:o,text:r,title:Rn(e,t,"title"),target:i,rel:u,linkClass:a}}(n,t);return{anchor:r,catalogs:{targets:_n(n),rels:Pn(n,r.target),classes:Nn(n),anchor:Cn(n),link:e},optNode:b.from(t),flags:{titleEnabled:M(n)}}}))},Ln=function(n){var t=function(n){var t=en(n);return Dn(n,t)}(n);t.then((function(t){var e=function(n,t){return function(e){var r=e.getData();if(!r.url.value)return mn(n),void e.close();var o=function(n){return b.from(r[n]).filter((function(e){return!P(t.anchor[n],e)}))},i={href:r.url.value,text:o("text"),target:o("target"),rel:o("rel"),class:o("linkClass"),title:o("title")},u={href:r.url.value,attach:void 0!==r.url.meta&&r.url.meta.attach?r.url.meta.attach:m};wn(n,i).then((function(t){sn(n,u,t)})),e.close()}}(n,t);return function(n,t,e){var r=n.anchor.text.map((function(){return{name:"text",type:"input",label:"Text to display"}})).toArray(),o=n.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],i=function(n,t){var e=n.anchor,r=e.url.getOr("");return{url:{value:r,meta:{original:{value:r}}},text:e.text.getOr(""),title:e.title.getOr(""),anchor:r,link:r,rel:e.rel.getOr(""),target:e.target.or(t).getOr(""),linkClass:e.linkClass.getOr("")}}(n,b.from(D(e))),u=n.catalogs,a=kn(i,u);return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:N([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],r,o,S([u.anchor.map(V.createUi("anchor","Anchors")),u.rels.map(V.createUi("rel","Rel")),u.targets.map(V.createUi("target","Open link in...")),u.link.map(V.createUi("link","Link list")),u.classes.map(V.createUi("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:i,onChange:function(n,t){var e=t.name;a.onChange(n.getData,{name:e}).each((function(t){n.setData(t)}))},onSubmit:t}}(t,e,n)})).then((function(t){n.windowManager.open(t)}))},En=function(n){var t=document.createElement("a");t.target="_blank",t.href=n,t.rel="noreferrer noopener";var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),function(n,t){document.body.appendChild(n),n.dispatchEvent(t),document.body.removeChild(n)}(t,e)},Mn=function(n,t){return n.dom.getParent(t,"a[href]")},Un=function(n){return Mn(n,n.selection.getStart())},Bn=function(n,t){if(t){var e=nn(t);if(/^#/.test(e)){var r=n.$(e);r.length&&n.selection.scrollIntoView(r[0],!0)}else En(t.href)}},In=function(n){return function(){Ln(n)}},Kn=function(n){return function(){Bn(n,Un(n))}},zn=function(n,t){return n.on("NodeChange",t),function(){return n.off("NodeChange",t)}},jn=function(n){return function(t){var e=function(){return t.setActive(!n.mode.isReadOnly()&&null!==en(n,n.selection.getNode()))};return e(),zn(n,e)}},Vn=function(n){return function(t){var e=function(){return t.setDisabled(null===en(n,n.selection.getNode()))};return e(),zn(n,e)}},qn=function(n){return function(t){var e=function(t){return on(t)||(e=n.selection.getRng(),Y(e,Q).length>0);var e},r=n.dom.getParents(n.selection.getStart());return t.setDisabled(!e(r)),zn(n,(function(n){return t.setDisabled(!e(n.parents))}))}},Fn=function(n){var t=function(t){var e=n.selection.getNode();return t.setDisabled(!en(n,e)),m};n.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:jn(n)},label:"Link",predicate:function(t){return!!en(n,t)&&function(n){return n.getParam("link_context_toolbar",!1,"boolean")}(n)},initValue:function(){var t=en(n);return t?nn(t):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(t){var e=n.selection.getNode();return t.setActive(!!en(n,e)),jn(n)(t)},onAction:function(t){var e=t.getValue(),r=function(t){var e=en(n),r=un(n);if(!e&&r){var o=rn(n.selection,e);return b.some(o.length>0?o:t)}return b.none()}(e);sn(n,{href:e,attach:m},{href:e,text:r,title:b.none(),rel:b.none(),target:b.none(),class:b.none()}),function(n){n.selection.collapse(!1)}(n),t.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:t,onAction:function(t){mn(n),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:t,onAction:function(t){Kn(n)(),t.hide()}}]})};r.add("link",(function(n){!function(n){n.ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:In(n),onSetup:jn(n)}),n.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:Kn(n),onSetup:Vn(n)}),n.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return mn(n)},onSetup:qn(n)})}(n),function(n){n.ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:Kn(n),onSetup:Vn(n)}),n.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:In(n)}),n.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return mn(n)},onSetup:qn(n)})}(n),function(n){n.ui.registry.addContextMenu("link",{update:function(t){return on(n.dom.getParents(t,"a"))?"link unlink openlink":"link"}})}(n),Fn(n),function(n){n.on("click",(function(t){var e=Mn(n,t.target);e&&o.metaKeyPressed(t)&&(t.preventDefault(),Bn(n,e))})),n.on("keydown",(function(t){var e=Un(n);e&&13===t.keyCode&&function(n){return!0===n.altKey&&!1===n.shiftKey&&!1===n.ctrlKey&&!1===n.metaKey}(t)&&(t.preventDefault(),Bn(n,e))}))}(n),function(n){n.addCommand("mceLink",(function(){!function(n){return n.getParam("link_quicklink",!1,"boolean")}(n)?In(n)():n.fire("contexttoolbar-show",{toolbarKey:"quicklink"})}))}(n),function(n){n.addShortcut("Meta+K","",(function(){n.execCommand("mceLink")}))}(n)}))}()}}]);
//# sourceMappingURL=27384.05d96a90eb7fb0906073.min.js.map