"use strict";(self.webpackChunkplone_mosaic=self.webpackChunkplone_mosaic||[]).push([[72908],{72908:function(e,t,r){r.r(t),r.d(t,{default:function(){return A}});r(35666);var a=r(10878),n=r.n(a),i=r(89867),o=r(19513),s=r(39191),c={init:function(e){var t={time:3,initialTime:8,exceptionAreas:[]};return this.each((function(){var r=n()(this);r.data("timeout")||(e&&n().extend(t,e),r.data("timeout",{lastEvent:new Date,trueTime:t.time,time:t.initialTime,untouched:!0,inExceptionArea:!1}),r.on("mouseover.timeout",c.mouseMoved),r.on("mouseenter.timeout",c.mouseMoved),n()(t.exceptionAreas).each((function(){r.find(this).live("mouseover.timeout",{parent:r},c.enteredException).live("mouseleave.timeout",{parent:r},c.leftException)})),t.initialTime>0?r.timeout("startTimer"):r.addClass("timeout"))}))},enteredException:function(e){var t=e.data.parent.data("timeout");t.inExceptionArea=!0,e.data.parent.data("timeout",t),e.data.parent.trigger("mouseover")},leftException:function(e){var t=e.data.parent.data("timeout");t.inExceptionArea=!1,e.data.parent.data("timeout",t)},destroy:function(){return this.each((function(){var e=n()(this),t=e.data("timeout");n()(window).off(".timeout"),t.timeout.remove(),e.removeData("timeout")}))},mouseMoved:function(){var e=n()(this),t=e.data("timeout");e.hasClass("timeout")?(e.removeClass("timeout"),e.timeout("startTimer")):t.untouched&&(t.untouched=!1,t.time=t.trueTime),t.lastEvent=new Date,e.data("timeout",t)},startTimer:function(){var e=n()(this),t=e.data("timeout"),r=function(){var t=e.data("timeout");if(t&&t.lastEvent)if(t.inExceptionArea)setTimeout(r,Math.floor(1e3*t.time));else{var a=new Date,n=Math.floor(1e3*t.time)-(a-t.lastEvent);n>0?setTimeout(r,n+100):e.addClass("timeout")}};setTimeout(r,Math.floor(1e3*t.time))}};n().fn.timeout=function(e){return c[e]?c[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void n().error("Method "+e+" does not exist on jQuery.timeout"):c.init.apply(this,arguments)},n().extend(n().expr[":"],{scrollable:function(e){return"scroll"===n()(e).css("overflow")||"scroll"===n()(e).css("overflowX")||"scroll"===n()(e).css("overflowY")||(e.clientHeight<e.scrollHeight&&(-1!==n().inArray(n()(e).css("overflowY"),["scroll","auto"])||-1!==n().inArray(n()(e).css("overflow"),["scroll","auto"]))||e.clientWidth<e.scrollWidth&&(-1!==n().inArray(n()(e).css("overflowX"),["scroll","auto"])||-1!==n().inArray(n()(e).css("overflow"),["scroll","auto"])))}}),n().fn.makeVisibleInScroll=function(e){var t=null;return"string"==typeof e?t=n()("#"+e):e&&(t=n()(e)),this.each((function(){var e,r=n()(this);e=t||((e=r.parents(":scrollable")).length>0?n()(e[0]):n()(window));var a=r.position().top,i=r.height()+a,o=e.scrollTop(),s=e.height()+o;a<o?e.scrollTop(a):i>s-e.height()/2&&e.scrollTop(a-(e.height()-r.height())/2)}))},n().fn.safeOffset=function(){var e,t=this[0],r={top:0,left:0};return t&&t.nodeType?(e=(t.ownerDocument||document).documentElement,n().contains(e,t)?n().fn.offset.apply(this,arguments):r):r},n().fn.setPositionAbsolute=function(e,t,r){return this.each((function(){var a=n()(this),i=n()(this).width(),o=e.safeOffset(),s=e.width(),c=e.height(),l=o.left+s-i+r,d=o.top+c+t;a.css({"z-index":1,position:"absolute",marginLeft:0,marginTop:0,left:l+"px",top:d+"px",width:i}),a.remove().appendTo("body").show()}))},n().fn.positionAncestor=function(e){var t=0,r=0;return this.each((function(){var a=n()(this).closest(e);if(a.length&&"static"!==a.css("position")){var i=n()(this),o=i.safeOffset().left-parseInt(i.css("marginLeft"),10),s=i.safeOffset().top-parseInt(i.css("marginTop"),10),c=a.safeOffset().left+parseInt(a.css("borderLeftWidth"),10),l=a.safeOffset().top+parseInt(a.css("borderTopWidth"),10);return t=o-c,r=s-l,!1}})),{left:t,top:r}},n().fn.findInclusive=function(e){return this.find("*").addBack().filter(e)},n().fn.slideIn=function(e,t,r){return this.animate({width:"show"},e,t,r)},n().fn.slideOut=function(e,t,r){return this.animate({width:"hide"},e,t,r)},n().expr[":"].Contains=function(e,t,r){return n()(e).text().toUpperCase().indexOf(r[3].toUpperCase())>=0},n().fn.scopedFind=function(e){return 0===e.indexOf("#")?n()(e):this.find(e)};var l=r(59050),d=r(40705),u=r(87657);const p=i.Z.getLogger("pat.ajax"),f=new d.Z("ajax");f.addArgument("accept","text/html"),f.addArgument("url",(function(e){return(e.is("a")?e.attr("href"):e.is("form")?e.attr("action"):"").split("#")[0]})),n().ajaxSetup({cache:!1});var g={get:function(e){return void 0!==this[e]?this[e]:0},inc:function(e){return this[e]=this.get(e)+1,this.get(e)}},h={name:"ajax",trigger:".pat-ajax",parser:f,init:function(e){return e.off(".pat-ajax"),e.filter("a").on("click.pat-ajax",h.onTriggerEvents),e.filter("form").on("submit.pat-ajax",h.onTriggerEvents).on("click.pat-ajax","[type=submit]",h.onClickSubmit),e.filter(":not(form,a)").each((function(){p.warn("Unsupported element:",this)})),e},destroy:function(e){e.off(".pat-ajax")},onClickSubmit:function(e){var t=n()(e.target).parents("form").first(),r=e.target.name,a=n()(e.target).val(),i={};r&&(i[r]=a),t.data("pat-ajax.clicked-data",i)},onTriggerEvents:function(e){e&&e.preventDefault(),h.request(n()(this))},request:function(e,t){return e.each((function(){h._request(n()(this),t)}))},_request:function(e,t){var r=h.parser.parse(e,t),a=g.inc(r.url),i=e.data("pat-ajax.clicked-data"),o=i?n().param(i):"",s={context:e,data:[e.serialize(),o].filter(Boolean).join("&"),headers:{},url:r.url,method:e.attr("method")?e.attr("method"):"GET"};if(r.accept&&(s.headers.Accept=r.accept),e.is("form")&&e.attr("method")&&"POST"==e.attr("method").toUpperCase()){var c=new FormData(e[0]);for(var l in i)c.append(l,i[l]);s.method="POST",s.data=c,s.cache=!1,s.contentType=!1,s.processData=!1,s.type="POST"}e.removeData("pat-ajax.clicked-data"),p.debug("request:",s,e[0]);var d=n().ajax(s);d&&d.done((function(t,n,i){p.debug("success: jqxhr:",i),a===g.get(r.url)&&e.trigger({type:"pat-ajax-success",jqxhr:i})})).fail((function(t,a,n){p.error("load error for "+r.url+":",n,t),e.trigger({type:"pat-ajax-error",jqxhr:t})}))}};u.Z.register(h);var m=h,y=r(54593);const j=i.Z.getLogger("pat.inject"),v=new d.Z("inject");v.addArgument("default-selector"),v.addArgument("target"),v.addArgument("data-type","html"),v.addArgument("next-href"),v.addArgument("source"),v.addArgument("trigger","default",["default","autoload","autoload-visible","idle"]),v.addArgument("delay"),v.addArgument("confirm","class",["never","always","form-data","class"]),v.addArgument("confirm-message","Are you sure you want to leave this page?"),v.addArgument("hooks",[],["raptor"],!0),v.addArgument("loading-class","injecting"),v.addArgument("executing-class","executing"),v.addArgument("executed-class","executed"),v.addArgument("class"),v.addArgument("history"),v.addArgument("push-marker"),v.addArgument("scroll"),v.addArgument("url");const b={name:"inject",trigger:".raptor-ui .ui-button.pat-inject, a.pat-inject, form.pat-inject, .pat-subform.pat-inject",parser:v,init(e,t){const r=this.extractConfig(e,t);if(r.some((e=>"record"===e.history))&&!("pushState"in history))return e;if(e.data("pat-inject",r),r[0].nextHref&&0===r[0].nextHref.indexOf("#")&&e.is("a")&&n()(r[0].nextHref).length>0)return j.debug("Skipping as next href is anchor, which already exists",r[0].nextHref),e.attr({href:(window.location.href.split("#")[0]||"")+r[0].nextHref});if(r[0].pushMarker&&n()("body").on("push",((t,a)=>{j.debug("received push message: "+a),a==r[0].pushMarker&&(j.debug("re-injecting "+a),this.onTrigger({currentTarget:e[0]}))})),r[0].idleTrigger)this._initIdleTrigger(e,r[0].idleTrigger);else switch(r[0].trigger){case"default":r.forEach((e=>{e.delay&&(e.processDelay=e.delay)})),e.is("form")?e.on("submit.pat-inject",this.onTrigger.bind(this)).on("click.pat-inject","[type=submit]",m.onClickSubmit).on("click.pat-inject","[type=submit][formaction], [type=image][formaction]",this.onFormActionSubmit.bind(this)):e.is(".pat-subform")?j.debug("Initializing subform with injection"):e.on("click.pat-inject",this.onTrigger.bind(this));break;case"autoload":if(r[0].delay){const t=Math.random().toString(36);e.attr("data-pat-inject-uid",t);const a=t=>0!=n()("[data-pat-inject-uid='"+t+"']").length&&(e.data("pat-inject-autoloaded",!0),this.onTrigger({currentTarget:e[0]}),!0);window.setTimeout(a.bind(null,t),r[0].delay)}else this.onTrigger({currentTarget:e[0]});break;case"autoload-visible":this._initAutoloadVisible(e,r);break;case"idle":this._initIdleTrigger(e,r[0].delay)}return j.debug("initialised:",e),e},destroy:e=>(e.off(".pat-inject"),e.data("pat-inject",null),e),onTrigger(e){const t=n()(e.currentTarget),r=t.data("pat-inject");t.is("form")&&n()(r).each(((e,r)=>{r.params=n().param(t.serializeArray())})),e.preventDefault&&e.preventDefault(),t.trigger("patterns-inject-triggered"),this.execute(r,t)},onFormActionSubmit(e){m.onClickSubmit(e);const t=n()(e.target),r=t.attr("formaction"),a=t.parents(".pat-inject").first(),i={url:r},o=t.closest("[data-pat-inject]"),s=this.extractConfig(o,i);n()(s).each(((e,t)=>{t.params=n().param(a.serializeArray())})),e.preventDefault(),a.trigger("patterns-inject-triggered"),this.execute(s,a)},submitSubform(e){const t=e.parents("form"),r=e.data("pat-inject");n()(r).each(((t,r)=>{r.params=n().param(e.serializeArray())}));try{t.trigger("patterns-inject-triggered")}catch(e){j.error("patterns-inject-triggered",e)}this.execute(r,t)},extractConfig(e,t){t=n().extend({},t);const r=v.parse(e,t,!0);return r.forEach((r=>{r.$context=e,r.url=t.url||r.url||e.attr("href")||e.attr("action")||e.parents("form").attr("action")||"";const a=r.url.split("#");if(r.url=a[0],a.length>2&&j.warn("Ignoring additional source ids:",a.slice(2)),r.defaultSelector||(r.defaultSelector=a[1]&&"#"+a[1]||"body"),r.delay)try{r.delay=o.Z.parseTime(r.delay)}catch(e){j.warn("Invalid delay value: ",r.delay),r.delay=null}r.processDelay=0})),r},elementIsDirty(e){const t=n().map(e.find(":input:not(select)"),(e=>{const t=n()(e).val();return Boolean(t)&&t!==n()(e).attr("placeholder")}));return-1!==n().inArray(!0,t)},askForConfirmation(e){let t,r=!1;return l.default.each(e,(e=>{let a=!1;"always"==e.confirm?a=!0:"form-data"===e.confirm?"none"!=e.target&&(a=this.elementIsDirty(e.$target)):"class"===e.confirm&&"none"!=e.target&&(a=e.$target.hasClass("is-dirty")),a&&(r=!0,t=e.confirmMessage)})),!(r&&!window.confirm(t))},ensureTarget(e){if("none"===e.target)return!0;if(e.$target=e.$target||("self"===e.target?e.$context:n()(e.target)),0===e.$target.length){if(!e.target)return j.error("Need target selector",e),!1;e.$target=this.createTarget(e.target),e.$injected=e.$target}return!0},verifySingleConfig(e,t){return t.url!==e?(j.error("Unsupported different urls for multi-inject"),!1):(t.source=t.source||t.defaultSelector,t.target=t.target||t.defaultSelector,!!this.extractModifiers(t)&&(!!this.ensureTarget(t)&&(this.listenForFormReset(t),!0)))},verifyConfig(e){return e.every(l.default.partial(this.verifySingleConfig.bind(this),e[0].url))},listenForFormReset(e){if("none"===e.target)return;const t=e.$target.parents("form");0!==t.length&&void 0===e.$target.data("initial-value")&&(e.$target.data("initial-value",e.$target.html()),t.on("reset",(()=>{e.$target.html(e.$target.data("initial-value"))})))},extractModifiers(e){const t=/^(.*?)(::element)?$/.exec(e.source),r=/^(.*?)(::element)?(::after|::before)?$/.exec(e.target);e.source=t[1],e.sourceMod=t[2]?"element":"content",e.target=r[1];const a=r[2]?"element":"content",n=(r[3]||"::").slice(2);return e.loadingClass&&(e.loadingClass+=" "+e.loadingClass+"-"+a,n&&e.loadingClass&&(e.loadingClass+=" "+e.loadingClass+"-"+n)),e.action=a+n,!0},createTarget(e){if("#"!==e.slice(0,1))return j.error("only id supported for non-existing target"),null;const t=n()("<div />").attr({id:e.slice(1)});return n()("body").append(t),t},stopBubblingFromRemovedElement(e,t,r){for(const a of t){const t=a.target;if(e.parents(t).addBack(t)&&!r.isPropagationStopped())return void r.stopPropagation()}},_performInjection(e,t,r,a,i,o){let s;"content"===a.sourceMod&&(r=r.contents()),s=document.all&&document.querySelector&&!document.addEventListener?r.map(((e,t)=>n()(t.outerHTML)[0])):r.safeClone(),s.findInclusive("img").on("load",(e=>{n()(e.currentTarget).trigger("pat-inject-content-loaded")}));const c=a.$injected||s;this._inject(i,s,n()(e),a)&&this._afterInjection(t,c,a);const l=a.url.indexOf("?")>-1?"&":"?";"record"===a.history&&"pushState"in history&&(a.params?history.pushState({url:a.url+l+a.params},"",a.url+l+a.params):history.pushState({url:a.url},"",a.url),o&&this._inject(i,o,n()("title"),{action:"element"}))},_afterInjection(e,t,r){if(t.filter(((e,t)=>3!==t.nodeType)).data("pat-injected",{origin:r.url}),1===t.length&&3==t[0].nodeType?t.parent().trigger("patterns-injected",[r,e[0],t[0]]):t.each(((t,a)=>{3!==a.nodeType&&n()(a).addClass(r.class).trigger("patterns-injected",[r,e[0],a])})),r.scroll&&"none"!==r.scroll){let e=r.$target.parents().addBack().filter(":scrollable");e=e.length?e[0]:window;let a=0,n=0;if("top"!==r.scroll){const i="target"===r.scroll?r.$target[0]:t.filter(r.scroll)[0],s=e===window?document.body:e;n=Math.abs(i.getBoundingClientRect().left+s.scrollLeft-s.getBoundingClientRect().left-o.Z.getCSSValue(s,"border-left-width",!0)),a=Math.abs(i.getBoundingClientRect().top+s.scrollTop-s.getBoundingClientRect().top-o.Z.getCSSValue(s,"border-top-width",!0))}e===window?e.scrollTo(n,a):(e.scrollLeft=n,e.scrollTop=a)}e[0].dispatchEvent(new Event("pat-inject-success",{bubbles:!0,cancelable:!0}))},async _onInjectSuccess(e,t,r){let a=r&&r.jqxhr&&r.jqxhr.responseText;if(!a)return void j.warn("No response content, aborting",r);"none"===t[0].source&&(a=""),n().each(t[0].hooks||[],((t,r)=>e.trigger("pat-inject-hook-"+r))),this.stopBubblingFromRemovedElement(e,t,r);const i=await this.callTypeHandler(t[0].dataType,"sources",e,[t,a,r]);let o;i&&i[i.length-1]&&i[i.length-1][0]&&"TITLE"==i[i.length-1][0].nodeName&&(o=i[i.length-1]),t.forEach(((t,a)=>{const n=()=>{"none"!=t.target&&t.$target.each(((n,s)=>{this._performInjection(s,e,i[a],t,r.target,o)}))};t.processDelay?setTimeout((()=>n()),t.processDelay):n()})),t[0].nextHref&&e.is("a")&&(e.attr({href:t[0].nextHref.replace(/&amp;/g,"&")}),this.destroy(e)),e.off("pat-ajax-success.pat-inject"),e.off("pat-ajax-error.pat-inject")},async _onInjectError(e,t,r){let a="";const i=r.jqxhr.status,o=new Date;let s,c;i%100==4?a="Sorry! We couldn't find the page to load. Please make a screenshot and send it to support. Thank you!":i%100==5?a="I am very sorry! There was an error at the server. Please make a screenshot and contact support. Thank you!":0==i&&(a="It seems, the server is down. Please make a screenshot and contact support. Thank you!");if(null===new URLSearchParams(window.location.search).get("pat-inject-errorhandler.off")){const e=document.querySelector(`meta[name^=pat-inject-status-${i}]`)?.getAttribute("content",!1);if(c=e?.split("#")[1],c=c?`#${c}`:null,c&&(s=document.createElement("html"),s.innerHTML=r.jqxhr.responseText,s=s.querySelector(c)),!s&&e)try{const t=await fetch(e,{method:"GET"});s=document.createElement("html"),s.innerHTML=await t.text(),s=s.querySelector(c||"body")}catch{}}if(t.forEach((t=>{"$injected"in t&&t.$injected.remove(),t.$target.removeClass(t.loadingClass),e.removeClass(t.executingClass)})),e.off("pat-ajax-success.pat-inject"),e.off("pat-ajax-error.pat-inject"),s){const e=document.querySelector(c||"body");e.innerHTML=s.innerHTML,u.Z.scan(e)}else{const e=`${a} Status is ${i} ${r.jqxhr.statusText}, time was ${o}. You can click to close this.`;n()("body").attr("data-error-message",e),n()("body").on("click",(()=>{n()("body").removeAttr("data-error-message"),window.location.href=window.location.href}))}},execute(e,t){e=e.map((e=>n().extend({},e))),this.verifyConfig(e)&&this.askForConfirmation(e)&&(t.data("pat-inject-triggered")||(t.data("pat-inject-triggered",!0),l.default.chain(e).filter(l.default.property("loadingClass")).each((e=>{"none"!=e.target&&e.$target.addClass(e.loadingClass)})),l.default.chain(e).filter(l.default.property("loadingClass")).each((e=>t.addClass(e.executingClass))),t.on("pat-ajax-success.pat-inject",this._onInjectSuccess.bind(this,t,e)),t.on("pat-ajax-error.pat-inject",this._onInjectError.bind(this,t,e)),t.on("pat-ajax-success.pat-inject pat-ajax-error.pat-inject",(()=>t.removeData("pat-inject-triggered"))),e[0].url.length?m.request(t,{url:e[0].url}):t.trigger({type:"pat-ajax-success",jqxhr:{responseText:n()("body").html()}})))},_inject(e,t,r,a){const i={contentbefore:"prepend",contentafter:"append",elementbefore:"before",elementafter:"after"}[a.action];return"none"===a.source?(r.replaceWith(""),!0):0===t.length?(j.warn("Aborting injection, source not found:",t),n()(e).trigger("pat-inject-missingSource",{url:a.url,selector:a.source}),!1):"none"===a.target||(0===r.length?(j.warn("Aborting injection, target not found:",r),n()(e).trigger("pat-inject-missingTarget",{selector:a.target}),!1):("content"===a.action?r.empty().append(t):"element"===a.action?r.replaceWith(t):r[i](t),!0))},_sourcesFromHtml(e,t,r){const a=this._parseRawHtml(e,t);return r.map((e=>{if("body"===e&&(e="#__original_body"),"none"===e)return n()("\x3c!-- --\x3e");const r=a.find(e);return 0===r.length&&"title"!=e&&j.warn("No source elements for selector:",e,a),r.find('a[href^="#"]').each(((e,a)=>{const n=a.getAttribute("href");-1===n.indexOf("#{1}")&&(1===n.length?a.href=t:r.find(n).length||(a.href=t+n))})),r}))},_rebaseAttrs:{A:"href",FORM:"action",IMG:"data-pat-inject-rebase-src",OBJECT:"data",SOURCE:"data-pat-inject-rebase-src",VIDEO:"data-pat-inject-rebase-src"},_rebaseOptions:{calendar:["url","event-sources"],collapsible:["load-content"],"date-picker":["i18n"],"datetime-picker":["i18n"],inject:["url"]},_rebaseHTML(e,t){if(""===t)return"";const r=n()(t.replace(/(\s)(src\s*)=/gi,'$1src="" data-pat-inject-rebase-$2=').trim()).wrapAll("<div>").parent();r.find(Object.keys(this._rebaseAttrs).join(",")).each(((t,r)=>{const a=n()(r),i=this._rebaseAttrs[r.tagName];let s=a.attr(i);s&&"@@"!==s.slice(0,2)&&"#"!==s[0]&&"mailto:"!==s.slice(0,7)&&"tel:"!==s.slice(0,4)&&"fax:"!==s.slice(0,4)&&"callto:"!==s.slice(0,7)&&"ts3server:"!==s.slice(0,10)&&"teams:"!==s.slice(0,6)&&"javascript:"!==s.slice(0,11)&&(s=o.Z.rebaseURL(e,s),a.attr(i,s))}));for(const[t,a]of Object.entries(this._rebaseOptions))for(const n of y.Z.querySelectorAllAndMe(r[0],`[data-pat-${t}]`)){const r=u.Z.patterns?.[t],i=r?.parser;if(!i)continue;const s=i.parse(n,{},!0,!1,!1);let c=!1;for(const t of s)for(const r of a){const a=t[r];a&&(c=!0,Array.isArray(a)?t[r]=a.map((t=>o.Z.rebaseURL(e,t))):t[r]=o.Z.rebaseURL(e,a))}c&&n.setAttribute(`data-pat-${t}`,JSON.stringify(1===s.length?s[0]:s))}return r.find("[data-pat-inject-rebase-src]").each(((e,t)=>{const r=n()(t);r.attr("src",r.attr("data-pat-inject-rebase-src")).removeAttr("data-pat-inject-rebase-src")})),r.html().replace(/src="" data-pat-inject-rebase-/g,"").trim()},_parseRawHtml(e,t){t=t||"";const r=e.match(/\<title\>(.*)\<\/title\>/);let a=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<head\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/head>/gi,"").replace(/<body([^>]*?)>/gi,'<div id="__original_body">').replace(/<\/body([^>]*?)>/gi,"</div>");r&&2==r.length&&(a=r[0]+a);try{a=this._rebaseHTML(t,a)}catch(e){j.error("Error rebasing urls",e)}const i=n()("<div/>").html(a);return 0===i.children().length&&j.warn("Parsing html resulted in empty jquery object:",a),i},_initAutoloadVisible(e,t){if(e.data("pat-inject-autoloaded"))return!1;const r=e.parents(":scrollable"),a=t=>!e.data("pat-inject-autoloaded")&&(e.data("pat-inject-autoloaded",!0),this.onTrigger({currentTarget:e[0]}),t&&t.preventDefault(),!0);if(e.click(a),r.length){const i=o.Z.debounce((()=>{if(e.data("patterns.autoload")||!n().contains(document,e[0]))return!1;if(!e.is(":visible"))return!1;if(!o.Z.elementInViewport(e[0]))return!1;const s=(e.data("pat-inject")[0].target||t[0].defaultSelector).replace(/::element/,"");return(!s||"self"===s||0!==n()(s).length)&&(n()(r[0]).off("scroll",i),n()(window).off("resize.pat-autoload",i),a())}),100);if(i())return!0;n()(r[0]).on("scroll",i),n()(window).on("resize.pat-autoload",i)}else{const r=o.Z.debounce((()=>{if(e.parents(":scrollable").length)return n()(window).off(".pat-autoload",r),this._initAutoloadVisible(e);if(e.data("patterns.autoload"))return!1;if(!e.is(":visible"))return!1;if(!o.Z.elementInViewport(e[0]))return!1;const i=(e.data("pat-inject")[0].target||t[0].defaultSelector).replace(/::element/,"");return(!i||"self"===i||0!==n()(i).length)&&(n()(window).off(".pat-autoload",r),a())}),100);if(r())return!0;if(IntersectionObserver){const t=new IntersectionObserver(r);e.each(((e,r)=>t.observe(r)))}else n()(window).on("resize.pat-autoload scroll.pat-autoload",r)}return!1},_initIdleTrigger(e,t){const r=parseInt(t,10);let a;const n=()=>{this.onTrigger({currentTarget:e[0]}),s(),clearTimeout(a)},i=o.Z.debounce((()=>{document.body.contains(e[0])?(clearTimeout(a),a=setTimeout(n,r)):s()}),r),s=()=>{["scroll","resize"].forEach((e=>window.removeEventListener(e,i))),["click","keypress","keyup","mousemove","touchstart","touchend"].forEach((e=>document.removeEventListener(e,i)))};i(),["scroll","resize"].forEach((e=>window.addEventListener(e,i))),["click","keypress","keyup","mousemove","touchstart","touchend"].forEach((e=>document.addEventListener(e,i)))},registerTypeHandler(e,t){this.handlers[e]=t},async callTypeHandler(e,t,r,a){return e=e||"html",this.handlers[e]&&n().isFunction(this.handlers[e][t])?await this.handlers[e][t].bind(this)(...a):null},handlers:{html:{sources(e,t){const r=e.map((e=>e.source));return r.push("title"),this._sourcesFromHtml(t,e[0].url,r)}}}};if(n()(document).on("patterns-injected.inject",((e,t,r,a)=>{t&&t.skipPatInjectHandler||(t&&(t.$target.removeClass(t.loadingClass),n()(r).removeClass(t.executingClass).addClass(t.executedClass)),3!==a.nodeType&&8!==a&&(u.Z.scan(a,null,{type:"injection",element:r}),n()(a).trigger("patterns-injected-scanned")))})),n()(window).on("popstate",(e=>{if(e.originalEvent.state||!("replaceState"in history))window.location.reload();else try{history.replaceState("anchor","",document.location.href)}catch(e){j.debug(e)}})),"replaceState"in history)try{history.replaceState("pageload","",document.location.href)}catch(e){j.debug(e)}u.Z.register(b);var x=b,w=i.Z.getLogger("pat.markdown"),T=/\.md$/,E=s.Z.extend({name:"markdown",trigger:".pat-markdown",async init(){if(this.$el.is(this.trigger)){var e=this.$el.is(":input")?this.$el.val():this.$el.text();(await this.render(e)).replaceAll(this.$el)}},async render(e){const t=(await r.e(53787).then(r.t.bind(r,53787,23))).default;t.extensions.prettify=function(){return[{type:"output",filter:function(e){return e.replace(/(<pre>)?<code>/gi,(function(e,t){return t?'<pre class="pat-syntax-highlight" tabIndex="0"><code data-inner="1">':'<code class="pat-syntax-highlight">'}))}}]};const a=n()("<div/>"),i=new t.Converter({tables:!0,extensions:["prettify"]});return a.html(i.makeHtml(e)),a},async renderForInjection(e,t){var r,a=t;if(e.source&&null!==(r=/^#+\s*(.*)/.exec(e.source))){if(null===(a=this.extractSection(a,r[1])))return w.warn('Could not find section "'+e.source+'" in '+e.url),n()("<div/>").attr("data-src",e.url);a+="\n"}return(await this.render(a)).attr("data-src",e.source?e.url+e.source:e.url)},extractSection(e,t){var r,a;t=o.Z.escapeRegExp(t);var n=new RegExp("^((#+)\\s*@TEXT@\\s*|@TEXT@\\s*\\n([=-])+\\s*)$".replace(/@TEXT@/g,t),"m"),i=n.exec(e);if(null===i)return null;if(i[2])a=i[2].length,r=(r="^#{@LEVEL@}\\s*@TEXT@\\s*$\\n+((?:.|\\n)*?(?=^#{1,@LEVEL@}\\s)|.*(?:.|\\n)*)").replace(/@LEVEL@/g,a);else{if(!i[3])return w.error("Unexpected section match result",i),null;r="="===i[3]?"^@TEXT@\\s*\\n=+\\s*\\n+((?:.|\\n)*?(?=^.*?\\n=+\\s*$)|(?:.|\\n)*)":"^@TEXT@\\s*\\n-+\\s*\\n+((?:.|\\n)*?(?=^.*?\\n[-=]+\\s*$)|(?:.|\\n)*)"}return r=r.replace(/@TEXT@/g,t),null===(i=(n=new RegExp(r,"m")).exec(e))&&w.error("Failed to find section with known present header?"),null!==i?i[0]:null}});n()(document).ready((function(){n()(document.body).on("patterns-inject-triggered.pat-markdown","a.pat-inject",(function(){n()(this).data("pat-inject").forEach((function(e){T.test(e.url)&&(e.dataType="markdown")}))}))})),x.registerTypeHandler("markdown",{sources:async(e,t)=>await Promise.all(e.map((async function(e){var r=E.init(e.$target);return await r.renderForInjection(e,t)})))});var A=E}}]);