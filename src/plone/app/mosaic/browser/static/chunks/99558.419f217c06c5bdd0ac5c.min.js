"use strict";(self.webpackChunkplone_mosaic=self.webpackChunkplone_mosaic||[]).push([[99558],{24283:function(t,e,i){i.r(e),i.d(e,{default:function(){return g}});var n=i(26373),a=i.n(n),o=i(24481),l=i.n(o),s=i(11191),r=i(10354),p=i(62832),c=i(50360),d=i(25219),h=s.Z.extend({name:"select2",trigger:".pat-select2",parser:"mockup",defaults:{separator:",",ajaxTimeout:300},initializeValues(){this.options.initialValues&&(this.options.id=t=>t.id,this.options.initSelection=(t,e)=>{const i=[],n=t.val();let o=this.options.initialValues;if("string"==typeof this.options.initialValues&&""!==this.options.initialValues)if("{"===this.options.initialValues[0])o=JSON.parse(this.options.initialValues);else{o={};const t=a()(this.options.initialValues.split(this.options.separator));for(const e of t){const t=e.split(":"),i=t[0].trim(),n=t[1].trim();o[i]=n}}const l=a()(n.split(this.options.separator));for(const t of l){let e=t;o[t]&&(e=o[t]),i.push({id:p.Z.removeHTML(t),text:p.Z.removeHTML(e)})}e(i)})},initializeTags(){this.options.tags&&"string"==typeof this.options.tags&&("["===this.options.tags.substr(0,1)?this.options.tags=JSON.parse(this.options.tags):this.options.tags=this.options.tags.split(this.options.separator)),this.options.tags&&!this.options.allowNewItems&&(this.options.data=this.options.tags.map((t=>({id:t,text:t}))),this.options.multiple=!0,delete this.options.tags)},async initializeOrdering(){if(!this.options.orderable)return;const t=(await i.e(37578).then(i.t.bind(i,37578,23))).default,e=()=>{const e=this.$select2[0].querySelector(".select2-choices");new t(e,{draggable:"li",dragClass:"select2-choice-dragging",chosenClass:"dragging",onStart:()=>this.$el.select2("onSortStart"),onEnd:()=>this.$el.select2("onSortEnd")})};this.$el.on("change",e.bind(this)),e()},async initializeSelect2(){Promise.all([i.e(14894),i.e(69106)]).then(i.bind(i,35502)),i.e(30385).then(i.bind(i,30385)),await i.e(1891).then(i.t.bind(i,1891,23));try{this.options.language&&"en"!==this.options.language&&await i(45753)(`./select2_locale_${this.options.language}`)}catch{console.warn("Language file could not be loaded",this.options.language)}function t(t,e){return t?(this.options.debug&&console.debug("callback",t,e),"string"==typeof t&&(t=window[t]),t(e)):t}this.options.formatResultCssClass=t=>{if(t.id)return"select2-option-"+t.id.toLowerCase().replace(/[ \:\)\(\[\]\{\}\_\+\=\&\*\%\#]/g,"-")},this.$el.select2(this.options),this.$el.on("select2-selected",(e=>t(this.options.onSelected,e))),this.$el.on("select2-selecting",(e=>t(this.options.onSelecting,e))),this.$el.on("select2-deselecting",(e=>t(this.options.onDeselecting,e))),this.$el.on("select2-deselected",(e=>t(this.options.onDeselected,e))),this.$select2=this.$el.parent().find(".select2-container"),this.$el.parent().off("close.plone-modal.patterns"),this.options.orderable&&this.$select2.addClass("select2-orderable")},opened(){return 1===a()(".select2-dropdown-open",this.$el.parent()).length},async init(){const t=new d.Z;if(this.options.language=t.currentLanguage,this.options.allowNewItems=!this.options.allowNewItems||JSON.parse(this.options.allowNewItems),this.options.ajax||this.options.vocabularyUrl){this.options.vocabularyUrl&&(this.options.multiple=void 0===this.options.multiple||this.options.multiple,this.options.ajax=this.options.ajax||{},this.options.ajax.url=this.options.vocabularyUrl,this.options.initSelection=(t,e)=>{const i=[],n=t.val();for(const t of n.split(this.options.separator)){const e=p.Z.removeHTML(t);i.push({id:e,text:e})}e(i)});let t="";const e=parseInt(this.options.ajaxTimeout||300,10);delete this.options.ajaxTimeout,this.options.ajax=a().extend({quietMillis:e,data:(e,i)=>(t=e,{query:e,page_limit:10,page:i}),results:e=>{let i=e.results;if(this.options.vocabularyUrl){const n=[];for(const t of e.results)n.push(t.id);i=[];const a=""===t||n.includes(t);this.options.allowNewItems&&!a&&(t=p.Z.removeHTML(t),i.push({id:t,text:t}));for(const t of e.results)i.push(t)}return{results:i}}},this.options.ajax)}else if(this.options.multiple&&this.$el.is("select")){this.$el.attr("multiple",!0);const t=this.$el.val()||[],e=[...this.el.querySelectorAll("option")].map((t=>({text:t.innerHTML,id:t.value}))),i=document.createElement("input");i.type="hidden",i.value=t.join(this.options.separator),i.className=this.el.getAttribute("class"),i.name=this.el.name,i.id=this.el.id,this.el.after(i),this.el.remove(),this.el=i,this.$el=a()(i),this.options.data=e}this.initializeValues(),this.initializeTags(),await this.initializeSelect2(),await this.initializeOrdering()}});const u=37,m=39;var g=s.Z.extend({name:"relateditems",trigger:".pat-relateditems",parser:"mockup",currentPath:void 0,selectedUIDs:[],openAfterInit:void 0,defaults:{vocabularyUrl:null,attributes:["UID","Title","portal_type","path","getURL","getIcon","is_folderish","review_state"],basePath:"",pageSize:10,browsing:void 0,closeOnSelect:!0,contextPath:void 0,dropdownCssClass:"pat-relateditems-dropdown",favorites:[],recentlyUsed:!1,recentlyUsedMaxItems:20,recentlyUsedKey:"relateditems_recentlyused",maximumSelectionSize:-1,minimumInputLength:0,mode:"browse",orderable:!0,pathOperator:"plone.app.querystring.operation.string.path",rootPath:"/",rootUrl:"",scanSelection:!1,selectableTypes:null,separator:",",sortOn:null,sortOrder:"ascending",tokenSeparators:[","," "],upload:!1,uploadAllowView:void 0,breadcrumbTemplateSelector:null,favoriteTemplateSelector:null,recentlyusedTemplateSelector:null,resultTemplateSelector:null,selectionTemplateSelector:null,toolbarTemplateSelector:null,multiple:!0,ajaxTimeout:500},recentlyUsed(t){let e=p.Z.storage.get(this.options.recentlyUsedKey)||[];e=e.slice(e.length-1e3,e.length),t&&e.filter(this.isSelectable.bind(this));const i=parseInt(this.options.recentlyUsedMaxItems,10);return i&&(e=e.slice(e.length-i,e.length)),e},applyTemplate(t,e){let i;this.options[t+"TemplateSelector"]&&(i=a()(this.options[t+"TemplateSelector"]).html()),i||(i=this.options[t+"Template"]?this.options[t+"Template"]:this[t+"Template"]);const n=a().extend(!0,{},this.options,e,{browsing:this.browsing,open_folder:(0,r.ZP)("Open folder"),current_directory:(0,r.ZP)("current directory:"),one_level_up:(0,r.ZP)("Go one level up")});return n._item=e,l().template(i)(n)},setAjax(){const t=parseInt(this.options.ajaxTimeout||500,10),e={url:this.options.vocabularyUrl,dataType:"JSON",quietMillis:t,data:(t,e)=>{const i=[];t&&(t="*"+t+"*",i.push({i:"SearchableText",o:"plone.app.querystring.operation.string.contains",v:t})),!this.browsing&&this.options.selectableTypes&&i.push({i:"portal_type",o:"plone.app.querystring.operation.selection.any",v:this.options.selectableTypes}),i.push({i:"path",o:this.options.pathOperator,v:this.options.rootPath+this.currentPath+(this.browsing?"::1":"")});let n=this.options.sortOn,a=n?this.options.sortOrder:null;this.browsing&&null===n&&(n="getObjPositionInParent",a="ascending");return{query:JSON.stringify({criteria:i,sort_on:n,sort_order:a}),attributes:JSON.stringify(this.options.attributes),batch:JSON.stringify({page:e||1,size:this.options.pageSize})}},results:(t,e)=>{const i=e*this.options.pageSize<t.total;let n=t.results;this.selectedUIDs=(this.$el.select2("data")||[]).map((t=>t.UID)),n=n.filter((t=>!!(this.browsing&&t.is_folderish||this.isSelectable(t)&&-1===this.selectedUIDs.indexOf(t.UID))));const a=this.currentPath.split("/");return 1===e&&this.browsing&&a.length>1&&"/"!==this.currentPath&&(n=[{oneLevelUp:!0,Title:(0,r.ZP)("One level up"),path:a.slice(0,a.length-1).join("/")||"/",currentPath:this.currentPath,is_folderish:!0,selectable:!1}].concat(n)),{results:n,more:i}}};this.options.ajax=e},async renderToolbar(){let t;const e=this.currentPath.split("/");let i="",n="";for(const t of e)if(""!==t){const e={};e.path=i=`${i}/${t}`,e.text=t,n+=this.applyTemplate("breadcrumb",e)}let o="";for(const t of this.options.favorites){const e=l().clone(t);e.path=e.path.substr(this.options.rootPath.length)||"/",o+=this.applyTemplate("favorite",e)}let s="";if(this.options.recentlyUsed){const t=this.recentlyUsed(!0);for(const e of t.reverse())s+=this.applyTemplate("recentlyused",e)}t=this.applyTemplate("toolbar",{items:n,favItems:o,favText:(0,r.ZP)("Favorites"),searchText:(0,r.ZP)("Current path:"),searchModeText:(0,r.ZP)("Search"),browseModeText:(0,r.ZP)("Browse"),recentlyUsedItems:s,recentlyUsedText:(0,r.ZP)("Recently Used"),icon_root:await p.Z.resolveIcon("house-fill"),icon_recently_used:await p.Z.resolveIcon("grid-fill"),icon_favorites:await p.Z.resolveIcon("star-fill"),icon_upload:await p.Z.resolveIcon("cloud-arrow-up"),upload:this.options.upload,upload_text:(0,r.ZP)("Upload")}),this.$toolbar.html(t),a()(".pat-relateditems-dropdown").off("mouseup"),a()(".pat-relateditems-dropdown").on("mouseup",(t=>{t.stopPropagation()})),a()("button.mode.search",this.$toolbar).on("click",(t=>{t.preventDefault(),this.browsing?(a()("button.mode.search",this.$toolbar).toggleClass("btn-primary btn-default"),a()("button.mode.browse",this.$toolbar).toggleClass("btn-primary btn-default"),this.browsing=!1,this.$el.select2("data").length>0&&(this.openAfterInit=!0),this.openAfterInit||(this.$el.select2("close"),this.$el.select2("open"))):(this.$el.select2("close"),this.$el.select2("open"))})),a()("button.mode.browse",this.$toolbar).on("click",(t=>{t.preventDefault(),this.browsing?(this.$el.select2("close"),this.$el.select2("open")):(a()("button.mode.search",this.$toolbar).toggleClass("btn-primary btn-default"),a()("button.mode.browse",this.$toolbar).toggleClass("btn-primary btn-default"),this.browsing=!0,this.$el.select2("data").length>0&&(this.openAfterInit=!0),this.openAfterInit||(this.$el.select2("close"),this.$el.select2("open")))})),a()("a.crumb",this.$toolbar).on("click",(t=>{t.preventDefault(),t.stopPropagation(),this.browseTo(a()(t.currentTarget).attr("href"))})),a()("a.fav",this.$toolbar).on("click",(t=>{t.preventDefault(),t.stopPropagation(),this.browseTo(a()(t.currentTarget).attr("href"))})),this.options.recentlyUsed&&a()(".pat-relateditems-recentlyused-select",this.$toolbar).on("click",(t=>{t.preventDefault();const e=a()(t.currentTarget).data("uid");let i=this.recentlyUsed().filter((t=>t.UID===e));if(i.length>0&&(i=i[0],this.selectItem(i),this.options.maximumSelectionSize>0)){if(this.$el.select2("data").length>=this.options.maximumSelectionSize)return}})),this.options.upload&&p.Z.featureSupport.dragAndDrop()&&p.Z.featureSupport.fileApi()&&(this.options.uploadAllowView?a().ajax({url:this.options.uploadAllowView,dataType:"JSON",data:{path:this.options.rootPath+this.currentPath},type:"GET",success:t=>{this.initUploadView(!t.allowUpload)}}):this.initUploadView())},async initUploadView(t){let e=await Promise.resolve().then(i.bind(i,37103));e=e.default;const n=this.$toolbar[0].querySelector(".upload button");n.disabled=t;const o=this.$toolbar[0].querySelector(".upload .pat-upload"),l={success:(t,e)=>{const i=e.UID;if(i){new p.Z.QueryHelper({vocabularyUrl:this.options.vocabularyUrl,attributes:this.options.attributes}).search("UID","plone.app.querystring.operation.selection.is",i,(t=>{const e=this.$el.select2("data");e.push.apply(e,t.results),this.$el.select2("data",e,!0),this.emit("selected"),this.popover.hide()}),!1)}},uloadMultiple:!0,allowPathSelection:!1,relativePath:"fileUpload",baseUrl:this.options.rootUrl},s=new e(a()(o),l);n.addEventListener("show.bs.dropdown",(()=>{this.currentPath!==s.currentPath&&s.setPath(this.currentPath)}))},browseTo(t){this.emit("before-browse"),this.currentPath=t,this.$el.select2("close"),this.renderToolbar(),this.$el.select2("open"),this.emit("after-browse")},selectItem(t){this.emit("selecting");const e=this.$el.select2("data");if(e.push(t),this.$el.select2("data",e,!0),this.options.recentlyUsed){const e=this.recentlyUsed(),i=e.filter((e=>e.UID===t.UID));i.length>0&&e.splice(e.indexOf(i[0]),1),e.push(t),p.Z.storage.set(this.options.recentlyUsedKey,e)}this.emit("selected")},deselectItem(t){this.emit("deselecting");const e=this.$el.select2("data");e.forEach(((i,n)=>{i.UID===t.UID&&e.splice(n,1)})),this.$el.select2("data",e,!0),this.emit("deselected")},isSelectable(t){return!1!==t.selectable&&(null===this.options.selectableTypes||-1!==this.options.selectableTypes.indexOf(t.portal_type))},async init(){(await i.e(35808).then(i.t.bind(i,35808,23))).Dropdown,i.e(76492).then(i.bind(i,76492)),this.breadcrumbTemplate=(await i.e(8147).then(i.t.bind(i,8147,17))).default,this.favoriteTemplate=(await i.e(58640).then(i.t.bind(i,58640,17))).default,this.recentlyusedTemplate=(await i.e(77427).then(i.t.bind(i,77427,17))).default,this.resultTemplate=(await i.e(71531).then(i.t.bind(i,71531,17))).default,this.selectionTemplate=(await i.e(8443).then(i.t.bind(i,8443,17))).default,this.toolbarTemplate=(await i.e(16071).then(i.t.bind(i,16071,17))).default,this.browsing="search"!==this.options.mode,this.options.rootPath=this.options.rootPath.replace(/\/$/,""),this.currentPath=this.options.basePath.substr(this.options.rootPath.length)||"/",this.setAjax(),this.$el.wrap('<div class="pat-relateditems-container" />'),this.$container=this.$el.parents(".pat-relateditems-container"),h.prototype.initializeValues.call(this),h.prototype.initializeTags.call(this),this.options.formatSelection=t=>{t=a().extend(!0,{Title:"",getIcon:"",getURL:"",path:"",portal_type:"",review_state:""},t);const e=a()(this.applyTemplate("selection",t));if(this.options.scanSelection&&c.Z.scan(e),1==this.options.maximumSelectionSize){let e=t.path,i=e.split("/");i=i.slice(0,-1),e=i.join("/"),this.currentPath=e,this.renderToolbar()}return e};const t=await p.Z.resolveIcon("arrow-left-circle"),e=await p.Z.resolveIcon("arrow-right-circle");this.options.formatResult=i=>{i.selectable=this.isSelectable(i),i=a().extend(!0,{Title:"",getIcon:"",getURL:"",is_folderish:!1,oneLevelUp:!1,iconLevelUp:t,iconLevelDown:e,path:"",portal_type:"",review_state:"",selectable:!1},i),-1!==this.selectedUIDs.indexOf(i.UID)&&(i.selectable=!1);const n=a()(this.applyTemplate("result",i));return a()(".pat-relateditems-result-select",n).on("click",(t=>{const e=t.currentTarget;if(t.preventDefault(),a()(e).is(".selectable")){const t=a()(e).parents(".pat-relateditems-result");if(t.is(".pat-relateditems-active"))t.removeClass("pat-relateditems-active"),this.deselectItem(i);else{if(this.options.maximumSelectionSize>0){this.$el.select2("data").length>=this.options.maximumSelectionSize&&this.$el.select2("close")}this.selectItem(i),t.addClass("pat-relateditems-active"),this.options.closeOnSelect&&this.$el.select2("close")}}})),a()(".pat-relateditems-result-browse",n).on("click",(t=>{t.preventDefault(),t.stopPropagation();const e=a()(t.currentTarget).data("path");this.browseTo(e)})),a()(n)},this.options.initSelection=(t,e)=>{const i=a()(t).val();if(""!==i){const t=i.split(this.options.separator);new p.Z.QueryHelper(a().extend(!0,{},this.options,{pattern:this})).search("UID","plone.app.querystring.operation.list.contains",t,(i=>{const n=i.results.reduce(((t,e)=>(t[e.UID]=e,t)),{});try{e(t.map((t=>n[t])).filter((t=>void 0!==t)))}catch(t){}this.openAfterInit&&(this.$el.select2("open"),this.openAfterInit=void 0)}),!1)}},this.options.tokenizer=t=>{"auto"===this.options.mode&&(this.browsing=!t)},this.options.id=t=>t.UID,await h.prototype.initializeSelect2.call(this),await h.prototype.initializeOrdering.call(this),this.$toolbar=a()('<div class="toolbar d-flex" />'),this.$container.prepend(this.$toolbar),this.$el.on("select2-selecting",(t=>{this.isSelectable(t.choice)||t.preventDefault()})),this.renderToolbar(),this.$el.on("select2-loaded",(()=>{let t=window.innerHeight||document.documentElement.clientHeight;const e=a()(".pat-relateditems-dropdown.select2-drop-active .select2-results")[0],i=t-e.getBoundingClientRect().top-18;a()(e).css("max-height",`${i}px`)})),a()(document).on("keyup",this.$el,(t=>{if(h.prototype.opened.call(this)&&(t.which===u||t.which===m)){t.stopPropagation();const e=t.which===u?".pat-relateditems-result.one-level-up":".select2-highlighted",i=".pat-relateditems-result-browse",n=a()(i,e);if(1!==n.length)return;const o=n.data("path");this.browseTo(o)}}))}})},99558:function(t,e,i){i.r(e),i.d(e,{default:function(){return k}});var n=i(26373),a=i.n(n),o=i(24481),l=i.n(o),s=i(11191),r=i(50360),p=i(47575),c=i.n(p),d='<div>\n  <div class="linkModal">\n    <h1><%- insertHeading %></h1>\n    <% if(_.contains(linkTypes, \'upload\')){ %>\n    <p class="info"><%- insertLinkHelp %></p>\n    <% } %>\n\n    <div class="linkTypes pat-autotoc autotabs"\n         data-pat-autotoc="section:fieldset;levels:legend;IDPrefix:tinymce-autotoc-">\n\n      <% if(_.contains(linkTypes, \'internal\')){ %>\n      <fieldset class="linkType internal" data-linkType="internal">\n        <legend id="tinylink-internal"><%- internal %></legend>\n        <div>\n          <div class="main mb-2">\n            \x3c!-- this gives the name to the "linkType" --\x3e\n            <input type="text" name="internal" class="form-control" />\n          </div>\n        </div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'upload\')){ %>\n      <fieldset class="linkType upload" data-linkType="upload">\n        <legend id="tinylink-upload"><%- uploadText %></legend>\n        <div class="uploadify-me"></div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'external\')){ %>\n      <fieldset class="linkType external" data-linkType="external">\n        <legend id="tinylink-external"><%- external %></legend>\n        <div class="main mb-2">\n          <label for="external"><%- externalText %></label>\n          <input type="text" name="external" class="form-control" />\n        </div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'email\')){ %>\n      <fieldset class="linkType email" data-linkType="email">\n        <legend id="tinylink-email"><%- emailText %></legend>\n        <div>\n          <div class="main mb-2">\n            <label><%- emailText %></label>\n            <input type="text" name="email" class="form-control" />\n          </div>\n          <div class="mb-2">\n            <label><%- subjectText %></label>\n            <input type="text" name="subject" class="form-control" />\n          </div>\n        </div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'anchor\')){ %>\n      <fieldset class="linkType anchor" data-linkType="anchor">\n        <legend id="tinylink-anchor"><%- anchor %></legend>\n        <div>\n          <div class="main mb-2">\n            <label><%- anchorLabel %></label>\n            <div class="input-wrapper">\n              <select name="anchor" class="pat-select2" data-pat-select2="width:500px"></select>\n            </div>\n          </div>\n        </div>\n      </fieldset>\n      <% } %>\n\n    </div>\x3c!-- / tabs --\x3e\n\n    <div class="common-controls mt-3 border-top pt-3">\n      <div class="mb-2">\n        <label><%- target %></label>\n        <select name="target" class="form-select">\n          <% _.each(targetList, function(target){ %>\n            <option value="<%- target.value %>"><%- target.text %></option>\n          <% }); %>\n        </select>\n      </div>\n      <div class="mb-2">\n        <label><%- titleText %></label>\n        <input type="text" name="title" class="form-control" />\n      </div>\n    </div>\n\n    <input type="submit" class="btn btn-secondary plone-btn me-1" name="cancel" value="<%- cancelBtn %>" />\n    <input type="submit" class="btn btn-primary plone-btn" name="insert" value="<%- insertBtn %>" />\n  </div>\n</div>\n',h='<div>\n  <div class="linkModal">\n    <h1><%- insertHeading %></h1>\n    <% if(_.contains(linkTypes, \'uploadImage\')){ %>\n    <p class="info"><%- insertImageHelp %></p>\n    <% } %>\n\n    <div class="linkTypes pat-autotoc autotabs"\n         data-pat-autotoc="section:fieldset;levels:legend;IDPrefix:tinymce-autotoc-">\n\n        <% if(_.contains(linkTypes, \'image\')){ %>\n      <fieldset class="linkType image" data-linkType="image">\n        <legend id="tinylink-image"><%- internalImageText %></legend>\n        <div>\n          <div class="main mb-2">\n            <input type="text" name="image" class="form-control" />\n          </div>\n          <div class="scale mb-2">\n            <label><%- scaleText %></label>\n            <select name="scale" class="form-select">\n              <% _.each(Object.keys(pictureVariants), function(key) { %>\n                <option value="<%- key %>" <% if (key === options.defaultSrcset) { %>selected<% } %> >\n                  <%- pictureVariants[key].title %>\n                </option>\n              <% }); %>\n            </select>\n          </div>\n        </div>\n      </fieldset>\n        <% } %>\n\n      <% if(_.contains(linkTypes, \'uploadImage\')){ %>\n      <fieldset class="linkType uploadImage" data-linkType="uploadImage">\n        <legend id="tinylink-uploadImage"><%- uploadText %></legend>\n        <div class="uploadify-me"></div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'externalImage\')){ %>\n      <fieldset class="linkType externalImage" data-linkType="externalImage">\n        <legend id="tinylink-externalImage"><%- externalImage %></legend>\n        <div>\n          <div class="main">\n            <label><%- externalImageText %></label>\n            <input type="text" name="externalImage" class="form-control" />\n          </div>\n        </div>\n      </fieldset>\n      <% } %>\n\n    </div>\x3c!-- / tabs --\x3e\n\n    <div class="common-controls mt-3 border-top pt-3">\n      <div class="title mb-2">\n        <label><%- titleText %></label>\n        <input type="text" name="title" class="form-control" />\n      </div>\n      <div class="text mb-2">\n        <label><%- altText %></label>\n        <input type="text" name="alt" class="form-control" />\n      </div>\n      <% if(imageCaptioningEnabled){ %>\n      <div class="captionFromDescription form-check mb-2">\n        <input type="checkbox" name="captionFromDescription" class="form-check-input" />\n        <label for="captionFromDescription" class="form-check-label">\n          <%- captionFromDescriptionText %>\n        </label>\n      </div>\n      <div class="caption mb-2">\n        <label><%- captionText %></label>\n        <textarea name="caption" class="form-control"></textarea>\n      </div>\n      <% } %>\n      <div class="align mb-2">\n        <label><%- imageAlignText %></label>\n        <select name="align" class="form-select">\n          <% _.each(Object.keys(options.imageClasses), function(align){ %>\n              <option value="<%- align %>">\n              <%- options.imageClasses[align] %>\n              </option>\n          <% }); %>\n        </select>\n      </div>\n      <div class="enable-zoom mb-2">\n        <input type="checkbox" name="enableImageZoom" class="form-check-input" />\n        <label for="enableImageZoom" class="form-check-label">\n          <%- enableImageZoom %>\n        </label>\n      </div>\n    </div>\n\n    <input type="submit" class="btn btn-secondary plone-btn me-1" name="cancel" value="<%- cancelBtn %>" />\n    <input type="submit" class="btn btn-primary plone-btn" name="insert" value="<%- insertBtn %>" />\n\n  </div>\n</div>\n',u=i(24283),m=(s.Z.extend({name:"autotoc",trigger:".pat-autotoc",parser:"mockup",defaults:{section:"section",levels:"h1,h2,h3",IDPrefix:"autotoc-item-",classTOCName:"autotoc-nav",classSectionName:"autotoc-section",classLevelPrefixName:"autotoc-level-",classActiveName:"active",scrollDuration:"slow",scrollEasing:"swing"},init:function(){i.e(4650).then(i.bind(i,4650));var t=this;t.$toc=a()("<nav/>").addClass(t.options.classTOCName),t.options.prependTo?t.$toc.prependTo(t.options.prependTo):t.options.appendTo?t.$toc.appendTo(t.options.appendTo):t.$toc.prependTo(t.$el),t.options.className&&t.$el.addClass(t.options.className),a()(t.options.section,t.$el).addClass(t.options.classSectionName);var e=t.$el.hasClass("autotabs"),n=null;a()(t.options.levels,t.$el).each((function(i){var o=a()(this),l=o.prop("id")?o.prop("id"):o.parents(t.options.section).prop("id");(!l||a()("#"+l).length>0)&&(l=t.options.IDPrefix+t.name+"-"+i),window.location.hash==="#"+l&&(n=l),null===n&&o.hasClass(t.options.classActiveName)&&(n=l),o.data("navref",l),a()("<a/>").appendTo(t.$toc).text(o.text()).attr("id",l).attr("href","#"+l).addClass(t.options.classLevelPrefixName+t.getLevel(o)).on("click",(function(i,n){i.stopPropagation(),i.preventDefault(),n||(n={doScroll:!0,skipHash:!1});var l=a()(this);t.$toc.children("."+t.options.classActiveName).removeClass(t.options.classActiveName),t.$el.children("."+t.options.classActiveName).removeClass(t.options.classActiveName),a()(i.target).addClass(t.options.classActiveName),o.parents(t.options.section).addClass(t.options.classActiveName),!1!==n.doScroll&&t.options.scrollDuration&&o&&!e&&a()("body,html").animate({scrollTop:o.offset().top},t.options.scrollDuration,t.options.scrollEasing),0!==t.$el.parents(".plone-modal").length&&t.$el.trigger("resize.plone-modal.patterns"),a()(this).trigger("clicked"),n.skipHash||window.history&&window.history.pushState&&window.history.pushState({},"","#"+l.attr("id"))})),o.data("autotoc-trigger-id",l)})),n?a()("a#"+n).trigger("click",{doScroll:!0,skipHash:!0}):t.$toc.find("a").first().trigger("click",{doScroll:!1,skipHash:!0})},getLevel:function(t){var e=0;return a().each(this.options.levels.split(","),(function(i,n){if(1===t.filter(n).length)return e=i+1,!1})),e}}),i(81142),i(37103)),g=s.Z.extend({name:"linktype",trigger:".pat-linktype-dummy",defaults:{linkModal:null},init:function(){this.linkModal=this.options.linkModal,this.tinypattern=this.options.tinypattern,this.tiny=this.tinypattern.tiny,this.dom=this.tiny.dom},getEl:function(){return this.$el.find("input")},value:function(){return this.getEl().val().trim()},toUrl:function(){return this.value()},load:function(t){let e=this.tiny.dom.getAttrib(t,"data-val");this.getEl().attr("value",e)},set:function(t){var e=this.getEl();e.attr("value",t),e.val(t)},attributes:function(){return{"data-val":this.value()}},updateRelatedItems:function(){}}),f=g.extend({name:"externallinktype",trigger:".pat-externallinktype-dummy",init:function(){g.prototype.init.call(this),this.getEl().on("change",(function(){var t=a()(this).val();new RegExp("https?://").test(t)||-1!==a()(this).val().split("/")[0].indexOf(".")&&a()(this).val("http://"+t)}))}}),v=g.extend({name:"internallinktype",trigger:".pat-internallinktype-dummy",init:function(){this.getEl().length&&(g.prototype.init.call(this),this.getEl().addClass("pat-relateditems"),this.createRelatedItems())},getEl:function(){return this.$el.find("input:not(.select2-input)")},createRelatedItems:function(){if(this.getEl().length){var t=this.linkModal.options.relatedItems;t.upload=!1,this.relatedItems=new u.default(this.getEl(),t)}},updateRelatedItems:function(t){this.relatedItems||this.createRelatedItems(),this.relatedItems.selectItem(t)},value:function(){var t=this.getEl().select2("data");return t&&"object"==typeof t&&(t=t[0]),t},toUrl:function(){var t=this.value();return t?this.tinypattern.generateUrl(t):null},load:function(t){var e=this.tiny.dom.getAttrib(t,"data-val");e&&this.set(e)},set:function(t){this.getEl().val(t).trigger("change"),this.updateRelatedItems(t)},attributes:function(){var t=this.value();return t?{"data-val":t.UID}:{}}}),y=g.extend({name:"uploadlinktype",trigger:".pat-uploadlinktype-dummy",getDelegatedLinkType:function(){return"uploadImage"===this.linkModal.linkType?this.linkModal.linkTypes.image:this.linkModal.linkTypes.internal},toUrl:function(){return this.getDelegatedLinkType().toUrl()},attributes:function(){return this.getDelegatedLinkType().attributes()},set:function(t){return this.getDelegatedLinkType().set(t)},load:function(t){return this.getDelegatedLinkType().load(t)},value:function(){return this.getDelegatedLinkType().value()}}),b=v.extend({name:"imagelinktype",trigger:".pat-imagelinktype-dummy",toUrl:function(){var t=this.value();return this.tinypattern.generateImageUrl(t,this.linkModal.getScaleFromSrcset(this.linkModal.$scale.val()))}}),T=g.extend({name:"emaillinktype",trigger:".pat-emaillinktype-dummy",toUrl:function(){var t=this.value();if(t){var e=this.getSubject(),i="mailto:"+t;return e&&(i+="?subject="+e),i}return null},load:function(t){g.prototype.load.apply(this,[t]),this.linkModal.$subject.val(this.tiny.dom.getAttrib(t,"data-subject"))},getSubject:function(){return this.linkModal.$subject.val()},attributes:function(){var t=g.prototype.attributes.call(this);return t["data-subject"]=this.getSubject(),t}}),x=g.extend({name:"anchorlinktype",trigger:".pat-anchorlinktype-dummy",init:function(){g.prototype.init.call(this),this.$select=this.$el.find("select"),this.anchorNodes=[],this.anchorData=[],this.populate()},value:function(){var t=this.$select.select2("data");return t&&"object"==typeof t&&(t=t.id),t},populate:function(){var t,e,i,n,o,l=this;l.$select.find("option").remove(),l.anchorNodes=[],l.anchorData=[];var s=l.tiny.dom.select(".mceItemAnchor,.mce-item-anchor");for(e=0;e<s.length;e+=1)t=s[e],(n=l.tiny.dom.getAttrib(t,"name"))||(n=l.tiny.dom.getAttrib(t,"id")),""!==n&&(l.anchorNodes.push(t),l.anchorData.push({name:n,title:n}));if((s=l.tiny.dom.select(l.linkModal.options.anchorSelector)).length>0)for(e=0;e<s.length;e+=1)if(t=s[e],""!==(o=a()(t).text().replace(/^\s+|\s+$/g,""))){n=(n=o.toLowerCase().substring(0,1024)).replace(/[^a-z0-9]/g,"-");var r=!1;for(i=0;i<l.anchorNodes.length;i+=1){var p=l.anchorData[i];if(p.name===n){r=!0,p.title=o;break}}r||(l.anchorData.push({name:n,title:o,newAnchor:!0}),l.anchorNodes.push(t))}if(l.anchorNodes.length>0)for(e=0;e<l.anchorData.length;e+=1){var c=l.anchorData[e];l.$select.append('<option value="'+e+'">'+c.title+"</option>")}else l.$select.append("<option>No anchors found..</option>")},getIndex:function(t){for(var e=0;e<this.anchorData.length;e+=1){if(this.anchorData[e].name===t)return e}return 0},toUrl:function(){var t=this.value();if(t){var e=parseInt(t,10),i=this.anchorNodes[e],n=this.anchorData[e];return n.newAnchor&&(i.innerHTML='<a name="'+n.name+'" class="mce-item-anchor"></a>'+i.innerHTML),"#"+n.name}return null},set:function(t){var e=this.getIndex(t);this.$select.select2("data",""+e)}});c().PluginManager.add("ploneimage",(function(t){t.ui.registry.addButton("ploneimage",{icon:"image",text:"Insert image",tooltip:"Insert/edit image",onAction:t.settings.addImageClicked})})),c().PluginManager.add("plonelink",(function(t){t.ui.registry.addButton("plonelink",{icon:"link",tooltip:"Insert/edit link",shortcut:"Ctrl+K",onAction:t.settings.addLinkClicked,stateSelector:"a[href]"}),t.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){t.execCommand("unlink")},stateSelector:"a[href]"})}));var k=s.Z.extend({name:"linkmodal",trigger:".pat-linkmodal",defaults:{anchorSelector:"h1,h2,h3",linkTypes:[],initialLinkType:"internal",text:{insertHeading:"Insert Link"},linkTypeClassMapping:{internal:v,upload:y,external:f,email:T,anchor:x,image:b,uploadImage:y,externalImage:g}},linkTypeTemplateMapping:{internal:d,upload:d,external:d,email:d,anchor:d,image:h,uploadImage:h,externalImage:h},template:function(t){return l().template(this.linkTypeTemplateMapping[this.linkType])(t)},init:function(){var t=this;t.tinypattern=t.options.tinypattern,t.tinypattern.options.anchorSelector&&(t.options.anchorSelector=t.tinypattern.options.anchorSelector),t.tiny=t.tinypattern.tiny,t.dom=t.tiny.dom,t.linkType=t.options.initialLinkType,t.linkTypes={},t.modal=r.Z.patterns["plone-modal"].init(t.$el,{html:t.generateModalHtml(),content:null,buttons:".plone-btn",reloadWindowOnClose:!1,templateOptions:{classDialog:"modal-dialog modal-lg",reloadWindowOnClose:!1},actionOptions:{reloadWindowOnClose:!1},backdropOptions:{zIndex:"1340",closeOnClick:!1}}),t.modal.on("shown",(e=>{t.modalShown.apply(t,[e])}))},isOnlyTextSelected:function(){var t=this.tiny.selection.getContent();if(/</.test(t)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(t)||-1===t.indexOf("href=")))return!1;if(this.anchorElm){var e=this.anchorElm.childNodes;if(0===e.length)return!1;for(var i=e.length-1;i>=0;i--)if(3!==e[i].nodeType)return!1}return!0},generateModalHtml:function(){return this.template({options:this.options,upload:this.options.upload,text:this.options.text,insertHeading:this.options.text.insertHeading,insertImageHelp:this.options.text.insertImageHelp,uploadText:this.options.text.upload,insertLinkHelp:this.options.text.insertLinkHelp,internal:this.options.text.internal,external:this.options.text.external,anchor:this.options.text.anchor,anchorLabel:this.options.text.anchorLabel,target:this.options.text.target,linkTypes:this.options.linkTypes,externalText:this.options.text.externalText,emailText:this.options.text.email,subjectText:this.options.text.subject,targetList:this.options.targetList,titleText:this.options.text.title,internalImageText:this.options.text.internalImage,externalImage:this.options.text.externalImage,externalImageText:this.options.text.externalImageText,altText:this.options.text.alt,imageAlignText:this.options.text.imageAlign,captionFromDescriptionText:this.options.text.captionFromDescription,enableImageZoom:this.options.text.enableImageZoom,captionText:this.options.text.caption,scaleText:this.options.text.scale,pictureVariants:this.options.pictureVariants,imageCaptioningEnabled:this.options.imageCaptioningEnabled,cancelBtn:this.options.text.cancelBtn,insertBtn:this.options.text.insertBtn})},isImageMode:function(){return-1!==["image","uploadImage","externalImage"].indexOf(this.linkType)},initElements:function(){var t=this;t.$target=a()('select[name="target"]',t.modal.$modal),t.$button=a()('.modal-footer input[name="insert"]',t.modal.$modal),t.$title=a()('input[name="title"]',t.modal.$modal),t.$subject=a()('input[name="subject"]',t.modal.$modal),t.$alt=a()('input[name="alt"]',t.modal.$modal),t.$align=a()('select[name="align"]',t.modal.$modal),t.$scale=a()('select[name="scale"]',t.modal.$modal),t.$enableImageZoom=a()('input[name="enableImageZoom"]',t.modal.$modal),t.$captionFromDescription=a()('input[name="captionFromDescription"]',t.modal.$modal),t.$caption=a()('textarea[name="caption"]',t.modal.$modal),l().each(t.options.linkTypes,(function(e){var i=a()(".linkType."+e+" .main",t.modal.$modal);i.length&&(t.linkTypes[e]=new t.options.linkTypeClassMapping[e](i,{linkModal:t,tinypattern:t.tinypattern}))})),a()(".autotoc-nav a",t.modal.$modal).on("click",(function(){var e=a()("fieldset.linkType",t.modal.$modal).eq(a()(this).index())[0].className.split(/\s+/);l().each(e,(function(e){-1!==l().indexOf(t.options.linkTypes,e)&&(t.linkType=e)}))})),t.$captionFromDescription.on("change",(function(){this.checked?t.$caption.prop("disabled",!0):t.$caption.prop("disabled",!1)}))},getLinkUrl:function(){return this.linkTypes[this.linkType].toUrl()},getValue:function(){return this.linkTypes[this.linkType].value()},updateAnchor:function(t){var e=this;e.tiny.focus(),e.tiny.selection.setRng(e.rng);var i=e.$target.val(),n=e.$title.val(),o=a().extend(!0,e.data,{title:n||null,target:i||null,"data-linkType":e.linkType,href:t},e.linkTypes[e.linkType].attributes());e.anchorElm?(e.onlyText&&o.text!==e.initialText&&("innerText"in e.anchorElm?e.anchorElm.innerText=e.data.text:e.anchorElm.textContent=e.data.text),e.tiny.dom.setAttribs(e.anchorElm,o),e.tiny.selection.select(e.anchorElm),e.tiny.undoManager.add()):e.onlyText?e.tiny.insertContent(e.tiny.dom.createHTML("a",o,e.tiny.dom.encode(e.data.text))):e.tiny.execCommand("mceInsertLink",!1,o)},focusElement:function(t){this.tiny.focus(),this.tiny.selection.select(t),this.tiny.nodeChanged()},getScaleFromSrcset:function(t){let e=this.options.pictureVariants[t];return e.sourceset[e.sourceset.length-1].scale},updateImage:function(t){var e=this,i=e.$title.val(),n=e.$captionFromDescription.prop("checked"),o=e.$enableImageZoom.prop("checked"),l=e.$caption.val();e.tiny.focus(),e.tiny.selection.setRng(e.rng);var s=["image-richtext",e.$align.val()];"externalImage"!==e.linkType&&s.push("picture-variant-"+e.$scale.val()),(n||l)&&s.push("captioned"),o&&s.push("zoomable");var r,p,c=a().extend(!0,{},{src:t,title:i||null,alt:e.$alt.val(),class:s.join(" "),"data-linkType":e.linkType,"data-scale":e.getScaleFromSrcset(e.$scale.val())},e.linkTypes[e.linkType].attributes());if("externalImage"!==e.linkType&&(c["data-picturevariant"]=e.$scale.val()),l&&!n&&(c["data-captiontext"]=l),e.imgElm&&!e.imgElm.getAttribute("data-mce-object")){const t=e.dom.getAttrib(e.imgElm,"width"),i=e.dom.getAttrib(e.imgElm,"height");t&&(c.width=t),i&&(c.height=i)}else e.imgElm=null;e.imgElm&&e.dom.remove(e.imgElm),c.id="__mcenew",r=e.dom.createHTML("img",c),e.tiny.insertContent(r),e.imgElm=e.dom.get("__mcenew"),e.dom.setAttrib(e.imgElm,"id",null),(p=e.imgElm).onload=p.onerror=function(){p.onload=p.onerror=null,e.focusElement(p)},e.imgElm.complete&&e.focusElement(e.imgElm)},modalShown:function(t){var e=this;e.initElements(),e.initData(),e.options.upload&&(e.$upload=a()(".uploadify-me",e.modal.$modal),e.options.upload.relatedItems=a().extend(!0,{},e.options.relatedItems),e.options.upload.relatedItems.selectableTypes=e.options.folderTypes,e.$upload.addClass("pat-upload"),new m.default(e.$upload,e.options.upload),e.$upload.on("uploadAllCompleted",function(t,i){e.linkTypes.image?(e.linkTypes.image.set(i.data.UID),a()("#"+a()("#tinylink-image",e.modal.$modal).data("navref")).trigger("click")):(e.linkTypes.internal.set(i.data.UID),a()("#"+a()("#tinylink-internal",e.modal.$modal).data("navref")).trigger("click"))}.bind(e))),e.$button.off("click").on("click",(function(t){if(t.preventDefault(),t.stopPropagation(),e.linkType=e.modal.$modal.find("fieldset.active").data("linktype"),"uploadImage"===e.linkType||"upload"===e.linkType){var i=e.$upload.data().patternUpload;i.dropzone.files.length>0&&(i.processUpload(),e.$upload.on("uploadAllCompleted",(function(t,i){var n=0,a=function(){if(n<5&&!e.linkTypes[e.linkType].value())return n+=1,void setTimeout(a,100);var t=e.getLinkUrl();e.updateImage(t),e.hide()};a()})))}var n;try{n=e.getLinkUrl()}catch(t){return}n&&(e.isImageMode()?e.updateImage(n):e.updateAnchor(n),e.hide())})),a()('.modal-footer input[name="cancel"]',e.modal.$modal).on("click",(function(t){t.preventDefault(),e.hide()}))},show:function(){this.modal.show()},hide:function(){this.modal.hide()},initData:function(){var t,e,i=this;if(i.data={},i.initialText=null,i.rng=i.tiny.selection.getRng(),i.selectedElm=i.tiny.selection.getNode(),i.anchorElm=i.tiny.dom.getParent(i.selectedElm,"a[href]"),i.onlyText=i.isOnlyTextSelected(),i.data.text=i.initialText=i.anchorElm?i.anchorElm.innerText||i.anchorElm.textContent:i.tiny.selection.getContent({format:"text"}),i.data.href=i.anchorElm?i.tiny.dom.getAttrib(i.anchorElm,"href"):"",i.anchorElm?i.data.target=i.tiny.dom.getAttrib(i.anchorElm,"target"):i.tiny.settings.default_link_target&&(i.data.target=i.tiny.settings.default_link_target),(t=i.tiny.dom.getAttrib(i.anchorElm,"rel"))&&(i.data.rel=t),(t=i.tiny.dom.getAttrib(i.anchorElm,"class"))&&(i.data.class=t),(t=i.tiny.dom.getAttrib(i.anchorElm,"title"))&&(i.data.title=t),i.tiny.focus(),i.anchorElm=i.dom.getParent(i.selectedElm,"a[href]"),i.isImageMode()){var n;n=i.selectedElm,i.imgElm=n;var o=i.dom.getAttrib(i.imgElm,"src"),l=i.dom.getAttrib(i.imgElm,"data-captiontext");if(i.$title.val(i.dom.getAttrib(i.imgElm,"title")),i.$alt.val(i.dom.getAttrib(i.imgElm,"alt")),a()(i.imgElm).hasClass("zoomable")&&i.$enableImageZoom.prop("checked",!0),a()(i.imgElm).hasClass("captioned")&&!l?(i.$captionFromDescription.prop("checked",!0),i.$caption.prop("disabled",!0)):(a()(i.imgElm).hasClass("captioned"),i.$captionFromDescription.prop("checked",!1)),l&&i.$caption.val(l),(e=i.dom.getAttrib(i.imgElm,"data-linktype"))&&e in i.linkTypes){i.linkType=e,i.linkTypes[i.linkType].load(i.imgElm);var s=i.dom.getAttrib(i.imgElm,"data-picturevariant");i.$scale.val(s),a()("#tinylink-"+i.linkType,i.modal.$modal).trigger("click")}else o&&i.guessImageLink(o);for(var r=i.dom.getAttrib(i.imgElm,"class").split(" "),p=0;p<r.length;p+=1){var c=r[p];for(var d in i.options.imageClasses)-1!==d.indexOf(c)&&i.$align.val(c)}}else if(i.anchorElm){i.focusElement(i.anchorElm);var h;if(h=i.dom.getAttrib(i.anchorElm,"href"),i.$target.val(i.dom.getAttrib(i.anchorElm,"target")),i.$title.val(i.dom.getAttrib(i.anchorElm,"title")),e=i.dom.getAttrib(i.anchorElm,"data-linktype")){i.linkType=e,i.linkTypes[i.linkType].load(i.anchorElm);var u=a()("#tinylink-"+i.linkType,i.modal.$modal);1===u.length&&a()("#"+u.data("autotoc-trigger-id")).trigger("click")}else h&&i.guessAnchorLink(h)}},guessImageLink:function(t){-1!==t.indexOf(this.options.prependToScalePart)?(this.linkType="image",this.$scale.val(this.tinypattern.getScaleFromUrl(t)),this.linkTypes.image.set(this.tinypattern.stripGeneratedUrl(t))):(this.linkType="externalImage",this.linkTypes.externalImage.set(t))},guessAnchorLink:function(t){if(this.options.prependToUrl&&-1!==t.indexOf(this.options.prependToUrl))this.linkType="internal",this.linkTypes.internal.set(this.tinypattern.stripGeneratedUrl(t));else if(-1!==t.indexOf("mailto:")){this.linkType="email";var e=t.substring(7,t.length).split("?subject=");this.linkTypes.email.set(e[0]),e.length>1&&this.$subject.val(decodeURIComponent(e[1]))}else"#"===t[0]?(this.linkType="anchor",this.linkTypes.anchor.set(t.substring(1))):(this.linkType="external",this.linkTypes.external.set(t))},setSelectElement:function(t,e){t.find("option:selected").prop("selected",!1),e&&t.find('option[value="'+e+'"]').prop("selected",!0)},reinitialize:function(){this.modal.options.html=this.generateModalHtml()}})},37103:function(t,e,i){i.r(e);var n=i(26373),a=i.n(n),o=i(24481),l=i.n(o),s=i(10354),r=i(11191),p=i(62832);let c;e.default=r.Z.extend({name:"upload",trigger:".pat-upload",parser:"mockup",defaults:{showTitle:!0,url:null,className:"upload",wrap:!1,wrapperTemplate:'<div class="upload-wrapper"/>',fileaddedClassName:"dropping",useTus:!1,container:"",ajaxUpload:!0,paramName:"file",addRemoveLinks:!1,autoCleanResults:!0,previewsContainer:".previews",previewTemplate:null,maxFiles:null,maxFilesize:99999999,allowPathSelection:void 0,relatedItems:{attributes:["UID","Title","Description","getURL","portal_type","path","ModificationDate"],batchSize:20,basePath:"/",vocabularyUrl:null,width:500,maximumSelectionSize:1,selectableTypes:["Folder"]}},init:async function(){i.e(83930).then(i.bind(i,83930)),i.e(50794).then(i.bind(i,50794)),c=(await i.e(59625).then(i.t.bind(i,15205,23))).default,c.autoDiscover=!1;const t=(await i.e(94818).then(i.t.bind(i,94818,17))).default;var e=this;void 0===e.options.allowPathSelection&&(e.options.allowPathSelection=e.options.baseUrl&&e.options.relativePath),a()(document).on("paste",(function(t){var i=t.originalEvent.clipboardData.items;if(i)for(var n=0;n<i.length;n++)if(-1!==i[n].type.indexOf("image")){var a=i[n].getAsFile();e.dropzone.addFile(a)}})),e.currentPath=e.options.currentPath,e.currentFile=0;let n=l().template(t)({_t:s.ZP,allowPathSelection:e.options.allowPathSelection});e.$el.addClass(e.options.className),e.$el.append(n),e.$progress=a()(".progress-bar-success",e.$el),e.options.showTitle||e.$el.find("h2.title").hide(),e.options.ajaxUpload||(a()(".fallback",this.$el).remove(),this.$el.hasClass(".upload-container")?this.$el.addClass("no-ajax-upload"):this.$el.closest(".upload-container").addClass("no-ajax-upload")),e.options.wrap&&(e.$el.wrap(e.options.wrapperTemplate),e.$el=e.$el.parent()),e.options.allowPathSelection?(e.$pathInput=a()('input[name="location"]',e.$el),e.relatedItems=await e.setupRelatedItems(e.$pathInput)):(a()('input[name="location"]',e.$el).parent().remove(),e.relatedItems=null),e.$dropzone=a()(".upload-area",e.$el),a()("div.browse-select button.browse",e.$el).on("click",(function(t){t.preventDefault(),t.stopPropagation(),(!e.options.maxFiles||e.dropzone.files.length<e.options.maxFiles)&&e.dropzone.hiddenFileInput.click()}));var o=await this.getDzoneOptions();try{e.dropzone=new c(e.$dropzone[0],o)}catch(t){throw window.DEBUG&&console.log(t),t}e.dropzone.on("maxfilesreached",(function(){e.showHideControls()})),e.dropzone.on("addedfile",(function(){e.showHideControls()})),e.dropzone.on("removedfile",(function(){e.showHideControls()})),e.dropzone.on("success",(function(t,i){var n;try{n=a().parseJSON(i)}catch(t){n=i}e.$el.trigger("uploadAllCompleted",{data:n,path_uid:e.$pathInput?e.$pathInput.val():null})})),e.options.autoCleanResults&&e.dropzone.on("complete",(function(t){t.status===c.SUCCESS&&setTimeout((function(){a()(t.previewElement).fadeOut()}),3e3)})),e.dropzone.on("complete",(function(t){t.status===c.SUCCESS&&1===e.dropzone.files.length&&e.showHideControls()})),e.dropzone.on("error",(function(t,e,i){void 0!==i&&403!==i.status&&a()(".dz-error-message span",t.previewElement).html((0,s.ZP)("The file transfer failed"))})),e.dropzone.on("totaluploadprogress",(function(t){t=(100*(e.currentFile-1)+t)/(100*e.dropzone.files.length)*100,e.$progress.attr("aria-valuenow",t).css("width",t+"%")})),a()(".upload-all",e.$el).on("click",(function(t){t.preventDefault(),t.stopPropagation(),e.processUpload({finished:function(){e.$progress.attr("aria-valuenow",0).css("width","0%")}})})),e.options.clipboardfile&&e.dropzone.addFile(e.options.clipboardfile)},showHideControls:function(){var t=this;t._showHideTimeout&&clearTimeout(t._showHideTimeout),t._showHideTimeout=setTimeout((function(){t._showHideControls()}),50)},_showHideControls:function(){var t=this,e=a()(".controls",t.$el),i=a()(".browse-select",t.$el),n=a()(".dz-hidden-input");if(t.options.maxFiles&&(t.dropzone.files.length<t.options.maxFiles?(i.show(),n.prop("disabled",!1)):(i.hide(),n.prop("disabled",!0))),t.dropzone.files.length>0){e.fadeIn("slow");var o=t.dropzone.files[0];a()(".dz-error-message span",o.previewElement).html("")}else e.fadeOut("slow")},pathJoin:function(){var t=[];return l().each(arguments,(function(e){e&&("/"===e[0]&&(e=e.substring(1)),"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),t.push(e))})),t.join("/")},getUrl:function(){var t=this,e=t.options.url;if(!e)if(t.options.baseUrl&&t.options.relativePath)"/"!==(e=t.options.baseUrl)[e.length-1]&&(e+="/"),e+=t.pathJoin(t.currentPath,t.options.relativePath);else{var i=t.$el.parents("form");e=i.length>0?i.attr("action"):window.location.href}return e},getDzoneOptions:async function(){let t=await i.e(51967).then(i.t.bind(i,51967,17));t=t.default;var e=this;e.options.clickable=!0;var n=a().extend({},e.options);if(n.url=e.getUrl(),n.headers={"X-CSRF-TOKEN":p.Z.getAuthenticator()},n.uploadMultiple=!1,delete n.wrap,delete n.wrapperTemplate,delete n.resultTemplate,delete n.autoCleanResults,delete n.fileaddedClassName,delete n.useTus,e.options.previewsContainer){var o=e.$el.find(e.options.previewsContainer);o.length>0&&(n.previewsContainer=o[0])}return n.autoProcessQueue=!1,n.previewTemplate=t,n},processUpload:function(t){t||(t={});var e=this,i=!1,n=e.options.useTus,a=e.options.fileaddedClassName,o=t.finished;e.currentFile=0,function t(){i=!0,0===e.dropzone.files.length&&(i=!1);var l=e.dropzone.files[0];if(i&&l.status===c.ERROR&&(l.status=c.QUEUED,i=!1),!i)return e.$el.removeClass(a),void(void 0!==o&&"function"==typeof o&&o());-1!==[c.SUCCESS,c.CANCELED].indexOf(l.status)?(e.dropzone.removeFile(l),t()):l.status!==c.UPLOADING?(n&&window.tus?e.handleTusUpload(l):(e.currentFile+=1,e.dropzone.processFile(l)),setTimeout(t,100)):setTimeout(t,100)}()},handleTusUpload:function(t){var e=this;t.status=c.UPLOADING,window.tus.upload(t,{endpoint:e.dropzone.options.url,headers:{FILENAME:t.name,"X-CSRF-TOKEN":p.Z.getAuthenticator()},chunkSize:5242880}).fail((function(){window.DEBUG&&console.alert((0,s.ZP)("Error uploading with TUS resumable uploads")),t.status=c.ERROR})).progress((function(t,i,n){var a=i/n*100;e.$progress.attr("aria-valuenow",a).css("width",a+"%"),e.$progress.html((0,s.ZP)("uploading...")+"<br />"+e.formatBytes(i)+" / "+e.formatBytes(n))})).done((function(t,i){i.status=c.SUCCESS,e.dropzone.emit("success",i),e.dropzone.emit("complete",i)}))},formatBytes:function(t){var e=Math.round(t/1024);if(e<1024)return e+" KiB";var i=Math.round(e/1024);return i<1024?i+" MB":Math.round(i/1024)+" GB"},setPath:function(t){var e=this;e.currentPath=t,e.options.url=null,e.options.url=e.dropzone.options.url=e.getUrl()},setupRelatedItems:async function(t){const e=(await Promise.resolve().then(i.bind(i,24283))).default;var n=this,o=n.options.relatedItems;o.upload=!1,n.options.initialFolder&&t.attr("value",n.options.initialFolder);var l=new e(t,o);return l.$el.on("change",(function(){var t=a()(this).select2("data"),e=null;t.length>0&&(e=t[0].path),n.setPath(e)})),l}})}}]);
//# sourceMappingURL=99558.419f217c06c5bdd0ac5c.min.js.map