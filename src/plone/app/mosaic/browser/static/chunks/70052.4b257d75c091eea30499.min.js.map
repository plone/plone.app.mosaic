{"version":3,"file":"chunks/70052.4b257d75c091eea30499.min.js","mappings":"uGAAA,IAAIA,EAAM,CACT,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,KACA,OAED,yBAA0B,CACzB,KACA,OAED,sBAAuB,CACtB,KACA,OAED,yBAA0B,CACzB,KACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,kCAAmC,CAClC,KACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,KACA,OAED,yBAA0B,CACzB,KACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,KACA,OAED,yBAA0B,CACzB,KACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,KACA,OAED,yBAA0B,CACzB,KACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,4BAA6B,CAC5B,MACA,OAED,yBAA0B,CACzB,MACA,OAED,4BAA6B,CAC5B,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,IACA,OAED,yBAA0B,CACzB,IACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,4BAA6B,CAC5B,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,sBAAuB,CACtB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,yBAA0B,CACzB,MACA,OAED,4BAA6B,CAC5B,MACA,OAED,yBAA0B,CACzB,MACA,OAED,4BAA6B,CAC5B,MACA,QAGF,SAASC,EAAoBC,GAC5B,IAAIC,EAAoBC,EAAEJ,EAAKE,GAC9B,OAAOG,QAAQC,UAAUC,MAAK,WAC7B,IAAIC,EAAI,IAAIC,MAAM,uBAAyBP,EAAM,KAEjD,MADAM,EAAEE,KAAO,mBACHF,CACP,IAGD,IAAIG,EAAMX,EAAIE,GAAMU,EAAKD,EAAI,GAC7B,OAAOR,EAAoBK,EAAEG,EAAI,IAAIJ,MAAK,WACzC,OAAOJ,EAAoBU,EAAED,EAAI,GAClC,GACD,CACAX,EAAoBa,K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","sources":["webpack://plone-mosaic/../mockup/node_modules/select2/ lazy ^\\.\\/select2_locale_.*$ namespace object","webpack://plone-mosaic/../mockup/src/pat/select2/select2.js","webpack://plone-mosaic/../mockup/src/pat/relateditems/relateditems.js","webpack://plone-mosaic/../mockup/src/pat/autotoc/autotoc.js","webpack://plone-mosaic/../mockup/src/pat/tinymce/js/links.js","webpack://plone-mosaic/../mockup/src/pat/upload/upload.js"],"sourcesContent":["var map = {\n\t\"./select2_locale_ar\": [\n\t\t29801,\n\t\t14894\n\t],\n\t\"./select2_locale_ar.js\": [\n\t\t29801,\n\t\t14894\n\t],\n\t\"./select2_locale_az\": [\n\t\t14945,\n\t\t14894\n\t],\n\t\"./select2_locale_az.js\": [\n\t\t14945,\n\t\t14894\n\t],\n\t\"./select2_locale_bg\": [\n\t\t2262,\n\t\t14894\n\t],\n\t\"./select2_locale_bg.js\": [\n\t\t2262,\n\t\t14894\n\t],\n\t\"./select2_locale_ca\": [\n\t\t7364,\n\t\t14894\n\t],\n\t\"./select2_locale_ca.js\": [\n\t\t7364,\n\t\t14894\n\t],\n\t\"./select2_locale_cs\": [\n\t\t25570,\n\t\t14894\n\t],\n\t\"./select2_locale_cs.js\": [\n\t\t25570,\n\t\t14894\n\t],\n\t\"./select2_locale_da\": [\n\t\t80906,\n\t\t14894\n\t],\n\t\"./select2_locale_da.js\": [\n\t\t80906,\n\t\t14894\n\t],\n\t\"./select2_locale_de\": [\n\t\t50865,\n\t\t14894\n\t],\n\t\"./select2_locale_de.js\": [\n\t\t50865,\n\t\t14894\n\t],\n\t\"./select2_locale_el\": [\n\t\t29168,\n\t\t14894\n\t],\n\t\"./select2_locale_el.js\": [\n\t\t29168,\n\t\t14894\n\t],\n\t\"./select2_locale_en.js.template\": [\n\t\t1154,\n\t\t14894\n\t],\n\t\"./select2_locale_es\": [\n\t\t34874,\n\t\t14894\n\t],\n\t\"./select2_locale_es.js\": [\n\t\t34874,\n\t\t14894\n\t],\n\t\"./select2_locale_et\": [\n\t\t35844,\n\t\t14894\n\t],\n\t\"./select2_locale_et.js\": [\n\t\t35844,\n\t\t14894\n\t],\n\t\"./select2_locale_eu\": [\n\t\t30297,\n\t\t14894\n\t],\n\t\"./select2_locale_eu.js\": [\n\t\t30297,\n\t\t14894\n\t],\n\t\"./select2_locale_fa\": [\n\t\t96458,\n\t\t14894\n\t],\n\t\"./select2_locale_fa.js\": [\n\t\t96458,\n\t\t14894\n\t],\n\t\"./select2_locale_fi\": [\n\t\t98341,\n\t\t14894\n\t],\n\t\"./select2_locale_fi.js\": [\n\t\t98341,\n\t\t14894\n\t],\n\t\"./select2_locale_fr\": [\n\t\t44854,\n\t\t14894\n\t],\n\t\"./select2_locale_fr.js\": [\n\t\t44854,\n\t\t14894\n\t],\n\t\"./select2_locale_gl\": [\n\t\t52235,\n\t\t14894\n\t],\n\t\"./select2_locale_gl.js\": [\n\t\t52235,\n\t\t14894\n\t],\n\t\"./select2_locale_he\": [\n\t\t33223,\n\t\t14894\n\t],\n\t\"./select2_locale_he.js\": [\n\t\t33223,\n\t\t14894\n\t],\n\t\"./select2_locale_hr\": [\n\t\t38962,\n\t\t14894\n\t],\n\t\"./select2_locale_hr.js\": [\n\t\t38962,\n\t\t14894\n\t],\n\t\"./select2_locale_hu\": [\n\t\t3244,\n\t\t14894\n\t],\n\t\"./select2_locale_hu.js\": [\n\t\t3244,\n\t\t14894\n\t],\n\t\"./select2_locale_id\": [\n\t\t40311,\n\t\t14894\n\t],\n\t\"./select2_locale_id.js\": [\n\t\t40311,\n\t\t14894\n\t],\n\t\"./select2_locale_is\": [\n\t\t60619,\n\t\t14894\n\t],\n\t\"./select2_locale_is.js\": [\n\t\t60619,\n\t\t14894\n\t],\n\t\"./select2_locale_it\": [\n\t\t8176,\n\t\t14894\n\t],\n\t\"./select2_locale_it.js\": [\n\t\t8176,\n\t\t14894\n\t],\n\t\"./select2_locale_ja\": [\n\t\t92060,\n\t\t14894\n\t],\n\t\"./select2_locale_ja.js\": [\n\t\t92060,\n\t\t14894\n\t],\n\t\"./select2_locale_ka\": [\n\t\t3856,\n\t\t14894\n\t],\n\t\"./select2_locale_ka.js\": [\n\t\t3856,\n\t\t14894\n\t],\n\t\"./select2_locale_ko\": [\n\t\t37741,\n\t\t14894\n\t],\n\t\"./select2_locale_ko.js\": [\n\t\t37741,\n\t\t14894\n\t],\n\t\"./select2_locale_lt\": [\n\t\t51577,\n\t\t14894\n\t],\n\t\"./select2_locale_lt.js\": [\n\t\t51577,\n\t\t14894\n\t],\n\t\"./select2_locale_lv\": [\n\t\t53616,\n\t\t14894\n\t],\n\t\"./select2_locale_lv.js\": [\n\t\t53616,\n\t\t14894\n\t],\n\t\"./select2_locale_mk\": [\n\t\t54154,\n\t\t14894\n\t],\n\t\"./select2_locale_mk.js\": [\n\t\t54154,\n\t\t14894\n\t],\n\t\"./select2_locale_ms\": [\n\t\t63331,\n\t\t14894\n\t],\n\t\"./select2_locale_ms.js\": [\n\t\t63331,\n\t\t14894\n\t],\n\t\"./select2_locale_nb\": [\n\t\t33656,\n\t\t14894\n\t],\n\t\"./select2_locale_nb.js\": [\n\t\t33656,\n\t\t14894\n\t],\n\t\"./select2_locale_nl\": [\n\t\t67745,\n\t\t14894\n\t],\n\t\"./select2_locale_nl.js\": [\n\t\t67745,\n\t\t14894\n\t],\n\t\"./select2_locale_pl\": [\n\t\t34321,\n\t\t14894\n\t],\n\t\"./select2_locale_pl.js\": [\n\t\t34321,\n\t\t14894\n\t],\n\t\"./select2_locale_pt-BR\": [\n\t\t21399,\n\t\t14894\n\t],\n\t\"./select2_locale_pt-BR.js\": [\n\t\t21399,\n\t\t14894\n\t],\n\t\"./select2_locale_pt-PT\": [\n\t\t69997,\n\t\t14894\n\t],\n\t\"./select2_locale_pt-PT.js\": [\n\t\t69997,\n\t\t14894\n\t],\n\t\"./select2_locale_ro\": [\n\t\t90111,\n\t\t14894\n\t],\n\t\"./select2_locale_ro.js\": [\n\t\t90111,\n\t\t14894\n\t],\n\t\"./select2_locale_rs\": [\n\t\t84204,\n\t\t14894\n\t],\n\t\"./select2_locale_rs.js\": [\n\t\t84204,\n\t\t14894\n\t],\n\t\"./select2_locale_ru\": [\n\t\t68302,\n\t\t14894\n\t],\n\t\"./select2_locale_ru.js\": [\n\t\t68302,\n\t\t14894\n\t],\n\t\"./select2_locale_sk\": [\n\t\t492,\n\t\t14894\n\t],\n\t\"./select2_locale_sk.js\": [\n\t\t492,\n\t\t14894\n\t],\n\t\"./select2_locale_sv\": [\n\t\t55391,\n\t\t14894\n\t],\n\t\"./select2_locale_sv.js\": [\n\t\t55391,\n\t\t14894\n\t],\n\t\"./select2_locale_th\": [\n\t\t62680,\n\t\t14894\n\t],\n\t\"./select2_locale_th.js\": [\n\t\t62680,\n\t\t14894\n\t],\n\t\"./select2_locale_tr\": [\n\t\t73576,\n\t\t14894\n\t],\n\t\"./select2_locale_tr.js\": [\n\t\t73576,\n\t\t14894\n\t],\n\t\"./select2_locale_ug-CN\": [\n\t\t45466,\n\t\t14894\n\t],\n\t\"./select2_locale_ug-CN.js\": [\n\t\t45466,\n\t\t14894\n\t],\n\t\"./select2_locale_uk\": [\n\t\t90058,\n\t\t14894\n\t],\n\t\"./select2_locale_uk.js\": [\n\t\t90058,\n\t\t14894\n\t],\n\t\"./select2_locale_vi\": [\n\t\t55405,\n\t\t14894\n\t],\n\t\"./select2_locale_vi.js\": [\n\t\t55405,\n\t\t14894\n\t],\n\t\"./select2_locale_zh-CN\": [\n\t\t82671,\n\t\t14894\n\t],\n\t\"./select2_locale_zh-CN.js\": [\n\t\t82671,\n\t\t14894\n\t],\n\t\"./select2_locale_zh-TW\": [\n\t\t88016,\n\t\t14894\n\t],\n\t\"./select2_locale_zh-TW.js\": [\n\t\t88016,\n\t\t14894\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__.t(id, 7 | 16);\n\t});\n}\nwebpackAsyncContext.keys = function() { return Object.keys(map); };\nwebpackAsyncContext.id = 74479;\nmodule.exports = webpackAsyncContext;","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport I18n from \"../../core/i18n\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"select2\",\n    trigger: \".pat-select2\",\n    parser: \"mockup\",\n    defaults: {\n        separator: \",\",\n        ajaxTimeout: 300,\n    },\n\n    initializeValues() {\n        // Init Selection ---------------------------------------------\n        if (this.options.initialValues) {\n            this.options.id = (term) => {\n                return term.id;\n            };\n            this.options.initSelection = ($el, callback) => {\n                const data = [];\n                const value = $el.val();\n                let seldefaults = this.options.initialValues;\n\n                // Create the initSelection value that contains the default selection,\n                // but in a javascript object\n                if (\n                    typeof this.options.initialValues === \"string\" &&\n                    this.options.initialValues !== \"\"\n                ) {\n                    // if default selection value starts with a '{', then treat the value as\n                    // a JSON object that needs to be parsed\n                    if (this.options.initialValues[0] === \"{\") {\n                        seldefaults = JSON.parse(this.options.initialValues);\n                    }\n                    // otherwise, treat the value as a list, separated by the defaults.separator value of\n                    // strings in the format \"id:text\", and convert it to an object\n                    else {\n                        seldefaults = {};\n                        const initial_values = $(\n                            this.options.initialValues.split(this.options.separator)\n                        );\n                        for (const it of initial_values) {\n                            const selection = it.split(\":\");\n                            const id = selection[0].trim();\n                            const text = selection[1].trim();\n                            seldefaults[id] = text;\n                        }\n                    }\n                }\n\n                const items = $(value.split(this.options.separator));\n                for (const it of items) {\n                    let text = it;\n                    if (seldefaults[it]) {\n                        text = seldefaults[it];\n                    }\n                    data.push({\n                        id: utils.removeHTML(it),\n                        text: utils.removeHTML(text),\n                    });\n                }\n                callback(data);\n            };\n        }\n    },\n\n    initializeTags() {\n        if (this.options.tags && typeof this.options.tags === \"string\") {\n            if (this.options.tags.substr(0, 1) === \"[\") {\n                this.options.tags = JSON.parse(this.options.tags);\n            } else {\n                this.options.tags = this.options.tags.split(this.options.separator);\n            }\n        }\n\n        if (this.options.tags && !this.options.allowNewItems) {\n            this.options.data = this.options.tags.map((value) => {\n                return { id: value, text: value };\n            });\n            this.options.multiple = true;\n            delete this.options.tags;\n        }\n    },\n\n    async initializeOrdering() {\n        if (!this.options.orderable) {\n            return;\n        }\n        const Sortable = (await import(\"sortablejs\")).default;\n        const _initializeOrdering = () => {\n            const sortable_el = this.$select2[0].querySelector(\".select2-choices\");\n            new Sortable(sortable_el, {\n                draggable: \"li\",\n                dragClass: \"select2-choice-dragging\",\n                chosenClass: \"dragging\",\n                onStart: () => this.$el.select2(\"onSortStart\"),\n                onEnd: () => this.$el.select2(\"onSortEnd\"),\n            });\n        };\n        this.$el.on(\"change\", _initializeOrdering.bind(this));\n        _initializeOrdering();\n    },\n\n    async initializeSelect2() {\n        import(\"select2/select2.css\");\n        import(\"./select2.scss\");\n        await import(\"select2\");\n        try {\n            // Don't load \"en\" which is the default where no separate language file exists.\n            if (this.options.language && this.options.language !== \"en\") {\n                await import(`select2/select2_locale_${this.options.language}`);\n            }\n        } catch {\n            console.warn(\"Language file could not be loaded\", this.options.language);\n        }\n\n        this.options.formatResultCssClass = (ob) => {\n            if (ob.id) {\n                return (\n                    \"select2-option-\" +\n                    ob.id.toLowerCase().replace(/[ \\:\\)\\(\\[\\]\\{\\}\\_\\+\\=\\&\\*\\%\\#]/g, \"-\")\n                );\n            }\n        };\n\n        function callback(action, e) {\n            if (action) {\n                if (this.options.debug) {\n                    console.debug(\"callback\", action, e);\n                }\n                if (typeof action === \"string\") {\n                    action = window[action];\n                }\n                return action(e);\n            } else {\n                return action;\n            }\n        }\n\n        this.$el.select2(this.options);\n        this.$el.on(\"select2-selected\", (e) => callback(this.options.onSelected, e));\n        this.$el.on(\"select2-selecting\", (e) => callback(this.options.onSelecting, e));\n        this.$el.on(\"select2-deselecting\", (e) =>\n            callback(this.options.onDeselecting, e)\n        );\n        this.$el.on(\"select2-deselected\", (e) => callback(this.options.onDeselected, e));\n        this.$select2 = this.$el.parent().find(\".select2-container\");\n        this.$el.parent().off(\"close.plone-modal.patterns\");\n        if (this.options.orderable) {\n            this.$select2.addClass(\"select2-orderable\");\n        }\n    },\n\n    opened() {\n        const isOpen = $(\".select2-dropdown-open\", this.$el.parent()).length === 1;\n        return isOpen;\n    },\n\n    async init() {\n        const i18n = new I18n();\n        this.options.language = i18n.currentLanguage;\n        this.options.allowNewItems = this.options.allowNewItems\n            ? JSON.parse(this.options.allowNewItems)\n            : true;\n\n        // TODO: Select2 respects the select fields multiple attribute.\n        //       Currently, only when multiple is set in the pattern options\n        //       the replacement to a hidden input field is done.\n        //       A collection's querystring widget has the multiple attribute\n        //       but must not be replaced with a hidden inout, otherwise robot\n        //       tests fail.\n        //if (this.el.hasAttribute(\"multiple\")) {\n        //    this.options.multiple = true;\n        //}\n\n        if (this.options.ajax || this.options.vocabularyUrl) {\n            if (this.options.vocabularyUrl) {\n                this.options.multiple =\n                    this.options.multiple === undefined ? true : this.options.multiple;\n                this.options.ajax = this.options.ajax || {};\n                this.options.ajax.url = this.options.vocabularyUrl;\n                // XXX removing the following function does'nt break tests. dead code?\n                this.options.initSelection = ($el, callback) => {\n                    const data = [];\n                    const value = $el.val();\n                    for (const val of value.split(this.options.separator)) {\n                        const _val = utils.removeHTML(val);\n                        data.push({ id: _val, text: _val });\n                    }\n                    callback(data);\n                };\n            }\n\n            let queryTerm = \"\";\n\n            const ajaxTimeout = parseInt(this.options.ajaxTimeout || 300, 10);\n            delete this.options.ajaxTimeout;\n            this.options.ajax = $.extend(\n                {\n                    quietMillis: ajaxTimeout,\n                    data: (term, page) => {\n                        queryTerm = term;\n                        return {\n                            query: term,\n                            page_limit: 10,\n                            page: page,\n                        };\n                    },\n                    results: (data) => {\n                        let results = data.results;\n                        if (this.options.vocabularyUrl) {\n                            const dataIds = [];\n                            for (const it of data.results) {\n                                dataIds.push(it.id);\n                            }\n                            results = [];\n\n                            const haveResult =\n                                queryTerm === \"\" || dataIds.includes(queryTerm);\n                            if (this.options.allowNewItems && !haveResult) {\n                                queryTerm = utils.removeHTML(queryTerm);\n                                results.push({\n                                    id: queryTerm,\n                                    text: queryTerm,\n                                });\n                            }\n\n                            for (const it of data.results) {\n                                results.push(it);\n                            }\n                        }\n                        return { results: results };\n                    },\n                },\n                this.options.ajax\n            );\n        } else if (this.options.multiple && this.$el.is(\"select\")) {\n            // Multiselects are converted to input[type=hidden] for Select2\n            // TODO: This should actually not be necessary.\n            //       This is kept for backwards compatibility but should be\n            //       re-checked and removed if possible.\n            this.$el.attr(\"multiple\", true);\n            const vals = this.$el.val() || [];\n            const options = [...this.el.querySelectorAll(\"option\")].map((it) => {\n                return { text: it.innerHTML, id: it.value };\n            });\n\n            const el = document.createElement(\"input\");\n            el.type = \"hidden\";\n            el.value = vals.join(this.options.separator);\n            el.className = this.el.getAttribute(\"class\");\n            el.name = this.el.name;\n            el.id = this.el.id;\n            this.el.after(el);\n            this.el.remove();\n            this.el = el;\n            this.$el = $(el);\n\n            this.options.data = options;\n        }\n        this.initializeValues();\n        this.initializeTags();\n        await this.initializeSelect2();\n        await this.initializeOrdering();\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport _t from \"../../core/i18n-wrapper\";\nimport utils from \"../../core/utils\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport Select2 from \"../select2/select2\";\n\nconst KEY = {\n    LEFT: 37,\n    RIGHT: 39,\n};\n\nexport default Base.extend({\n    name: \"relateditems\",\n    trigger: \".pat-relateditems\",\n    parser: \"mockup\",\n    currentPath: undefined,\n    selectedUIDs: [],\n    openAfterInit: undefined,\n    defaults: {\n        // main option\n        vocabularyUrl: null, // must be set to work\n\n        // more options\n        attributes: [\n            \"UID\",\n            \"Title\",\n            \"portal_type\",\n            \"path\",\n            \"getURL\",\n            \"getIcon\",\n            \"is_folderish\",\n            \"review_state\",\n        ], // used by utils.QueryHelper\n        basePath: \"\",\n        pageSize: 10,\n        browsing: undefined,\n        closeOnSelect: true,\n        contextPath: undefined,\n        dropdownCssClass: \"pat-relateditems-dropdown\",\n        favorites: [],\n        recentlyUsed: false,\n        recentlyUsedMaxItems: 20,\n        recentlyUsedKey: \"relateditems_recentlyused\",\n        maximumSelectionSize: -1,\n        minimumInputLength: 0,\n        mode: \"browse\", // possible values are 'auto', 'search' and 'browse'.\n        orderable: true, // mockup-patterns-select2\n        pathOperator: \"plone.app.querystring.operation.string.path\",\n        rootPath: \"/\",\n        rootUrl: \"\", // default to be relative.\n        scanSelection: false, // False, to no unnecessarily use CPU time on this.\n        selectableTypes: null, // null means everything is selectable, otherwise a list of strings to match types that are selectable\n        separator: \",\",\n        sortOn: null,\n        sortOrder: \"ascending\",\n        tokenSeparators: [\",\", \" \"],\n        upload: false,\n        uploadAllowView: undefined,\n\n        // templates\n        breadcrumbTemplateSelector: null,\n        favoriteTemplateSelector: null,\n        recentlyusedTemplateSelector: null,\n        resultTemplateSelector: null,\n        selectionTemplateSelector: null,\n        toolbarTemplateSelector: null,\n\n        // needed\n        multiple: true,\n\n        // ajax settings\n        ajaxTimeout: 500,\n    },\n\n    recentlyUsed(filterSelectable) {\n        let ret = utils.storage.get(this.options.recentlyUsedKey) || [];\n        // hard-limit to 1000 entries\n        ret = ret.slice(ret.length - 1000, ret.length);\n        if (filterSelectable) {\n            // Filter out only selectable items.\n            // This is used only to create the list of items to be displayed.\n            // the list to be stored is unfiltered and can be reused among\n            // different instances of this widget with different settings.\n            ret.filter(this.isSelectable.bind(this));\n        }\n        // max is applied AFTER filtering selectable items.\n        const max = parseInt(this.options.recentlyUsedMaxItems, 10);\n        if (max) {\n            // return the slice from the end, as we want to display newest items first.\n            ret = ret.slice(ret.length - max, ret.length);\n        }\n        return ret;\n    },\n\n    applyTemplate(tpl, item) {\n        let template;\n        if (this.options[tpl + \"TemplateSelector\"]) {\n            template = $(this.options[tpl + \"TemplateSelector\"]).html();\n        }\n        if (!template) {\n            if (this.options[tpl + \"Template\"]) {\n                template = this.options[tpl + \"Template\"];\n            } else {\n                template = this[tpl + \"Template\"];\n            }\n        }\n        // let's give all the options possible to the template generation\n        const options = $.extend(true, {}, this.options, item, {\n            browsing: this.browsing,\n            open_folder: _t(\"Open folder\"),\n            current_directory: _t(\"current directory:\"),\n            one_level_up: _t(\"Go one level up\"),\n        });\n        options._item = item;\n        return _.template(template)(options);\n    },\n\n    setAjax() {\n        const ajaxTimeout = parseInt(this.options.ajaxTimeout || 500, 10);\n\n        const ajax = {\n            url: this.options.vocabularyUrl,\n            dataType: \"JSON\",\n            quietMillis: ajaxTimeout,\n\n            data: (term, page) => {\n                const criterias = [];\n                if (term) {\n                    term = \"*\" + term + \"*\";\n                    criterias.push({\n                        i: \"SearchableText\",\n                        o: \"plone.app.querystring.operation.string.contains\",\n                        v: term,\n                    });\n                }\n\n                // We don't restrict for selectable types while browsing...\n                if (!this.browsing && this.options.selectableTypes) {\n                    criterias.push({\n                        i: \"portal_type\",\n                        o: \"plone.app.querystring.operation.selection.any\",\n                        v: this.options.selectableTypes,\n                    });\n                }\n\n                criterias.push({\n                    i: \"path\",\n                    o: this.options.pathOperator,\n                    v:\n                        this.options.rootPath +\n                        this.currentPath +\n                        (this.browsing ? \"::1\" : \"\"),\n                });\n\n                let sort_on = this.options.sortOn;\n                let sort_order = sort_on ? this.options.sortOrder : null;\n                if (this.browsing && sort_on === null) {\n                    sort_on = \"getObjPositionInParent\";\n                    sort_order = \"ascending\";\n                }\n\n                const data = {\n                    query: JSON.stringify({\n                        criteria: criterias,\n                        sort_on: sort_on,\n                        sort_order: sort_order,\n                    }),\n                    attributes: JSON.stringify(this.options.attributes),\n                    batch: JSON.stringify({\n                        page: page ? page : 1,\n                        size: this.options.pageSize,\n                    }),\n                };\n                return data;\n            },\n\n            results: (data, page) => {\n                const more = page * this.options.pageSize < data.total;\n                let results = data.results;\n\n                this.selectedUIDs = (this.$el.select2(\"data\") || []).map((el) => {\n                    // populate current selection. Reuse in formatResult\n                    return el.UID;\n                });\n\n                // Filter out items:\n                // While browsing: always include folderish items\n                // Browsing and searching: Only include selectable items which are not already selected, and all folders\n                // even if they're selected, as we need them available for browsing/selecting their children\n                results = results.filter((item) => {\n                    if (\n                        (this.browsing && item.is_folderish) ||\n                        (this.isSelectable(item) &&\n                            this.selectedUIDs.indexOf(item.UID) === -1)\n                    ) {\n                        return true;\n                    }\n                    return false;\n                });\n\n                // Extend ``data`` with a ``oneLevelUp`` item when browsing\n                const path = this.currentPath.split(\"/\");\n                if (\n                    page === 1 && // Show level up only on top.\n                    this.browsing && // only level up when browsing\n                    path.length > 1 && // do not try to level up one level under root.\n                    this.currentPath !== \"/\" // do not try to level up beyond root\n                ) {\n                    results = [\n                        {\n                            oneLevelUp: true,\n                            Title: _t(\"One level up\"),\n                            path: path.slice(0, path.length - 1).join(\"/\") || \"/\",\n                            currentPath: this.currentPath,\n                            is_folderish: true,\n                            selectable: false,\n                        },\n                    ].concat(results);\n                }\n                return {\n                    results: results,\n                    more: more,\n                };\n            },\n        };\n        this.options.ajax = ajax;\n    },\n\n    async renderToolbar() {\n        const path = this.currentPath;\n        let html;\n\n        const parts = path.split(\"/\");\n        let itemPath = \"\";\n        let itemsHtml = \"\";\n        for (const part of parts) {\n            if (part !== \"\") {\n                const item = {};\n                item.path = itemPath = `${itemPath}/${part}`;\n                item.text = part;\n                itemsHtml = itemsHtml + this.applyTemplate(\"breadcrumb\", item);\n            }\n        }\n\n        // favorites\n        let favoritesHtml = \"\";\n        for (const item of this.options.favorites) {\n            const item_copy = _.clone(item);\n            item_copy.path = item_copy.path.substr(this.options.rootPath.length) || \"/\";\n            favoritesHtml = favoritesHtml + this.applyTemplate(\"favorite\", item_copy);\n        }\n\n        let recentlyUsedHtml = \"\";\n        if (this.options.recentlyUsed) {\n            const recentlyUsed = this.recentlyUsed(true); // filter out only those items which can actually be selected\n            for (const item of recentlyUsed.reverse()) {\n                // reverse to get newest first.\n                recentlyUsedHtml =\n                    recentlyUsedHtml + this.applyTemplate(\"recentlyused\", item);\n            }\n        }\n\n        html = this.applyTemplate(\"toolbar\", {\n            items: itemsHtml,\n            favItems: favoritesHtml,\n            favText: _t(\"Favorites\"),\n            searchText: _t(\"Current path:\"),\n            searchModeText: _t(\"Search\"),\n            browseModeText: _t(\"Browse\"),\n            recentlyUsedItems: recentlyUsedHtml,\n            recentlyUsedText: _t(\"Recently Used\"),\n            icon_root: await utils.resolveIcon(\"house-fill\"),\n            icon_recently_used: await utils.resolveIcon(\"grid-fill\"),\n            icon_favorites: await utils.resolveIcon(\"star-fill\"),\n            icon_upload: await utils.resolveIcon(\"cloud-arrow-up\"),\n            upload: this.options.upload,\n            upload_text: _t(\"Upload\"),\n        });\n\n        this.$toolbar.html(html);\n\n        // unbind mouseup event from select2 to override the behavior:\n        $(\".pat-relateditems-dropdown\").off(\"mouseup\");\n        $(\".pat-relateditems-dropdown\").on(\"mouseup\", (e) => {\n            e.stopPropagation();\n        });\n\n        $(\"button.mode.search\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            if (this.browsing) {\n                $(\"button.mode.search\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-default\"\n                );\n                $(\"button.mode.browse\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-default\"\n                );\n                this.browsing = false;\n                if (this.$el.select2(\"data\").length > 0) {\n                    // Have to call after initialization\n                    this.openAfterInit = true;\n                }\n                if (!this.openAfterInit) {\n                    this.$el.select2(\"close\");\n                    this.$el.select2(\"open\");\n                }\n            } else {\n                // just open result list\n                this.$el.select2(\"close\");\n                this.$el.select2(\"open\");\n            }\n        });\n\n        $(\"button.mode.browse\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            if (!this.browsing) {\n                $(\"button.mode.search\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-default\"\n                );\n                $(\"button.mode.browse\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-default\"\n                );\n                this.browsing = true;\n                if (this.$el.select2(\"data\").length > 0) {\n                    // Have to call after initialization\n                    this.openAfterInit = true;\n                }\n                if (!this.openAfterInit) {\n                    this.$el.select2(\"close\");\n                    this.$el.select2(\"open\");\n                }\n            } else {\n                // just open result list\n                this.$el.select2(\"close\");\n                this.$el.select2(\"open\");\n            }\n        });\n\n        $(\"a.crumb\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            this.browseTo($(e.currentTarget).attr(\"href\"));\n        });\n\n        $(\"a.fav\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            this.browseTo($(e.currentTarget).attr(\"href\"));\n        });\n\n        if (this.options.recentlyUsed) {\n            $(\".pat-relateditems-recentlyused-select\", this.$toolbar).on(\n                \"click\",\n                (event) => {\n                    event.preventDefault();\n                    const uid = $(event.currentTarget).data(\"uid\");\n                    let item = this.recentlyUsed().filter((it) => {\n                        return it.UID === uid;\n                    });\n                    if (item.length > 0) {\n                        item = item[0];\n                    } else {\n                        return;\n                    }\n                    this.selectItem(item);\n                    if (this.options.maximumSelectionSize > 0) {\n                        const items = this.$el.select2(\"data\");\n                        if (items.length >= this.options.maximumSelectionSize) {\n                            return;\n                        }\n                    }\n                }\n            );\n        }\n\n        // upload\n        if (\n            this.options.upload &&\n            utils.featureSupport.dragAndDrop() &&\n            utils.featureSupport.fileApi()\n        ) {\n            if (this.options.uploadAllowView) {\n                // Check, if uploads are allowed in current context\n                $.ajax({\n                    url: this.options.uploadAllowView,\n                    // url: this.currentUrl() + this.options.uploadAllowView,  // not working yet\n                    dataType: \"JSON\",\n                    data: {\n                        path: this.options.rootPath + this.currentPath,\n                    },\n                    type: \"GET\",\n                    success: (result) => {\n                        this.initUploadView(!result.allowUpload);\n                    },\n                });\n            } else {\n                // just initialize upload view without checking, if uploads are allowed.\n                this.initUploadView();\n            }\n        }\n    },\n\n    async initUploadView(disabled) {\n        let Upload = await import(\"../upload/upload\");\n        Upload = Upload.default;\n\n        const upload_button = this.$toolbar[0].querySelector(\".upload button\");\n        upload_button.disabled = disabled;\n\n        const upload_el = this.$toolbar[0].querySelector(\".upload .pat-upload\");\n\n        const upload_config = {\n            success: (e, response) => {\n                const uid = response.UID;\n                if (uid) {\n                    const query = new utils.QueryHelper({\n                        vocabularyUrl: this.options.vocabularyUrl,\n                        attributes: this.options.attributes,\n                    });\n                    query.search(\n                        \"UID\",\n                        \"plone.app.querystring.operation.selection.is\",\n                        uid,\n                        (e) => {\n                            const data = this.$el.select2(\"data\");\n                            data.push.apply(data, e.results);\n                            this.$el.select2(\"data\", data, true);\n                            this.emit(\"selected\");\n                            this.popover.hide();\n                        },\n                        false\n                    );\n                }\n            },\n            uloadMultiple: true,\n            allowPathSelection: false,\n            relativePath: \"fileUpload\",\n            baseUrl: this.options.rootUrl,\n        };\n        const upload = new Upload($(upload_el), upload_config);\n\n        upload_button.addEventListener(\"show.bs.dropdown\", () => {\n            if (this.currentPath !== upload.currentPath) {\n                upload.setPath(this.currentPath);\n            }\n        });\n    },\n\n    browseTo(path) {\n        this.emit(\"before-browse\");\n        this.currentPath = path;\n        this.$el.select2(\"close\");\n        this.renderToolbar();\n        this.$el.select2(\"open\");\n        this.emit(\"after-browse\");\n    },\n\n    selectItem(item) {\n        this.emit(\"selecting\");\n        const data = this.$el.select2(\"data\");\n        data.push(item);\n        this.$el.select2(\"data\", data, true);\n\n        if (this.options.recentlyUsed) {\n            // add to recently added items\n            const recentlyUsed = this.recentlyUsed(); // do not filter for selectable but get all. append to that list the new item.\n            const alreadyPresent = recentlyUsed.filter((it) => {\n                return it.UID === item.UID;\n            });\n            if (alreadyPresent.length > 0) {\n                recentlyUsed.splice(recentlyUsed.indexOf(alreadyPresent[0]), 1);\n            }\n            recentlyUsed.push(item);\n            utils.storage.set(this.options.recentlyUsedKey, recentlyUsed);\n        }\n\n        this.emit(\"selected\");\n    },\n\n    deselectItem(item) {\n        this.emit(\"deselecting\");\n        const data = this.$el.select2(\"data\");\n        data.forEach((obj, i) => {\n            if (obj.UID === item.UID) {\n                data.splice(i, 1);\n            }\n        });\n        this.$el.select2(\"data\", data, true);\n        this.emit(\"deselected\");\n    },\n\n    isSelectable(item) {\n        if (item.selectable === false) {\n            return false;\n        }\n        if (this.options.selectableTypes === null) {\n            return true;\n        } else {\n            return this.options.selectableTypes.indexOf(item.portal_type) !== -1;\n        }\n    },\n\n    async init() {\n        (await import(\"bootstrap\")).Dropdown;\n        import(\"./relateditems.scss\");\n\n        // templates\n        this.breadcrumbTemplate = (await import(\"./templates/breadcrumb.xml\")).default; // prettier-ignore\n        this.favoriteTemplate = (await import(\"./templates/favorite.xml\")).default; // prettier-ignore\n        this.recentlyusedTemplate = (await import(\"./templates/recentlyused.xml\")).default; // prettier-ignore\n        this.resultTemplate = (await import(\"./templates/result.xml\")).default; // prettier-ignore\n        this.selectionTemplate = (await import(\"./templates/selection.xml\")).default; // prettier-ignore\n        this.toolbarTemplate = (await import(\"./templates/toolbar.xml\")).default; // prettier-ignore\n\n        this.browsing = this.options.mode !== \"search\";\n\n        // Remove trailing slash\n        this.options.rootPath = this.options.rootPath.replace(/\\/$/, \"\");\n        // Substract rootPath from basePath with is the relative currentPath. Has a leading slash. Or use '/'\n        this.currentPath =\n            this.options.basePath.substr(this.options.rootPath.length) || \"/\";\n\n        this.setAjax();\n\n        this.$el.wrap('<div class=\"pat-relateditems-container\" />');\n        this.$container = this.$el.parents(\".pat-relateditems-container\");\n\n        Select2.prototype.initializeValues.call(this);\n        Select2.prototype.initializeTags.call(this);\n\n        this.options.formatSelection = (item) => {\n            item = $.extend(\n                true,\n                {\n                    Title: \"\",\n                    getIcon: \"\",\n                    getURL: \"\",\n                    path: \"\",\n                    portal_type: \"\",\n                    review_state: \"\",\n                },\n                item\n            );\n\n            // activate petterns on the result set.\n            const $selection = $(this.applyTemplate(\"selection\", item));\n            if (this.options.scanSelection) {\n                registry.scan($selection);\n            }\n            if (this.options.maximumSelectionSize == 1) {\n                // If this related field accepts only 1 item, the breadcrumbs should\n                // reflect the location for this particular item\n                let itemPath = item.path;\n                let path_split = itemPath.split(\"/\");\n                path_split = path_split.slice(0, -1); // Remove last part of path, we always want the parent path\n                itemPath = path_split.join(\"/\");\n                this.currentPath = itemPath;\n                this.renderToolbar();\n            }\n            return $selection;\n        };\n\n        const icon_level_up = await utils.resolveIcon(\"arrow-left-circle\");\n        const icon_level_down = await utils.resolveIcon(\"arrow-right-circle\");\n\n        this.options.formatResult = (item) => {\n            item.selectable = this.isSelectable(item);\n            item = $.extend(\n                true,\n                {\n                    Title: \"\",\n                    getIcon: \"\",\n                    getURL: \"\",\n                    is_folderish: false,\n                    oneLevelUp: false,\n                    iconLevelUp: icon_level_up,\n                    iconLevelDown: icon_level_down,\n                    path: \"\",\n                    portal_type: \"\",\n                    review_state: \"\",\n                    selectable: false,\n                },\n                item\n            );\n\n            if (this.selectedUIDs.indexOf(item.UID) !== -1) {\n                // do not allow already selected items to be selected again.\n                item.selectable = false;\n            }\n            const result = $(this.applyTemplate(\"result\", item));\n\n            $(\".pat-relateditems-result-select\", result).on(\"click\", (event) => {\n                const _el = event.currentTarget;\n                event.preventDefault();\n                // event.stopPropagation();\n                if ($(_el).is(\".selectable\")) {\n                    const $parent = $(_el).parents(\".pat-relateditems-result\");\n                    if ($parent.is(\".pat-relateditems-active\")) {\n                        $parent.removeClass(\"pat-relateditems-active\");\n                        this.deselectItem(item);\n                    } else {\n                        if (this.options.maximumSelectionSize > 0) {\n                            const items = this.$el.select2(\"data\");\n                            if (items.length >= this.options.maximumSelectionSize) {\n                                this.$el.select2(\"close\");\n                            }\n                        }\n                        this.selectItem(item);\n                        $parent.addClass(\"pat-relateditems-active\");\n                        if (this.options.closeOnSelect) {\n                            this.$el.select2(\"close\");\n                        }\n                    }\n                }\n            });\n\n            $(\".pat-relateditems-result-browse\", result).on(\"click\", (event) => {\n                event.preventDefault();\n                event.stopPropagation();\n                const path = $(event.currentTarget).data(\"path\");\n                this.browseTo(path);\n            });\n\n            return $(result);\n        };\n\n        this.options.initSelection = (element, callback) => {\n            const value = $(element).val();\n            if (value !== \"\") {\n                const ids = value.split(this.options.separator);\n                const query = new utils.QueryHelper(\n                    $.extend(true, {}, this.options, {\n                        pattern: this,\n                    })\n                );\n                query.search(\n                    \"UID\",\n                    \"plone.app.querystring.operation.list.contains\",\n                    ids,\n                    (data) => {\n                        const results = data.results.reduce((prev, item) => {\n                            prev[item.UID] = item;\n                            return prev;\n                        }, {});\n\n                        try {\n                            callback(\n                                ids\n                                    .map((uid) => results[uid])\n                                    .filter((item) => item !== undefined)\n                            );\n                        } catch (e) {\n                            // Select2 3.5.4 throws an error in some cases in\n                            // updateSelection, ``this.selection.find(\".select2-search-choice\").remove();``\n                            // No idea why, hard to track.\n                        }\n\n                        if (this.openAfterInit) {\n                            // open after initialization\n                            this.$el.select2(\"open\");\n                            this.openAfterInit = undefined;\n                        }\n                    },\n                    false\n                );\n            }\n        };\n\n        this.options.tokenizer = (input) => {\n            if (this.options.mode === \"auto\") {\n                this.browsing = input ? false : true;\n            }\n        };\n\n        this.options.id = (item) => item.UID;\n\n        await Select2.prototype.initializeSelect2.call(this);\n        await Select2.prototype.initializeOrdering.call(this);\n\n        this.$toolbar = $('<div class=\"toolbar d-flex\" />');\n        this.$container.prepend(this.$toolbar);\n        this.$el.on(\"select2-selecting\", (event) => {\n            if (!this.isSelectable(event.choice)) {\n                event.preventDefault();\n            }\n        });\n        this.renderToolbar();\n        this.$el.on(\"select2-loaded\", () => {\n            let yMax = window.innerHeight || document.documentElement.clientHeight;\n            const element = $(\n                \".pat-relateditems-dropdown.select2-drop-active .select2-results\"\n            )[0];\n            const rect = element.getBoundingClientRect();\n            const maxHeight = yMax - rect.top - 18;\n            $(element).css(\"max-height\", `${maxHeight}px`);\n        });\n\n        $(document).on(\"keyup\", this.$el, (event) => {\n            const isOpen = Select2.prototype.opened.call(this);\n            if (!isOpen) {\n                return;\n            }\n\n            if (event.which === KEY.LEFT || event.which === KEY.RIGHT) {\n                event.stopPropagation();\n\n                const selectorContext =\n                    event.which === KEY.LEFT\n                        ? \".pat-relateditems-result.one-level-up\"\n                        : \".select2-highlighted\";\n\n                const browsableItemSelector = \".pat-relateditems-result-browse\";\n                const browsableItem = $(browsableItemSelector, selectorContext);\n\n                if (browsableItem.length !== 1) {\n                    return;\n                }\n\n                const path = browsableItem.data(\"path\");\n\n                this.browseTo(path);\n            }\n        });\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"autotoc\",\n    trigger: \".pat-autotoc\",\n    parser: \"mockup\",\n    defaults: {\n        section: \"section\",\n        levels: \"h1,h2,h3\",\n        IDPrefix: \"autotoc-item-\",\n        classTOCName: \"autotoc-nav\",\n        classSectionName: \"autotoc-section\",\n        classLevelPrefixName: \"autotoc-level-\",\n        classActiveName: \"active\",\n        scrollDuration: \"slow\",\n        scrollEasing: \"swing\",\n    },\n    init: function () {\n        import(\"./autotoc.scss\");\n\n        var self = this;\n\n        self.$toc = $(\"<nav/>\").addClass(self.options.classTOCName);\n\n        if (self.options.prependTo) {\n            self.$toc.prependTo(self.options.prependTo);\n        } else if (self.options.appendTo) {\n            self.$toc.appendTo(self.options.appendTo);\n        } else {\n            self.$toc.prependTo(self.$el);\n        }\n\n        if (self.options.className) {\n            self.$el.addClass(self.options.className);\n        }\n\n        $(self.options.section, self.$el).addClass(self.options.classSectionName);\n\n        var asTabs = self.$el.hasClass(\"autotabs\");\n\n        var activeId = null;\n\n        $(self.options.levels, self.$el).each(function (i) {\n            var $level = $(this),\n                id = $level.prop(\"id\")\n                    ? $level.prop(\"id\")\n                    : $level.parents(self.options.section).prop(\"id\");\n            if (!id || $(\"#\" + id).length > 0) {\n                id = self.options.IDPrefix + self.name + \"-\" + i;\n            }\n            if (window.location.hash === \"#\" + id) {\n                activeId = id;\n            }\n            if (activeId === null && $level.hasClass(self.options.classActiveName)) {\n                activeId = id;\n            }\n            $level.data(\"navref\", id);\n            $(\"<a/>\")\n                .appendTo(self.$toc)\n                .text($level.text())\n                .attr(\"id\", id)\n                .attr(\"href\", \"#\" + id)\n                .addClass(self.options.classLevelPrefixName + self.getLevel($level))\n                .on(\"click\", function (e, options) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    if (!options) {\n                        options = {\n                            doScroll: true,\n                            skipHash: false,\n                        };\n                    }\n                    var $el = $(this);\n                    self.$toc\n                        .children(\".\" + self.options.classActiveName)\n                        .removeClass(self.options.classActiveName);\n                    self.$el\n                        .children(\".\" + self.options.classActiveName)\n                        .removeClass(self.options.classActiveName);\n                    $(e.target).addClass(self.options.classActiveName);\n                    $level\n                        .parents(self.options.section)\n                        .addClass(self.options.classActiveName);\n                    if (\n                        options.doScroll !== false &&\n                        self.options.scrollDuration &&\n                        $level &&\n                        !asTabs\n                    ) {\n                        $(\"body,html\").animate(\n                            {\n                                scrollTop: $level.offset().top,\n                            },\n                            self.options.scrollDuration,\n                            self.options.scrollEasing\n                        );\n                    }\n                    if (self.$el.parents(\".plone-modal\").length !== 0) {\n                        self.$el.trigger(\"resize.plone-modal.patterns\");\n                    }\n                    $(this).trigger(\"clicked\");\n                    if (!options.skipHash) {\n                        if (window.history && window.history.pushState) {\n                            window.history.pushState({}, \"\", \"#\" + $el.attr(\"id\"));\n                        }\n                    }\n                });\n            $level.data(\"autotoc-trigger-id\", id);\n        });\n\n        if (activeId) {\n            $(\"a#\" + activeId).trigger(\"click\", {\n                doScroll: true,\n                skipHash: true,\n            });\n        } else {\n            self.$toc.find(\"a\").first().trigger(\"click\", {\n                doScroll: false,\n                skipHash: true,\n            });\n        }\n    },\n    getLevel: function ($el) {\n        var elementLevel = 0;\n        $.each(this.options.levels.split(\",\"), function (level, levelSelector) {\n            if ($el.filter(levelSelector).length === 1) {\n                elementLevel = level + 1;\n                return false;\n            }\n        });\n        return elementLevel;\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\n\nimport tinymce from \"tinymce/tinymce\";\nimport LinkTemplate from \"../templates/link.xml\";\nimport ImageTemplate from \"../templates/image.xml\";\nimport RelatedItems from \"../../relateditems/relateditems\";\nimport \"../../autotoc/autotoc\";\nimport \"../../modal/modal\";\nimport PatternUpload from \"../../upload/upload\";\n\nvar LinkType = Base.extend({\n    name: \"linktype\",\n    trigger: \".pat-linktype-dummy\",\n    defaults: {\n        linkModal: null, // required\n    },\n\n    init: function () {\n        this.linkModal = this.options.linkModal;\n        this.tinypattern = this.options.tinypattern;\n        this.tiny = this.tinypattern.tiny;\n        this.dom = this.tiny.dom;\n    },\n\n    getEl: function () {\n        return this.$el.find(\"input\");\n    },\n\n    value: function () {\n        return this.getEl().val().trim();\n    },\n\n    toUrl: function () {\n        return this.value();\n    },\n\n    load: function (element) {\n        let val = this.tiny.dom.getAttrib(element, \"data-val\");\n        this.getEl().attr(\"value\", val);\n    },\n\n    set: function (val) {\n        var $el = this.getEl();\n        $el.attr(\"value\", val);\n        $el.val(val);\n    },\n\n    attributes: function () {\n        return {\n            \"data-val\": this.value(),\n        };\n    },\n    updateRelatedItems: function () {},\n});\n\nvar ExternalLink = LinkType.extend({\n    name: \"externallinktype\",\n    trigger: \".pat-externallinktype-dummy\",\n    init: function () {\n        LinkType.prototype.init.call(this);\n        this.getEl().on(\"change\", function () {\n            // check here if we should automatically add in http:// to url\n            var val = $(this).val();\n            if (new RegExp(\"https?://\").test(val)) {\n                // already valid url\n                return;\n            }\n            var domain = $(this).val().split(\"/\")[0];\n            if (domain.indexOf(\".\") !== -1) {\n                $(this).val(\"http://\" + val);\n            }\n        });\n    },\n});\n\nvar InternalLink = LinkType.extend({\n    name: \"internallinktype\",\n    trigger: \".pat-internallinktype-dummy\",\n    init: function () {\n        if (!this.getEl().length) {\n            return;\n        }\n        LinkType.prototype.init.call(this);\n        this.getEl().addClass(\"pat-relateditems\");\n        this.createRelatedItems();\n    },\n\n    getEl: function () {\n        return this.$el.find(\"input:not(.select2-input)\");\n    },\n\n    createRelatedItems: function () {\n        if (!this.getEl().length) {\n            return;\n        }\n        var options = this.linkModal.options.relatedItems;\n        options.upload = false; // ensure that related items upload is off.\n        this.relatedItems = new RelatedItems(this.getEl(), options);\n    },\n\n    updateRelatedItems: function (val) {\n        if (!this.relatedItems) {\n            // prevent toolbar from being rendered twice\n            this.createRelatedItems();\n        }\n        this.relatedItems.selectItem(val);\n    },\n\n    value: function () {\n        var val = this.getEl().select2(\"data\");\n        if (val && typeof val === \"object\") {\n            val = val[0];\n        }\n        return val;\n    },\n\n    toUrl: function () {\n        var value = this.value();\n        if (value) {\n            return this.tinypattern.generateUrl(value);\n        }\n        return null;\n    },\n    load: function (element) {\n        var val = this.tiny.dom.getAttrib(element, \"data-val\");\n        if (val) {\n            this.set(val);\n        }\n    },\n\n    set: function (val) {\n        var $el = this.getEl();\n        $el.val(val).trigger(\"change\");\n        this.updateRelatedItems(val);\n    },\n\n    attributes: function () {\n        var val = this.value();\n        if (val) {\n            return {\n                \"data-val\": val.UID,\n            };\n        }\n        return {};\n    },\n});\n\nvar UploadLink = LinkType.extend({\n    name: \"uploadlinktype\",\n    trigger: \".pat-uploadlinktype-dummy\",\n    /* need to do it a bit differently here.\n       when a user uploads and tries to upload from\n       it, you need to delegate to the real insert\n       linke types */\n    getDelegatedLinkType: function () {\n        if (this.linkModal.linkType === \"uploadImage\") {\n            return this.linkModal.linkTypes.image;\n        } else {\n            return this.linkModal.linkTypes.internal;\n        }\n    },\n    toUrl: function () {\n        return this.getDelegatedLinkType().toUrl();\n    },\n    attributes: function () {\n        return this.getDelegatedLinkType().attributes();\n    },\n    set: function (val) {\n        return this.getDelegatedLinkType().set(val);\n    },\n    load: function (element) {\n        return this.getDelegatedLinkType().load(element);\n    },\n    value: function () {\n        return this.getDelegatedLinkType().value();\n    },\n});\n\nvar ImageLink = InternalLink.extend({\n    name: \"imagelinktype\",\n    trigger: \".pat-imagelinktype-dummy\",\n    toUrl: function () {\n        var value = this.value();\n        return this.tinypattern.generateImageUrl(\n            value,\n            this.linkModal.getScaleFromSrcset(this.linkModal.$scale.val())\n        );\n    },\n});\n\nvar EmailLink = LinkType.extend({\n    name: \"emaillinktype\",\n    trigger: \".pat-emaillinktype-dummy\",\n    toUrl: function () {\n        var self = this;\n        var val = self.value();\n        if (val) {\n            var subject = self.getSubject();\n            var href = \"mailto:\" + val;\n            if (subject) {\n                href += \"?subject=\" + subject;\n            }\n            return href;\n        }\n        return null;\n    },\n\n    load: function (element) {\n        LinkType.prototype.load.apply(this, [element]);\n        this.linkModal.$subject.val(this.tiny.dom.getAttrib(element, \"data-subject\"));\n    },\n\n    getSubject: function () {\n        return this.linkModal.$subject.val();\n    },\n\n    attributes: function () {\n        var attribs = LinkType.prototype.attributes.call(this);\n        attribs[\"data-subject\"] = this.getSubject();\n        return attribs;\n    },\n});\n\nvar AnchorLink = LinkType.extend({\n    name: \"anchorlinktype\",\n    trigger: \".pat-anchorlinktype-dummy\",\n    init: function () {\n        LinkType.prototype.init.call(this);\n        this.$select = this.$el.find(\"select\");\n        this.anchorNodes = [];\n        this.anchorData = [];\n        this.populate();\n    },\n\n    value: function () {\n        var val = this.$select.select2(\"data\");\n        if (val && typeof val === \"object\") {\n            val = val.id;\n        }\n        return val;\n    },\n\n    populate: function () {\n        var self = this;\n        self.$select.find(\"option\").remove();\n        self.anchorNodes = [];\n        self.anchorData = [];\n        var node, i, j, name, title;\n\n        var nodes = self.tiny.dom.select(\".mceItemAnchor,.mce-item-anchor\");\n        for (i = 0; i < nodes.length; i = i + 1) {\n            node = nodes[i];\n            name = self.tiny.dom.getAttrib(node, \"name\");\n            if (!name) {\n                name = self.tiny.dom.getAttrib(node, \"id\");\n            }\n            if (name !== \"\") {\n                self.anchorNodes.push(node);\n                self.anchorData.push({ name: name, title: name });\n            }\n        }\n\n        nodes = self.tiny.dom.select(self.linkModal.options.anchorSelector);\n        if (nodes.length > 0) {\n            for (i = 0; i < nodes.length; i = i + 1) {\n                node = nodes[i];\n                title = $(node)\n                    .text()\n                    .replace(/^\\s+|\\s+$/g, \"\");\n                if (title === \"\") {\n                    continue;\n                }\n                name = title.toLowerCase().substring(0, 1024);\n                name = name.replace(/[^a-z0-9]/g, \"-\");\n                /* okay, ugly, but we need to first check that this anchor isn't already available */\n                var found = false;\n                for (j = 0; j < self.anchorNodes.length; j = j + 1) {\n                    var anode = self.anchorData[j];\n                    if (anode.name === name) {\n                        found = true;\n                        // so it's also found, let's update the title to be more presentable\n                        anode.title = title;\n                        break;\n                    }\n                }\n                if (!found) {\n                    self.anchorData.push({\n                        name: name,\n                        title: title,\n                        newAnchor: true,\n                    });\n                    self.anchorNodes.push(node);\n                }\n            }\n        }\n        if (self.anchorNodes.length > 0) {\n            for (i = 0; i < self.anchorData.length; i = i + 1) {\n                var data = self.anchorData[i];\n                self.$select.append(\n                    '<option value=\"' + i + '\">' + data.title + \"</option>\"\n                );\n            }\n        } else {\n            self.$select.append(\"<option>No anchors found..</option>\");\n        }\n    },\n\n    getIndex: function (name) {\n        for (var i = 0; i < this.anchorData.length; i = i + 1) {\n            var data = this.anchorData[i];\n            if (data.name === name) {\n                return i;\n            }\n        }\n        return 0;\n    },\n\n    toUrl: function () {\n        var val = this.value();\n        if (val) {\n            var index = parseInt(val, 10);\n            var node = this.anchorNodes[index];\n            var data = this.anchorData[index];\n            if (data.newAnchor) {\n                node.innerHTML =\n                    '<a name=\"' +\n                    data.name +\n                    '\" class=\"mce-item-anchor\"></a>' +\n                    node.innerHTML;\n            }\n            return \"#\" + data.name;\n        }\n        return null;\n    },\n\n    set: function (val) {\n        var anchor = this.getIndex(val);\n        this.$select.select2(\"data\", \"\" + anchor);\n    },\n});\n\ntinymce.PluginManager.add(\"ploneimage\", function (editor) {\n    editor.ui.registry.addButton(\"ploneimage\", {\n        icon: \"image\",\n        text: \"Insert image\",\n        tooltip: \"Insert/edit image\",\n        onAction: editor.settings.addImageClicked,\n        // stateSelector: \"img:not([data-mce-object])\",\n    });\n});\n\n/* register the tinymce plugin */\ntinymce.PluginManager.add(\"plonelink\", function (editor) {\n    editor.ui.registry.addButton(\"plonelink\", {\n        icon: \"link\",\n        tooltip: \"Insert/edit link\",\n        shortcut: \"Ctrl+K\",\n        onAction: editor.settings.addLinkClicked,\n        stateSelector: \"a[href]\",\n    });\n\n    editor.ui.registry.addButton(\"unlink\", {\n        icon: \"unlink\",\n        tooltip: \"Remove link\",\n        onAction: function () {\n            editor.execCommand(\"unlink\");\n        },\n        stateSelector: \"a[href]\",\n    });\n\n    // editor.ui.registry.addButton(\"Ctrl+K\", \"\", editor.settings.addLinkClicked);\n\n    // editor.ui.registry.addButton(\"plonelink\", {\n    //     icon: \"link\",\n    //     text: \"Insert link\",\n    //     shortcut: \"Ctrl+K\",\n    //     onAction: editor.settings.addLinkClicked,\n    //     stateSelector: \"a[href]\",\n    //     context: \"insert\",\n    //     prependToContext: true,\n    // });\n});\n\nexport default Base.extend({\n    name: \"linkmodal\",\n    trigger: \".pat-linkmodal\",\n    defaults: {\n        anchorSelector: \"h1,h2,h3\",\n        linkTypes: [\n            /* available, none activate by default because these options\n         * only get merged, not set.\n        'internal',\n        'upload',\n        'external',\n        'email',\n        'anchor',\n        'image'\n        'externalImage'*/\n        ],\n        initialLinkType: \"internal\",\n        text: {\n            insertHeading: \"Insert Link\",\n        },\n        linkTypeClassMapping: {\n            internal: InternalLink,\n            upload: UploadLink,\n            external: ExternalLink,\n            email: EmailLink,\n            anchor: AnchorLink,\n            image: ImageLink,\n            uploadImage: UploadLink,\n            externalImage: LinkType,\n        },\n    },\n    // XXX: this is a temporary work around for having separated templates.\n    // Image modal is going to have its own modal class, funcs and template.\n    linkTypeTemplateMapping: {\n        internal: LinkTemplate,\n        upload: LinkTemplate,\n        external: LinkTemplate,\n        email: LinkTemplate,\n        anchor: LinkTemplate,\n        image: ImageTemplate,\n        uploadImage: ImageTemplate,\n        externalImage: ImageTemplate,\n    },\n\n    template: function (data) {\n        return _.template(this.linkTypeTemplateMapping[this.linkType])(data);\n    },\n\n    init: function () {\n        var self = this;\n        self.tinypattern = self.options.tinypattern;\n        if (self.tinypattern.options.anchorSelector) {\n            self.options.anchorSelector = self.tinypattern.options.anchorSelector;\n        }\n        self.tiny = self.tinypattern.tiny;\n        self.dom = self.tiny.dom;\n        self.linkType = self.options.initialLinkType;\n        self.linkTypes = {};\n        self.modal = registry.patterns[\"plone-modal\"].init(self.$el, {\n            html: self.generateModalHtml(),\n            content: null,\n            buttons: \".plone-btn\",\n            reloadWindowOnClose: false,\n            templateOptions: {\n                classDialog: \"modal-dialog modal-lg\",\n                reloadWindowOnClose: false,\n            },\n            actionOptions: { reloadWindowOnClose: false },\n            backdropOptions: {\n                zIndex: \"1340\",\n                closeOnClick: false,\n            },\n        });\n        self.modal.on(\"shown\", (e) => {\n            self.modalShown.apply(self, [e]);\n        });\n    },\n\n    isOnlyTextSelected: function () {\n        /* pulled from TinyMCE link plugin */\n        var html = this.tiny.selection.getContent();\n\n        // Partial html and not a fully selected anchor element\n        if (\n            /</.test(html) &&\n            (!/^<a [^>]+>[^<]+<\\/a>$/.test(html) || html.indexOf(\"href=\") === -1)\n        ) {\n            return false;\n        }\n\n        if (this.anchorElm) {\n            var nodes = this.anchorElm.childNodes;\n\n            if (nodes.length === 0) {\n                return false;\n            }\n\n            for (var ii = nodes.length - 1; ii >= 0; ii--) {\n                if (nodes[ii].nodeType !== 3) {\n                    return false;\n                }\n            }\n        }\n\n        return true;\n    },\n\n    generateModalHtml: function () {\n        return this.template({\n            options: this.options,\n            upload: this.options.upload,\n            text: this.options.text,\n            insertHeading: this.options.text.insertHeading,\n            insertImageHelp: this.options.text.insertImageHelp,\n            uploadText: this.options.text.upload,\n            insertLinkHelp: this.options.text.insertLinkHelp,\n            internal: this.options.text.internal,\n            external: this.options.text.external,\n            anchor: this.options.text.anchor,\n            anchorLabel: this.options.text.anchorLabel,\n            target: this.options.text.target,\n            linkTypes: this.options.linkTypes,\n            externalText: this.options.text.externalText,\n            emailText: this.options.text.email,\n            subjectText: this.options.text.subject,\n            targetList: this.options.targetList,\n            titleText: this.options.text.title,\n            internalImageText: this.options.text.internalImage,\n            externalImage: this.options.text.externalImage,\n            externalImageText: this.options.text.externalImageText,\n            altText: this.options.text.alt,\n            imageAlignText: this.options.text.imageAlign,\n            captionFromDescriptionText: this.options.text.captionFromDescription,\n            enableImageZoom: this.options.text.enableImageZoom,\n            captionText: this.options.text.caption,\n            scaleText: this.options.text.scale,\n            pictureVariants: this.options.pictureVariants,\n            imageCaptioningEnabled: this.options.imageCaptioningEnabled,\n            cancelBtn: this.options.text.cancelBtn,\n            insertBtn: this.options.text.insertBtn,\n        });\n    },\n\n    isImageMode: function () {\n        return [\"image\", \"uploadImage\", \"externalImage\"].indexOf(this.linkType) !== -1;\n    },\n\n    initElements: function () {\n        var self = this;\n        self.$target = $('select[name=\"target\"]', self.modal.$modal);\n        self.$button = $('.modal-footer input[name=\"insert\"]', self.modal.$modal);\n        self.$title = $('input[name=\"title\"]', self.modal.$modal);\n        self.$subject = $('input[name=\"subject\"]', self.modal.$modal);\n\n        self.$alt = $('input[name=\"alt\"]', self.modal.$modal);\n        self.$align = $('select[name=\"align\"]', self.modal.$modal);\n        self.$scale = $('select[name=\"scale\"]', self.modal.$modal);\n        self.$enableImageZoom = $('input[name=\"enableImageZoom\"]', self.modal.$modal);\n        self.$captionFromDescription = $(\n            'input[name=\"captionFromDescription\"]',\n            self.modal.$modal\n        );\n        self.$caption = $('textarea[name=\"caption\"]', self.modal.$modal);\n\n        /* load up all the link types */\n        _.each(self.options.linkTypes, function (type) {\n            var $container = $(\".linkType.\" + type + \" .main\", self.modal.$modal);\n            if ($container.length) {\n                self.linkTypes[type] = new self.options.linkTypeClassMapping[type](\n                    $container,\n                    {\n                        linkModal: self,\n                        tinypattern: self.tinypattern,\n                    }\n                );\n            }\n        });\n\n        $(\".autotoc-nav a\", self.modal.$modal).on(\"click\", function () {\n            var $fieldset = $(\"fieldset.linkType\", self.modal.$modal).eq(\n                $(this).index()\n            );\n            var classes = $fieldset[0].className.split(/\\s+/);\n            _.each(classes, function (val) {\n                if (_.indexOf(self.options.linkTypes, val) !== -1) {\n                    self.linkType = val;\n                }\n            });\n        });\n\n        self.$captionFromDescription.on(\"change\", function () {\n            if (this.checked) {\n                self.$caption.prop(\"disabled\", true);\n            } else {\n                self.$caption.prop(\"disabled\", false);\n            }\n        });\n    },\n\n    getLinkUrl: function () {\n        // get the url, only get one uid\n        return this.linkTypes[this.linkType].toUrl();\n    },\n\n    getValue: function () {\n        return this.linkTypes[this.linkType].value();\n    },\n\n    updateAnchor: function (href) {\n        var self = this;\n\n        self.tiny.focus();\n        self.tiny.selection.setRng(self.rng);\n\n        var target = self.$target.val();\n        var title = self.$title.val();\n        var linkAttrs = $.extend(\n            true,\n            self.data,\n            {\n                \"title\": title ? title : null,\n                \"target\": target ? target : null,\n                \"data-linkType\": self.linkType,\n                \"href\": href,\n            },\n            self.linkTypes[self.linkType].attributes()\n        );\n        if (self.anchorElm) {\n            if (self.onlyText && linkAttrs.text !== self.initialText) {\n                if (\"innerText\" in self.anchorElm) {\n                    self.anchorElm.innerText = self.data.text;\n                } else {\n                    self.anchorElm.textContent = self.data.text;\n                }\n            }\n\n            self.tiny.dom.setAttribs(self.anchorElm, linkAttrs);\n\n            self.tiny.selection.select(self.anchorElm);\n            self.tiny.undoManager.add();\n        } else {\n            if (self.onlyText) {\n                self.tiny.insertContent(\n                    self.tiny.dom.createHTML(\n                        \"a\",\n                        linkAttrs,\n                        self.tiny.dom.encode(self.data.text)\n                    )\n                );\n            } else {\n                self.tiny.execCommand(\"mceInsertLink\", false, linkAttrs);\n            }\n        }\n    },\n\n    focusElement: function (elm) {\n        this.tiny.focus();\n        this.tiny.selection.select(elm);\n        this.tiny.nodeChanged();\n    },\n\n    getScaleFromSrcset: function (pictureVariant) {\n        let pictureVariantsConfig = this.options.pictureVariants[pictureVariant];\n        return pictureVariantsConfig.sourceset[\n            pictureVariantsConfig.sourceset.length - 1\n        ].scale;\n    },\n\n    updateImage: function (src) {\n        var self = this;\n        var title = self.$title.val();\n        var captionFromDescription = self.$captionFromDescription.prop(\"checked\");\n        var enableImageZoom = self.$enableImageZoom.prop(\"checked\");\n        var caption = self.$caption.val();\n\n        self.tiny.focus();\n        self.tiny.selection.setRng(self.rng);\n        var cssclasses = [\n            \"image-richtext\",\n            self.$align.val(),\n        ];\n        if(self.linkType !== \"externalImage\"){\n            cssclasses.push(\"picture-variant-\" + self.$scale.val())\n        }\n        if (captionFromDescription || caption) {\n            cssclasses.push(\"captioned\");\n        }\n        if (enableImageZoom) {\n            cssclasses.push(\"zoomable\");\n        }\n        var data = $.extend(\n            true,\n            {},\n            {\n                \"src\": src,\n                \"title\": title ? title : null,\n                \"alt\": self.$alt.val(),\n                \"class\": cssclasses.join(\" \"),\n                \"data-linkType\": self.linkType,\n                \"data-scale\": self.getScaleFromSrcset(self.$scale.val()),\n            },\n            self.linkTypes[self.linkType].attributes()\n        );\n        if(self.linkType !== \"externalImage\"){\n            data[\"data-picturevariant\"] = self.$scale.val();\n        }\n\n        if (caption && !captionFromDescription) {\n            data[\"data-captiontext\"] = caption;\n        }\n        if (self.imgElm && !self.imgElm.getAttribute(\"data-mce-object\")) {\n            const imgWidth = self.dom.getAttrib(self.imgElm, \"width\");\n            const imgHight = self.dom.getAttrib(self.imgElm, \"height\");\n            if (imgWidth) {\n                data.width = imgWidth;\n            }\n            if (imgHight) {\n                data.height = imgHight;\n            }\n        } else {\n            self.imgElm = null;\n        }\n\n        function waitLoad(imgElm) {\n            imgElm.onload = imgElm.onerror = function () {\n                imgElm.onload = imgElm.onerror = null;\n                self.focusElement(imgElm);\n            };\n        }\n\n        data.id = \"__mcenew\";\n        var html_inner = self.dom.createHTML(\"img\", data);\n        var html_string;\n        html_string = html_inner;\n        self.tiny.insertContent(html_string);\n        self.imgElm = self.dom.get(\"__mcenew\");\n        self.dom.setAttrib(self.imgElm, \"id\", null);\n\n        waitLoad(self.imgElm);\n        if (self.imgElm.complete) {\n            self.focusElement(self.imgElm);\n        }\n    },\n\n    // eslint-disable-next-line no-unused-vars\n    modalShown: function (e) {\n        var self = this;\n        self.initElements();\n        self.initData();\n        // upload init\n        if (self.options.upload) {\n            self.$upload = $(\".uploadify-me\", self.modal.$modal);\n            self.options.upload.relatedItems = $.extend(\n                true,\n                {},\n                self.options.relatedItems\n            );\n            self.options.upload.relatedItems.selectableTypes = self.options.folderTypes;\n            self.$upload.addClass(\"pat-upload\");\n            new PatternUpload(self.$upload, self.options.upload);\n            self.$upload.on(\n                \"uploadAllCompleted\",\n                function (evt, data) {\n                    if (self.linkTypes.image) {\n                        self.linkTypes.image.set(data.data.UID);\n                        $(\n                            \"#\" + $(\"#tinylink-image\", self.modal.$modal).data(\"navref\")\n                        ).trigger(\"click\");\n                    } else {\n                        self.linkTypes.internal.set(data.data.UID);\n                        $(\n                            \"#\" +\n                                $(\"#tinylink-internal\", self.modal.$modal).data(\"navref\")\n                        ).trigger(\"click\");\n                    }\n                }.bind(self)\n            );\n        }\n\n        self.$button.off(\"click\").on(\"click\", function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            self.linkType = self.modal.$modal.find(\"fieldset.active\").data(\"linktype\");\n\n            if (self.linkType === \"uploadImage\" || self.linkType === \"upload\") {\n                var patUpload = self.$upload.data().patternUpload;\n                if (patUpload.dropzone.files.length > 0) {\n                    patUpload.processUpload();\n                    // eslint-disable-next-line no-unused-vars\n                    self.$upload.on(\"uploadAllCompleted\", function (evt, data) {\n                        var counter = 0;\n                        var checkUpload = function () {\n                            if (counter < 5 && !self.linkTypes[self.linkType].value()) {\n                                counter += 1;\n                                setTimeout(checkUpload, 100);\n                                return;\n                            } else {\n                                var href = self.getLinkUrl();\n                                self.updateImage(href);\n                                self.hide();\n                            }\n                        };\n                        checkUpload();\n                    });\n                }\n            }\n            var href;\n            try {\n                href = self.getLinkUrl();\n            } catch (error) {\n                return; // just cut out if no url\n            }\n            if (!href) {\n                return; // just cut out if no url\n            }\n            if (self.isImageMode()) {\n                self.updateImage(href);\n            } else {\n                /* regular anchor */\n                self.updateAnchor(href);\n            }\n            self.hide();\n        });\n        $('.modal-footer input[name=\"cancel\"]', self.modal.$modal).on(\"click\", function (e) {\n            e.preventDefault();\n            self.hide();\n        });\n    },\n\n    show: function () {\n        this.modal.show();\n    },\n\n    hide: function () {\n        this.modal.hide();\n    },\n\n    initData: function () {\n        var self = this;\n\n        self.data = {};\n        // get selection BEFORE..\n        // This is pulled from TinyMCE link plugin\n        self.initialText = null;\n        var value;\n        self.rng = self.tiny.selection.getRng();\n        self.selectedElm = self.tiny.selection.getNode();\n        self.anchorElm = self.tiny.dom.getParent(self.selectedElm, \"a[href]\");\n        self.onlyText = self.isOnlyTextSelected();\n\n        self.data.text = self.initialText = self.anchorElm\n            ? self.anchorElm.innerText || self.anchorElm.textContent\n            : self.tiny.selection.getContent({ format: \"text\" });\n        self.data.href = self.anchorElm\n            ? self.tiny.dom.getAttrib(self.anchorElm, \"href\")\n            : \"\";\n\n        if (self.anchorElm) {\n            self.data.target = self.tiny.dom.getAttrib(self.anchorElm, \"target\");\n        } else if (self.tiny.settings.default_link_target) {\n            self.data.target = self.tiny.settings.default_link_target;\n        }\n\n        if ((value = self.tiny.dom.getAttrib(self.anchorElm, \"rel\"))) {\n            self.data.rel = value;\n        }\n\n        if ((value = self.tiny.dom.getAttrib(self.anchorElm, \"class\"))) {\n            self.data[\"class\"] = value;\n        }\n\n        if ((value = self.tiny.dom.getAttrib(self.anchorElm, \"title\"))) {\n            self.data.title = value;\n        }\n\n        self.tiny.focus();\n        self.anchorElm = self.dom.getParent(self.selectedElm, \"a[href]\");\n\n        var linkType;\n        if (self.isImageMode()) {\n            var img;\n            img = self.selectedElm;\n            self.imgElm = img;\n\n            var src = self.dom.getAttrib(self.imgElm, \"src\");\n            var captionText = self.dom.getAttrib(self.imgElm, \"data-captiontext\");\n            self.$title.val(self.dom.getAttrib(self.imgElm, \"title\"));\n            self.$alt.val(self.dom.getAttrib(self.imgElm, \"alt\"));\n\n            if ($(self.imgElm).hasClass(\"zoomable\")) {\n                self.$enableImageZoom.prop(\"checked\", true);\n            }\n            if ($(self.imgElm).hasClass(\"captioned\") && !captionText) {\n                self.$captionFromDescription.prop(\"checked\", true);\n                self.$caption.prop(\"disabled\", true);\n            } else if ($(self.imgElm).hasClass(\"captioned\") && captionText) {\n                self.$captionFromDescription.prop(\"checked\", false);\n            } else {\n                self.$captionFromDescription.prop(\"checked\", false);\n            }\n            if (captionText) {\n                self.$caption.val(captionText);\n            }\n\n            linkType = self.dom.getAttrib(self.imgElm, \"data-linktype\");\n            if (linkType && linkType in self.linkTypes) {\n                self.linkType = linkType;\n                self.linkTypes[self.linkType].load(self.imgElm);\n                // set scale selection in link modal:\n                var pictureVariant = self.dom.getAttrib(\n                    self.imgElm,\n                    \"data-picturevariant\"\n                );\n                self.$scale.val(pictureVariant);\n                $(\"#tinylink-\" + self.linkType, self.modal.$modal).trigger(\"click\");\n            } else if (src) {\n                self.guessImageLink(src);\n            }\n            var className = self.dom.getAttrib(self.imgElm, \"class\");\n            var klasses = className.split(\" \");\n            for (var i = 0; i < klasses.length; i = i + 1) {\n                var klass = klasses[i];\n                for (var availClass in self.options.imageClasses) {\n                    if (availClass.indexOf(klass) !== -1) {\n                        self.$align.val(klass);\n                    }\n                }\n            }\n        } else if (self.anchorElm) {\n            self.focusElement(self.anchorElm);\n            var href = \"\";\n            href = self.dom.getAttrib(self.anchorElm, \"href\");\n            self.$target.val(self.dom.getAttrib(self.anchorElm, \"target\"));\n            self.$title.val(self.dom.getAttrib(self.anchorElm, \"title\"));\n            linkType = self.dom.getAttrib(self.anchorElm, \"data-linktype\");\n            if (linkType) {\n                self.linkType = linkType;\n                self.linkTypes[self.linkType].load(self.anchorElm);\n                var $panel = $(\"#tinylink-\" + self.linkType, self.modal.$modal);\n                // $('#tinylink-' + self.linkType, self.modal.$modal).trigger('click');\n                if ($panel.length === 1) {\n                    $(\"#\" + $panel.data(\"autotoc-trigger-id\")).trigger(\"click\");\n                }\n            } else if (href) {\n                self.guessAnchorLink(href);\n            }\n        }\n    },\n\n    guessImageLink: function (src) {\n        if (src.indexOf(this.options.prependToScalePart) !== -1) {\n            this.linkType = \"image\";\n            // TODO: use data-scale attribute instead:\n            this.$scale.val(this.tinypattern.getScaleFromUrl(src));\n            this.linkTypes.image.set(this.tinypattern.stripGeneratedUrl(src));\n        } else {\n            this.linkType = \"externalImage\";\n            this.linkTypes.externalImage.set(src);\n        }\n    },\n\n    guessAnchorLink: function (href) {\n        if (\n            this.options.prependToUrl &&\n            href.indexOf(this.options.prependToUrl) !== -1\n        ) {\n            // XXX if using default configuration, it gets more difficult\n            // here to detect internal urls so this might need to change...\n            this.linkType = \"internal\";\n            this.linkTypes.internal.set(this.tinypattern.stripGeneratedUrl(href));\n        } else if (href.indexOf(\"mailto:\") !== -1) {\n            this.linkType = \"email\";\n            var email = href.substring(\"mailto:\".length, href.length);\n            var split = email.split(\"?subject=\");\n            this.linkTypes.email.set(split[0]);\n            if (split.length > 1) {\n                this.$subject.val(decodeURIComponent(split[1]));\n            }\n        } else if (href[0] === \"#\") {\n            this.linkType = \"anchor\";\n            this.linkTypes.anchor.set(href.substring(1));\n        } else {\n            this.linkType = \"external\";\n            this.linkTypes.external.set(href);\n        }\n    },\n\n    setSelectElement: function ($el, val) {\n        $el.find(\"option:selected\").prop(\"selected\", false);\n        if (val) {\n            // update\n            $el.find('option[value=\"' + val + '\"]').prop(\"selected\", true);\n        }\n    },\n\n    reinitialize: function () {\n        /*\n         * This will probably be called before show is run.\n         * It will overwrite the base html template given to\n         * be able to privde default values for the overlay\n         */\n        this.modal.options.html = this.generateModalHtml();\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport _t from \"../../core/i18n-wrapper\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport utils from \"../../core/utils\";\n\nlet Dropzone;\n\nexport default Base.extend({\n    name: \"upload\",\n    trigger: \".pat-upload\",\n    parser: \"mockup\",\n    defaults: {\n        showTitle: true,\n        url: null, // XXX MUST provide url to submit to OR be in a form\n        className: \"upload\",\n        wrap: false,\n        wrapperTemplate: '<div class=\"upload-wrapper\"/>',\n        fileaddedClassName: \"dropping\",\n        useTus: false,\n        container: \"\",\n        ajaxUpload: true,\n\n        paramName: \"file\",\n        addRemoveLinks: false,\n        autoCleanResults: true,\n        previewsContainer: \".previews\",\n        previewTemplate: null,\n        maxFiles: null,\n        maxFilesize: 99999999, // let's not have a max by default...\n\n        allowPathSelection: undefined,\n        relatedItems: {\n            // UID attribute is required here since we're working with related items\n            attributes: [\n                \"UID\",\n                \"Title\",\n                \"Description\",\n                \"getURL\",\n                \"portal_type\",\n                \"path\",\n                \"ModificationDate\",\n            ],\n            batchSize: 20,\n            basePath: \"/\",\n            vocabularyUrl: null,\n            width: 500,\n            maximumSelectionSize: 1,\n            selectableTypes: [\"Folder\"],\n        },\n    },\n\n    init: async function () {\n        import(\"dropzone/dist/dropzone.css\");\n        import(\"./upload.scss\");\n        Dropzone = (await import(\"dropzone\")).default;\n        /* we do not want this plugin to auto discover */\n        Dropzone.autoDiscover = false;\n\n        const UploadTemplate = (await import(\"./templates/upload.xml\")).default;\n\n        var self = this;\n\n        if (typeof self.options.allowPathSelection === \"undefined\") {\n            // Set allowPathSelection to true, if we can use path based urls.\n            self.options.allowPathSelection =\n                self.options.baseUrl && self.options.relativePath;\n        }\n\n        // TODO: find a way to make this work in firefox (and IE)\n        $(document).on(\"paste\", function (e) {\n            var oe = e.originalEvent;\n            var items = oe.clipboardData.items;\n            if (items) {\n                for (var i = 0; i < items.length; i++) {\n                    if (items[i].type.indexOf(\"image\") !== -1) {\n                        var blob = items[i].getAsFile();\n                        self.dropzone.addFile(blob);\n                    }\n                }\n            }\n        });\n        // values that will change current processing\n        self.currentPath = self.options.currentPath;\n        self.currentFile = 0;\n\n        let template = _.template(UploadTemplate)({\n            _t: _t,\n            allowPathSelection: self.options.allowPathSelection,\n        });\n        self.$el.addClass(self.options.className);\n        self.$el.append(template);\n\n        self.$progress = $(\".progress-bar-success\", self.$el);\n\n        if (!self.options.showTitle) {\n            self.$el.find(\"h2.title\").hide();\n        }\n\n        if (!self.options.ajaxUpload) {\n            // no ajax upload, drop the fallback\n            $(\".fallback\", this.$el).remove();\n            if (this.$el.hasClass(\".upload-container\")) {\n                this.$el.addClass(\"no-ajax-upload\");\n            } else {\n                this.$el.closest(\".upload-container\").addClass(\"no-ajax-upload\");\n            }\n        }\n\n        if (self.options.wrap) {\n            self.$el.wrap(self.options.wrapperTemplate);\n            self.$el = self.$el.parent();\n        }\n\n        if (self.options.allowPathSelection) {\n            // only use related items if we can generate path based urls and if it's not turned off.\n            self.$pathInput = $('input[name=\"location\"]', self.$el);\n            self.relatedItems = await self.setupRelatedItems(self.$pathInput);\n        } else {\n            $('input[name=\"location\"]', self.$el).parent().remove();\n            self.relatedItems = null;\n        }\n\n        self.$dropzone = $(\".upload-area\", self.$el);\n\n        $(\"div.browse-select button.browse\", self.$el).on(\"click\", function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            if (\n                !self.options.maxFiles ||\n                self.dropzone.files.length < self.options.maxFiles\n            ) {\n                self.dropzone.hiddenFileInput.click();\n            }\n        });\n\n        var dzoneOptions = await this.getDzoneOptions();\n\n        try {\n            // if init of Dropzone fails it says nothing and\n            // it fails silently. Using this block we make sure\n            // that if you break it w/ some weird or missing option\n            // you can get a proper log of it\n            //\n            self.dropzone = new Dropzone(self.$dropzone[0], dzoneOptions);\n        } catch (e) {\n            if (window.DEBUG) {\n                // log it!\n                console.log(e);\n            }\n            throw e;\n        }\n\n        self.dropzone.on(\"maxfilesreached\", function () {\n            self.showHideControls();\n        });\n\n        self.dropzone.on(\"addedfile\", function (/* file */) {\n            self.showHideControls();\n        });\n\n        self.dropzone.on(\"removedfile\", function () {\n            self.showHideControls();\n        });\n\n        self.dropzone.on(\"success\", function (e, response) {\n            // Trigger event 'uploadAllCompleted' and pass the server's reponse and\n            // the path uid. This event can be listened to by patterns using the\n            // upload pattern, e.g. the TinyMCE pattern's link plugin.\n            var data;\n            try {\n                data = $.parseJSON(response);\n            } catch (ex) {\n                data = response;\n            }\n            self.$el.trigger(\"uploadAllCompleted\", {\n                data: data,\n                path_uid: self.$pathInput ? self.$pathInput.val() : null,\n            });\n        });\n\n        if (self.options.autoCleanResults) {\n            self.dropzone.on(\"complete\", function (file) {\n                if (file.status === Dropzone.SUCCESS) {\n                    setTimeout(function () {\n                        $(file.previewElement).fadeOut();\n                    }, 3000);\n                }\n            });\n        }\n\n        self.dropzone.on(\"complete\", function (file) {\n            if (file.status === Dropzone.SUCCESS && self.dropzone.files.length === 1) {\n                self.showHideControls();\n            }\n        });\n\n        self.dropzone.on(\"error\", function (file, response, xmlhr) {\n            if (typeof xmlhr !== \"undefined\" && xmlhr.status !== 403) {\n                // If error other than 403, just print a generic message\n                $(\".dz-error-message span\", file.previewElement).html(\n                    _t(\"The file transfer failed\")\n                );\n            }\n        });\n\n        self.dropzone.on(\"totaluploadprogress\", function (pct) {\n            // need to caclulate total pct here in reality since we're manually\n            // processing each file one at a time.\n            pct =\n                (((self.currentFile - 1) * 100 + pct) /\n                    (self.dropzone.files.length * 100)) *\n                100;\n            self.$progress.attr(\"aria-valuenow\", pct).css(\"width\", pct + \"%\");\n        });\n\n        $(\".upload-all\", self.$el).on(\"click\", function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            self.processUpload({\n                finished: function () {\n                    self.$progress.attr(\"aria-valuenow\", 0).css(\"width\", \"0%\");\n                },\n            });\n        });\n        if (self.options.clipboardfile) {\n            self.dropzone.addFile(self.options.clipboardfile);\n        }\n    },\n\n    showHideControls: function () {\n        /* we do this delayed because this can be called multiple times\n         AND we need to do this hide/show AFTER dropzone is done with\n         all it's own events. This is NASTY but the only way we can\n         enforce some numFiles with dropzone! */\n        var self = this;\n        if (self._showHideTimeout) {\n            clearTimeout(self._showHideTimeout);\n        }\n        self._showHideTimeout = setTimeout(function () {\n            self._showHideControls();\n        }, 50);\n    },\n\n    _showHideControls: function () {\n        var self = this;\n        var $controls = $(\".controls\", self.$el);\n        var $browse = $(\".browse-select\", self.$el);\n        var $input = $(\".dz-hidden-input\");\n\n        if (self.options.maxFiles) {\n            if (self.dropzone.files.length < self.options.maxFiles) {\n                $browse.show();\n                $input.prop(\"disabled\", false);\n            } else {\n                $browse.hide();\n                $input.prop(\"disabled\", true);\n            }\n        }\n        if (self.dropzone.files.length > 0) {\n            $controls.fadeIn(\"slow\");\n            var file = self.dropzone.files[0];\n            $(\".dz-error-message span\", file.previewElement).html(\"\");\n        } else {\n            $controls.fadeOut(\"slow\");\n        }\n    },\n\n    pathJoin: function () {\n        var parts = [];\n        _.each(arguments, function (part) {\n            if (!part) {\n                return;\n            }\n            if (part[0] === \"/\") {\n                part = part.substring(1);\n            }\n            if (part[part.length - 1] === \"/\") {\n                part = part.substring(0, part.length - 1);\n            }\n            parts.push(part);\n        });\n        return parts.join(\"/\");\n    },\n\n    getUrl: function () {\n        var self = this;\n        var url = self.options.url;\n        if (!url) {\n            if (self.options.baseUrl && self.options.relativePath) {\n                url = self.options.baseUrl;\n                if (url[url.length - 1] !== \"/\") {\n                    url = url + \"/\";\n                }\n                url = url + self.pathJoin(self.currentPath, self.options.relativePath);\n            } else {\n                var $form = self.$el.parents(\"form\");\n                if ($form.length > 0) {\n                    url = $form.attr(\"action\");\n                } else {\n                    url = window.location.href;\n                }\n            }\n        }\n        return url;\n    },\n\n    getDzoneOptions: async function () {\n        let PreviewTemplate = await import(\"./templates/preview.xml\");\n        PreviewTemplate = PreviewTemplate.default;\n\n        var self = this;\n\n        // This pattern REQUIRE dropzone to be clickable\n        self.options.clickable = true;\n\n        var options = $.extend({}, self.options);\n        options.url = self.getUrl();\n\n        options.headers = {\n            \"X-CSRF-TOKEN\": utils.getAuthenticator(),\n        };\n\n        // XXX force to only upload one to the server at a time,\n        // right now we don't support multiple for backends\n        options.uploadMultiple = false;\n\n        delete options.wrap;\n        delete options.wrapperTemplate;\n        delete options.resultTemplate;\n        delete options.autoCleanResults;\n        delete options.fileaddedClassName;\n        delete options.useTus;\n\n        if (self.options.previewsContainer) {\n            /*\n             * if they have a select but it's not an id, let's make an id selector\n             * so we can target the correct container. dropzone is weird here...\n             */\n            var $preview = self.$el.find(self.options.previewsContainer);\n            if ($preview.length > 0) {\n                options.previewsContainer = $preview[0];\n            }\n        }\n\n        // XXX: do we need to allow this?\n        options.autoProcessQueue = false;\n        // options.addRemoveLinks = true;  // we show them in the template\n        options.previewTemplate = PreviewTemplate;\n\n        // if our element is a form we should force some values\n        // https://github.com/enyo/dropzone/wiki/Combine-normal-form-with-Dropzone\n        return options;\n    },\n\n    processUpload: function (options) {\n        if (!options) {\n            options = {};\n        }\n\n        var self = this,\n            processing = false,\n            useTus = self.options.useTus,\n            fileaddedClassName = self.options.fileaddedClassName,\n            finished = options.finished;\n\n        self.currentFile = 0;\n\n        function process() {\n            processing = true;\n            if (self.dropzone.files.length === 0) {\n                processing = false;\n            }\n\n            var file = self.dropzone.files[0];\n            if (processing && file.status === Dropzone.ERROR) {\n                // Put the file back as \"queued\" for retrying\n                file.status = Dropzone.QUEUED;\n                processing = false;\n            }\n\n            if (!processing) {\n                self.$el.removeClass(fileaddedClassName);\n                if (finished !== undefined && typeof finished === \"function\") {\n                    finished();\n                }\n                return;\n            }\n\n            if ([Dropzone.SUCCESS, Dropzone.CANCELED].indexOf(file.status) !== -1) {\n                // remove it\n                self.dropzone.removeFile(file);\n                process();\n            } else if (file.status !== Dropzone.UPLOADING) {\n                // start processing file\n                if (useTus && window.tus) {\n                    // use tus upload if installed\n                    self.handleTusUpload(file);\n                } else {\n                    // otherwise, just use dropzone to process\n                    self.currentFile += 1;\n                    self.dropzone.processFile(file);\n                }\n                setTimeout(process, 100);\n            } else {\n                // currently processing\n                setTimeout(process, 100);\n            }\n        }\n        process();\n    },\n\n    handleTusUpload: function (file) {\n        /* this needs fixing... */\n        var self = this,\n            chunkSize = 1024 * 1024 * 5; // 5mb chunk size\n\n        file.status = Dropzone.UPLOADING;\n\n        window.tus\n            .upload(file, {\n                endpoint: self.dropzone.options.url,\n                headers: {\n                    \"FILENAME\": file.name,\n                    \"X-CSRF-TOKEN\": utils.getAuthenticator(),\n                },\n                chunkSize: chunkSize,\n            })\n            .fail(function () {\n                if (window.DEBUG) {\n                    console.alert(_t(\"Error uploading with TUS resumable uploads\"));\n                }\n                file.status = Dropzone.ERROR;\n            })\n            .progress(function (e, bytesUploaded, bytesTotal) {\n                var percentage = (bytesUploaded / bytesTotal) * 100;\n                self.$progress\n                    .attr(\"aria-valuenow\", percentage)\n                    .css(\"width\", percentage + \"%\");\n                self.$progress.html(\n                    _t(\"uploading...\") +\n                        \"<br />\" +\n                        self.formatBytes(bytesUploaded) +\n                        \" / \" +\n                        self.formatBytes(bytesTotal)\n                );\n            })\n            .done(function (url, file) {\n                file.status = Dropzone.SUCCESS;\n                self.dropzone.emit(\"success\", file);\n                self.dropzone.emit(\"complete\", file);\n            });\n    },\n\n    formatBytes: function (bytes) {\n        var kb = Math.round(bytes / 1024);\n        if (kb < 1024) {\n            return kb + \" KiB\";\n        }\n        var mb = Math.round(kb / 1024);\n        if (mb < 1024) {\n            return mb + \" MB\";\n        }\n        return Math.round(mb / 1024) + \" GB\";\n    },\n\n    setPath: function (path) {\n        var self = this;\n        self.currentPath = path;\n        self.options.url = null;\n        self.options.url = self.dropzone.options.url = self.getUrl();\n    },\n\n    setupRelatedItems: async function ($input) {\n        const RelatedItems = (await import(\"../relateditems/relateditems\")).default;\n\n        var self = this;\n        var options = self.options.relatedItems;\n        options.upload = false; // ensure that related items upload is off.\n        if (self.options.initialFolder) {\n            $input.attr(\"value\", self.options.initialFolder);\n        }\n        var ri = new RelatedItems($input, options);\n        ri.$el.on(\"change\", function () {\n            var result = $(this).select2(\"data\");\n            var path = null;\n            if (result.length > 0) {\n                path = result[0].path;\n            }\n            self.setPath(path);\n        });\n        return ri;\n    },\n});\n"],"names":["map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","t","keys","Object","module","exports","Base","name","trigger","parser","defaults","separator","ajaxTimeout","initializeValues","this","options","initialValues","term","initSelection","$el","callback","data","value","val","seldefaults","JSON","parse","initial_values","$","split","it","selection","trim","text","items","push","utils","initializeTags","tags","substr","allowNewItems","multiple","async","orderable","Sortable","default","_initializeOrdering","sortable_el","$select2","querySelector","draggable","dragClass","chosenClass","onStart","select2","onEnd","on","bind","language","console","warn","action","debug","window","formatResultCssClass","ob","toLowerCase","replace","onSelected","onSelecting","onDeselecting","onDeselected","parent","find","off","addClass","opened","length","i18n","I18n","currentLanguage","ajax","vocabularyUrl","undefined","url","_val","queryTerm","parseInt","quietMillis","page","query","page_limit","results","dataIds","haveResult","includes","is","attr","vals","el","querySelectorAll","innerHTML","document","createElement","type","join","className","getAttribute","after","remove","initializeSelect2","initializeOrdering","KEY","currentPath","selectedUIDs","openAfterInit","attributes","basePath","pageSize","browsing","closeOnSelect","contextPath","dropdownCssClass","favorites","recentlyUsed","recentlyUsedMaxItems","recentlyUsedKey","maximumSelectionSize","minimumInputLength","mode","pathOperator","rootPath","rootUrl","scanSelection","selectableTypes","sortOn","sortOrder","tokenSeparators","upload","uploadAllowView","breadcrumbTemplateSelector","favoriteTemplateSelector","recentlyusedTemplateSelector","resultTemplateSelector","selectionTemplateSelector","toolbarTemplateSelector","filterSelectable","ret","slice","filter","isSelectable","max","applyTemplate","tpl","item","template","html","open_folder","_t","current_directory","one_level_up","_item","_","setAjax","dataType","criterias","i","v","sort_on","sort_order","stringify","criteria","batch","size","more","total","UID","is_folderish","indexOf","path","oneLevelUp","Title","selectable","concat","parts","itemPath","itemsHtml","part","favoritesHtml","item_copy","recentlyUsedHtml","reverse","favItems","favText","searchText","searchModeText","browseModeText","recentlyUsedItems","recentlyUsedText","icon_root","icon_recently_used","icon_favorites","icon_upload","upload_text","$toolbar","stopPropagation","preventDefault","toggleClass","browseTo","currentTarget","event","uid","selectItem","success","result","initUploadView","allowUpload","disabled","Upload","upload_button","upload_el","upload_config","response","search","apply","emit","popover","hide","uloadMultiple","allowPathSelection","relativePath","baseUrl","addEventListener","setPath","renderToolbar","alreadyPresent","splice","deselectItem","forEach","obj","portal_type","Dropdown","breadcrumbTemplate","favoriteTemplate","recentlyusedTemplate","resultTemplate","selectionTemplate","toolbarTemplate","wrap","$container","parents","Select2","formatSelection","getIcon","getURL","review_state","$selection","registry","path_split","icon_level_up","icon_level_down","formatResult","iconLevelUp","iconLevelDown","_el","$parent","removeClass","element","pattern","reduce","prev","tokenizer","input","prepend","choice","yMax","innerHeight","documentElement","clientHeight","maxHeight","getBoundingClientRect","top","css","which","selectorContext","browsableItemSelector","browsableItem","section","levels","IDPrefix","classTOCName","classSectionName","classLevelPrefixName","classActiveName","scrollDuration","scrollEasing","init","self","$toc","prependTo","appendTo","asTabs","hasClass","activeId","each","$level","prop","location","hash","getLevel","doScroll","skipHash","children","target","animate","scrollTop","offset","history","pushState","first","elementLevel","level","levelSelector","LinkType","linkModal","tinypattern","tiny","dom","getEl","toUrl","load","getAttrib","set","updateRelatedItems","ExternalLink","extend","prototype","call","RegExp","test","InternalLink","createRelatedItems","relatedItems","RelatedItems","generateUrl","UploadLink","getDelegatedLinkType","linkType","linkTypes","image","internal","ImageLink","generateImageUrl","getScaleFromSrcset","$scale","EmailLink","subject","getSubject","href","$subject","attribs","AnchorLink","$select","anchorNodes","anchorData","populate","node","j","title","nodes","select","anchorSelector","substring","found","anode","newAnchor","append","getIndex","index","anchor","tinymce","editor","ui","addButton","icon","tooltip","onAction","settings","addImageClicked","shortcut","addLinkClicked","stateSelector","execCommand","initialLinkType","insertHeading","linkTypeClassMapping","external","email","uploadImage","externalImage","linkTypeTemplateMapping","LinkTemplate","ImageTemplate","modal","generateModalHtml","content","buttons","reloadWindowOnClose","templateOptions","classDialog","actionOptions","backdropOptions","zIndex","closeOnClick","modalShown","isOnlyTextSelected","getContent","anchorElm","childNodes","ii","nodeType","insertImageHelp","uploadText","insertLinkHelp","anchorLabel","externalText","emailText","subjectText","targetList","titleText","internalImageText","internalImage","externalImageText","altText","alt","imageAlignText","imageAlign","captionFromDescriptionText","captionFromDescription","enableImageZoom","captionText","caption","scaleText","scale","pictureVariants","imageCaptioningEnabled","cancelBtn","insertBtn","isImageMode","initElements","$target","$modal","$button","$title","$alt","$align","$enableImageZoom","$captionFromDescription","$caption","classes","eq","checked","getLinkUrl","getValue","updateAnchor","focus","setRng","rng","linkAttrs","onlyText","initialText","innerText","textContent","setAttribs","undoManager","add","insertContent","createHTML","encode","focusElement","elm","nodeChanged","pictureVariant","pictureVariantsConfig","sourceset","updateImage","src","cssclasses","html_string","imgElm","imgWidth","imgHight","width","height","get","setAttrib","onload","onerror","complete","initData","$upload","folderTypes","PatternUpload","evt","patUpload","patternUpload","dropzone","files","processUpload","counter","checkUpload","setTimeout","error","show","getRng","selectedElm","getNode","getParent","format","default_link_target","rel","img","guessImageLink","klasses","klass","availClass","imageClasses","$panel","guessAnchorLink","prependToScalePart","getScaleFromUrl","stripGeneratedUrl","prependToUrl","decodeURIComponent","setSelectElement","reinitialize","Dropzone","showTitle","wrapperTemplate","fileaddedClassName","useTus","container","ajaxUpload","paramName","addRemoveLinks","autoCleanResults","previewsContainer","previewTemplate","maxFiles","maxFilesize","batchSize","autoDiscover","UploadTemplate","originalEvent","clipboardData","blob","getAsFile","addFile","currentFile","$progress","closest","$pathInput","setupRelatedItems","$dropzone","hiddenFileInput","click","dzoneOptions","getDzoneOptions","DEBUG","log","showHideControls","ex","path_uid","file","status","SUCCESS","previewElement","fadeOut","xmlhr","pct","finished","clipboardfile","_showHideTimeout","clearTimeout","_showHideControls","$controls","$browse","$input","fadeIn","pathJoin","arguments","getUrl","$form","PreviewTemplate","clickable","headers","uploadMultiple","$preview","autoProcessQueue","processing","process","ERROR","QUEUED","CANCELED","removeFile","UPLOADING","tus","handleTusUpload","processFile","endpoint","chunkSize","fail","alert","progress","bytesUploaded","bytesTotal","percentage","formatBytes","done","bytes","kb","Math","round","mb","initialFolder","ri"],"sourceRoot":""}