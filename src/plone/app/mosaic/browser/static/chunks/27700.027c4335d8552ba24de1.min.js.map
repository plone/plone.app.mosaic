{"version":3,"file":"chunks/27700.027c4335d8552ba24de1.min.js","mappings":"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","sources":["webpack://plone-mosaic/./resources/js/mosaic.actions.js"],"sourcesContent":["// This plugin is used to register and execute actions.\nimport $ from \"jquery\";\nimport logging from \"@patternslib/patternslib/src/core/logging\";\nimport mosaic_utils from \"./utils\";\nimport Modal from \"@plone/mockup/src/pat/modal/modal\";\nimport utils from \"@plone/mockup/src/core/utils\";\nimport \"./mosaic.overlay\";\n\nconst log = logging.getLogger(\"pat-mosaic/actions\");\n\nclass ActionManager {\n    constructor(mosaic) {\n        this.mosaic = mosaic;\n        this.actions = []; // Array with all the actions\n        this.shortcuts = []; // Lookup array for shortcuts\n    }\n\n    registerAction (name, options) {\n        var self = this;\n        // Extend default settings\n        options = $.extend(\n            {\n                // Handler for executing the action\n                exec: function () { },\n\n                // Shortcut can be any key + ctrl/shift/alt or a combination of\n                // those\n                shortcut: {\n                    ctrl: false,\n                    alt: false,\n                    shift: false,\n                    key: \"\",\n                },\n\n                // Method to see if the actions should be visible based on the\n                // current tile state\n                visible: function (tile) {\n                    return true;\n                },\n            },\n            options\n        );\n\n        // Add action to manager\n        self.actions[name] = options;\n\n        // Check if shortcut is defined\n        if (options.shortcut.key !== \"\") {\n            // Set keyCode and charCode\n            options.shortcut.charCode = options.shortcut.key.toUpperCase().charCodeAt(0);\n            options.shortcut.action = name;\n\n            // Set shortcut\n            self.shortcuts.push(options.shortcut);\n        }\n    }\n\n    execAction (action, source) {\n        var self = this;\n        if(!(action in self.actions)) {\n            log.error(`Action ${action} not in \"${self.actions}\"`);\n            return;\n        }\n        return self.actions[action].exec(source);\n    }\n\n    getPrefixedClassName (name) {\n        if (name.indexOf(\"-\") > -1) {\n            // dash-spaced-class-name\n            return \"mosaic-\" + name;\n        } else {\n            // camelCaseClassName\n            return \"mosaic\" + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n    };\n\n    async initActions () {\n        var self = this;\n        var mosaic = self.mosaic;\n\n        // Register generic re-usable toggle tile class format action\n        self.registerAction(\"tile-toggle-class\", {\n            exec: function () {\n                var name;\n                if (arguments.length > 0 && arguments[0].value) {\n                    name = self.getPrefixedClassName(arguments[0].value);\n                    $(\".mosaic-selected-tile\", mosaic.document).toggleClass(name);\n                }\n            },\n        });\n\n        // Register generic re-usable toggle tile class format action\n        self.registerAction(\"tile-remove-format\", {\n            exec: function () {\n                var i, j, group, action, name;\n                for (i = 0; i < mosaic.options.formats.length; i++) {\n                    group = mosaic.options.formats[i];\n                    for (j = 0; j < group.actions.length; j++) {\n                        action = group.actions[j];\n                        if (action.category === \"tile\") {\n                            name = self.getPrefixedClassName(action.name);\n                            $(\".mosaic-selected-tile\", mosaic.document).removeClass(name);\n                        }\n                    }\n                }\n            },\n        });\n\n        // Register generic re-usable toggle row class format action\n        self.registerAction(\"row-toggle-class\", {\n            exec: function () {\n                var name;\n                if (arguments.length > 0 && arguments[0].value) {\n                    name = self.getPrefixedClassName(arguments[0].value);\n                    $(\".mosaic-selected-tile\", mosaic.document)\n                        .parents(\".mosaic-grid-row\")\n                        .first()\n                        .toggleClass(name);\n                }\n            },\n        });\n\n        // Register generic re-usable toggle row class format action\n        self.registerAction(\"row-remove-format\", {\n            exec: function () {\n                var i, j, group, action, name;\n                for (i = 0; i < mosaic.options.formats.length; i++) {\n                    group = mosaic.options.formats[i];\n                    for (j = 0; j < group.actions.length; j++) {\n                        action = group.actions[j];\n                        if (action.category === \"row\") {\n                            name = self.getPrefixedClassName(action.name);\n                            $(\".mosaic-selected-tile\", mosaic.document)\n                                .parents(\".mosaic-grid-row\")\n                                .first()\n                                .removeClass(name)\n                                .removeClass(action.name);\n                        }\n                    }\n                }\n            },\n        });\n\n        // Register tile align block action\n        self.registerAction(\"tile-align-block\", {\n            exec: function () {\n                // Remove left and right align classes\n                $(\".mosaic-selected-tile\", mosaic.document)\n                    .removeClass(\"mosaic-tile-align-right\")\n                    .removeClass(\"mosaic-tile-align-left\");\n            },\n            shortcut: {\n                ctrl: true,\n                alt: false,\n                shift: true,\n                key: \"b\",\n            },\n        });\n\n        // Register tile align left action\n        self.registerAction(\"tile-align-left\", {\n            exec: function () {\n                // Remove right align class, add left align class\n                $(\".mosaic-selected-tile\", mosaic.document)\n                    .removeClass(\"mosaic-tile-align-right\")\n                    .addClass(\"mosaic-tile-align-left\");\n            },\n            shortcut: {\n                ctrl: true,\n                alt: false,\n                shift: true,\n                key: \"l\",\n            },\n        });\n\n        // Register tile align right action\n        self.registerAction(\"tile-align-right\", {\n            exec: function () {\n                // Remove left align class, add right align class\n                $(\".mosaic-selected-tile\", mosaic.document)\n                    .removeClass(\"mosaic-tile-align-left\")\n                    .addClass(\"mosaic-tile-align-right\");\n            },\n            shortcut: {\n                ctrl: true,\n                alt: false,\n                shift: true,\n                key: \"r\",\n            },\n        });\n\n        // Register save action\n        self.registerAction(\"save\", {\n            exec: function () {\n                mosaic.saving = true;\n                self.blurSelectedTile();\n                mosaic.toolbar.SelectedTileChange();\n                mosaic.queue(function (next) {\n                    mosaic.layoutManager.saveLayoutToForm();\n                    $(\"#form-buttons-save\").trigger(\"click\");\n                    mosaic.saving = false;\n                    next();\n                });\n            },\n            shortcut: {\n                ctrl: true,\n                alt: false,\n                shift: false,\n                key: \"s\",\n            },\n        });\n\n        // Register cancel action\n        self.registerAction(\"cancel\", {\n            exec: function () {\n                // Cancel form\n                $(\"#form-buttons-cancel\").trigger(\"click\");\n            },\n        });\n\n        // Register preview action\n        self.registerAction(\"preview\", {\n            exec: function () {\n                // Trigger validation => drafting sync\n                $(\n                    \"#form-widgets-ILayoutAware-customContentLayout, \" +\n                    \"[name='form.widgets.ILayoutAware.customContentLayout']\"\n                )\n                    .trigger(\"focus\")\n                    .trigger(\"focusout\");\n\n                // Layout preview\n                setTimeout(function () {\n                    window.open(\n                        mosaic.options.context_url + \"/@@layout_preview\",\n                        \"_blank\"\n                    );\n                }, 1000);\n            },\n        });\n\n        // Register html action\n        self.registerAction(\"html\", {\n            exec: function () {\n                // Local variables\n                var tilecontent, text, height;\n\n                // Get tile content div\n                tilecontent = $(\".mosaic-selected-tile\", mosaic.document).children(\n                    \".mosaic-tile-content\"\n                );\n\n                // Check if not already html editable\n                if (tilecontent.find(\".mosaic-rich-text-textarea\").length === 0) {\n                    // Add new text area and set content\n                    text = tilecontent.html();\n                    height = tilecontent.height();\n                    tilecontent.empty();\n                    tilecontent.prepend(\n                        $(mosaic.document.createElement(\"textarea\"))\n                            .addClass(\"mosaic-rich-text-textarea\")\n                            .html($.trim(text))\n                            .height(height)\n                    );\n                }\n            },\n        });\n\n        // Register page properties action\n        self.registerAction(\"properties\", {\n            exec: function () {\n                mosaic.overlay.open(\"all\");\n            },\n        });\n\n        self.registerAction(\"layout\", {\n            /* layout drop down */\n            exec: function () {\n                var $container = $(\".mosaic-button-group-layout\");\n                $container.toggleClass(\"active\");\n            },\n            visible: function () {\n                return true;\n            },\n        });\n\n        // register customize layout button\n        self.registerAction(\"customizelayout\", {\n            exec: function () {\n                mosaic.setSelectedContentLayout(\"\"); // clear selected layout, will use stored layout then\n                $(\".mosaic-toolbar-secondary-functions\").removeClass(\"d-none\");\n                $(\".mosaic-button-customizelayout\").hide();\n                $(\".mosaic-button-savelayout\").show();\n                // go through each tile and add movable\n                $(\".mosaic-panel .mosaic-tile\", mosaic.document).each(function () {\n                    var $mosaic_tile = $(this).data(\"mosaic-tile\");\n                    $mosaic_tile.makeMovable();\n                    $mosaic_tile.$el.mosaicAddDrag();\n                });\n                $(\".mosaic-button-group-layout\").removeClass(\"active\");\n            },\n            visible: function () {\n                return mosaic.options.canChangeLayout;\n            },\n        });\n\n        // register change layout button\n        self.registerAction(\"changelayout\", {\n            exec: function () {\n                var yes = mosaic.hasContentLayout;\n                if (!yes) {\n                    yes = confirm(\n                        \"Changing your layout will destroy all existing custom layout \" +\n                        \"settings you have in place. Are you sure you want to continue?\"\n                    );\n                }\n                if (yes) {\n                    mosaic.selectLayout();\n                }\n                $(\".mosaic-button-group-layout\").removeClass(\"active\");\n            },\n            visible: function () {\n                return mosaic.options.available_layouts.length > 0;\n            },\n        });\n\n        // register change layout button\n        self.registerAction(\"savelayout\", {\n            exec: function () {\n                mosaic.saveLayout();\n                $(\".mosaic-button-group-layout\").removeClass(\"active\");\n            },\n            visible: function () {\n                return true;\n            },\n        });\n\n        // Register add tile action\n        self.registerAction(\"add-tile\", {\n            exec: function () {\n                // Open overlay\n                var m = new Modal($(\".mosaic-toolbar\"), {\n                    ajaxUrl: mosaic.options.context_url +\n                        \"/@@add-tile?form.button.Create=Create\",\n                });\n                m.show();\n            },\n        });\n\n        // Register format action\n        self.registerAction(\"format\", {\n            exec: function (source) {\n                var val = $(source).val();\n                var action = $(source).find(`[value=\"${val}\"]`).data(\"action\")\n                self.execAction(action, source);\n                // reset selector\n                $(source).select2(\"val\", \"none\");\n            },\n        });\n\n        // Register page-insert action\n        self.registerAction(\"insert\", {\n            exec: function (source) {\n                // Local variables\n                var tile_config, tile_type;\n\n                // Check if value selected\n                if ($(source).val() === \"none\") {\n                    return false;\n                } else {\n                    tile_type = $(source).val();\n                }\n\n                // Deselect tiles\n                self.blurSelectedTile()\n\n                // Set actions\n                mosaic.toolbar.SelectedTileChange();\n\n                // Get tile config\n                for (const tile_group of mosaic.options.tiles) {\n                    for (const tile of tile_group.tiles) {\n                        if (tile.name === tile_type) {\n                            tile_config = tile;\n                        }\n                    }\n                }\n\n                // Create new app tile\n                if (tile_config.tile_type === \"textapp\") {\n                    // an app tile\n                    var uid = mosaic_utils.generate_uid();\n                    var tileUrl = mosaic.options.context_url + \"/@@\" + tile_type + \"/\" + uid;\n                    var html = \"<html><body>\" +\n                        mosaic.layoutManager.getDefaultValue(tile_config) +\n                        \"</body></html>\";\n                    mosaic.layoutManager.addAppTileHTML(tile_type, html, tileUrl);\n                } else if (tile_config.tile_type === \"app\") {\n                    // Load add form form selected tiletype\n                    var initial = true;\n                    utils.loading.show();\n                    $.ajax({\n                        type: \"GET\",\n                        url: mosaic.options.context_url +\n                            \"/@@add-tile?tiletype=\" +\n                            tile_type +\n                            \"&form.button.Create=Create\",\n                        success: function (value, xhr) {\n                            utils.loading.hide();\n                            var $value, action_url, authenticator, modalFunc;\n\n                            // Read form\n                            $value = $(value);\n                            action_url = $value.find(\"#add_tile\").attr(\"action\");\n                            authenticator = $value.find('[name=\"_authenticator\"]').val();\n                            // Open add form in modal when requires user input\n                            modalFunc = function (html) {\n                                mosaic.overlay.app = new Modal($(\".mosaic-toolbar\"), {\n                                    html: html,\n                                    loadLinksWithinModal: true,\n                                    buttons: '.formControls > button[type=\"submit\"], .actionButtons > button[type=\"submit\"]',\n                                });\n                                mosaic.overlay.app.$el.off(\"after-render\");\n                                mosaic.overlay.app.on(\"after-render\", function (event) {\n                                    /* Remove field errors since the user has not actually\n                                        been able to fill out the form yet\n                                    */\n                                    if (initial) {\n                                        $(\n                                            \".field.error\",\n                                            mosaic.overlay.app.$modal\n                                        ).removeClass(\"error\");\n                                        $(\n                                            \".fieldErrorBox,.portalMessage\",\n                                            mosaic.overlay.app.$modal\n                                        ).remove();\n                                        initial = false;\n                                    }\n\n                                    $('input[name*=\"cancel\"]', mosaic.overlay.app.$modal)\n                                        .off(\"click\")\n                                        .on(\"click\", function () {\n                                            // Close overlay\n                                            mosaic.overlay.app.hide();\n                                            mosaic.overlay.app = null;\n                                        });\n                                });\n                                mosaic.overlay.app.show();\n                                mosaic.overlay.app.$el.off(\"formActionSuccess\");\n                                mosaic.overlay.app.on(\n                                    \"formActionSuccess\",\n                                    function (event, response, state, xhr) {\n                                        var tileUrl = xhr.getResponseHeader(\"X-Tile-Url\");\n                                        if (tileUrl) {\n                                            mosaic.layoutManager.addAppTileHTML(\n                                                tile_type,\n                                                response,\n                                                tileUrl\n                                            );\n                                            mosaic.overlay.app.hide();\n                                            mosaic.overlay.app = null;\n                                        }\n                                    }\n                                );\n                            };\n\n                            // Auto-submit add-form when all required fields are filled\n                            if ($(\"form .required\", $value).filter(function () {\n                                var val = $(this)\n                                    .parents(\".field\")\n                                    .first()\n                                    .find(\"input, select, textarea\")\n                                    .not('[type=\"hidden\"]')\n                                    .last()\n                                    .val();\n                                return val === null || val.length === 0;\n                            }).length > 0) {\n                                modalFunc(value);\n                            } else if (action_url) {\n                                $(\"form\", $value).ajaxSubmit({\n                                    type: \"POST\",\n                                    url: action_url,\n                                    data: {\n                                        \"buttons.save\": \"Save\",\n                                        \"_authenticator\": authenticator,\n                                    },\n                                    success: function (value, state, xhr) {\n                                        var tileUrl = xhr.getResponseHeader(\"X-Tile-Url\");\n                                        if (tileUrl) {\n                                            mosaic.layoutManager.addAppTileHTML(\n                                                tile_type,\n                                                value,\n                                                tileUrl\n                                            );\n                                        } else {\n                                            modalFunc(value);\n                                        }\n                                    },\n                                });\n                            }\n                        },\n                    });\n                } else {\n                    // Add tile\n                    mosaic.layoutManager.addTile(tile_type, mosaic.layoutManager.getDefaultValue(tile_config));\n                }\n\n                // reset menu\n                $(source).select2(\"val\", \"none\");\n\n                // Normal exit\n                return true;\n            },\n        });\n\n        // Handle keypress event, check for shortcuts\n        $(document).on(\"keypress\", function (e) {\n            // Action name\n            var action = \"\";\n\n            // Loop through shortcuts\n            $(mosaic.actionManager.shortcuts).each(function () {\n                // Check if shortcut matched\n                if ((e.ctrlKey === this.ctrl ||\n                    (navigator.userAgent.toLowerCase().indexOf(\"macintosh\") !== -1 &&\n                        e.metaKey === this.ctrl)) &&\n                    (e.altKey === this.alt || e.altKey === undefined) &&\n                    e.shiftKey === this.shift &&\n                    e.charCode &&\n                    String.fromCharCode(e.charCode).toUpperCase().charCodeAt(0) ===\n                    this.charCode) {\n                    // Found action\n                    action = this.action;\n                }\n            });\n\n            // Check if shortcut found\n            if (action !== \"\") {\n                // Exec actions\n                mosaic.actionManager.actions[action].exec();\n\n                // Prevent other actions\n                return false;\n            }\n\n            // Normal exit\n            return true;\n        });\n    };\n\n    blurSelectedTile() {\n        var self = this;\n        this.mosaic.document.querySelectorAll(\".mosaic-selected-tile\").forEach(function(el) {\n            $(el).data(\"mosaic-tile\").blur();\n        });\n    };\n\n    mosaicExecAction() {\n        // Loop through matched elements\n        return this.each(function () {\n            // Check if actions specified\n            if ($(this).data(\"action\") !== \"\") {\n                var mgr = $.mosaic.actionManager;\n\n                // Exec actions\n                mgr.actions[$(this).data(\"action\")].exec(this);\n            }\n        });\n    };\n}\n\nexport default ActionManager;\n"],"names":["i","log","logging","ActionManager","mosaic","this","actions","shortcuts","name","options","$","exec","shortcut","ctrl","alt","shift","key","visible","tile","charCode","toUpperCase","charCodeAt","action","push","source","self","error","indexOf","charAt","slice","registerAction","arguments","length","value","getPrefixedClassName","document","toggleClass","j","group","formats","category","removeClass","parents","first","addClass","saving","blurSelectedTile","toolbar","SelectedTileChange","queue","next","layoutManager","saveLayoutToForm","trigger","setTimeout","window","open","context_url","tilecontent","text","height","children","find","html","empty","prepend","createElement","overlay","setSelectedContentLayout","hide","show","each","$mosaic_tile","data","makeMovable","$el","mosaicAddDrag","canChangeLayout","yes","hasContentLayout","confirm","selectLayout","available_layouts","saveLayout","Modal","ajaxUrl","val","execAction","select2","tile_config","tile_type","tiles","uid","mosaic_utils","tileUrl","getDefaultValue","addAppTileHTML","initial","utils","type","url","success","xhr","$value","action_url","authenticator","modalFunc","attr","app","loadLinksWithinModal","buttons","off","on","event","$modal","remove","response","state","getResponseHeader","filter","not","last","ajaxSubmit","addTile","e","actionManager","ctrlKey","navigator","userAgent","toLowerCase","metaKey","altKey","undefined","shiftKey","String","fromCharCode","querySelectorAll","forEach","el","blur"],"sourceRoot":""}