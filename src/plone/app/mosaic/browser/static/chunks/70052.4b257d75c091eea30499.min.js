(self.webpackChunkplone_mosaic=self.webpackChunkplone_mosaic||[]).push([[70052],{74479:function(e,t,i){var n={"./select2_locale_ar":[29801,14894],"./select2_locale_ar.js":[29801,14894],"./select2_locale_az":[14945,14894],"./select2_locale_az.js":[14945,14894],"./select2_locale_bg":[2262,14894],"./select2_locale_bg.js":[2262,14894],"./select2_locale_ca":[7364,14894],"./select2_locale_ca.js":[7364,14894],"./select2_locale_cs":[25570,14894],"./select2_locale_cs.js":[25570,14894],"./select2_locale_da":[80906,14894],"./select2_locale_da.js":[80906,14894],"./select2_locale_de":[50865,14894],"./select2_locale_de.js":[50865,14894],"./select2_locale_el":[29168,14894],"./select2_locale_el.js":[29168,14894],"./select2_locale_en.js.template":[1154,14894],"./select2_locale_es":[34874,14894],"./select2_locale_es.js":[34874,14894],"./select2_locale_et":[35844,14894],"./select2_locale_et.js":[35844,14894],"./select2_locale_eu":[30297,14894],"./select2_locale_eu.js":[30297,14894],"./select2_locale_fa":[96458,14894],"./select2_locale_fa.js":[96458,14894],"./select2_locale_fi":[98341,14894],"./select2_locale_fi.js":[98341,14894],"./select2_locale_fr":[44854,14894],"./select2_locale_fr.js":[44854,14894],"./select2_locale_gl":[52235,14894],"./select2_locale_gl.js":[52235,14894],"./select2_locale_he":[33223,14894],"./select2_locale_he.js":[33223,14894],"./select2_locale_hr":[38962,14894],"./select2_locale_hr.js":[38962,14894],"./select2_locale_hu":[3244,14894],"./select2_locale_hu.js":[3244,14894],"./select2_locale_id":[40311,14894],"./select2_locale_id.js":[40311,14894],"./select2_locale_is":[60619,14894],"./select2_locale_is.js":[60619,14894],"./select2_locale_it":[8176,14894],"./select2_locale_it.js":[8176,14894],"./select2_locale_ja":[92060,14894],"./select2_locale_ja.js":[92060,14894],"./select2_locale_ka":[3856,14894],"./select2_locale_ka.js":[3856,14894],"./select2_locale_ko":[37741,14894],"./select2_locale_ko.js":[37741,14894],"./select2_locale_lt":[51577,14894],"./select2_locale_lt.js":[51577,14894],"./select2_locale_lv":[53616,14894],"./select2_locale_lv.js":[53616,14894],"./select2_locale_mk":[54154,14894],"./select2_locale_mk.js":[54154,14894],"./select2_locale_ms":[63331,14894],"./select2_locale_ms.js":[63331,14894],"./select2_locale_nb":[33656,14894],"./select2_locale_nb.js":[33656,14894],"./select2_locale_nl":[67745,14894],"./select2_locale_nl.js":[67745,14894],"./select2_locale_pl":[34321,14894],"./select2_locale_pl.js":[34321,14894],"./select2_locale_pt-BR":[21399,14894],"./select2_locale_pt-BR.js":[21399,14894],"./select2_locale_pt-PT":[69997,14894],"./select2_locale_pt-PT.js":[69997,14894],"./select2_locale_ro":[90111,14894],"./select2_locale_ro.js":[90111,14894],"./select2_locale_rs":[84204,14894],"./select2_locale_rs.js":[84204,14894],"./select2_locale_ru":[68302,14894],"./select2_locale_ru.js":[68302,14894],"./select2_locale_sk":[492,14894],"./select2_locale_sk.js":[492,14894],"./select2_locale_sv":[55391,14894],"./select2_locale_sv.js":[55391,14894],"./select2_locale_th":[62680,14894],"./select2_locale_th.js":[62680,14894],"./select2_locale_tr":[73576,14894],"./select2_locale_tr.js":[73576,14894],"./select2_locale_ug-CN":[45466,14894],"./select2_locale_ug-CN.js":[45466,14894],"./select2_locale_uk":[90058,14894],"./select2_locale_uk.js":[90058,14894],"./select2_locale_vi":[55405,14894],"./select2_locale_vi.js":[55405,14894],"./select2_locale_zh-CN":[82671,14894],"./select2_locale_zh-CN.js":[82671,14894],"./select2_locale_zh-TW":[88016,14894],"./select2_locale_zh-TW.js":[88016,14894]};function l(e){if(!i.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],l=t[0];return i.e(t[1]).then((function(){return i.t(l,23)}))}l.keys=function(){return Object.keys(n)},l.id=74479,e.exports=l},68455:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return g}});var n=i(57845),l=i.n(n),a=i(99321),o=i.n(a),s=i(43296),r=i(15684),c=i(27113),p=i(4841),d=i(63359),h=s.Z.extend({name:"select2",trigger:".pat-select2",parser:"mockup",defaults:{separator:",",ajaxTimeout:300},initializeValues(){this.options.initialValues&&(this.options.id=e=>e.id,this.options.initSelection=(e,t)=>{const i=[],n=e.val();let a=this.options.initialValues;if("string"==typeof this.options.initialValues&&""!==this.options.initialValues)if("{"===this.options.initialValues[0])a=JSON.parse(this.options.initialValues);else{a={};const e=l()(this.options.initialValues.split(this.options.separator));for(const t of e){const e=t.split(":"),i=e[0].trim(),n=e[1].trim();a[i]=n}}const o=l()(n.split(this.options.separator));for(const e of o){let t=e;a[e]&&(t=a[e]),i.push({id:c.Z.removeHTML(e),text:c.Z.removeHTML(t)})}t(i)})},initializeTags(){this.options.tags&&"string"==typeof this.options.tags&&("["===this.options.tags.substr(0,1)?this.options.tags=JSON.parse(this.options.tags):this.options.tags=this.options.tags.split(this.options.separator)),this.options.tags&&!this.options.allowNewItems&&(this.options.data=this.options.tags.map((e=>({id:e,text:e}))),this.options.multiple=!0,delete this.options.tags)},async initializeOrdering(){if(!this.options.orderable)return;const e=(await i.e(67257).then(i.t.bind(i,67257,23))).default,t=()=>{const t=this.$select2[0].querySelector(".select2-choices");new e(t,{draggable:"li",dragClass:"select2-choice-dragging",chosenClass:"dragging",onStart:()=>this.$el.select2("onSortStart"),onEnd:()=>this.$el.select2("onSortEnd")})};this.$el.on("change",t.bind(this)),t()},async initializeSelect2(){Promise.all([i.e(14894),i.e(69106)]).then(i.bind(i,45202)),i.e(52954).then(i.bind(i,52954)),await i.e(96528).then(i.t.bind(i,96528,23));try{this.options.language&&"en"!==this.options.language&&await i(74479)(`./select2_locale_${this.options.language}`)}catch{console.warn("Language file could not be loaded",this.options.language)}function e(e,t){return e?(this.options.debug&&console.debug("callback",e,t),"string"==typeof e&&(e=window[e]),e(t)):e}this.options.formatResultCssClass=e=>{if(e.id)return"select2-option-"+e.id.toLowerCase().replace(/[ \:\)\(\[\]\{\}\_\+\=\&\*\%\#]/g,"-")},this.$el.select2(this.options),this.$el.on("select2-selected",(t=>e(this.options.onSelected,t))),this.$el.on("select2-selecting",(t=>e(this.options.onSelecting,t))),this.$el.on("select2-deselecting",(t=>e(this.options.onDeselecting,t))),this.$el.on("select2-deselected",(t=>e(this.options.onDeselected,t))),this.$select2=this.$el.parent().find(".select2-container"),this.$el.parent().off("close.plone-modal.patterns"),this.options.orderable&&this.$select2.addClass("select2-orderable")},opened(){return 1===l()(".select2-dropdown-open",this.$el.parent()).length},async init(){const e=new d.Z;if(this.options.language=e.currentLanguage,this.options.allowNewItems=!this.options.allowNewItems||JSON.parse(this.options.allowNewItems),this.options.ajax||this.options.vocabularyUrl){this.options.vocabularyUrl&&(this.options.multiple=void 0===this.options.multiple||this.options.multiple,this.options.ajax=this.options.ajax||{},this.options.ajax.url=this.options.vocabularyUrl,this.options.initSelection=(e,t)=>{const i=[],n=e.val();for(const e of n.split(this.options.separator)){const t=c.Z.removeHTML(e);i.push({id:t,text:t})}t(i)});let e="";const t=parseInt(this.options.ajaxTimeout||300,10);delete this.options.ajaxTimeout,this.options.ajax=l().extend({quietMillis:t,data:(t,i)=>(e=t,{query:t,page_limit:10,page:i}),results:t=>{let i=t.results;if(this.options.vocabularyUrl){const n=[];for(const e of t.results)n.push(e.id);i=[];const l=""===e||n.includes(e);this.options.allowNewItems&&!l&&(e=c.Z.removeHTML(e),i.push({id:e,text:e}));for(const e of t.results)i.push(e)}return{results:i}}},this.options.ajax)}else if(this.options.multiple&&this.$el.is("select")){this.$el.attr("multiple",!0);const e=this.$el.val()||[],t=[...this.el.querySelectorAll("option")].map((e=>({text:e.innerHTML,id:e.value}))),i=document.createElement("input");i.type="hidden",i.value=e.join(this.options.separator),i.className=this.el.getAttribute("class"),i.name=this.el.name,i.id=this.el.id,this.el.after(i),this.el.remove(),this.el=i,this.$el=l()(i),this.options.data=t}this.initializeValues(),this.initializeTags(),await this.initializeSelect2(),await this.initializeOrdering()}});const u=37,m=39;var g=s.Z.extend({name:"relateditems",trigger:".pat-relateditems",parser:"mockup",currentPath:void 0,selectedUIDs:[],openAfterInit:void 0,defaults:{vocabularyUrl:null,attributes:["UID","Title","portal_type","path","getURL","getIcon","is_folderish","review_state"],basePath:"",pageSize:10,browsing:void 0,closeOnSelect:!0,contextPath:void 0,dropdownCssClass:"pat-relateditems-dropdown",favorites:[],recentlyUsed:!1,recentlyUsedMaxItems:20,recentlyUsedKey:"relateditems_recentlyused",maximumSelectionSize:-1,minimumInputLength:0,mode:"browse",orderable:!0,pathOperator:"plone.app.querystring.operation.string.path",rootPath:"/",rootUrl:"",scanSelection:!1,selectableTypes:null,separator:",",sortOn:null,sortOrder:"ascending",tokenSeparators:[","," "],upload:!1,uploadAllowView:void 0,breadcrumbTemplateSelector:null,favoriteTemplateSelector:null,recentlyusedTemplateSelector:null,resultTemplateSelector:null,selectionTemplateSelector:null,toolbarTemplateSelector:null,multiple:!0,ajaxTimeout:500},recentlyUsed(e){let t=c.Z.storage.get(this.options.recentlyUsedKey)||[];t=t.slice(t.length-1e3,t.length),e&&t.filter(this.isSelectable.bind(this));const i=parseInt(this.options.recentlyUsedMaxItems,10);return i&&(t=t.slice(t.length-i,t.length)),t},applyTemplate(e,t){let i;this.options[e+"TemplateSelector"]&&(i=l()(this.options[e+"TemplateSelector"]).html()),i||(i=this.options[e+"Template"]?this.options[e+"Template"]:this[e+"Template"]);const n=l().extend(!0,{},this.options,t,{browsing:this.browsing,open_folder:(0,r.ZP)("Open folder"),current_directory:(0,r.ZP)("current directory:"),one_level_up:(0,r.ZP)("Go one level up")});return n._item=t,o().template(i)(n)},setAjax(){const e=parseInt(this.options.ajaxTimeout||500,10),t={url:this.options.vocabularyUrl,dataType:"JSON",quietMillis:e,data:(e,t)=>{const i=[];e&&(e="*"+e+"*",i.push({i:"SearchableText",o:"plone.app.querystring.operation.string.contains",v:e})),!this.browsing&&this.options.selectableTypes&&i.push({i:"portal_type",o:"plone.app.querystring.operation.selection.any",v:this.options.selectableTypes}),i.push({i:"path",o:this.options.pathOperator,v:this.options.rootPath+this.currentPath+(this.browsing?"::1":"")});let n=this.options.sortOn,l=n?this.options.sortOrder:null;this.browsing&&null===n&&(n="getObjPositionInParent",l="ascending");return{query:JSON.stringify({criteria:i,sort_on:n,sort_order:l}),attributes:JSON.stringify(this.options.attributes),batch:JSON.stringify({page:t||1,size:this.options.pageSize})}},results:(e,t)=>{const i=t*this.options.pageSize<e.total;let n=e.results;this.selectedUIDs=(this.$el.select2("data")||[]).map((e=>e.UID)),n=n.filter((e=>!!(this.browsing&&e.is_folderish||this.isSelectable(e)&&-1===this.selectedUIDs.indexOf(e.UID))));const l=this.currentPath.split("/");return 1===t&&this.browsing&&l.length>1&&"/"!==this.currentPath&&(n=[{oneLevelUp:!0,Title:(0,r.ZP)("One level up"),path:l.slice(0,l.length-1).join("/")||"/",currentPath:this.currentPath,is_folderish:!0,selectable:!1}].concat(n)),{results:n,more:i}}};this.options.ajax=t},async renderToolbar(){let e;const t=this.currentPath.split("/");let i="",n="";for(const e of t)if(""!==e){const t={};t.path=i=`${i}/${e}`,t.text=e,n+=this.applyTemplate("breadcrumb",t)}let a="";for(const e of this.options.favorites){const t=o().clone(e);t.path=t.path.substr(this.options.rootPath.length)||"/",a+=this.applyTemplate("favorite",t)}let s="";if(this.options.recentlyUsed){const e=this.recentlyUsed(!0);for(const t of e.reverse())s+=this.applyTemplate("recentlyused",t)}e=this.applyTemplate("toolbar",{items:n,favItems:a,favText:(0,r.ZP)("Favorites"),searchText:(0,r.ZP)("Current path:"),searchModeText:(0,r.ZP)("Search"),browseModeText:(0,r.ZP)("Browse"),recentlyUsedItems:s,recentlyUsedText:(0,r.ZP)("Recently Used"),icon_root:await c.Z.resolveIcon("house-fill"),icon_recently_used:await c.Z.resolveIcon("grid-fill"),icon_favorites:await c.Z.resolveIcon("star-fill"),icon_upload:await c.Z.resolveIcon("cloud-arrow-up"),upload:this.options.upload,upload_text:(0,r.ZP)("Upload")}),this.$toolbar.html(e),l()(".pat-relateditems-dropdown").off("mouseup"),l()(".pat-relateditems-dropdown").on("mouseup",(e=>{e.stopPropagation()})),l()("button.mode.search",this.$toolbar).on("click",(e=>{e.preventDefault(),this.browsing?(l()("button.mode.search",this.$toolbar).toggleClass("btn-primary btn-default"),l()("button.mode.browse",this.$toolbar).toggleClass("btn-primary btn-default"),this.browsing=!1,this.$el.select2("data").length>0&&(this.openAfterInit=!0),this.openAfterInit||(this.$el.select2("close"),this.$el.select2("open"))):(this.$el.select2("close"),this.$el.select2("open"))})),l()("button.mode.browse",this.$toolbar).on("click",(e=>{e.preventDefault(),this.browsing?(this.$el.select2("close"),this.$el.select2("open")):(l()("button.mode.search",this.$toolbar).toggleClass("btn-primary btn-default"),l()("button.mode.browse",this.$toolbar).toggleClass("btn-primary btn-default"),this.browsing=!0,this.$el.select2("data").length>0&&(this.openAfterInit=!0),this.openAfterInit||(this.$el.select2("close"),this.$el.select2("open")))})),l()("a.crumb",this.$toolbar).on("click",(e=>{e.preventDefault(),e.stopPropagation(),this.browseTo(l()(e.currentTarget).attr("href"))})),l()("a.fav",this.$toolbar).on("click",(e=>{e.preventDefault(),e.stopPropagation(),this.browseTo(l()(e.currentTarget).attr("href"))})),this.options.recentlyUsed&&l()(".pat-relateditems-recentlyused-select",this.$toolbar).on("click",(e=>{e.preventDefault();const t=l()(e.currentTarget).data("uid");let i=this.recentlyUsed().filter((e=>e.UID===t));if(i.length>0&&(i=i[0],this.selectItem(i),this.options.maximumSelectionSize>0)){if(this.$el.select2("data").length>=this.options.maximumSelectionSize)return}})),this.options.upload&&c.Z.featureSupport.dragAndDrop()&&c.Z.featureSupport.fileApi()&&(this.options.uploadAllowView?l().ajax({url:this.options.uploadAllowView,dataType:"JSON",data:{path:this.options.rootPath+this.currentPath},type:"GET",success:e=>{this.initUploadView(!e.allowUpload)}}):this.initUploadView())},async initUploadView(e){let t=await Promise.resolve().then(i.bind(i,94357));t=t.default;const n=this.$toolbar[0].querySelector(".upload button");n.disabled=e;const a=this.$toolbar[0].querySelector(".upload .pat-upload"),o={success:(e,t)=>{const i=t.UID;if(i){new c.Z.QueryHelper({vocabularyUrl:this.options.vocabularyUrl,attributes:this.options.attributes}).search("UID","plone.app.querystring.operation.selection.is",i,(e=>{const t=this.$el.select2("data");t.push.apply(t,e.results),this.$el.select2("data",t,!0),this.emit("selected"),this.popover.hide()}),!1)}},uloadMultiple:!0,allowPathSelection:!1,relativePath:"fileUpload",baseUrl:this.options.rootUrl},s=new t(l()(a),o);n.addEventListener("show.bs.dropdown",(()=>{this.currentPath!==s.currentPath&&s.setPath(this.currentPath)}))},browseTo(e){this.emit("before-browse"),this.currentPath=e,this.$el.select2("close"),this.renderToolbar(),this.$el.select2("open"),this.emit("after-browse")},selectItem(e){this.emit("selecting");const t=this.$el.select2("data");if(t.push(e),this.$el.select2("data",t,!0),this.options.recentlyUsed){const t=this.recentlyUsed(),i=t.filter((t=>t.UID===e.UID));i.length>0&&t.splice(t.indexOf(i[0]),1),t.push(e),c.Z.storage.set(this.options.recentlyUsedKey,t)}this.emit("selected")},deselectItem(e){this.emit("deselecting");const t=this.$el.select2("data");t.forEach(((i,n)=>{i.UID===e.UID&&t.splice(n,1)})),this.$el.select2("data",t,!0),this.emit("deselected")},isSelectable(e){return!1!==e.selectable&&(null===this.options.selectableTypes||-1!==this.options.selectableTypes.indexOf(e.portal_type))},async init(){(await i.e(39709).then(i.t.bind(i,39709,23))).Dropdown,i.e(64195).then(i.bind(i,64195)),this.breadcrumbTemplate=(await i.e(47272).then(i.t.bind(i,47272,17))).default,this.favoriteTemplate=(await i.e(83823).then(i.t.bind(i,83823,17))).default,this.recentlyusedTemplate=(await i.e(50082).then(i.t.bind(i,50082,17))).default,this.resultTemplate=(await i.e(97729).then(i.t.bind(i,97729,17))).default,this.selectionTemplate=(await i.e(32113).then(i.t.bind(i,32113,17))).default,this.toolbarTemplate=(await i.e(91777).then(i.t.bind(i,91777,17))).default,this.browsing="search"!==this.options.mode,this.options.rootPath=this.options.rootPath.replace(/\/$/,""),this.currentPath=this.options.basePath.substr(this.options.rootPath.length)||"/",this.setAjax(),this.$el.wrap('<div class="pat-relateditems-container" />'),this.$container=this.$el.parents(".pat-relateditems-container"),h.prototype.initializeValues.call(this),h.prototype.initializeTags.call(this),this.options.formatSelection=e=>{e=l().extend(!0,{Title:"",getIcon:"",getURL:"",path:"",portal_type:"",review_state:""},e);const t=l()(this.applyTemplate("selection",e));if(this.options.scanSelection&&p.Z.scan(t),1==this.options.maximumSelectionSize){let t=e.path,i=t.split("/");i=i.slice(0,-1),t=i.join("/"),this.currentPath=t,this.renderToolbar()}return t};const e=await c.Z.resolveIcon("arrow-left-circle"),t=await c.Z.resolveIcon("arrow-right-circle");this.options.formatResult=i=>{i.selectable=this.isSelectable(i),i=l().extend(!0,{Title:"",getIcon:"",getURL:"",is_folderish:!1,oneLevelUp:!1,iconLevelUp:e,iconLevelDown:t,path:"",portal_type:"",review_state:"",selectable:!1},i),-1!==this.selectedUIDs.indexOf(i.UID)&&(i.selectable=!1);const n=l()(this.applyTemplate("result",i));return l()(".pat-relateditems-result-select",n).on("click",(e=>{const t=e.currentTarget;if(e.preventDefault(),l()(t).is(".selectable")){const e=l()(t).parents(".pat-relateditems-result");if(e.is(".pat-relateditems-active"))e.removeClass("pat-relateditems-active"),this.deselectItem(i);else{if(this.options.maximumSelectionSize>0){this.$el.select2("data").length>=this.options.maximumSelectionSize&&this.$el.select2("close")}this.selectItem(i),e.addClass("pat-relateditems-active"),this.options.closeOnSelect&&this.$el.select2("close")}}})),l()(".pat-relateditems-result-browse",n).on("click",(e=>{e.preventDefault(),e.stopPropagation();const t=l()(e.currentTarget).data("path");this.browseTo(t)})),l()(n)},this.options.initSelection=(e,t)=>{const i=l()(e).val();if(""!==i){const e=i.split(this.options.separator);new c.Z.QueryHelper(l().extend(!0,{},this.options,{pattern:this})).search("UID","plone.app.querystring.operation.list.contains",e,(i=>{const n=i.results.reduce(((e,t)=>(e[t.UID]=t,e)),{});try{t(e.map((e=>n[e])).filter((e=>void 0!==e)))}catch(e){}this.openAfterInit&&(this.$el.select2("open"),this.openAfterInit=void 0)}),!1)}},this.options.tokenizer=e=>{"auto"===this.options.mode&&(this.browsing=!e)},this.options.id=e=>e.UID,await h.prototype.initializeSelect2.call(this),await h.prototype.initializeOrdering.call(this),this.$toolbar=l()('<div class="toolbar d-flex" />'),this.$container.prepend(this.$toolbar),this.$el.on("select2-selecting",(e=>{this.isSelectable(e.choice)||e.preventDefault()})),this.renderToolbar(),this.$el.on("select2-loaded",(()=>{let e=window.innerHeight||document.documentElement.clientHeight;const t=l()(".pat-relateditems-dropdown.select2-drop-active .select2-results")[0],i=e-t.getBoundingClientRect().top-18;l()(t).css("max-height",`${i}px`)})),l()(document).on("keyup",this.$el,(e=>{if(h.prototype.opened.call(this)&&(e.which===u||e.which===m)){e.stopPropagation();const t=e.which===u?".pat-relateditems-result.one-level-up":".select2-highlighted",i=".pat-relateditems-result-browse",n=l()(i,t);if(1!==n.length)return;const a=n.data("path");this.browseTo(a)}}))}})},70052:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return _}});var n=i(57845),l=i.n(n),a=i(99321),o=i.n(a),s=i(43296),r=i(4841),c=i(60950),p=i.n(c),d='<div>\n  <div class="linkModal">\n    <h1><%- insertHeading %></h1>\n    <% if(_.contains(linkTypes, \'upload\')){ %>\n    <p class="info"><%- insertLinkHelp %></p>\n    <% } %>\n\n    <div class="linkTypes pat-autotoc autotabs"\n         data-pat-autotoc="section:fieldset;levels:legend;IDPrefix:tinymce-autotoc-">\n\n      <% if(_.contains(linkTypes, \'internal\')){ %>\n      <fieldset class="linkType internal" data-linkType="internal">\n        <legend id="tinylink-internal"><%- internal %></legend>\n        <div>\n          <div class="main mb-2">\n            \x3c!-- this gives the name to the "linkType" --\x3e\n            <input type="text" name="internal" class="form-control" />\n          </div>\n        </div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'upload\')){ %>\n      <fieldset class="linkType upload" data-linkType="upload">\n        <legend id="tinylink-upload"><%- uploadText %></legend>\n        <div class="uploadify-me"></div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'external\')){ %>\n      <fieldset class="linkType external" data-linkType="external">\n        <legend id="tinylink-external"><%- external %></legend>\n        <div class="main mb-2">\n          <label for="external"><%- externalText %></label>\n          <input type="text" name="external" class="form-control" />\n        </div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'email\')){ %>\n      <fieldset class="linkType email" data-linkType="email">\n        <legend id="tinylink-email"><%- emailText %></legend>\n        <div>\n          <div class="main mb-2">\n            <label><%- emailText %></label>\n            <input type="text" name="email" class="form-control" />\n          </div>\n          <div class="mb-2">\n            <label><%- subjectText %></label>\n            <input type="text" name="subject" class="form-control" />\n          </div>\n        </div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'anchor\')){ %>\n      <fieldset class="linkType anchor" data-linkType="anchor">\n        <legend id="tinylink-anchor"><%- anchor %></legend>\n        <div>\n          <div class="main mb-2">\n            <label><%- anchorLabel %></label>\n            <div class="input-wrapper">\n              <select name="anchor" class="pat-select2" data-pat-select2="width:500px"></select>\n            </div>\n          </div>\n        </div>\n      </fieldset>\n      <% } %>\n\n    </div>\x3c!-- / tabs --\x3e\n\n    <div class="common-controls mt-3 border-top pt-3">\n      <div class="mb-2">\n        <label><%- target %></label>\n        <select name="target" class="form-select">\n          <% _.each(targetList, function(target){ %>\n            <option value="<%- target.value %>"><%- target.text %></option>\n          <% }); %>\n        </select>\n      </div>\n      <div class="mb-2">\n        <label><%- titleText %></label>\n        <input type="text" name="title" class="form-control" />\n      </div>\n    </div>\n\n    <input type="submit" class="btn btn-secondary plone-btn me-1" name="cancel" value="<%- cancelBtn %>" />\n    <input type="submit" class="btn btn-primary plone-btn" name="insert" value="<%- insertBtn %>" />\n  </div>\n</div>\n',h='<div>\n  <div class="linkModal">\n    <h1><%- insertHeading %></h1>\n    <% if(_.contains(linkTypes, \'uploadImage\')){ %>\n    <p class="info"><%- insertImageHelp %></p>\n    <% } %>\n\n    <div class="linkTypes pat-autotoc autotabs"\n         data-pat-autotoc="section:fieldset;levels:legend;IDPrefix:tinymce-autotoc-">\n\n        <% if(_.contains(linkTypes, \'image\')){ %>\n      <fieldset class="linkType image" data-linkType="image">\n        <legend id="tinylink-image"><%- internalImageText %></legend>\n        <div>\n          <div class="main mb-2">\n            <input type="text" name="image" class="form-control" />\n          </div>\n          <div class="scale mb-2">\n            <label><%- scaleText %></label>\n            <select name="scale" class="form-select">\n              <% _.each(Object.keys(pictureVariants), function(key) { %>\n                <option value="<%- key %>" <% if (key === options.defaultSrcset) { %>selected<% } %> >\n                  <%- pictureVariants[key].title %>\n                </option>\n              <% }); %>\n            </select>\n          </div>\n        </div>\n      </fieldset>\n        <% } %>\n\n      <% if(_.contains(linkTypes, \'uploadImage\')){ %>\n      <fieldset class="linkType uploadImage" data-linkType="uploadImage">\n        <legend id="tinylink-uploadImage"><%- uploadText %></legend>\n        <div class="uploadify-me"></div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'externalImage\')){ %>\n      <fieldset class="linkType externalImage" data-linkType="externalImage">\n        <legend id="tinylink-externalImage"><%- externalImage %></legend>\n        <div>\n          <div class="main">\n            <label><%- externalImageText %></label>\n            <input type="text" name="externalImage" class="form-control" />\n          </div>\n        </div>\n      </fieldset>\n      <% } %>\n\n    </div>\x3c!-- / tabs --\x3e\n\n    <div class="common-controls mt-3 border-top pt-3">\n      <div class="title mb-2">\n        <label><%- titleText %></label>\n        <input type="text" name="title" class="form-control" />\n      </div>\n      <div class="text mb-2">\n        <label><%- altText %></label>\n        <input type="text" name="alt" class="form-control" />\n      </div>\n      <% if(imageCaptioningEnabled){ %>\n      <div class="captionFromDescription form-check mb-2">\n        <input type="checkbox" name="captionFromDescription" class="form-check-input" />\n        <label for="captionFromDescription" class="form-check-label">\n          <%- captionFromDescriptionText %>\n        </label>\n      </div>\n      <div class="caption mb-2">\n        <label><%- captionText %></label>\n        <textarea name="caption" class="form-control"></textarea>\n      </div>\n      <% } %>\n      <div class="align mb-2">\n        <label><%- imageAlignText %></label>\n        <select name="align" class="form-select">\n          <% _.each(Object.keys(options.imageClasses), function(align){ %>\n              <option value="<%- align %>">\n              <%- options.imageClasses[align] %>\n              </option>\n          <% }); %>\n        </select>\n      </div>\n      <div class="enable-zoom mb-2">\n        <input type="checkbox" name="enableImageZoom" class="form-check-input" />\n        <label for="enableImageZoom" class="form-check-label">\n          <%- enableImageZoom %>\n        </label>\n      </div>\n    </div>\n\n    <input type="submit" class="btn btn-secondary plone-btn me-1" name="cancel" value="<%- cancelBtn %>" />\n    <input type="submit" class="btn btn-primary plone-btn" name="insert" value="<%- insertBtn %>" />\n\n  </div>\n</div>\n',u=i(68455),m=(s.Z.extend({name:"autotoc",trigger:".pat-autotoc",parser:"mockup",defaults:{section:"section",levels:"h1,h2,h3",IDPrefix:"autotoc-item-",classTOCName:"autotoc-nav",classSectionName:"autotoc-section",classLevelPrefixName:"autotoc-level-",classActiveName:"active",scrollDuration:"slow",scrollEasing:"swing"},init:function(){i.e(59368).then(i.bind(i,59368));var e=this;e.$toc=l()("<nav/>").addClass(e.options.classTOCName),e.options.prependTo?e.$toc.prependTo(e.options.prependTo):e.options.appendTo?e.$toc.appendTo(e.options.appendTo):e.$toc.prependTo(e.$el),e.options.className&&e.$el.addClass(e.options.className),l()(e.options.section,e.$el).addClass(e.options.classSectionName);var t=e.$el.hasClass("autotabs"),n=null;l()(e.options.levels,e.$el).each((function(i){var a=l()(this),o=a.prop("id")?a.prop("id"):a.parents(e.options.section).prop("id");(!o||l()("#"+o).length>0)&&(o=e.options.IDPrefix+e.name+"-"+i),window.location.hash==="#"+o&&(n=o),null===n&&a.hasClass(e.options.classActiveName)&&(n=o),a.data("navref",o),l()("<a/>").appendTo(e.$toc).text(a.text()).attr("id",o).attr("href","#"+o).addClass(e.options.classLevelPrefixName+e.getLevel(a)).on("click",(function(i,n){i.stopPropagation(),i.preventDefault(),n||(n={doScroll:!0,skipHash:!1});var o=l()(this);e.$toc.children("."+e.options.classActiveName).removeClass(e.options.classActiveName),e.$el.children("."+e.options.classActiveName).removeClass(e.options.classActiveName),l()(i.target).addClass(e.options.classActiveName),a.parents(e.options.section).addClass(e.options.classActiveName),!1!==n.doScroll&&e.options.scrollDuration&&a&&!t&&l()("body,html").animate({scrollTop:a.offset().top},e.options.scrollDuration,e.options.scrollEasing),0!==e.$el.parents(".plone-modal").length&&e.$el.trigger("resize.plone-modal.patterns"),l()(this).trigger("clicked"),n.skipHash||window.history&&window.history.pushState&&window.history.pushState({},"","#"+o.attr("id"))})),a.data("autotoc-trigger-id",o)})),n?l()("a#"+n).trigger("click",{doScroll:!0,skipHash:!0}):e.$toc.find("a").first().trigger("click",{doScroll:!1,skipHash:!0})},getLevel:function(e){var t=0;return l().each(this.options.levels.split(","),(function(i,n){if(1===e.filter(n).length)return t=i+1,!1})),t}}),i(74360),i(94357)),g=s.Z.extend({name:"linktype",trigger:".pat-linktype-dummy",defaults:{linkModal:null},init:function(){this.linkModal=this.options.linkModal,this.tinypattern=this.options.tinypattern,this.tiny=this.tinypattern.tiny,this.dom=this.tiny.dom},getEl:function(){return this.$el.find("input")},value:function(){return this.getEl().val().trim()},toUrl:function(){return this.value()},load:function(e){let t=this.tiny.dom.getAttrib(e,"data-val");this.getEl().attr("value",t)},set:function(e){var t=this.getEl();t.attr("value",e),t.val(e)},attributes:function(){return{"data-val":this.value()}},updateRelatedItems:function(){}}),f=g.extend({name:"externallinktype",trigger:".pat-externallinktype-dummy",init:function(){g.prototype.init.call(this),this.getEl().on("change",(function(){var e=l()(this).val();new RegExp("https?://").test(e)||-1!==l()(this).val().split("/")[0].indexOf(".")&&l()(this).val("http://"+e)}))}}),v=g.extend({name:"internallinktype",trigger:".pat-internallinktype-dummy",init:function(){this.getEl().length&&(g.prototype.init.call(this),this.getEl().addClass("pat-relateditems"),this.createRelatedItems())},getEl:function(){return this.$el.find("input:not(.select2-input)")},createRelatedItems:function(){if(this.getEl().length){var e=this.linkModal.options.relatedItems;e.upload=!1,this.relatedItems=new u.default(this.getEl(),e)}},updateRelatedItems:function(e){this.relatedItems||this.createRelatedItems(),this.relatedItems.selectItem(e)},value:function(){var e=this.getEl().select2("data");return e&&"object"==typeof e&&(e=e[0]),e},toUrl:function(){var e=this.value();return e?this.tinypattern.generateUrl(e):null},load:function(e){var t=this.tiny.dom.getAttrib(e,"data-val");t&&this.set(t)},set:function(e){this.getEl().val(e).trigger("change"),this.updateRelatedItems(e)},attributes:function(){var e=this.value();return e?{"data-val":e.UID}:{}}}),y=g.extend({name:"uploadlinktype",trigger:".pat-uploadlinktype-dummy",getDelegatedLinkType:function(){return"uploadImage"===this.linkModal.linkType?this.linkModal.linkTypes.image:this.linkModal.linkTypes.internal},toUrl:function(){return this.getDelegatedLinkType().toUrl()},attributes:function(){return this.getDelegatedLinkType().attributes()},set:function(e){return this.getDelegatedLinkType().set(e)},load:function(e){return this.getDelegatedLinkType().load(e)},value:function(){return this.getDelegatedLinkType().value()}}),b=v.extend({name:"imagelinktype",trigger:".pat-imagelinktype-dummy",toUrl:function(){var e=this.value();return this.tinypattern.generateImageUrl(e,this.linkModal.getScaleFromSrcset(this.linkModal.$scale.val()))}}),T=g.extend({name:"emaillinktype",trigger:".pat-emaillinktype-dummy",toUrl:function(){var e=this.value();if(e){var t=this.getSubject(),i="mailto:"+e;return t&&(i+="?subject="+t),i}return null},load:function(e){g.prototype.load.apply(this,[e]),this.linkModal.$subject.val(this.tiny.dom.getAttrib(e,"data-subject"))},getSubject:function(){return this.linkModal.$subject.val()},attributes:function(){var e=g.prototype.attributes.call(this);return e["data-subject"]=this.getSubject(),e}}),k=g.extend({name:"anchorlinktype",trigger:".pat-anchorlinktype-dummy",init:function(){g.prototype.init.call(this),this.$select=this.$el.find("select"),this.anchorNodes=[],this.anchorData=[],this.populate()},value:function(){var e=this.$select.select2("data");return e&&"object"==typeof e&&(e=e.id),e},populate:function(){var e,t,i,n,a,o=this;o.$select.find("option").remove(),o.anchorNodes=[],o.anchorData=[];var s=o.tiny.dom.select(".mceItemAnchor,.mce-item-anchor");for(t=0;t<s.length;t+=1)e=s[t],(n=o.tiny.dom.getAttrib(e,"name"))||(n=o.tiny.dom.getAttrib(e,"id")),""!==n&&(o.anchorNodes.push(e),o.anchorData.push({name:n,title:n}));if((s=o.tiny.dom.select(o.linkModal.options.anchorSelector)).length>0)for(t=0;t<s.length;t+=1)if(e=s[t],""!==(a=l()(e).text().replace(/^\s+|\s+$/g,""))){n=(n=a.toLowerCase().substring(0,1024)).replace(/[^a-z0-9]/g,"-");var r=!1;for(i=0;i<o.anchorNodes.length;i+=1){var c=o.anchorData[i];if(c.name===n){r=!0,c.title=a;break}}r||(o.anchorData.push({name:n,title:a,newAnchor:!0}),o.anchorNodes.push(e))}if(o.anchorNodes.length>0)for(t=0;t<o.anchorData.length;t+=1){var p=o.anchorData[t];o.$select.append('<option value="'+t+'">'+p.title+"</option>")}else o.$select.append("<option>No anchors found..</option>")},getIndex:function(e){for(var t=0;t<this.anchorData.length;t+=1){if(this.anchorData[t].name===e)return t}return 0},toUrl:function(){var e=this.value();if(e){var t=parseInt(e,10),i=this.anchorNodes[t],n=this.anchorData[t];return n.newAnchor&&(i.innerHTML='<a name="'+n.name+'" class="mce-item-anchor"></a>'+i.innerHTML),"#"+n.name}return null},set:function(e){var t=this.getIndex(e);this.$select.select2("data",""+t)}});p().PluginManager.add("ploneimage",(function(e){e.ui.registry.addButton("ploneimage",{icon:"image",text:"Insert image",tooltip:"Insert/edit image",onAction:e.settings.addImageClicked})})),p().PluginManager.add("plonelink",(function(e){e.ui.registry.addButton("plonelink",{icon:"link",tooltip:"Insert/edit link",shortcut:"Ctrl+K",onAction:e.settings.addLinkClicked,stateSelector:"a[href]"}),e.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){e.execCommand("unlink")},stateSelector:"a[href]"})}));var _=s.Z.extend({name:"linkmodal",trigger:".pat-linkmodal",defaults:{anchorSelector:"h1,h2,h3",linkTypes:[],initialLinkType:"internal",text:{insertHeading:"Insert Link"},linkTypeClassMapping:{internal:v,upload:y,external:f,email:T,anchor:k,image:b,uploadImage:y,externalImage:g}},linkTypeTemplateMapping:{internal:d,upload:d,external:d,email:d,anchor:d,image:h,uploadImage:h,externalImage:h},template:function(e){return o().template(this.linkTypeTemplateMapping[this.linkType])(e)},init:function(){var e=this;e.tinypattern=e.options.tinypattern,e.tinypattern.options.anchorSelector&&(e.options.anchorSelector=e.tinypattern.options.anchorSelector),e.tiny=e.tinypattern.tiny,e.dom=e.tiny.dom,e.linkType=e.options.initialLinkType,e.linkTypes={},e.modal=r.Z.patterns["plone-modal"].init(e.$el,{html:e.generateModalHtml(),content:null,buttons:".plone-btn",reloadWindowOnClose:!1,templateOptions:{classDialog:"modal-dialog modal-lg",reloadWindowOnClose:!1},actionOptions:{reloadWindowOnClose:!1},backdropOptions:{zIndex:"1340",closeOnClick:!1}}),e.modal.on("shown",(t=>{e.modalShown.apply(e,[t])}))},isOnlyTextSelected:function(){var e=this.tiny.selection.getContent();if(/</.test(e)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(e)||-1===e.indexOf("href=")))return!1;if(this.anchorElm){var t=this.anchorElm.childNodes;if(0===t.length)return!1;for(var i=t.length-1;i>=0;i--)if(3!==t[i].nodeType)return!1}return!0},generateModalHtml:function(){return this.template({options:this.options,upload:this.options.upload,text:this.options.text,insertHeading:this.options.text.insertHeading,insertImageHelp:this.options.text.insertImageHelp,uploadText:this.options.text.upload,insertLinkHelp:this.options.text.insertLinkHelp,internal:this.options.text.internal,external:this.options.text.external,anchor:this.options.text.anchor,anchorLabel:this.options.text.anchorLabel,target:this.options.text.target,linkTypes:this.options.linkTypes,externalText:this.options.text.externalText,emailText:this.options.text.email,subjectText:this.options.text.subject,targetList:this.options.targetList,titleText:this.options.text.title,internalImageText:this.options.text.internalImage,externalImage:this.options.text.externalImage,externalImageText:this.options.text.externalImageText,altText:this.options.text.alt,imageAlignText:this.options.text.imageAlign,captionFromDescriptionText:this.options.text.captionFromDescription,enableImageZoom:this.options.text.enableImageZoom,captionText:this.options.text.caption,scaleText:this.options.text.scale,pictureVariants:this.options.pictureVariants,imageCaptioningEnabled:this.options.imageCaptioningEnabled,cancelBtn:this.options.text.cancelBtn,insertBtn:this.options.text.insertBtn})},isImageMode:function(){return-1!==["image","uploadImage","externalImage"].indexOf(this.linkType)},initElements:function(){var e=this;e.$target=l()('select[name="target"]',e.modal.$modal),e.$button=l()('.modal-footer input[name="insert"]',e.modal.$modal),e.$title=l()('input[name="title"]',e.modal.$modal),e.$subject=l()('input[name="subject"]',e.modal.$modal),e.$alt=l()('input[name="alt"]',e.modal.$modal),e.$align=l()('select[name="align"]',e.modal.$modal),e.$scale=l()('select[name="scale"]',e.modal.$modal),e.$enableImageZoom=l()('input[name="enableImageZoom"]',e.modal.$modal),e.$captionFromDescription=l()('input[name="captionFromDescription"]',e.modal.$modal),e.$caption=l()('textarea[name="caption"]',e.modal.$modal),o().each(e.options.linkTypes,(function(t){var i=l()(".linkType."+t+" .main",e.modal.$modal);i.length&&(e.linkTypes[t]=new e.options.linkTypeClassMapping[t](i,{linkModal:e,tinypattern:e.tinypattern}))})),l()(".autotoc-nav a",e.modal.$modal).on("click",(function(){var t=l()("fieldset.linkType",e.modal.$modal).eq(l()(this).index())[0].className.split(/\s+/);o().each(t,(function(t){-1!==o().indexOf(e.options.linkTypes,t)&&(e.linkType=t)}))})),e.$captionFromDescription.on("change",(function(){this.checked?e.$caption.prop("disabled",!0):e.$caption.prop("disabled",!1)}))},getLinkUrl:function(){return this.linkTypes[this.linkType].toUrl()},getValue:function(){return this.linkTypes[this.linkType].value()},updateAnchor:function(e){var t=this;t.tiny.focus(),t.tiny.selection.setRng(t.rng);var i=t.$target.val(),n=t.$title.val(),a=l().extend(!0,t.data,{title:n||null,target:i||null,"data-linkType":t.linkType,href:e},t.linkTypes[t.linkType].attributes());t.anchorElm?(t.onlyText&&a.text!==t.initialText&&("innerText"in t.anchorElm?t.anchorElm.innerText=t.data.text:t.anchorElm.textContent=t.data.text),t.tiny.dom.setAttribs(t.anchorElm,a),t.tiny.selection.select(t.anchorElm),t.tiny.undoManager.add()):t.onlyText?t.tiny.insertContent(t.tiny.dom.createHTML("a",a,t.tiny.dom.encode(t.data.text))):t.tiny.execCommand("mceInsertLink",!1,a)},focusElement:function(e){this.tiny.focus(),this.tiny.selection.select(e),this.tiny.nodeChanged()},getScaleFromSrcset:function(e){let t=this.options.pictureVariants[e];return t.sourceset[t.sourceset.length-1].scale},updateImage:function(e){var t=this,i=t.$title.val(),n=t.$captionFromDescription.prop("checked"),a=t.$enableImageZoom.prop("checked"),o=t.$caption.val();t.tiny.focus(),t.tiny.selection.setRng(t.rng);var s=["image-richtext",t.$align.val()];"externalImage"!==t.linkType&&s.push("picture-variant-"+t.$scale.val()),(n||o)&&s.push("captioned"),a&&s.push("zoomable");var r,c,p=l().extend(!0,{},{src:e,title:i||null,alt:t.$alt.val(),class:s.join(" "),"data-linkType":t.linkType,"data-scale":t.getScaleFromSrcset(t.$scale.val())},t.linkTypes[t.linkType].attributes());if("externalImage"!==t.linkType&&(p["data-picturevariant"]=t.$scale.val()),o&&!n&&(p["data-captiontext"]=o),t.imgElm&&!t.imgElm.getAttribute("data-mce-object")){const e=t.dom.getAttrib(t.imgElm,"width"),i=t.dom.getAttrib(t.imgElm,"height");e&&(p.width=e),i&&(p.height=i)}else t.imgElm=null;p.id="__mcenew",r=t.dom.createHTML("img",p),t.tiny.insertContent(r),t.imgElm=t.dom.get("__mcenew"),t.dom.setAttrib(t.imgElm,"id",null),(c=t.imgElm).onload=c.onerror=function(){c.onload=c.onerror=null,t.focusElement(c)},t.imgElm.complete&&t.focusElement(t.imgElm)},modalShown:function(e){var t=this;t.initElements(),t.initData(),t.options.upload&&(t.$upload=l()(".uploadify-me",t.modal.$modal),t.options.upload.relatedItems=l().extend(!0,{},t.options.relatedItems),t.options.upload.relatedItems.selectableTypes=t.options.folderTypes,t.$upload.addClass("pat-upload"),new m.default(t.$upload,t.options.upload),t.$upload.on("uploadAllCompleted",function(e,i){t.linkTypes.image?(t.linkTypes.image.set(i.data.UID),l()("#"+l()("#tinylink-image",t.modal.$modal).data("navref")).trigger("click")):(t.linkTypes.internal.set(i.data.UID),l()("#"+l()("#tinylink-internal",t.modal.$modal).data("navref")).trigger("click"))}.bind(t))),t.$button.off("click").on("click",(function(e){if(e.preventDefault(),e.stopPropagation(),t.linkType=t.modal.$modal.find("fieldset.active").data("linktype"),"uploadImage"===t.linkType||"upload"===t.linkType){var i=t.$upload.data().patternUpload;i.dropzone.files.length>0&&(i.processUpload(),t.$upload.on("uploadAllCompleted",(function(e,i){var n=0,l=function(){if(n<5&&!t.linkTypes[t.linkType].value())return n+=1,void setTimeout(l,100);var e=t.getLinkUrl();t.updateImage(e),t.hide()};l()})))}var n;try{n=t.getLinkUrl()}catch(e){return}n&&(t.isImageMode()?t.updateImage(n):t.updateAnchor(n),t.hide())})),l()('.modal-footer input[name="cancel"]',t.modal.$modal).on("click",(function(e){e.preventDefault(),t.hide()}))},show:function(){this.modal.show()},hide:function(){this.modal.hide()},initData:function(){var e,t,i=this;if(i.data={},i.initialText=null,i.rng=i.tiny.selection.getRng(),i.selectedElm=i.tiny.selection.getNode(),i.anchorElm=i.tiny.dom.getParent(i.selectedElm,"a[href]"),i.onlyText=i.isOnlyTextSelected(),i.data.text=i.initialText=i.anchorElm?i.anchorElm.innerText||i.anchorElm.textContent:i.tiny.selection.getContent({format:"text"}),i.data.href=i.anchorElm?i.tiny.dom.getAttrib(i.anchorElm,"href"):"",i.anchorElm?i.data.target=i.tiny.dom.getAttrib(i.anchorElm,"target"):i.tiny.settings.default_link_target&&(i.data.target=i.tiny.settings.default_link_target),(e=i.tiny.dom.getAttrib(i.anchorElm,"rel"))&&(i.data.rel=e),(e=i.tiny.dom.getAttrib(i.anchorElm,"class"))&&(i.data.class=e),(e=i.tiny.dom.getAttrib(i.anchorElm,"title"))&&(i.data.title=e),i.tiny.focus(),i.anchorElm=i.dom.getParent(i.selectedElm,"a[href]"),i.isImageMode()){var n;n=i.selectedElm,i.imgElm=n;var a=i.dom.getAttrib(i.imgElm,"src"),o=i.dom.getAttrib(i.imgElm,"data-captiontext");if(i.$title.val(i.dom.getAttrib(i.imgElm,"title")),i.$alt.val(i.dom.getAttrib(i.imgElm,"alt")),l()(i.imgElm).hasClass("zoomable")&&i.$enableImageZoom.prop("checked",!0),l()(i.imgElm).hasClass("captioned")&&!o?(i.$captionFromDescription.prop("checked",!0),i.$caption.prop("disabled",!0)):(l()(i.imgElm).hasClass("captioned"),i.$captionFromDescription.prop("checked",!1)),o&&i.$caption.val(o),(t=i.dom.getAttrib(i.imgElm,"data-linktype"))&&t in i.linkTypes){i.linkType=t,i.linkTypes[i.linkType].load(i.imgElm);var s=i.dom.getAttrib(i.imgElm,"data-picturevariant");i.$scale.val(s),l()("#tinylink-"+i.linkType,i.modal.$modal).trigger("click")}else a&&i.guessImageLink(a);for(var r=i.dom.getAttrib(i.imgElm,"class").split(" "),c=0;c<r.length;c+=1){var p=r[c];for(var d in i.options.imageClasses)-1!==d.indexOf(p)&&i.$align.val(p)}}else if(i.anchorElm){i.focusElement(i.anchorElm);var h;if(h=i.dom.getAttrib(i.anchorElm,"href"),i.$target.val(i.dom.getAttrib(i.anchorElm,"target")),i.$title.val(i.dom.getAttrib(i.anchorElm,"title")),t=i.dom.getAttrib(i.anchorElm,"data-linktype")){i.linkType=t,i.linkTypes[i.linkType].load(i.anchorElm);var u=l()("#tinylink-"+i.linkType,i.modal.$modal);1===u.length&&l()("#"+u.data("autotoc-trigger-id")).trigger("click")}else h&&i.guessAnchorLink(h)}},guessImageLink:function(e){-1!==e.indexOf(this.options.prependToScalePart)?(this.linkType="image",this.$scale.val(this.tinypattern.getScaleFromUrl(e)),this.linkTypes.image.set(this.tinypattern.stripGeneratedUrl(e))):(this.linkType="externalImage",this.linkTypes.externalImage.set(e))},guessAnchorLink:function(e){if(this.options.prependToUrl&&-1!==e.indexOf(this.options.prependToUrl))this.linkType="internal",this.linkTypes.internal.set(this.tinypattern.stripGeneratedUrl(e));else if(-1!==e.indexOf("mailto:")){this.linkType="email";var t=e.substring(7,e.length).split("?subject=");this.linkTypes.email.set(t[0]),t.length>1&&this.$subject.val(decodeURIComponent(t[1]))}else"#"===e[0]?(this.linkType="anchor",this.linkTypes.anchor.set(e.substring(1))):(this.linkType="external",this.linkTypes.external.set(e))},setSelectElement:function(e,t){e.find("option:selected").prop("selected",!1),t&&e.find('option[value="'+t+'"]').prop("selected",!0)},reinitialize:function(){this.modal.options.html=this.generateModalHtml()}})},94357:function(e,t,i){"use strict";i.r(t);var n=i(57845),l=i.n(n),a=i(99321),o=i.n(a),s=i(15684),r=i(43296),c=i(27113);let p;t.default=r.Z.extend({name:"upload",trigger:".pat-upload",parser:"mockup",defaults:{showTitle:!0,url:null,className:"upload",wrap:!1,wrapperTemplate:'<div class="upload-wrapper"/>',fileaddedClassName:"dropping",useTus:!1,container:"",ajaxUpload:!0,paramName:"file",addRemoveLinks:!1,autoCleanResults:!0,previewsContainer:".previews",previewTemplate:null,maxFiles:null,maxFilesize:99999999,allowPathSelection:void 0,relatedItems:{attributes:["UID","Title","Description","getURL","portal_type","path","ModificationDate"],batchSize:20,basePath:"/",vocabularyUrl:null,width:500,maximumSelectionSize:1,selectableTypes:["Folder"]}},init:async function(){i.e(88058).then(i.bind(i,88058)),i.e(98789).then(i.bind(i,98789)),p=(await i.e(50708).then(i.t.bind(i,50708,23))).default,p.autoDiscover=!1;const e=(await i.e(62518).then(i.t.bind(i,62518,17))).default;var t=this;void 0===t.options.allowPathSelection&&(t.options.allowPathSelection=t.options.baseUrl&&t.options.relativePath),l()(document).on("paste",(function(e){var i=e.originalEvent.clipboardData.items;if(i)for(var n=0;n<i.length;n++)if(-1!==i[n].type.indexOf("image")){var l=i[n].getAsFile();t.dropzone.addFile(l)}})),t.currentPath=t.options.currentPath,t.currentFile=0;let n=o().template(e)({_t:s.ZP,allowPathSelection:t.options.allowPathSelection});t.$el.addClass(t.options.className),t.$el.append(n),t.$progress=l()(".progress-bar-success",t.$el),t.options.showTitle||t.$el.find("h2.title").hide(),t.options.ajaxUpload||(l()(".fallback",this.$el).remove(),this.$el.hasClass(".upload-container")?this.$el.addClass("no-ajax-upload"):this.$el.closest(".upload-container").addClass("no-ajax-upload")),t.options.wrap&&(t.$el.wrap(t.options.wrapperTemplate),t.$el=t.$el.parent()),t.options.allowPathSelection?(t.$pathInput=l()('input[name="location"]',t.$el),t.relatedItems=await t.setupRelatedItems(t.$pathInput)):(l()('input[name="location"]',t.$el).parent().remove(),t.relatedItems=null),t.$dropzone=l()(".upload-area",t.$el),l()("div.browse-select button.browse",t.$el).on("click",(function(e){e.preventDefault(),e.stopPropagation(),(!t.options.maxFiles||t.dropzone.files.length<t.options.maxFiles)&&t.dropzone.hiddenFileInput.click()}));var a=await this.getDzoneOptions();try{t.dropzone=new p(t.$dropzone[0],a)}catch(e){throw window.DEBUG&&console.log(e),e}t.dropzone.on("maxfilesreached",(function(){t.showHideControls()})),t.dropzone.on("addedfile",(function(){t.showHideControls()})),t.dropzone.on("removedfile",(function(){t.showHideControls()})),t.dropzone.on("success",(function(e,i){var n;try{n=l().parseJSON(i)}catch(e){n=i}t.$el.trigger("uploadAllCompleted",{data:n,path_uid:t.$pathInput?t.$pathInput.val():null})})),t.options.autoCleanResults&&t.dropzone.on("complete",(function(e){e.status===p.SUCCESS&&setTimeout((function(){l()(e.previewElement).fadeOut()}),3e3)})),t.dropzone.on("complete",(function(e){e.status===p.SUCCESS&&1===t.dropzone.files.length&&t.showHideControls()})),t.dropzone.on("error",(function(e,t,i){void 0!==i&&403!==i.status&&l()(".dz-error-message span",e.previewElement).html((0,s.ZP)("The file transfer failed"))})),t.dropzone.on("totaluploadprogress",(function(e){e=(100*(t.currentFile-1)+e)/(100*t.dropzone.files.length)*100,t.$progress.attr("aria-valuenow",e).css("width",e+"%")})),l()(".upload-all",t.$el).on("click",(function(e){e.preventDefault(),e.stopPropagation(),t.processUpload({finished:function(){t.$progress.attr("aria-valuenow",0).css("width","0%")}})})),t.options.clipboardfile&&t.dropzone.addFile(t.options.clipboardfile)},showHideControls:function(){var e=this;e._showHideTimeout&&clearTimeout(e._showHideTimeout),e._showHideTimeout=setTimeout((function(){e._showHideControls()}),50)},_showHideControls:function(){var e=this,t=l()(".controls",e.$el),i=l()(".browse-select",e.$el),n=l()(".dz-hidden-input");if(e.options.maxFiles&&(e.dropzone.files.length<e.options.maxFiles?(i.show(),n.prop("disabled",!1)):(i.hide(),n.prop("disabled",!0))),e.dropzone.files.length>0){t.fadeIn("slow");var a=e.dropzone.files[0];l()(".dz-error-message span",a.previewElement).html("")}else t.fadeOut("slow")},pathJoin:function(){var e=[];return o().each(arguments,(function(t){t&&("/"===t[0]&&(t=t.substring(1)),"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),e.push(t))})),e.join("/")},getUrl:function(){var e=this,t=e.options.url;if(!t)if(e.options.baseUrl&&e.options.relativePath)"/"!==(t=e.options.baseUrl)[t.length-1]&&(t+="/"),t+=e.pathJoin(e.currentPath,e.options.relativePath);else{var i=e.$el.parents("form");t=i.length>0?i.attr("action"):window.location.href}return t},getDzoneOptions:async function(){let e=await i.e(99752).then(i.t.bind(i,99752,17));e=e.default;var t=this;t.options.clickable=!0;var n=l().extend({},t.options);if(n.url=t.getUrl(),n.headers={"X-CSRF-TOKEN":c.Z.getAuthenticator()},n.uploadMultiple=!1,delete n.wrap,delete n.wrapperTemplate,delete n.resultTemplate,delete n.autoCleanResults,delete n.fileaddedClassName,delete n.useTus,t.options.previewsContainer){var a=t.$el.find(t.options.previewsContainer);a.length>0&&(n.previewsContainer=a[0])}return n.autoProcessQueue=!1,n.previewTemplate=e,n},processUpload:function(e){e||(e={});var t=this,i=!1,n=t.options.useTus,l=t.options.fileaddedClassName,a=e.finished;t.currentFile=0,function e(){i=!0,0===t.dropzone.files.length&&(i=!1);var o=t.dropzone.files[0];if(i&&o.status===p.ERROR&&(o.status=p.QUEUED,i=!1),!i)return t.$el.removeClass(l),void(void 0!==a&&"function"==typeof a&&a());-1!==[p.SUCCESS,p.CANCELED].indexOf(o.status)?(t.dropzone.removeFile(o),e()):o.status!==p.UPLOADING?(n&&window.tus?t.handleTusUpload(o):(t.currentFile+=1,t.dropzone.processFile(o)),setTimeout(e,100)):setTimeout(e,100)}()},handleTusUpload:function(e){var t=this;e.status=p.UPLOADING,window.tus.upload(e,{endpoint:t.dropzone.options.url,headers:{FILENAME:e.name,"X-CSRF-TOKEN":c.Z.getAuthenticator()},chunkSize:5242880}).fail((function(){window.DEBUG&&console.alert((0,s.ZP)("Error uploading with TUS resumable uploads")),e.status=p.ERROR})).progress((function(e,i,n){var l=i/n*100;t.$progress.attr("aria-valuenow",l).css("width",l+"%"),t.$progress.html((0,s.ZP)("uploading...")+"<br />"+t.formatBytes(i)+" / "+t.formatBytes(n))})).done((function(e,i){i.status=p.SUCCESS,t.dropzone.emit("success",i),t.dropzone.emit("complete",i)}))},formatBytes:function(e){var t=Math.round(e/1024);if(t<1024)return t+" KiB";var i=Math.round(t/1024);return i<1024?i+" MB":Math.round(i/1024)+" GB"},setPath:function(e){var t=this;t.currentPath=e,t.options.url=null,t.options.url=t.dropzone.options.url=t.getUrl()},setupRelatedItems:async function(e){const t=(await Promise.resolve().then(i.bind(i,68455))).default;var n=this,a=n.options.relatedItems;a.upload=!1,n.options.initialFolder&&e.attr("value",n.options.initialFolder);var o=new t(e,a);return o.$el.on("change",(function(){var e=l()(this).select2("data"),t=null;e.length>0&&(t=e[0].path),n.setPath(t)})),o}})}}]);
//# sourceMappingURL=70052.4b257d75c091eea30499.min.js.map