define("mosaic-url/mosaic.tile",["jquery","pat-logger","underscore","mockup-utils","pat-registry","mockup-patterns-tinymce","tinymce","mockup-patterns-modal"],function(f,e,a,i,t,g,d,o){"use strict";var c=e.getLogger("pat-mosaic"),s=0,v=function(){clearTimeout(s),s=setTimeout(n,50)},n=function(){var e=f(".mosaic-rich-text-toolbar").filter(":visible");if(0!==e.size()&&0!==e.find(".mce-first").size()){var t=e.parent();e.removeClass("right"),t.offset().left>=f(window).width()/2&&e.addClass("right");var a=f(window);if(t.offset().top-e.height()<a.scrollTop()){if(!e.hasClass("sticky")){f("body").addClass("mce-sticky"),e.addClass("sticky");var i={top:f(".mosaic-toolbar").height()+e.height()};e.hasClass("right")?i.right=e.offset().right:i.left=e.offset().left,e.css(i)}}else e.removeClass("sticky"),e.removeAttr("style"),f("body").removeClass("mce-sticky")}};f(window).off("scroll",v).on("scroll",v);var y=function(e){var a=this;a.tinymce=null,a.$el=f(e),a.$el.is(".mosaic-tile")||(a.$el=a.$el.parents(".mosaic-tile")),a.focusCheckCount=0,a.$el.children(".mosaic-tile-content").off("blur").on("blur",function(){if("plone.app.standardtiles.rawhtml"===a.getType()){var e=a.getEditUrl();if(e){var t=a.getHtmlContent();if(t===a.$el.data("lastSavedData"))return;if(a.$el.data("activeSave"))return;a.$el.data("activeSave",!0),f.ajax({url:e,method:"POST",data:{"plone.app.standardtiles.rawhtml.content":t,_authenticator:i.getAuthenticator(),"buttons.save":"Save"}}).always(function(){a.$el.data("lastSavedData",t),a.$el.data("activeSave",!1)})}}})};return y.prototype.getDataTileEl=function(e,t){return this.$el.find("[data-tile]")},y.prototype.getContentEl=function(e,t){return this.$el.children(".mosaic-tile-content")},y.prototype.getHtmlContent=function(){return this.getContentEl().html()},y.prototype.getEditUrl=function(){var e=this.getUrl();if(e&&(e=e.replace(/@@/,"@@edit-tile/")))return e.match(/^\.\/.*/)&&(e=f.mosaic.options.context_url+e.replace(/^\./,"")),e},y.prototype.getDeleteUrl=function(){var e=this.getUrl().split("?")[0],t=(e=e.split("@@"))[1].split("/");return(e=e[0]+"@@delete-tile/"+t[0]+"/"+t[1]).match(/^\.\/.*/)&&(e=f.mosaic.options.context_url+e.replace(/^\./,"")),e},y.prototype.getUrl=function(){var e=this.$el.find(".tileUrl").html();if(!e){var t=this.$el.find("[data-tileUrl]");0<t.size()&&(e=t.attr("data-tileUrl"))}return e||(e=this.$el.find("[data-tile]").attr("data-tile")),e&&(e=(e=e.replace(f.mosaic.options.context_url,"./")).replace(/^\.\/\//,"./"),f.mosaic.hasContentLayout?-1===e.indexOf("X-Tile-Persistent")&&(-1===e.indexOf("?")?e+="?":e+="&",e+="X-Tile-Persistent=yes"):-1!==e.indexOf("X-Tile-Persistent")&&(e=e.replace("X-Tile-Persistent=yes","").replace("&&","&"))),e},y.prototype.getType=function(){var t="",e=this.$el,a=[];return e.attr("class")&&(a=e.attr("class").split(" "),f(a).each(function(){var e;null!==(e=this.match(/^mosaic-([\w.\-]+)-tile$/))&&"selected"!==e[1]&&"new"!==e[1]&&"read-only"!==e[1]&&"helper"!==e[1]&&"original"!==e[1]&&"edited"!==e[1]&&(t=e[1])})),t||c.error("Could not find tile type on element with classes: "+a.join(", ")),t},y.prototype.getConfig=function(){for(var e,t=this.getType(),a=0;a<f.mosaic.options.tiles.length;a+=1){for(var i=!1,o=f.mosaic.options.tiles[a],s=0;s<o.tiles.length;s+=1){if("field"===o.tiles[s].tile_type){var n=o.tiles[s].widget.split(".");switch(n=n[n.length-1]){case"TextWidget":case"TextFieldWidget":case"TextAreaWidget":case"TextAreaFieldWidget":case"TextLinesWidget":case"TextLinesFieldWidget":case"WysiwygWidget":case"WysiwygFieldWidget":case"RichTextWidget":case"RichTextFieldWidget":o.tiles[s].settings=!1;break;default:o.tiles[s].settings=!0}}if(o.tiles[s].name===t){e=o.tiles[s],i=!0;break}}if(i)break}if(e)return e;c.error("Could not load tile config for tile type: "+t)},y.prototype.getValueFromClasses=function(e,t){var a;return e.forEach(function(e){-1!==e.indexOf(t)&&(a=e.replace(t,""))}),a},y.prototype.getHtmlBody=function(){var e,t="",a=this.$el.attr("class").split(" ");switch(e=this.getType(),a=f(a).filter(function(){switch(this){case"mosaic-new-tile":case"mosaic-helper-tile":case"mosaic-original-tile":case"mosaic-selected-tile":case"mosaic-edited-tile":return!1;default:return!0}}).toArray(),this.getConfig().tile_type){case"text":t+='          <div class="'+a.join(" ")+'">\n',t+='          <div class="mosaic-tile-content">\n',t+=this.$el.children(".mosaic-tile-content").html().replace(/^\s+|\s+$/g,"")+"\n",t+="          </div>\n",t+="          </div>\n";break;case"app":case"textapp":t+='          <div class="'+a.join(" ")+'">\n',t+='          <div class="mosaic-tile-content">\n',t+='          <div data-tile="'+this.getUrl()+'"></div>\n',t+="          </div>\n",t+="          </div>\n";break;case"field":t+='          <div class="'+a.join(" ")+'">\n',t+='          <div class="mosaic-tile-content">\n';var i="./@@plone.app.standardtiles.field?field="+e,o=this.getValueFromClasses(a,"mosaic-subfield-");o&&(i+="&subfield="+o);var s=this.getValueFromClasses(a,"mosaic-format-");s&&(i+="&format="+s),t+='          <div data-tile="'+i+'"></div>\n',t+="          </div>\n",t+="          </div>\n",this.saveForm()}return t},y.prototype.isRichText=function(e){return void 0===e&&(e=this.getConfig()),!(!e||!1!==this.$el.hasClass("mosaic-read-only-tile")||!("text"===e.tile_type&&e.rich_text||"textapp"===e.tile_type&&e.rich_text||"app"===e.tile_type&&e.rich_text||"field"===e.tile_type&&!1===e.read_only&&("z3c.form.browser.text.TextWidget"===e.widget||"z3c.form.browser.text.TextFieldWidget"===e.widget||"z3c.form.browser.textarea.TextAreaWidget"===e.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===e.widget||"z3c.form.browser.textlines.TextLinesWidget"===e.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===e.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===e.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===e.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===e.widget||"plone.app.widgets.dx.RichTextWidget"===e.widget)))},y.prototype.initialize=function(){var e=this.getConfig();e&&e.read_only&&this.$el.addClass("mosaic-read-only-tile"),this.isRichText()&&this.setupWysiwyg(),this.$el.prepend(f(f.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(f(f.mosaic.document.createElement("div")).addClass("mosaic-tile-inner-border"))),e&&this.$el.prepend(f(f.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-label").append(f(f.mosaic.document.createElement("div")).addClass("mosaic-tile-label-content").html(e.label)).append(f(f.mosaic.document.createElement("div")).addClass("mosaic-tile-label-left"))),this.makeMovable(),this.initializeButtons();var t=this;a.each(["top","bottom","right","left"],function(e){t.$el.prepend(f(f.mosaic.document.createElement("div")).addClass("mosaic-divider mosaic-divider-"+e).append(f(f.mosaic.document.createElement("div")).addClass("mosaic-divider-dot")))})},y.prototype.initializeButtons=function(){var o=[],e=this.getConfig();this.$el.find(".mosaic-tile-buttons").remove();var t=function(e,t,a){var i=document.createElement("button");return i.className="mosaic-btn-"+t,i.textContent=e,o.push(i),f(i).on("click",a),i};if(e&&e.settings&&!1===this.$el.hasClass("mosaic-read-only-tile")&&t("Edit","settings",this.settingsClicked.bind(this)),!f.mosaic.hasContentLayout){t("Delete","delete",this.deleteClicked.bind(this));var a=t("Confirm delete","confirm",this.confirmClicked.bind(this));f(a).hide();var i=t("Cancel","cancel",this.cancelClicked.bind(this));f(i).hide()}if(0<o.length){var s=f(f.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-buttons");this.$el.prepend(s),o.forEach(function(e){s.append(e)})}},y.prototype.cancelClicked=function(e){e.preventDefault(),f(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).show(),f(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).hide()},y.prototype.deleteClicked=function(e){e.preventDefault(),f(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).hide(),f(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).show()},y.prototype.confirmClicked=function(e){if(e.preventDefault(),"app"===this.getConfig().tile_type){var t=this.getUrl();t&&"undefined"!==t&&(f.mosaic.removeHeadTags(t),f.ajax({type:"POST",url:this.getDeleteUrl(),data:{"buttons.delete":"Delete",_authenticator:i.getAuthenticator()}}))}f.mosaic.options.panels.find(".mosaic-empty-row").remove();var a=this.$el.parent().parent();this.saveForm(),this.$el.remove(),f.mosaic.undo.snapshot(),a.mosaicCleanupRow(),f.mosaic.options.panels.mosaicAddEmptyRows(),f.mosaic.options.toolbar.trigger("selectedtilechange"),f.mosaic.options.toolbar.mosaicSetResizeHandleLocation()},y.prototype.settingsClicked=function(e){e.preventDefault();var l=this,t=l.getConfig();if("app"===t.tile_type){var a=l.getEditUrl();f.mosaic.overlay.app=new o(f(".mosaic-toolbar"),{ajaxUrl:a,loadLinksWithinModal:!0,buttons:'.formControls > input[type="submit"], .actionButtons > input[type="submit"]'}),f.mosaic.overlay.app.$el.off("after-render"),f.mosaic.overlay.app.on("after-render",function(e){f('input[name*="cancel"]',f.mosaic.overlay.app.$modal).off("click").on("click",function(){f.mosaic.overlay.app.hide(),f.mosaic.overlay.app=null}),f.mosaic.hasContentLayout&&f("form",f.mosaic.overlay.app.$modal).append(f('<input type="hidden" name="X-Tile-Persistent" value="yes" />'))}),f.mosaic.overlay.app.show(),f.mosaic.overlay.app.$el.off("formActionSuccess"),f.mosaic.overlay.app.on("formActionSuccess",function(e,t,a,i,o){var s=i.getResponseHeader("X-Tile-Url"),n=f.mosaic.getDomTreeFromHtml(t);if(s){f.mosaic.removeHeadTags(s),f.mosaic.addHeadTags(s,n);var c=n.find(".temp_body_tag").html();l.fillContent(c,s),f.mosaic.overlay.app.hide(),f.mosaic.overlay.app=null}})}else f.mosaic.overlay.open("field",t)},y.prototype.makeMovable=function(){this.$el.hasClass("movable")&&f.mosaic.options.canChangeLayout&&!f.mosaic.hasContentLayout&&this.$el.prepend(f(f.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-drag-handle"))},y.prototype.initializeContent=function(){var a,e,t,i,o,s=this,n=f("body",f.mosaic.document).attr("data-base-url");n||(n=f("head > base",f.mosaic.document).attr("href"));var c=this.getUrl(),l=this.getConfig();if(l)if("field"===l.tile_type){switch(i="",t="IDublinCore-title"===l.name?(e='<h1 class="documentFirstHeading">',"</h1>"):"IDublinCore-description"===l.name?(e='<p class="documentDescription">',"</p>"):(e="<div>","</div>"),l.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":i=e+f("#"+l.id).find("input").attr("value")+t;break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":o=f("#"+l.id).find("textarea").val().split("\n"),i+=e;for(var r=0;r<o.length;r+=1)i+=o[r]+"<br/>";i+=t;break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":i=f("#"+l.id).find("textarea").val();break;default:i='<div class="discreet">Placeholder for field:<br/><b>'+l.label+"</b></div>"}s.fillContent(i)}else l&&(s.$el.addClass("mosaic-tile-loading"),-1===(a=n?[n,c].join("/").replace(/\/+\.\//g,"/"):c).indexOf("_layouteditor")&&(-1===a.indexOf("?")?a+="?":"&"!=a.charAt(a.length-1)&&(a+="&"),a+="_layouteditor=true"),f.ajax({type:"GET",url:a,success:function(e){s.$el.removeClass("mosaic-tile-loading"),(e=f.mosaic.getDomTreeFromHtml(e)).find("#protect-script").remove(),f.mosaic.addHeadTags(c,e);var t=e.find(".temp_body_tag").html();s.fillContent(t,a),"plone.app.standardtiles.rawhtml"===s.getType()&&(s.$el.data("lastSavedData")||s.$el.data("lastSavedData",s.getHtmlContent()))},error:function(){s.$el.removeClass("mosaic-tile-loading")}}))},y.prototype.fillContent=function(e,t){var a,i=this.getDataTileEl();if(0<i.length?(i.parent().html(e),a=this.getContentEl()):(a=this.getContentEl()).html(e),t&&0<a.size()){for(t=t.replace(/&/gim,"&amp;");-1!==t.indexOf("&amp;&amp;");)t=t.replace("&amp;&amp;","&amp;");a.attr("data-tileUrl",t)}this.cacheHtml(e),this.scanRegistry()},y.prototype.cacheHtml=function(e){if(!this.isRichText()){var t=this.$el.children(".mosaic-tile-content");0!==t.size()&&(void 0===e&&(e=t.html()),t[0]._preScanHTML=e)}},y.prototype.scanRegistry=function(){if(!this.isRichText()){var e=this.$el.find(".mosaic-tile-content");0!==e.size()&&(e[0]._preScanHTML&&e.html(e[0]._preScanHTML),t.scan(e),f("a",e).on("click",function(e){e.preventDefault(),e.stopPropagation()}))}},y.prototype.select=function(){if(!1===this.$el.hasClass("mosaic-selected-tile")&&!1===this.$el.hasClass("mosaic-read-only-tile")){var e=f(".mosaic-selected-tile",f.mosaic.document);if(1===e.size())new y(e).blur();this.focus()}},y.prototype._change=function(){f.mosaic.options.toolbar.trigger("selectedtilechange"),f.mosaic.options.panels.mosaicSetResizeHandleLocation(),this.saveForm()},y.prototype.blur=function(){this.$el.removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),this.$el.find(".mce-edit-focus").removeClass("mce-edit-focus"),this._change()},y.prototype._focus=function(){var e=this;this.$el.addClass("mosaic-selected-tile"),this.$el.children(".mosaic-tile-content").focus(),this._change(),this.initializeButtons();e.isRichText()&&e.focusCheckCount<30&&(e.focusCheckTimeout&&clearTimeout(e.focusCheckTimeout),e.focusCheckTimeout=setTimeout(function(){e.focusCheckCount+=1,e.$el.hasClass("mosaic-selected-tile")&&(e.$el.find(".mosaic-rich-text").hasClass("mce-edit-focus")||(e.$el.removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),e.$el.find(".mce-edit-focus").removeClass("mce-edit-focus"),e._focus()))},50))},y.prototype.focus=function(){this.isRichText()&&!0!==this.$el.data("tinymce-loaded")?this.$el.data("delayed-focus",!0):this._focus()},y.prototype.saveForm=function(){var e,t,a,i,o=this.getType(),s=this.getConfig();if(s&&"field"===s.tile_type&&!1===s.read_only&&("z3c.form.browser.text.TextWidget"===s.widget||"z3c.form.browser.text.TextFieldWidget"===s.widget||"z3c.form.browser.textarea.TextAreaWidget"===s.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===s.widget||"z3c.form.browser.textlines.TextLinesWidget"===s.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===s.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===s.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===s.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===s.widget||"plone.app.widgets.dx.RichTextWidget"===s.widget))switch(s.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":var n=f(".mosaic-panel .mosaic-"+o+"-tile",f.mosaic.document);1<n.size()&&(n=n.filter(function(){return 0<f(".mosaic-tile-control",this).length}));var c=n.find(".mosaic-tile-content > *").text();f("#"+s.id).find("input").attr("value",c);break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":a="",i="IDublinCore-description"===s.name?" ":"\n",f(".mosaic-panel .mosaic-"+o+"-tile",f.mosaic.document).find(".mosaic-tile-content > *").each(function(){a+=f(this).html().replace(/<br[^>]*>/gi,i).replace("&nbsp;","").replace(/^\s+|\s+$/g,"")+i}),a=a.replace(/^\s+|\s+$/g,""),f("#"+s.id).find("textarea").val(a);break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":var l=f(document.getElementById(s.id)).find("textarea");e=l.attr("id"),t=d.get(e);var r=f(".mosaic-"+o+"-tile",f.mosaic.document).find(".mosaic-tile-content").html();l.val(r),t&&t.setContent(r)}},y.prototype.setupWysiwyg=function(){var t=this,a=t.$el.find(".mosaic-tile-content");try{a.data("pattern-tinymce").destroy(),a.removeData("pattern-tinymce"),t.$el.data("tinymce-loaded",!1)}catch(e){}for(var e=1+Math.floor(1e5*Math.random());0<f("#mosaic-rich-text-init-"+e,f.mosaic.document).length;)e=1+Math.floor(1e5*Math.random());var i="mosaic-rich-text-init-"+e;a.attr("id",i),a.siblings(".mosaic-rich-text-toolbar").remove();var o,s,n,c,l,r,d=f('<div class="mosaic-rich-text-toolbar"></div>').attr("id",a.attr("id")+"-panel");a.before(d);var m=t.getType();for(o=f.mosaic.options.default_available_actions,n=0;n<f.mosaic.options.tiles.length;n+=1)for(s=f.mosaic.options.tiles[n],c=0;c<s.tiles.length;c+=1)s.tiles[c].name===m&&(o=o.concat(s.tiles[c].available_actions));for(l=[],n=0;n<f.mosaic.options.richtext_toolbar.length;n+=1){for(s=f.mosaic.options.richtext_toolbar[n],c=0;c<s.actions.length;c+=1)-1<f.inArray(s.actions[c].name,o)&&l.push(s.actions[c].action);l.length&&"|"!=l[l.length-1]&&l.push("|")}for(l.length&&"|"==l[l.length-1]&&l.pop(),r=[],n=0;n<f.mosaic.options.richtext_contextmenu.length;n+=1){for(s=f.mosaic.options.richtext_contextmenu[n],c=0;c<s.actions.length;c+=1)-1<f.inArray(s.actions[c].name,o)&&r.push(s.actions[c].action);r.length&&"|"!=r[r.length-1]&&r.push("|")}r.length&&"|"==r[r.length-1]&&r.pop();var u=function(){var e=a.find("p > *");(0===e.length||1===e.length&&e.is("br"))&&0===a.text().replace(/^\s+|\s+$/g,"").length?(a.addClass("mosaic-tile-content-empty"),0===a.find("p").length&&a.empty().append("<p></p>")):a.removeClass("mosaic-tile-content-empty")},p=0,h=function(){clearTimeout(p),p=setTimeout(u,100)};new g(a,f.extend(!0,{},f.mosaic.options.tinymce,{inline:!1,tiny:{body_id:i,selector:"#"+i,inline:!0,fixed_toolbar_container:"#"+d.attr("id"),theme_advanced_toolbar_align:"right",menubar:!1,toolbar:l.join(" ")||!1,statusbar:!1,contextmenu:r.join(" ")||!1,plugins:f.mosaic.options.tinymce.tiny.plugins.concat(r.length?["contextmenu"]:[]),setup:function(e){(t.tinymce=e).on("focus",function(e){e.target.id&&(0===f(".mosaic-helper-tile").length?(t.select(),v()):setTimeout(function(){f(".mce-edit-focus").each(function(){new y(f(this).parent()).blur();var e=window.tinyMCE.get(this.getAttribute("id"));e&&e.hide()})},10))}),0===l.length&&e.on("keydown",function(e){13!==e.keyCode||e.preventDefault()}),e.on("keyup change",h),h(),e.on("init",function(){t.$el.data("tinymce-loaded",!0),!0===t.$el.data("delayed-focus")&&(t.$el.data("delayed-focus",!1),setTimeout(function(){t._focus()},100))})}}})),a.addClass("mosaic-rich-text")},y.validTile=function(e){var t=f(e);return!!t.is(".mosaic-tile")||0<t.parents(".mosaic-tile").size()},y}),define("mosaic-url/mosaic.panel",["jquery","pat-logger","underscore"],function(s,e,t){"use strict";var a=e.getLogger("pat-mosaic"),i=function(e){this.$el=s(e)};return i.prototype.initialize=function(e){var t,a=this.$el.data("panel"),i=s("[data-panel="+a+"]",s.mosaic.document),o=this.$el.data("max-columns")||4;"content"===a&&0===i.length&&s("#"+a,s.mosaic.document).each(function(){(i=s(this)).attr("data-panel",a)}),"content"===a?(t=i.attr("id"),0===s(".mosaic-original-content",s.mosaic.document).size()?(i.before(s(document.createElement("div")).attr("id",t).attr("class",i.attr("class")).addClass("mosaic-panel").attr("data-panel","content").attr("data-max-columns",o).html(e.find("[data-panel="+a+"]").html())),i.removeAttr("data-panel").removeAttr("id").addClass("mosaic-original-content")):i.replaceWith(s(document.createElement("div")).attr("id",t).attr("class",i.attr("class")).addClass("mosaic-panel").attr("data-panel","content").attr("data-max-columns",o).html(e.find("[data-panel="+a+"]").html()))):(i.attr("class",e.find("[data-panel="+a+"]").attr("class")),i.addClass("mosaic-panel"),i.html(e.find("[data-panel="+a+"]").html()))},i.prototype.prefill=function(){this.$el.hasClass("mosaic-panel")||(a.info(s(this)),s(this).addClass("mosaic-panel"),s(this).children().wrap(s('<div class="mosaic-grid-row"><div class="mosaic-grid-cell mosaic-width-full mosaic-position-leftmost"><div class="movable removable mosaic-tile mosaic-text-tile"><div class="mosaic-tile-content"></div></div></div></div>')))},i}),define("mosaic-url/mosaic.layout",["jquery","mosaic-url/mosaic.tile","pat-logger","underscore","pat-registry","mockup-patterns-modal"],function(u,p,e,h,t,a){"use strict";function l(e){switch(e){case 25:return"mosaic-width-quarter";case 33:return"mosaic-width-third";case 50:return"mosaic-width-half";case 66:case 67:return"mosaic-width-two-thirds";case 75:return"mosaic-width-three-quarters";case 100:return"mosaic-width-full"}return"mosaic-width-full"}function r(e){switch(e){case 0:return"mosaic-position-leftmost";case 25:return"mosaic-position-quarter";case 33:return"mosaic-position-third";case 50:return"mosaic-position-half";case 66:case 67:return"mosaic-position-two-thirds";case 75:return"mosaic-position-three-quarters"}return"mosaic-position-leftmost"}return void 0===u.mosaic&&(u.mosaic={}),u.mosaic.layout={widthClasses:["mosaic-width-quarter","mosaic-width-third","mosaic-width-half","mosaic-width-two-thirds","mosaic-width-three-quarters","mosaic-width-full"],positionClasses:["mosaic-position-leftmost","mosaic-position-quarter","mosaic-position-third","mosaic-position-half","mosaic-position-two-thirds","mosaic-position-three-quarters"]},u.fn.mosaicLayout=function(){u(u.mosaic.document).off("keydown").on("keydown",function(e){if(27===e.keyCode){var t=u(".mosaic-original-tile",u.mosaic.document);0<t.length?t.each(function(){u(this).addClass("mosaic-drag-cancel"),u(this).hasClass("mosaic-helper-tile-new")?u(document).trigger("mousedown"):u(document).trigger("mouseup")}):u(".mosaic-selected-tile",u.mosaic.document).each(function(){new p(this).blur()}),u(".mosaic-resize-handle-helper",u.mosaic.document).each(function(){u(this).parents("[data-panel]").removeClass("mosaic-panel-resizing"),u(this).parent().removeClass("mosaic-row-resizing"),u(this).parent().children(".mosaic-resize-placeholder").remove(),u(this).remove()}),u.mosaic.overlay.app&&u.mosaic.overlay.app.hide()}});u(u.mosaic.document).off("mousedown").on("mousedown",function(e){var t;if(e.target?t=e.target:e.srcElement&&(t=e.srcElement),!(0<u(t).parents(".mce-panel").length)){0===u(t).parents(".mosaic-tile").length&&0===u(t).parents(".mosaic-toolbar").length&&(u(".mosaic-selected-tile",u.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),u.mosaic.options.toolbar.trigger("selectedtilechange"),u.mosaic.options.panels.mosaicSetResizeHandleLocation());var a=u(".mosaic-helper-tile-new",u.mosaic.document);0<a.length&&a.each(function(){u(this).mosaicHandleDragEnd()})}});var e=function(c){u(".mosaic-helper-tile-new",u.mosaic.document).each(function(){var e=u(this).parent().offset();u(this).css("top",c.pageY+3-e.top),u(this).css("left",c.pageX+3-e.left)}),u(".mosaic-resize-handle-helper",u.mosaic.document).each(function(){var e,t,a=u(this),i=a.parent(),o=parseFloat(c.pageX-i.offset().left-4)/a.data("row_width")*100,s=25,n=1e3;if(u([25,33,50,67,75]).each(function(){(t=Math.abs(this-o))<n&&(s=this,n=t)}),2===a.data("nr_of_columns"))a.data("column_sizes").split(" ")[0]!==s&&(i.children(".mosaic-resize-placeholder").each(function(e){0===e?u(this).removeClass(u.mosaic.layout.widthClasses.join(" ")).addClass(l(parseInt(s,10))):(u(this).removeClass(u.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(u.mosaic.layout.widthClasses.join(" ")).addClass(l(parseInt(100-s,10))).addClass(r(parseInt(s,10)).replace("position","resize")),a.removeClass(u.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(r(parseInt(s,10)).replace("position","resize")))}),u(this).data("column_sizes",s+" "+(100-s)));else if(1===u(this).data("resize_handle_index")){if(a.data("column_sizes").split(" ")[u(this).data("resize_handle_index")-1]!==s&&parseInt(s,10)<=50)switch((e=i.children(".mosaic-resize-placeholder")).removeClass(u.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(u.mosaic.layout.widthClasses.join(" ")),a.removeClass(u.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(r(parseInt(s,10)).replace("position","resize")),parseInt(s,10)){case 25:u(e.get(0)).addClass(r(0).replace("position","resize")+" "+l(25)),u(e.get(1)).addClass(r(25).replace("position","resize")+" "+l(50)),u(e.get(2)).addClass(r(75).replace("position","resize")+" "+l(25)),a.data("column_sizes","25 50 25");break;case 33:u(e.get(0)).addClass(r(0).replace("position","resize")+" "+l(33)),u(e.get(1)).addClass(r(33).replace("position","resize")+" "+l(33)),u(e.get(2)).addClass(r(66).replace("position","resize")+" "+l(33)),a.data("column_sizes","33 33 33");break;case 50:u(e.get(0)).addClass(r(0).replace("position","resize")+" "+l(50)),u(e.get(1)).addClass(r(50).replace("position","resize")+" "+l(25)),u(e.get(2)).addClass(r(75).replace("position","resize")+" "+l(25)),a.data("column_sizes","50 25 25")}}else if(a.data("column_sizes").split(" ")[u(this).data("resize_handle_index")]!==100-s&&50<=parseInt(s,10))switch((e=i.children(".mosaic-resize-placeholder")).removeClass(u.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(u.mosaic.layout.widthClasses.join(" ")),a.removeClass(u.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(r(parseInt(s,10)).replace("position","resize")),parseInt(s,10)){case 50:u(e.get(0)).addClass(r(0).replace("position","resize")+" "+l(25)),u(e.get(1)).addClass(r(25).replace("position","resize")+" "+l(25)),u(e.get(2)).addClass(r(50).replace("position","resize")+" "+l(50)),a.data("column_sizes","25 25 50");break;case 66:case 67:u(e.get(0)).addClass(r(0).replace("position","resize")+" "+l(33)),u(e.get(1)).addClass(r(33).replace("position","resize")+" "+l(33)),u(e.get(2)).addClass(r(66).replace("position","resize")+" "+l(33)),a.data("column_sizes","33 33 33");break;case 75:u(e.get(0)).addClass(r(0).replace("position","resize")+" "+l(25)),u(e.get(1)).addClass(r(25).replace("position","resize")+" "+l(50)),u(e.get(2)).addClass(r(75).replace("position","resize")+" "+l(25)),a.data("column_sizes","25 50 25")}})};u(u.mosaic.document).off("mousemove").on("mousemove",e),u(u.mosaic.document).off("dragover").on("dragover",e);u(u.mosaic.document).off("mouseup").on("mouseup",function(e){u(".mosaic-resize-handle-helper",u.mosaic.document).each(function(){var e=u(this).parents("[data-panel]"),i=u(this).data("column_sizes").split(" ");u(this).parent().children(".mosaic-grid-cell").each(function(e){for(var t=0,a=0;a<e;a+=1)t+=parseInt(i[a],10);u(this).removeClass(u.mosaic.layout.positionClasses.join(" ")).removeClass(u.mosaic.layout.widthClasses.join(" ")).addClass(r(t)+" "+l(parseInt(i[e],10)))}),e.removeClass("mosaic-panel-resizing"),u(this).parent().removeClass("mosaic-row-resizing"),u(this).parent().children(".mosaic-resize-placeholder").remove(),u(this).parent().mosaicSetResizeHandles(),e.mosaicSetResizeHandleLocation();var t=e.find(".mosaic-selected-tile");0<t.size()&&new p(t).select(),u(this).remove()})});var t=function(e){if(u(this).parents("[data-panel]").hasClass("mosaic-panel-dragging")&&(u(".mosaic-selected-divider",u.mosaic.document).removeClass("mosaic-selected-divider"),!1===u(this).hasClass("mosaic-original-tile")&&!1===u(this).hasClass("mosaic-tile-align-left")&&!1===u(this).hasClass("mosaic-tile-align-right"))){var t=u(this).mosaicGetDirection(e),a=u(this).children(".mosaic-divider-"+t);if("left"===t||"right"===t){var i=a.parent().parent().parent();if(i.children(".mosaic-grid-cell").length>=u(".mosaic-panel").data("max-columns"))return;1<i.children(".mosaic-grid-cell").length?(a.height(i.height()+5),a.css("top",i.offset().top-a.parent().offset().top-5)):(a.height(a.parent().height()+5),a.css("top",-5))}a.addClass("mosaic-selected-divider")}};u(u.mosaic.document).off("mousemove",".mosaic-tile").on("mousemove",".mosaic-tile",t),u(u.mosaic.document).off("dragover",".mosaic-tile").on("dragover",".mosaic-tile",t),u(u.mosaic.document).off("click",".mosaic-tile").on("click",".mosaic-tile",function(){0===u(".mosaic-helper-tile-new",u.mosaic.document).length&&new p(this).select()});var s=this.length;return this.each(function(e){var t=u(this);if(t.find(".mosaic-tile").each(function(){var e=new p(this);e.initialize(),e.scanRegistry()}),t.find(".mosaic-tile").mosaicAddDrag(),t.mosaicAddEmptyRows(),t.children(".mosaic-grid-row").mosaicSetResizeHandles(),e===s-1){var a=0,i=0;u.mosaic.options.panels.each(function(e){u(this).width()>a&&(a=u(this).width(),i=e)});var o=u.mosaic.options.panels.eq(i).find(".mosaic-tile:first");if(0<o.size())new p(o).select()}})},u.fn.mosaicAddMouseMoveEmptyRow=function(){return this.each(function(){u(this).mousemove(function(){u(this).parents("[data-panel]").hasClass("mosaic-panel-dragging")&&(u(".mosaic-selected-divider",u.mosaic.document).removeClass("mosaic-selected-divider"),u(this).children("div").addClass("mosaic-selected-divider"))})})},u.fn.mosaicAddEmptyRows=function(){return this.each(function(){u(this).find(".mosaic-grid-row").each(function(e){1<u(this).children(".mosaic-grid-cell").length&&(0===e&&u(this).before(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(u(u.mosaic.document.createElement("div")).append(u(u.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(u(u.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow()),(0===u(this).nextAll(".mosaic-grid-row").length||1<u(this).next().children(".mosaic-grid-cell").length)&&u(this).after(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(u(u.mosaic.document.createElement("div")).append(u(u.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(u(u.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow()))}),0===u(this).find(".mosaic-grid-row").length&&u(this).append(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(u(u.mosaic.document.createElement("div")).append(u(u.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(u(u.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow())})},u.fn.mosaicGetWidthClass=function(){var e;for(e in u.mosaic.layout.widthClasses)if(u.mosaic.layout.widthClasses.hasOwnProperty(e)&&u(this).hasClass(u.mosaic.layout.widthClasses[e]))return u.mosaic.layout.widthClasses[e];for(e in u.mosaic.layout.widthClasses)if(u.mosaic.layout.widthClasses.hasOwnProperty(e)&&u(this).hasClass(u.mosaic.layout.widthClasses[e].replace("position","resize")))return u.mosaic.layout.widthClasses[e];return u.mosaic.layout.widthClasses[0]},u.fn.mosaicGetPositionClass=function(){var e;for(e in u.mosaic.layout.positionClasses)if(u(this).hasClass(u.mosaic.layout.positionClasses[e]))return u.mosaic.layout.positionClasses[e];for(e in u.mosaic.layout.positionClasses)if(u(this).hasClass(u.mosaic.layout.positionClasses[e].replace("position","resize")))return u.mosaic.layout.positionClasses[e];return u.mosaic.layout.positionClasses[0]},u.fn.mosaicAddDrag=function(){return this.each(function(){var e=u(this),n=function(e){var t=u(".mosaic-helper-tile",u.mosaic.document),a=t.parents("[data-panel]").offset();t.css("top",e.pageY+3-a.top),t.css("left",e.pageX+3-a.left)},c=function(){var e=u(".mosaic-helper-tile",u.mosaic.document);u(u.mosaic.document).unbind("mousemove",n).unbind("mouseup",c),e.mosaicHandleDragEnd(),e.remove()};return e.each(function(){e.find("div.mosaic-drag-handle").unbind("mousedown").bind("mousedown",function(e){var i=e.pageX,o=e.pageY,s=function(e){if(1<=Math.max(Math.abs(i-e.pageX),Math.abs(o-e.pageY))){u.mosaic.options.panels.addClass("mosaic-panel-dragging"),u(".mosaic-selected-tile",u.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur();var t=u(e.target).parents(".mosaic-tile"),a=t.clone(!0);t.addClass("mosaic-original-tile"),t.parents("[data-panel]").append(a),a.css({width:t.width(),position:"absolute",opacity:.5}).addClass("mosaic-helper-tile"),u(u.mosaic.document).mousemove(n),u(u.mosaic.document).mouseup(c),u(u.mosaic.document).unbind("mousemove",s)}};u(u.mosaic.document).bind("mousemove",s),u(u.mosaic.document).bind("mouseup",function(){u(u.mosaic.document).unbind("mousemove",s)})})})})},u.fn.mosaicHandleDragEnd=function(){var e=u(this).parents("[data-panel]");u.mosaic.options.panels.removeClass("mosaic-panel-dragging mosaic-panel-dragging-new");var t=u(".mosaic-selected-divider",u.mosaic.document),a=t.parent(),i="";h.each(["top","bottom","left","right"],function(e){t.hasClass("mosaic-divider-"+e)&&(i=e)}),t.removeClass("mosaic-selected-divider");var o=0<u(".mosaic-helper-tile-new",u.mosaic.document).length,s=u(".mosaic-original-tile",u.mosaic.document);if((0===t.length||a.hasClass("mosaic-helper-tile"))&&s.addClass("mosaic-drag-cancel"),s.hasClass("mosaic-drag-cancel"))s.removeClass("mosaic-drag-cancel"),u.mosaic.options.panels.find(".mosaic-empty-row").remove(),o||s.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");else if(a.hasClass("mosaic-empty-row"))a.removeClass("mosaic-empty-row").attr("class",s.parents(".mosaic-grid-row").first().attr("class")).unbind("mousemove"),a.children(".mosaic-grid-cell").children("div").remove(),a.children(".mosaic-grid-cell").append(s.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile")),u(".mosaic-empty-row",u.mosaic.document).remove();else if(!1===a.hasClass("mosaic-tile"))u(".mosaic-empty-row",u.mosaic.document).remove(),o||s.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");else if(a.parent().parent().children(".mosaic-grid-cell").length>=e.data("max-columns")&&("left"===i||"right"===i))u(".mosaic-empty-row",u.mosaic.document).remove(),o||s.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");else if(u(".mosaic-empty-row",u.mosaic.document).remove(),"top"===i)a.before(s.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"));else if("bottom"===i)a.after(s.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"));else if("left"===i||"right"===i)if(1===a.parent().parent().children(".mosaic-grid-cell").length){var n=a.prevAll();0<n.length&&(a.parent().parent().before(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(u(n.get().reverse()).clone(!0).mosaicAddDrag()))),n.remove());var c=a.nextAll();0<c.length&&(a.parent().parent().after(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(c.clone(!0).mosaicAddDrag()))),c.remove()),a.parent().removeClass(u.mosaic.layout.widthClasses.join(" ")).removeClass(u.mosaic.layout.positionClasses.join(" ")).addClass("mosaic-width-half"),"left"===i?a.parent().addClass("mosaic-position-half").before(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-leftmost").append(s.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))):a.parent().addClass("mosaic-position-leftmost").after(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-half").append(s.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))),a.parent().parent().mosaicSetResizeHandles()}else"left"===i?a.parent().before(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-cell").append(s.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))):a.parent().after(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-cell").append(s.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))),a.parent().parent().mosaicSetColumnSizes(),a.parent().parent().mosaicSetResizeHandles();var l=s.parent().parent();u(".mosaic-original-tile",u.mosaic.document).remove(),l.mosaicCleanupRow(),u.mosaic.options.panels.mosaicAddEmptyRows();var r=u(".mosaic-new-tile",u.mosaic.document);r.removeClass("mosaic-new-tile");var d=new p(r),m=s.find(".mosaic-tile-content");0<m.size()&&m[0]._preScanHTML&&d.cacheHtml(m[0]._preScanHTML),d.isRichText()||d.scanRegistry(),u('.mosaic-tile:not(".mosaic-helper-tile") .mosaic-tile-content.mosaic-rich-text').each(function(){new p(u(this).parent()).setupWysiwyg()}),d.blur(),o&&d.focus()},u.fn.mosaicSetColumnSizes=function(){return this.each(function(){var t=u(this).children(".mosaic-grid-cell").length;u(this).children(".mosaic-grid-cell").each(function(e){switch(u(this).removeClass(u.mosaic.layout.widthClasses.join(" ")).removeClass(u.mosaic.layout.positionClasses.join(" ")),t){case 1:u(this).addClass("mosaic-width-full mosaic-position-leftmost");break;case 2:switch(e){case 0:u(this).addClass("mosaic-width-half mosaic-position-leftmost");break;case 1:u(this).addClass("mosaic-width-half mosaic-position-half")}break;case 3:switch(e){case 0:u(this).addClass("mosaic-width-third mosaic-position-leftmost");break;case 1:u(this).addClass("mosaic-width-third mosaic-position-third");break;case 2:u(this).addClass("mosaic-width-third mosaic-position-two-thirds")}break;case 4:switch(e){case 0:u(this).addClass("mosaic-width-quarter mosaic-position-leftmost");break;case 1:u(this).addClass("mosaic-width-quarter mosaic-position-quarter");break;case 2:u(this).addClass("mosaic-width-quarter mosaic-position-half");break;case 3:u(this).addClass("mosaic-width-quarter mosaic-position-three-quarters")}}})})},u.fn.mosaicSetResizeHandles=function(){return this.each(function(){switch(u(this).children(".mosaic-resize-handle").remove(),u(this).children(".mosaic-grid-cell").length){case 2:u(this).append(u(u.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-one "+u(u(this).children(".mosaic-grid-cell").get(1)).mosaicGetPositionClass().replace("position","resize")));break;case 3:u(this).append(u(u.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-one "+u(u(this).children(".mosaic-grid-cell").get(1)).mosaicGetPositionClass().replace("position","resize"))),u(this).append(u(u.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-two "+u(u(this).children(".mosaic-grid-cell").get(2)).mosaicGetPositionClass().replace("position","resize")))}u(this).children(".mosaic-resize-handle").mousedown(function(){var e=[];u(this).parent().children(".mosaic-grid-cell").each(function(){switch(u(this).mosaicGetWidthClass()){case"mosaic-width-half":e.push("50");break;case"mosaic-width-quarter":e.push("25");break;case"mosaic-width-third":e.push("33");break;case"mosaic-width-two-thirds":e.push("66");break;case"mosaic-width-three-quarters":e.push("75")}u(this).parent().append(u(u.mosaic.document.createElement("div")).addClass("mosaic-resize-placeholder "+u(this).mosaicGetWidthClass()+" "+u(this).mosaicGetPositionClass().replace("position","resize")).append(u(u.mosaic.document.createElement("div")).addClass("mosaic-resize-placeholder-inner-border")))});var t=1;return u(this).hasClass("mosaic-resize-handle-two")&&(t=2),u(this).parent().append(u(u.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-helper").addClass(u(this).mosaicGetPositionClass().replace("position","resize")).data("row_width",u(this).parent().width()).data("nr_of_columns",u(this).parent().children(".mosaic-grid-cell").length).data("column_sizes",e.join(" ")).data("resize_handle_index",t)),u(this).parents("[data-panel]").addClass("mosaic-panel-resizing"),u(this).parent().addClass("mosaic-row-resizing"),u(".mosaic-selected-tile",u.mosaic.document).children(".mosaic-tile-content").blur(),!1})})},u.fn.mosaicCleanupRow=function(){return this.each(function(){var e=u(this);if(e.children(".mosaic-grid-cell").each(function(){0===u(this).children().length&&(u(this).remove(),e.mosaicSetColumnSizes())}),0===e.find(".mosaic-tile").length){var t=e;if(0<e.nextAll(".mosaic-grid-row").length)e=e.next(".mosaic-grid-row");else{if(!(0<e.prevAll(".mosaic-grid-row").length))return void e.remove();e=e.prev(".mosaic-grid-row")}t.remove()}e.mosaicSetResizeHandles()})},u.fn.mosaicSetResizeHandleLocation=function(){u(this).children(".mosaic-grid-row").each(function(){var e=u(this),t=e.children(".mosaic-grid-cell");2!==t.length&&3!==t.length||(e.children(".mosaic-resize-handle").removeClass("mosaic-resize-handle-left mosaic-resize-handle-center mosaic-resize-handle-right"),u(t.get(0)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(e.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-left"),e.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-center")):u(t.get(1)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(e.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-right"),e.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-left")):3===t.length&&u(t.get(2)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(e.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-center"),e.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-right")):(e.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-center"),e.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-center")))})},u.fn.mosaicGetDirection=function(e){var t=parseFloat(u(this).width()),a=parseFloat(u(this).height()),i=parseFloat(e.pageX-u(this).offset().left-t/2),o=parseFloat(e.pageY-u(this).offset().top-a/2),s=t/2,n=a/2;return i<0?o<0?i/o<-1*s/(-1*n)?"top":"left":i/o<-1*s/n?"left":"bottom":o<0?i/o<1*s/(-1*n)?"right":"top":i/o<s/n?"bottom":"right"},u.mosaic.disableEditHtmlSource=function(){u(".mosaic-rich-text-textarea",u.mosaic.document).each(function(){var e;e=u(this).val(),u(this).parent().html(e),new p(u(this).parent()).setupWysiwyg()})},u.mosaic.addAppTile=function(t,a){u.mosaic.overlay.app&&u.mosaic.overlay.app.hide(),u.ajax({type:"GET",url:a,success:function(e){e=u.mosaic.getDomTreeFromHtml(e),u.mosaic.addHeadTags(a,e),u.mosaic.addTile(t,e.find(".temp_body_tag").html(),a)}})},u.mosaic.addAppTileHTML=function(e,t,a){var i;i=u.mosaic.getDomTreeFromHtml(t),u.mosaic.addHeadTags(a,i),u.mosaic.addTile(e,i.find(".temp_body_tag").html(),a)},u.mosaic.editAppTile=function(a){u.mosaic.overlay.close(),window.parent.focus(),u.ajax({type:"GET",url:a,success:function(e){e=u.mosaic.getDomTreeFromHtml(e),u.mosaic.removeHeadTags(a),u.mosaic.addHeadTags(a,e);var t=u(".mosaic-selected-tile .mosaic-tile-content",u.mosaic.document);t.html(e.find(".temp_body_tag").html()),t.attr("data-tileUrl",a.replace(/&/gim,"&amp;"))}})},u.mosaic.addTile=function(e,t,a){u.mosaic.options.panels.addClass("mosaic-panel-dragging mosaic-panel-dragging-new"),u(u.mosaic.options.panels.get(0)).append(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(u(u.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-leftmost").append(u(u.mosaic.document.createElement("div")).addClass("movable removable mosaic-tile mosaic-"+e+"-tile").append(u(u.mosaic.document.createElement("div")).addClass("mosaic-tile-content").attr("data-tileUrl",a&&a.replace(/&/gim,"&amp;")).html(t)).addClass("mosaic-helper-tile mosaic-helper-tile-new mosaic-original-tile"))));var i=u.mosaic.options.panels.find(".mosaic-helper-tile-new"),o=0;u.mosaic.options.panels.each(function(){u(this).width()>o&&(o=u(this).width())}),i.width()<o/4?i.width(o/4):i.width(i.width());var s=new p(i);s.initialize(),s.cacheHtml(),s.scanRegistry()},u.mosaic.getDefaultValue=function(t){var e,a,i,o;switch(o="IDublinCore-title"===t.name?(i='<h1 class="documentFirstHeading">',"</h1>"):"IDublinCore-description"===t.name?(i='<p class="documentDescription">',"</p>"):(i="<div>","</div>"),t.tile_type){case"field":switch(t.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":return i+u("#"+t.id,u.mosaic.document).find("input").attr("value")+o;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":for(var s=u("#"+t.id,u.mosaic.document).find("textarea").val().split("\n"),n="",c=0;c<s.length;c+=1)n+=s[c]+"<br/>";return i+n+o;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":if(e=u("#"+t.id).find("textarea").attr("id"),!(a=tinymce.get(e)))return"";try{return a.getContent()}catch(e){return'<div class="discreet">Placeholder for field:<br/><b>'+t.label+"</b></div>"}break;default:return'<div class="discreet">Placeholder for field:<br/><b>'+t.label+"</b></div>"}break;default:return t.default_value}},u.mosaic.getPageContent=function(){var e,t=1,a=12,i="",o="";return u.mosaic.disableEditHtmlSource(),i+="  <body>\n",u("[data-panel]",u.mosaic.document).each(function(){i+='    <div data-panel="'+u(this).data("panel")+'"',i+='         data-max-columns="'+u(this).data("max-columns")+'">\n',u(this).children(".mosaic-grid-row").each(function(){!1===u(this).hasClass("mosaic-empty-row")&&(o=u(this).attr("class"),i+='      <div class="'+o+'"\n',i+='           data-grid=\'{"type": "row"}\'>\n',u(this).children(".mosaic-grid-cell").each(function(){switch(u(this).mosaicGetPositionClass()){case"mosaic-position-leftmost":t=1;break;case"mosaic-position-quarter":t=4;break;case"mosaic-position-third":t=5;break;case"mosaic-position-half":t=7;break;case"mosaic-position-two-thirds":t=9;break;case"mosaic-position-three-quarters":t=10}switch(u(this).mosaicGetWidthClass()){case"mosaic-width-half":a=6;break;case"mosaic-width-quarter":a=3;break;case"mosaic-width-third":a=4;break;case"mosaic-width-two-thirds":a=8;break;case"mosaic-width-three-quarters":a=9;break;case"mosaic-width-full":a=12}i+='        <div class="'+u(this).attr("class")+'"\n',i+='             data-grid=\'{"type": "cell", "info":{"xs": "true", "sm": "true", "lg": "true", "pos": {"x": '+t+', "width": '+a+"}}}'>\n",u(this).children(".mosaic-tile").each(function(){var e=new p(this);i+=e.getHtmlBody()}),i+="        </div>\n"}),i+="      </div>\n")}),i+="    </div>\n"}),i+="  </body>\n",e='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" data-layout="'+u.mosaic.options.layout+'">\n',e+=i,e+="</html>\n"},u.mosaic.saveTileFormData=function(){u("[data-panel]",u.mosaic.document).each(function(){u(this).find(".mosaic-tile").each(function(){new p(this).saveForm()})})},u.mosaic.saveLayoutToForm=function(){u.mosaic.saveTileFormData();var e=u("#form-widgets-ILayoutAware-content, [name='form.widgets.ILayoutAware.content']");u.mosaic.hasContentLayout?e.val(""):e.val(u.mosaic.getPageContent())},{Tile:p}}),define("mosaic-url/mosaic.toolbar",["jquery","mosaic-url/mosaic.tile","mosaic-url/mosaic.layout"],function(p,h){"use strict";void 0===p.mosaic&&(p.mosaic={});var f=function(e){return e.replace(/(_|\.|\/)/g,"-").toLowerCase()};function g(e,i){var t;void 0!==typeof i.menu&&i.menu?i.icon?(t=p(document.createElement("label")),e.append(t.addClass("mosaic-icon-menu mosaic-icon-menu-"+f(i.name)+" mosaic-icon").html(i.label).attr("title",i.label).append(p(document.createElement("select")).addClass("mosaic-menu-"+f(i.name)).data("action",i.action).change(function(){p(this).mosaicExecAction()}).each(function(){var e,t,a;for(e in i.items)if(void 0!==i.items[e].items)for(a in p(this).append(p(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+f(i.items[e].value)).attr("label",i.items[e].label)),t=p(this).find(".mosaic-option-group-"+f(i.items[e].value)),i.items[e].items)t.append(p(document.createElement("option")).attr("value",i.items[e].items[a].value).addClass("mosaic-option mosaic-option-"+f(i.items[e].items[a].value)).html(i.items[e].items[a].label));else p(this).append(p(document.createElement("option")).attr("value",i.items[e].value).addClass("mosaic-option mosaic-option-"+f(i.items[e].value)).html(i.items[e].label))})))):(t=p(document.createElement("select")),e.append(t.addClass("mosaic-menu mosaic-menu-"+i.name.replace(/_/g,"-")).data("action",i.action).change(function(){p(this).mosaicExecAction()}).each(function(){var e,t,a;for(e=0;e<i.items.length;e+=1)if(void 0!==i.items[e].items)for(a in p(this).append(p(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+f(i.items[e].value)).attr("label",i.items[e].label)),t=p(this).find(".mosaic-option-group-"+f(i.items[e].value)),i.items[e].items)t.append(p(document.createElement("option")).attr("value",i.items[e].items[a].value).addClass("mosaic-option mosaic-option-"+f(i.items[e].items[a].value)).html(i.items[e].items[a].label));else p(this).append(p(document.createElement("option")).attr("value",i.items[e].value).addClass("mosaic-option mosaic-option-"+f(i.items[e].value)).html(i.items[e].label))}))):(t=p(document.createElement("button")),e.append(t.addClass("mosaic-button mosaic-button-"+f(i.name)+(i.icon?" mosaic-icon":"")).html(i.label).attr("title",i.label).attr("type","button").data("action",i.action).mousedown(function(){p(this).mosaicExecAction()}))),p.mosaic.actionManager.actions[i.name]&&(p.mosaic.actionManager.actions[i.name].visible()||t.hide())}p.fn._mosaicToolbarLayoutEditor=function(e){var t,a,i,o;if(p(".mosaic-toolbar-secondary-functions",this).show(),void 0!==p.mosaic.options.formats)for(t=0;t<p.mosaic.options.formats.length;t+=1){for(i=p.mosaic.options.formats[t],e.primary_actions.append(p(document.createElement("fieldset")).addClass("mosaic-button-group mosaic-button-group-"+f(i.name))),o=e.primary_actions.children(".mosaic-button-group-"+i.name.replace(/_/g,"-")),a=0;a<i.actions.length;a+=1)i.actions[a].favorite&&g(o,i.actions[a]);0===o.children().length&&o.remove()}if(void 0!==p.mosaic.options.tiles){var s=e.secondary_actions.find(".mosaic-menu-insert");for(t=0;t<p.mosaic.options.tiles.length;t+=1){for(i=p.mosaic.options.tiles[t],s.append(p(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+f(i.name)).attr("label",i.label)),o=e.secondary_actions.find(".mosaic-option-group-"+f(i.name)),a=0;a<i.tiles.length;a+=1){var n=i.tiles[a];o.append(p(document.createElement("option")).addClass("mosaic-option mosaic-option-"+f(n.name)).attr("value",n.name).html(n.label))}0===o.children().length&&o.remove()}}if(void 0!==p.mosaic.options.formats){var c=e.secondary_actions.find(".mosaic-menu-format");for(t=0;t<p.mosaic.options.formats.length;t+=1){for(i=p.mosaic.options.formats[t],c.append(p(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+f(i.name)).attr("label",i.label)),o=e.secondary_actions.find(".mosaic-option-group-"+f(i.name)),a=0;a<i.actions.length;a+=1){var l=i.actions[a];!1===l.favorite&&o.append(p(document.createElement("option")).addClass("mosaic-option mosaic-option-"+f(l.name)).attr("value",l.name).html(l.label).data("action",l.action))}0===o.children().length&&o.remove()}}},p.fn.mosaicToolbar=function(){return this.each(function(){var t,e,a,i,o,s,n,c,l;for(i in(t=p(this)).html(""),t.append(p(document.createElement("div")).addClass("mosaic-inline-toolbar")),(t=t.children(".mosaic-inline-toolbar")).append(p(document.createElement("div")).addClass("mosaic-toolbar-content")),a={},(e=t.children(".mosaic-toolbar-content")).append(p(document.createElement("div")).addClass("mosaic-toolbar-primary-functions")),a.primary_actions=e.children(".mosaic-toolbar-primary-functions"),e.append(p(document.createElement("div")).addClass("mosaic-toolbar-secondary-functions")),a.secondary_actions=e.children(".mosaic-toolbar-secondary-functions"),a)for(o=0;o<p.mosaic.options[i].length;o+=1)if(void 0===p.mosaic.options[i][o].actions)g(a[i],p.mosaic.options[i][o]);else{s=p.mosaic.options[i][o];var r=f(p.mosaic.options[i][o].name),d=p(document.createElement("div")).addClass("mosaic-button-group mosaic-button-group-"+r);d.append(g(d,p.extend({},!0,s,{action:s.name.toLowerCase(),name:s.name.toLowerCase()})));var m=p(document.createElement("div")).addClass("btn-container");for(d.append(m),a[i].append(d),n=0;n<s.actions.length;n+=1)g(m,s.actions[n])}t._mosaicToolbarLayoutEditor(a),p.mosaic.hasContentLayout&&p(".mosaic-toolbar-secondary-functions",this).hide(),c=function(){var e;parseInt(p(window).scrollTop(),10)>parseInt(t.parent().offset().top,10)?t.hasClass("mosaic-inline-toolbar")&&(e=t.offset().left,t.width(t.width()).css({left:e,"margin-left":"0px"}).removeClass("mosaic-inline-toolbar").addClass("mosaic-external-toolbar").parent().height(t.height())):t.hasClass("mosaic-external-toolbar")&&t.css({width:"",left:"","margin-left":""}).removeClass("mosaic-external-toolbar").addClass("mosaic-inline-toolbar").parent().css("height","")},p(window).bind("scroll",c),l=function(){var a,e,t,i,o,s;p.mosaic.disableEditHtmlSource(),a=p(this);var n=p(".mosaic-selected-tile",p.mosaic.document);0<n.length&&(e=new h(n).getType());for(t=p.mosaic.options.default_available_actions,i=0;i<p.mosaic.options.tiles.length;i+=1)for(o=p.mosaic.options.tiles[i],s=0;s<o.tiles.length;s+=1)o.tiles[s].name===e&&(t=t.concat(o.tiles[s].available_actions));n.hasClass("removable")||(t=p(t).filter(function(){return"remove"!==this})),a.find(".mosaic-option-group").show(),a.find(".mosaic-button").hide(),a.find(".mosaic-menu").hide(),a.find(".mosaic-icon-menu").hide(),a.find(".mosaic-menu-format").find(".mosaic-option").hide().attr("disabled","disabled"),p(a.find(".mosaic-menu-format").find(".mosaic-option").get(0)).show().removeAttr("disabled"),p(t).each(function(e,t){p.mosaic.actionManager.actions[t]&&!p.mosaic.actionManager.actions[t].visible()||(a.find(".mosaic-button-"+t).show(),a.find(".mosaic-icon-menu-"+t).show(),a.find(".mosaic-menu-"+t).show(),a.find(".mosaic-option-"+t).show().removeAttr("disabled"))}),p.mosaic.actionManager.actions.layout.visible()&&p(".mosaic-button-layout").show(),a.find(".mosaic-menu-insert").children(".mosaic-option-group-fields").children().each(function(){0===p.mosaic.options.panels.find(".mosaic-"+p(this).attr("value")+"-tile").length?p(this).show().removeAttr("disabled"):p(this).hide().attr("disabled","disabled")}),a.find(".mosaic-option-group").each(function(){0===p(this).children(":enabled").length&&p(this).hide()}),p(".mosaic-menu, .mosaic-icon-menu",p.mosaic.document).each(function(){1===p(this).find(".mosaic-option:enabled").length&&p(this).hide()}),!p.mosaic.hasContentLayout&&p.mosaic.options.canChangeLayout?p(".mosaic-button-savelayout").show():p(".mosaic-button-savelayout").hide()},p(this).bind("selectedtilechange",l),p(this).trigger("selectedtilechange"),p(".mosaic-menu").each(function(){p(this).select2({width:"style",dropdownCssClass:"mosaic-dropdown mosaic-dropdown-"+p(this).data("action"),dropdownAutoWidth:!0,minimumResultsForSearch:99})});var u=(new Date).getTime();p(this).on("selectedtilechange",function(){p.mosaic.overlay.app||6e3<(new Date).getTime()-u&&(p.mosaic.saveLayoutToForm(),setTimeout(function(){p("#form-widgets-ILayoutAware-content, [name='form.widgets.ILayoutAware.content']").blur()},1e3),u=(new Date).getTime())})})}}),define("mosaic-url/mosaic.actions",["jquery","mosaic-url/mosaic.tile","mockup-utils","mockup-patterns-modal"],function(d,t,m,u){"use strict";void 0===d.mosaic&&(d.mosaic={}),d.mosaic.actionManager={actions:[],shortcuts:[]},d.mosaic.registerAction=function(e,t){t=d.extend({exec:function(){},shortcut:{ctrl:!1,alt:!1,shift:!1,key:""},visible:function(e){return!0},undoable:!1},t),""!==(d.mosaic.actionManager.actions[e]=t).shortcut.key&&(t.shortcut.charCode=t.shortcut.key.toUpperCase().charCodeAt(0),t.shortcut.action=e,d.mosaic.actionManager.shortcuts.push(t.shortcut))},d.fn.mosaicExecAction=function(){return this.each(function(){if(""!==d(this).data("action")){var e=d.mosaic.actionManager;e.actions[d(this).data("action")].exec(this),e.actions[d(this).data("action")].undoable&&d.mosaic.undo.snapshot()}})},d.mosaic.fixWebkitSpan=function(){var e=d(".Apple-style-span",d.mosaic.document);e.after(e.html()),e.remove()},d.mosaic.getPrefixedClassName=function(e){return-1<e.indexOf("-")?"mosaic-"+e:"mosaic"+e.charAt(0).toUpperCase()+e.slice(1)},d.mosaic.initActions=function(){d.mosaic.registerAction("tile-toggle-class",{exec:function(){var e;0<arguments.length&&arguments[0].value&&(e=d.mosaic.getPrefixedClassName(arguments[0].value),d(".mosaic-selected-tile",d.mosaic.document).toggleClass(e))}}),d.mosaic.registerAction("tile-remove-format",{exec:function(){var e,t,a,i,o;for(e=0;e<d.mosaic.options.formats.length;e++)for(a=d.mosaic.options.formats[e],t=0;t<a.actions.length;t++)"tile"===(i=a.actions[t]).category&&(o=d.mosaic.getPrefixedClassName(i.name),d(".mosaic-selected-tile",d.mosaic.document).removeClass(o))}}),d.mosaic.registerAction("row-toggle-class",{exec:function(){var e;0<arguments.length&&arguments[0].value&&(e=d.mosaic.getPrefixedClassName(arguments[0].value),d(".mosaic-selected-tile",d.mosaic.document).parents(".mosaic-grid-row").first().toggleClass(e))}}),d.mosaic.registerAction("row-remove-format",{exec:function(){var e,t,a,i,o;for(e=0;e<d.mosaic.options.formats.length;e++)for(a=d.mosaic.options.formats[e],t=0;t<a.actions.length;t++)"row"===(i=a.actions[t]).category&&(o=d.mosaic.getPrefixedClassName(i.name),d(".mosaic-selected-tile",d.mosaic.document).parents(".mosaic-grid-row").first().removeClass(o))}}),d.mosaic.registerAction("tile-align-block",{exec:function(){d(".mosaic-selected-tile",d.mosaic.document).removeClass("mosaic-tile-align-right").removeClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"b"}}),d.mosaic.registerAction("tile-align-left",{exec:function(){d(".mosaic-selected-tile",d.mosaic.document).removeClass("mosaic-tile-align-right").addClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"l"}}),d.mosaic.registerAction("tile-align-right",{exec:function(){d(".mosaic-selected-tile",d.mosaic.document).removeClass("mosaic-tile-align-left").addClass("mosaic-tile-align-right")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"r"}}),d.mosaic.registerAction("save",{exec:function(){d.mosaic.options.toolbar.trigger("selectedtilechange"),d.mosaic.saveLayoutToForm(),d("#form-buttons-save").click()},shortcut:{ctrl:!0,alt:!1,shift:!1,key:"s"}}),d.mosaic.registerAction("cancel",{exec:function(){d("#form-buttons-cancel").click()}}),d.mosaic.registerAction("html",{exec:function(){var e,t,a;0===(e=d(".mosaic-selected-tile",d.mosaic.document).children(".mosaic-tile-content")).find(".mosaic-rich-text-textarea").length&&(t=e.html(),a=e.height(),e.empty(),e.prepend(d(d.mosaic.document.createElement("textarea")).addClass("mosaic-rich-text-textarea").html(d.trim(t)).height(a)))}}),d.mosaic.registerAction("undo",{exec:function(){d.mosaic.undo.undo()}}),d.mosaic.registerAction("redo",{exec:function(){d.mosaic.undo.redo()}}),d.mosaic.registerAction("properties",{exec:function(){d.mosaic.overlay.open("all")}}),d.mosaic.registerAction("layout",{exec:function(){d(".mosaic-button-group-layout").toggleClass("active")},visible:function(){return!0}}),d.mosaic.registerAction("customizelayout",{exec:function(){d.mosaic.setSelectedContentLayout(""),d(".mosaic-toolbar-secondary-functions").show(),d(".mosaic-button-customizelayout").hide(),d(".mosaic-button-savelayout").show(),d(".mosaic-panel .mosaic-tile",d.mosaic.document).each(function(){var e=new t(this);e.makeMovable(),e.$el.mosaicAddDrag()}),d(".mosaic-button-group-layout").removeClass("active")},visible:function(){return d.mosaic.hasContentLayout&&d.mosaic.options.canChangeLayout}}),d.mosaic.registerAction("changelayout",{exec:function(){var e=d.mosaic.hasContentLayout;e||(e=confirm("Changing your layout will destroy all existing custom layout settings you have in place. Are you sure you want to continue?")),e&&d.mosaic.selectLayout(),d(".mosaic-button-group-layout").removeClass("active")},visible:function(){return 0<d.mosaic.options.available_layouts.length}}),d.mosaic.registerAction("savelayout",{exec:function(){d.mosaic.saveLayout(),d(".mosaic-button-group-layout").removeClass("active")},visible:function(){return!0}}),d.mosaic.registerAction("add-tile",{exec:function(){new u(d(".mosaic-toolbar"),{ajaxUrl:d.mosaic.options.context_url+"/@@add-tile?form.button.Create=Create"}).show()}}),d.mosaic.registerAction("format",{exec:function(e){d(e).find("[value="+d(e).val()+"]").mosaicExecAction(),d(e).select2("val","none")}}),d.mosaic.registerAction("insert",{exec:function(e){var t,a,n,i,o;if("none"===d(e).val())return!1;for(n=d(e).val(),d(".mosaic-selected-tile",d.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),d.mosaic.options.panels.trigger("selectedtilechange"),i=0;i<d.mosaic.options.tiles.length;i+=1)for(a=d.mosaic.options.tiles[i],o=0;o<a.tiles.length;o+=1)a.tiles[o].name===n&&(t=a.tiles[o]);if("textapp"===t.tile_type){var s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),c=d.mosaic.options.context_url+"/@@"+n+"/"+s,l="<html><body>"+d.mosaic.getDefaultValue(t)+"</body></html>";d.mosaic.addAppTileHTML(n,l,c)}else if("app"===t.tile_type){var r=!0;m.loading.show(),d.ajax({type:"GET",url:d.mosaic.options.context_url+"/@@add-tile?tiletype="+n+"&form.button.Create=Create",success:function(e,t){var a,i,o,s;m.loading.hide(),i=(a=d(e)).find("#add_tile").attr("action"),o=a.find('[name="_authenticator"]').val(),s=function(e){d.mosaic.overlay.app=new u(d(".mosaic-toolbar"),{html:e,loadLinksWithinModal:!0,buttons:'.formControls > input[type="submit"], .actionButtons > input[type="submit"]'}),d.mosaic.overlay.app.$el.off("after-render"),d.mosaic.overlay.app.on("after-render",function(e){r&&(d(".field.error",d.mosaic.overlay.app.$modal).removeClass("error"),d(".fieldErrorBox,.portalMessage",d.mosaic.overlay.app.$modal).remove(),r=!1),d('input[name*="cancel"]',d.mosaic.overlay.app.$modal).off("click").on("click",function(){d.mosaic.overlay.app.hide(),d.mosaic.overlay.app=null})}),d.mosaic.overlay.app.show(),d.mosaic.overlay.app.$el.off("formActionSuccess"),d.mosaic.overlay.app.on("formActionSuccess",function(e,t,a,i){var o=i.getResponseHeader("X-Tile-Url");o&&(d.mosaic.addAppTileHTML(n,t,o),d.mosaic.overlay.app.hide(),d.mosaic.overlay.app=null)})},0<d("form .required",a).filter(function(){var e=d(this).parents(".field").first().find("input, select, textarea").not('[type="hidden"]').last().val();return null===e||0===e.length}).length?s(e):i&&d("form",a).ajaxSubmit({type:"POST",url:i,data:{"buttons.save":"Save",_authenticator:o},success:function(e,t,a){var i=a.getResponseHeader("X-Tile-Url");i?d.mosaic.addAppTileHTML(n,e,i):s(e)}})}})}else d.mosaic.addTile(n,d.mosaic.getDefaultValue(t));return d(e).select2("val","none"),!0}}),d(document).keypress(function(e){var t="";return d(d.mosaic.actionManager.shortcuts).each(function(){e.ctrlKey!==this.ctrl&&(-1===navigator.userAgent.toLowerCase().indexOf("macintosh")||e.metaKey!==this.ctrl)||e.altKey!==this.alt&&void 0!==e.altKey||e.shiftKey!==this.shift||!e.charCode||String.fromCharCode(e.charCode).toUpperCase().charCodeAt(0)!==this.charCode||(t=this.action)}),""===t||(d.mosaic.actionManager.actions[t].exec(),d.mosaic.actionManager.actions[t].undoable&&d.mosaic.undo.snapshot(),!1)})}}),define("mosaic-url/mosaic.core",["jquery","pat-logger","underscore","mosaic-url/mosaic.tile","mosaic-url/mosaic.panel","mockup-patterns-modal","mockup-utils","mosaic-url/mosaic.toolbar","mosaic-url/mosaic.layout","mosaic-url/mosaic.actions"],function(n,e,s,t,a,c,l){"use strict";e.getLogger("pat-mosaic");void 0===n.mosaic&&(n.mosaic={}),n.mosaic.loaded=!1,n.mosaic.selectLayoutTemplate=s.template('<div><h1>Select Layout</h1><div class="mosaic-select-layout"><div class="global-layouts"><ul><% _.each(available_layouts, function(layout){ var screenshot = layout.preview || layout.screenshot;if(!screenshot){screenshot = "++plone++mosaic/img/default-layout-screenshot.png";} %><li><a href="#" data-value="<%- layout.path %>"><p><%- layout.title %></p><img src="<%- portal_url %>/<%- screenshot %>"></a></li><% }); %></ul></div><% if(user_layouts.length > 0){ %><hr /><div class="user-layouts"><h4>My Layouts</h4><ul><% _.each(user_layouts, function(layout){ var screenshot = layout.preview || layout.screenshot;if(!screenshot){screenshot = "++resource++plone.app.mosaic/img/default-layout-screenshot.png";} %><li><a href="#" data-value="<%- layout.path %>"><p><%- layout.title %></p><img src="<%- portal_url %>/<%- screenshot %>"></a></li><% }); %></ul></div><% } %><% if(hasCustomLayouts) { %><hr /><p class="manage-custom-layouts"><a href="#">Manage custom layouts</a></p><% } %></div><div class="buttons">\x3c!-- <button class="plone-btn plone-btn-default">Select</button> --\x3e</div></div>'),n.mosaic.saveLayoutTemplate=s.template('<div><h1>Save Layout</h1><div class="mosaic-save-layout"><p>This process takes a copy of the existing layout and saves it to a new, resuable layout.</p><div class="form-group field"><label for="layoutNameField">Name</label><input type="text" name="name" class="form-control" id="layoutNameField" /></div><div class="field form-group"><span class="option"><input id="globalLayout" type="checkbox"><label for="globalLayout"><span class="label">Global</span></label></span><div class="formHelp">Should this layout be available for all users on the site?</div></div></div><div class="buttons"><button class="plone-btn plone-btn-primary">Save</button></div></div>'),n.mosaic.manageLayoutsTemplate=s.template('<div><h1>Manage custom layouts</h1><div class="mosaic-manage-custom-layouts"><table><thead><tr><th>Name</th><th>Path</th><th>Actions</th></tr></thead><tbody><% _.each(available_layouts.concat(user_layouts), function(layout){ %><% if(layout.path.indexOf("custom/") !== -1){ %><tr><td><%- layout.title %></td><td><%- layout.path %></td><td><a href="#" class="btn btn-danger delete-layout" data-layout="<%- layout.path %>">Delete</a></td></tr><% } %><% }); %></tbody></table></div></div>'),n.mosaic.deleteLayoutTemplate=s.template('<div><h1>Delete layout</h1><div class="mosaic-delete-layout"><% if(existing.length === 0 && !selected){  %><div class="portalMessage warning"><strong>Warning</strong>Are you certain you want to delete this layout? This can not be undone.</div><% } else { %><div class="portalMessage error"><strong>Warning</strong>Are you certain you want to delete this layout? This can not be undone. <% if(existing.length > 0) { %>There are currently <%- existing.length %> items assigned to this layout. <% } %>You need to provide a replacement layout for the existing items in order to delete this for items currently assigned to this.</div><div class="form-group field"><label for="layoutField">Replacement Layout</label><select name="layout" class="form-control" id="layoutField"><% _.each(available_layouts.concat(user_layouts), function(l){ %><% if(l.path !== layout.path){ %><option value="<%- l.path %>"><%- l.title %></option><% } %><% }); %></select></div><% } %></div><div class="buttons"><button class="plone-btn plone-btn-danger delete">Yes, delete</button><button class="plone-btn plone-btn-default cancel">No</button></div></div>'),n.mosaic.initialized=function(){n.mosaic.loaded||(n.mosaic.loaded=!0,n.mosaic.undo.snapshot())},n.mosaic.init=function(e){var t;e=n.extend({url:window.document.location.href,type:"",ignore_context:!1},e),n.mosaic.document=window.document,n.mosaic.initActions(),(t=e.url.match(/^([\w#!:.?+=&%@!\-\/]+)\/edit$/))&&(e.url=t[1]),(t=e.url.match(/^([\w#:.?=%@!\-\/]+)\/\+\+add\+\+([\w#!:.?+=&%@!\-\/]+)$/))&&(e.url=t[1],e.type=t[2],e.ignore_context=!0),n.mosaic.options=e.data,n.mosaic.options.url=e.url,n.mosaic.options.ignore_context=e.ignore_context,n.mosaic.options.tileheadelements=[],n.mosaic.hasContentLayout=!0;var a=n.mosaic.getSelectedContentLayout();if(a)n.mosaic.applyLayout(a);else{var i=n(n.mosaic.options.customContentLayout_field_selector).val();if(i){var o=n.mosaic.getDomTreeFromHtml(i);"no-layout"===o.attr("id")?n.mosaic.selectLayout(!0):(n("body").addClass("mosaic-layout-customized"),n.mosaic.hasContentLayout=!1,n.mosaic._init(o));var s=n(".mosaic-helper-tile-new");0<s.length&&s.parents(".mosaic-grid-row").remove()}else n.mosaic.selectLayout(!0)}},n.mosaic.getSelectedContentLayout=function(){return n(n.mosaic.options.contentLayout_field_selector).val()},n.mosaic.setSelectedContentLayout=function(e){return e?(n.mosaic.hasContentLayout=!0,n(".mosaic-toolbar-secondary-functions",n.mosaic.document).hide(),n("body").removeClass("mosaic-layout-customized")):(n("body").addClass("mosaic-layout-customized"),n.mosaic.hasContentLayout=!1),n(n.mosaic.options.contentLayout_field_selector).attr("value",e)},n.mosaic._initPanels=function(e){n.mosaic.options.layout=e.attr("data-layout"),n("[data-panel] [data-panel]",n.mosaic.document).removeAttr("data-panel"),e.find("[data-panel]").each(function(){new a(this).initialize(e)}),n("[data-panel]",n.mosaic.document).each(function(){new a(this).prefill()}),n.mosaic.options.panels=n(".mosaic-panel",n.mosaic.document),n.mosaic.options.panels.find("[data-tile]").each(function(){t.validTile(this)&&new t(n(this).parent()).initializeContent()})},n.mosaic._init=function(e){n.mosaic._initPanels(e),n(".mosaic-original-content",n.mosaic.document).mosaicOverlay(),n("body").prepend(n(document.createElement("div")).addClass("mosaic-toolbar")),n.mosaic.options.toolbar=n(".mosaic-toolbar"),n.mosaic.options.toolbar.mosaicToolbar(),n.mosaic.options.panels.mosaicLayout(),n("*",n.mosaic.document).each(function(){var e;"block"===(e=n(this)).css("display")&&(e.hasClass("mosaic-panel")||e.hasClass("mosaic-toolbar")||e.hasClass("mosaic-notifications")||e.hasClass("mosaic-modal-wrapper")||"edit-zone"===e.attr("id")||0===e.parents(".mosaic-panel, .mosaic-toolbar").length&&0===e.find(".mosaic-panel, .mosaic-toolbar").length&&0!==e.parent().find(".mosaic-panel, .mosaic-toolbar").length&&e.addClass("mosaic-blur"))}),n.mosaic.undo.init(),n("body").addClass("mosaic-enabled"),n.mosaic.initialized()},n.mosaic.applyLayout=function(a,e){void 0===e&&(e=function(){}),l.loading.show(),n.ajax({url:n("body").attr("data-portal-url")+"/"+a,cache:!1}).done(function(e){var t=n.mosaic.getDomTreeFromHtml(e);n.mosaic.setSelectedContentLayout(a),n.mosaic.loaded?(n.mosaic._initPanels(t),n.mosaic.options.panels.mosaicLayout()):n.mosaic._init(t)}).fail(function(e,t,a){"Not Found"===a?window.alert("Specified layout can not be found. Loading default layout."):window.alert("Error loading layout specified for this content. Falling back to basic layout."),n.mosaic.applyLayout("++contentlayout++default/basic.html")}).always(function(){l.loading.hide()})};var r=function(){return 0<n.mosaic.options.user_layouts.length||0<s.filter(n.mosaic.options.available_layouts,function(e){return-1!==e.path.indexOf("custom/")}).length};n.mosaic._deleteLayout=function(a,e,i){var t=n("<div/>").appendTo("body"),o=new c(t,{html:n.mosaic.deleteLayoutTemplate(n.extend({},!0,{existing:e,layout:a,selected:n.mosaic.getSelectedContentLayout()==="++contentlayout++"+a.path},n.mosaic.options)),content:null,buttons:".plone-btn"});o.on("shown",function(){n("button.delete:visible",o.$modal).off("click").on("click",function(e){e.preventDefault(),l.loading.show();var t=n("#layoutField",o.$modal).val();n.ajax({url:n("body").attr("data-base-url")+"/@@manage-layouts-from-editor",data:{action:"deletelayout",layout:a.path,replacement:t,_authenticator:l.getAuthenticator()}}).done(function(e){o.hide(),i(e),t&&n.mosaic.getSelectedContentLayout()==="++contentlayout++"+a.path&&n.mosaic.applyLayout("++contentlayout++"+t)}).fail(function(){window.alert("Error deleting layout")}).always(function(){l.loading.hide()})}),n("button.cancel:visible",o.$modal).off("click").on("click",function(e){e.preventDefault(),o.hide()})}),o.show()},n.mosaic.deleteLayout=function(t,a){l.loading.show(),n.ajax({url:n("body").attr("data-base-url")+"/@@manage-layouts-from-editor",data:{action:"existing",layout:t.path}}).done(function(e){n.mosaic._deleteLayout(t,e.data,a)}).fail(function(){window.alert("Error loading data for existing assignments")}).always(function(){l.loading.hide()})},n.mosaic.manageCustomLayouts=function(){var e=n("<div/>").appendTo("body"),a=new c(e,{html:n.mosaic.manageLayoutsTemplate(n.extend({},!0,{},n.mosaic.options)),content:null,buttons:".plone-btn"});a.on("shown",function(){n(".delete-layout",a.$modal).off("click").on("click",function(e){e.preventDefault();var t=n(this).attr("data-layout");s.each(n.mosaic.options.available_layouts.concat(n.mosaic.options.user_layouts),function(e){if(e.path===t)return n.mosaic.deleteLayout(e,function(e){n.mosaic.options.available_layouts=e.available_layouts,n.mosaic.options.user_layouts=e.user_layouts,a.hide(),n.mosaic.manageCustomLayouts()})})})}),a.show()},n.mosaic.selectLayout=function(e){if(void 0!==e&&e&&1===n.mosaic.options.available_layouts.length){var t=n.mosaic.options.available_layouts[0],a="++contentlayout++"+t.directory+"/"+t.file;n.mosaic.applyLayout(a)}else if(0!==n.mosaic.options.available_layouts.length){var i=n("<div/>").appendTo("body"),o=new c(i,{html:n.mosaic.selectLayoutTemplate(n.extend({},!0,{hasCustomLayouts:r(),portal_url:n("body").attr("data-portal-url")},n.mosaic.options)),content:null,buttons:".plone-btn"});o.on("shown",function(){n(".manage-custom-layouts a",o.$modal).off("click").on("click",function(e){e.preventDefault(),o.hide(),n.mosaic.manageCustomLayouts()}),n("li a",o.$modal).off("click").on("click",function(e){var t;e.preventDefault();var a=n(this).attr("data-value");s.each(n.mosaic.options.available_layouts.concat(n.mosaic.options.user_layouts),function(e){e.path===a&&(t=e)});var i="++contentlayout++"+t.path;o.hide(),n.mosaic.applyLayout(i)})}),o.show()}else n.mosaic.applyLayout("++contentlayout++default/basic.html")},n.mosaic.saveLayout=function(e){var t=n("<div/>").appendTo("body"),a=new c(t,{html:n.mosaic.saveLayoutTemplate(n.extend({},!0,{hasCustomLayouts:r()},n.mosaic.options)),content:null,buttons:".plone-btn"});a.on("shown",function(){n(".plone-btn:visible",a.$modal).off("click").on("click",function(e){l.loading.show(),e.preventDefault();var t="false";n("#globalLayout",a.$modal)[0].checked&&(t="true"),n.ajax({url:n("body").attr("data-base-url")+"/@@manage-layouts-from-editor",method:"POST",data:{action:"save",_authenticator:l.getAuthenticator(),global:t,name:n("#layoutNameField",a.$modal).val(),layout:n.mosaic.getPageContent()}}).done(function(e){e.success&&(n.mosaic.options.available_layouts=e.available_layouts,n.mosaic.options.user_layouts=e.user_layouts,n.mosaic.applyLayout(e.layout))}).fail(function(){window.alert("Error saving layout")}).always(function(){l.loading.hide(),a.hide()})})}),a.show()},n.mosaic.getDomTreeFromHtml=function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<!DOCTYPE[\w\s\- .\/\":]+>/,"")).replace(/<html>/,'<div class="temp_html_tag">')).replace(/<\/html>/,"</div>")).replace(/<html\s/,'<div class="temp_html_tag" ')).replace(/<\/html\s/,"</div ")).replace(/<head>/,'<div class="temp_head_tag">')).replace(/<\/head>/,"</div>")).replace(/<head\s/,'<div class="temp_head_tag" ')).replace(/<\/head\s/,"</div ")).replace(/<body>/,'<div class="temp_body_tag">')).replace(/<\/body>/,"</div>")).replace(/<body\s/,'<div class="temp_body_tag" ')).replace(/<\/body\s/,"</div "),n(n(e)[0])},n.mosaic.removeHeadTags=function(e){if(e&&"undefined"!==e){var t,a,i,o;if(t=(e=(e=e.split("?")[0]).split("@@"))[1].split("/"),e=e[0]+"@@delete-tile?type="+t[0]+"&id="+t[1]+"&confirm=true",a=t[0].replace(/\./g,"-")+"-"+t[1],i=n.mosaic.options.tileheadelements[a])for(o=0;o<i.length;o+=1)n(i[o],n.mosaic.document).remove();n.mosaic.options.tileheadelements[a]=[]}},n.mosaic.addHeadTags=function(e,t){var a,i;a=(e=(e=e.split("?")[0]).split("@@"))[1].split("/"),i=a[0].replace(/\./g,"-")+"-"+a[1],n.mosaic.options.tileheadelements[i]=[],t.find(".temp_head_tag").children().each(function(){n.mosaic.options.tileheadelements[i].push(this),n("head",n.mosaic.document).append(this)})}}),define("mosaic-url/mosaic.upload",["jquery"],function($){"use strict";void 0===$.mosaic&&($.mosaic={}),$.mosaic.initUpload=function(){$(".mosaic-panel",$.mosaic.document).bind("dragover",function(e){0===$(".mosaic-panel-dragging",$.mosaic.document).length&&($(".mosaic-selected-tile",$.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),$.mosaic.options.toolbar.trigger("selectedtilechange"),$.mosaic.options.panels.mosaicSetResizeHandleLocation(),$.mosaic.addTile("image",'<img src="++resource++plone.app.mosaic.images/files.png" border="0" />'))}),document.addEventListener("drop",function(event){var dt,first,i,files,newtile,file,img,tile,xhr,boundary,data;for(dt=event.dataTransfer,files=dt.files,event.stopPropagation(),event.preventDefault(),$($.mosaic.document).trigger("mousedown"),first=!0,i=0;i<files.length;i+=1)file=files.item(i),0===file.mediaType.indexOf("image")?(first?(img=$(".mosaic-selected-tile",$.mosaic.document).children(".mosaic-tile-content").children("img"),tile=$(".mosaic-selected-tile",$.mosaic.document),first=!1):(newtile=$($.mosaic.document.createElement("div")).addClass("movable removable mosaic-tile mosaic-image-tile").append($($.mosaic.document.createElement("div")).addClass("mosaic-tile-content").append($($.mosaic.document.createElement("img")).attr("border",0))),$(".mosaic-selected-tile",$.mosaic.document).after(newtile),newtile.mosaicInitTile(),newtile.mosaicAddDrag(),img=newtile.children(".mosaic-tile-content").children("img"),tile=newtile),tile.append($($.mosaic.document.createElement("div")).addClass("mosaic-tile-uploadprogress")),img.get(0).src=file.getAsDataURL(),xhr=new XMLHttpRequest,xhr.upload.log=img,xhr.addEventListener("load",function(event){var response=eval("("+event.target.responseText+")");1===response.status?$.plone.notify({type:"error",title:"Error",message:response.message,sticky:!0}):$(event.target.upload.log).attr({src:response.url,alt:response.title}).parents(".mosaic-tile").children(".mosaic-tile-uploadprogress").fadeOut("slow",function(){$(this).remove()})},!1),xhr.upload.addEventListener("error",function(e){$.plone.notify({type:"error",title:"Error",message:"Error uploading file: "+e,sticky:!0})},!1),boundary="AJAX---------------------------AJAX",xhr.open("POST",$.mosaic.options.url+"/@@mosaic-upload",!0),xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+boundary),data="--"+boundary+"\r\n",data+="Content-Disposition: form-data; ",data+='name="uploadfile"; ',data+='filename="'+file.fileName+'"\r\n',data+="Content-Type: "+file.mediaType,data+="\r\n\r\n",data+=file.getAsBinary()+"\r\n",data+="--"+boundary+"--\r\n",xhr.sendAsBinary(data)):$.plone.notify({type:"warning",title:"Warning",message:"The filetype of file "+file.fileName+" is unsupported",sticky:!0});first&&$(".mosaic-button.remove").mosaicExecAction()},!1)}}),define("mosaic-url/mosaic.editor",["jquery"],function(e){"use strict";void 0===e.mosaic&&(e.mosaic={}),e.mosaic.editor={},e.mosaic.execCommand=function(e,t,a){tinymce.activeEditor&&tinymce.activeEditor.execCommand(e,t,a)},e.mosaic.editor.applyFormat=function(e){tinymce.activeEditor&&tinyMCE.activeEditor.formatter.apply(e)},e.mosaic.editor.registerFormat=function(e,t){tinymce.activeEditor&&tinymce.activeEditor.formatter.register(e,t)}}),define("mosaic-url/mosaic.undo",["jquery"],function(i){"use strict";void 0===i.mosaic&&(i.mosaic={}),i.mosaic.undo=function(){},i.mosaic.undo.init=function(){i.mosaic.undo.undoManager=new i.mosaic.undo.UndoManager(10,function(e){for(var t=0;t<e.length;t+=1)i("#"+e[t].target,i.mosaic.document).html(e[t].source)})},i.mosaic.undo.snapshot=function(){var e=[];i(".mosaic-panel",i.mosaic.document).each(function(){e.push({target:i(this).attr("id"),source:i(this).html()})}),void 0===i.mosaic.undo.undoManager&&i.mosaic.undo.init(),i.mosaic.undo.undoManager.add(e)},i.mosaic.undo.hasInitial=function(){return 0<i.mosaic.undo.undoManager.stack.size()},i.mosaic.undo.undo=function(){i.mosaic.undo.undoManager.undo()},i.mosaic.undo.redo=function(){i.mosaic.undo.undoManager.redo()},i.mosaic.undo.Stack=function(e){this.maxsize=void 0===e?10:e,this.stack=[]},i.mosaic.undo.Stack.prototype.size=function(){return this.stack.length},i.mosaic.undo.Stack.prototype.add=function(e){this.stack.length>=this.maxsize&&this.stack.pop(),this.stack.unshift(e)},i.mosaic.undo.Stack.prototype.get=function(e){return this.stack[e]},i.mosaic.undo.UndoManager=function(e,t,a){this.stack=new i.mosaic.undo.Stack(e),this.pointer=0,this.handler=t,void 0!==a&&this.stack.add(a)},i.mosaic.undo.UndoManager.prototype.add=function(e){this.stack.add(e)},i.mosaic.undo.UndoManager.prototype.undo=function(){var e=this.stack.get(this.pointer+1);e&&(this.handler(e),this.pointer+=1)},i.mosaic.undo.UndoManager.prototype.redo=function(){var e=this.stack.get(this.pointer-1);e&&(this.handler(e),this.pointer-=1)}}),define("mosaic-url/mosaic.overlay",["jquery"],function(m){"use strict";void 0===m.mosaic&&(m.mosaic={}),m.mosaic.overlay={},m.fn.mosaicOverlay=function(){return void 0===m.mosaic.overlay_hide_fields&&(m.mosaic.overlay_hide_fields=!0),this.each(function(){var e=m(this),t=m("form",e),a=m("h1",e),i=m('<div class="plone-modal-wrapper mosaic-overlay"><div class="mosaic-modal fade in" style="position: absolute; padding: 20px;"><div class="plone-modal-dialog"><div class="plone-modal-content"><div class="plone-modal-header"><a class="plone-modal-close"></a></div><div class="plone-modal-body"></div><div class="plone-modal-footer"><div class="pattern-modal-buttons"></div></div></div></div></div></div>');m(".plone-modal-header",i).append("<h2>"+a.text()+"</h2>"),m(".plone-modal-body",i).append(t),m(document.body,m.mosaic.document).append(i),e.hide(),m(document.body,m.mosaic.document).prepend(m(document.createElement("div")).addClass("mosaic-overlay-blocker"))})},m.mosaic.overlay.open=function(e,t){var a,i,o,s,n,c,l,r;if(m(".mosaic-overlay").show().addClass("active"),m(".mosaic-overlay-blocker").show(),m("body").addClass("plone-modal-open"),a=m(".mosaic-overlay").find("form"),0===m(".mosaic-overlay-ok-button").length&&(m(".mosaic-overlay .formControls").children("input").hide(),m(".mosaic-overlay .pattern-modal-buttons").append(m(document.createElement("input")).attr({type:"button",value:"Done"}).addClass("mosaic-overlay-ok-button plone-btn plone-btn-primary").click(function(){m.mosaic.overlay.close()})),m(".mosaic-overlay .plone-modal-close").off("click").on("click",function(e){e.preventDefault(),m.mosaic.overlay.close()}),m(".mosaic-overlay .plone-modal-header h2").html("Properties")),"all"===e&&m.mosaic.overlay_hide_fields){for((i=a.find("nav")).removeClass("mosaic-hidden"),a.find("fieldset").children().removeClass("mosaic-hidden"),a.find("fieldset").removeClass("active"),i.find("a").removeClass("active"),a.find(m.mosaic.options.customContentLayout_selector).addClass("mosaic-hidden"),a.find(m.mosaic.options.contentLayout_selector).addClass("mosaic-hidden"),0<m(".mosaic-IDublinCore-title-tile").size()?a.find("#formfield-form-widgets-IDublinCore-title").addClass("mosaic-hidden"):a.find("#formfield-form-widgets-IDublinCore-title").removeClass("mosaic-hidden"),0<m(".mosaic-IDublinCore-description-tile").size()?a.find("#formfield-form-widgets-IDublinCore-description").addClass("mosaic-hidden"):a.find("#formfield-form-widgets-IDublinCore-description").removeClass("mosaic-hidden"),s=0;s<m.mosaic.options.tiles.length;s+=1)"fields"===m.mosaic.options.tiles[s].name&&(o=m.mosaic.options.tiles[s]);for(s=0;s<o.tiles.length;s+=1)c=o.tiles[s],0!==m.mosaic.options.panels.find(".mosaic-"+c.name+"-tile").length&&m(m.mosaic.document.getElementById(c.id)).addClass("mosaic-hidden");a.find("fieldset").each(function(){0===m(this).children("div:not(.mosaic-hidden)").length&&m("a[href=#fieldsetlegend-"+m(this).attr("id").split("-")[1]+"]").addClass("mosaic-hidden")}),(n=i.children(":not(.mosaic-hidden)")).eq(0).addClass("active");var d=a.find("#fieldset-"+n.eq(0).attr("href").split("-")[1]);0===d.size()&&(d=a.find("fieldset:not(.mosaic-hidden)").eq(0)),d.addClass("active")}else"field"===e&&(r=(l=m("#"+t.id)).parents("fieldset"),a.find("fieldset").removeClass("active"),r.addClass("active"),r.children().addClass("mosaic-hidden"),l.removeClass("mosaic-hidden"),a.find("nav").addClass("mosaic-hidden"))},m.mosaic.overlay.close=function(){m(".mosaic-overlay").hide().removeClass("active"),m(".mosaic-overlay-blocker").hide(),m("body").removeClass("plone-modal-open")}}),window.DEBUG=!0,require(["jquery","mockup-patterns-base","mosaic-url/mosaic.core","mosaic-url/mosaic.layout","mosaic-url/mosaic.toolbar","mosaic-url/mosaic.actions","mosaic-url/mosaic.upload","mosaic-url/mosaic.editor","mosaic-url/mosaic.undo","mosaic-url/mosaic.overlay"],function(e,t){"use strict";return t.extend({name:"layout",trigger:".pat-layout",parser:"mockup",defaults:{attribute:"class"},init:function(){this.options.data.$el=this.$el,e.mosaic.init({data:this.options.data})}})}),define("/Users/nathan/wildcard/castle/castle.cms/src/plone.app.mosaic/src/plone/app/mosaic/browser/static/js/mosaic.pattern.js",function(){});
//# sourceMappingURL=plone-mosaic.js.map