!function(){function e(){}function i(){}function t(e,i){this._loggers={},this.name=e||"",this._parent=i||null,i||(this._enabled=!0,this._level=c.WARN)}function a(){return n}function o(e){n=e}Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var i=Array.prototype.slice.call(arguments,1),t=this,a=function(){},o=function(){return t.apply(this instanceof a&&e?this:e,i.concat(Array.prototype.slice.call(arguments)))};return a.prototype=this.prototype,o.prototype=new a,o});var s,n,c={DEBUG:10,INFO:20,WARN:30,ERROR:40,FATAL:50};e.prototype={output:function(e,i,t){if("undefined"!=typeof window.console&&"undefined"!=typeof console.log){e&&t.unshift(e+":");var a=t.join(" ");if(void 0===typeof console.info){var o;o=i<=c.DEBUG?"DEBUG":i<=c.INFO?"INFO":i<=c.WARN?"WARN":i<=c.ERROR?"ERROR":"FATAL",console.log("["+o+"] "+a)}else i<=c.DEBUG?(a="[DEBUG] "+a,console.log(a)):i<=c.INFO?console.info(a):i<=c.WARN?console.warn(a):console.error(a)}}},i.prototype={output:function(e,i,t){e&&t.unshift(e+":"),i<=c.DEBUG?(t.unshift("[DEBUG]"),console.log.apply(console,t)):i<=c.INFO?console.info.apply(console,t):i<=c.WARN?console.warn.apply(console,t):console.error.apply(console,t)}},t.prototype={getLogger:function(e){for(var i=e.split("."),a=this,o=this.name?[this.name]:[];i.length;){var s=i.shift();o.push(s),s in a._loggers||(a._loggers[s]=new t(o.join("."),a)),a=a._loggers[s]}return a},_getFlag:function(e){var i=this;for(e="_"+e;null!==i;){if(void 0!==i[e])return i[e];i=i._parent}return null},setEnabled:function(e){this._enabled=!!e},isEnabled:function(){this._getFlag("enabled")},setLevel:function(e){"number"==typeof e?this._level=e:"string"==typeof e&&(e=e.toUpperCase(),e in c&&(this._level=c[e]))},getLevel:function(){return this._getFlag("level")},log:function(e,i){!i.length||!this._getFlag("enabled")||e<this._getFlag("level")||(i=Array.prototype.slice.call(i),n.output(this.name,e,i))},debug:function(){this.log(c.DEBUG,arguments)},info:function(){this.log(c.INFO,arguments)},warn:function(){this.log(c.WARN,arguments)},error:function(){this.log(c.ERROR,arguments)},fatal:function(){this.log(c.FATAL,arguments)}},o(window.console&&window.console.log&&"function"==typeof window.console.log.apply?new i:new e),s=new t;for(var l,r=/loglevel(|-[^=]+)=([^&]+)/g;null!==(l=r.exec(window.location.search));){var d=""===l[1]?s:s.getLogger(l[1].slice(1));d.setLevel(l[2].toUpperCase())}var m={Level:c,getLogger:s.getLogger.bind(s),setEnabled:s.setEnabled.bind(s),isEnabled:s.isEnabled.bind(s),setLevel:s.setLevel.bind(s),getLevel:s.getLevel.bind(s),debug:s.debug.bind(s),info:s.info.bind(s),warn:s.warn.bind(s),error:s.error.bind(s),fatal:s.fatal.bind(s),getWriter:a,setWriter:o};"function"==typeof define?define("logging",[],function(){return m}):window.logging=m}(),define("pat-logger",["logging"],function(e){var i=e.getLogger("patterns");return i}),define("mosaic-url/mosaic.tile",["jquery","pat-logger","underscore","mockup-utils","pat-registry","mockup-patterns-tinymce","tinymce"],function(e,i,t,a,o,s,n){"use strict";var c=i.getLogger("pat-mosaic"),l=function(i){var t=this;t.$el=e(i),t.$el.is(".mosaic-tile")||(t.$el=t.$el.parents(".mosaic-tile")),t.$el.children(".mosaic-tile-content").off("blur").on("blur",function(){var i=t.getType();if("plone.app.standardtiles.rawhtml"===i){var o=t.getEditUrl();if(o){var s=t.getHtmlContent();if(s===t.$el.data("lastSavedData"))return;if(t.$el.data("activeSave"))return;t.$el.data("activeSave",!0),e.ajax({url:o,method:"POST",data:{"plone.app.standardtiles.rawhtml.content":s,_authenticator:a.getAuthenticator(),"buttons.save":"Save"}}).always(function(){t.$el.data("lastSavedData",s),t.$el.data("activeSave",!1)})}}})};return l.prototype.getHtmlContent=function(){return this.$el.children(".mosaic-tile-content").html()},l.prototype.getEditUrl=function(){var i=this.getUrl();return(i=i.replace(/@@/,"@@edit-tile/"))?(i.match(/^\.\/.*/)&&(i=e.mosaic.options.context_url+i.replace(/^\./,"")),i):void 0},l.prototype.getUrl=function(){var i=this.$el.find(".tileUrl").html();if(!i){var t=this.$el.find("[data-tileUrl]");t.size()>0&&(i=t.attr("data-tileUrl"))}return i||(i=this.$el.find("[data-tile]").attr("data-tile")),i&&(i=i.replace(e.mosaic.options.context_url,"./"),i=i.replace(/^\.\/\//,"./"),e.mosaic.hasContentLayout?-1===i.indexOf("X-Tile-Persistent")&&(i+=-1===i.indexOf("?")?"?":"&",i+="X-Tile-Persistent=yes"):-1!==i.indexOf("X-Tile-Persistent")&&(i=i.replace("X-Tile-Persistent=yes","").replace("&&","&"))),i},l.prototype.getType=function(){var i="",t=this.$el,a=t.attr("class"),o=[];return a&&(o=t.attr("class").split(" "),e(o).each(function(){var e;e=this.match(/^mosaic-([\w.\-]+)-tile$/),null!==e&&"selected"!==e[1]&&"new"!==e[1]&&"read-only"!==e[1]&&"helper"!==e[1]&&"original"!==e[1]&&(i=e[1])})),i||c.error("Could not find tile type on element with classes: "+o.join(", ")),i},l.prototype.getConfig=function(){for(var i,t=this.getType(),a=0;a<e.mosaic.options.tiles.length;a+=1){for(var o=!1,s=e.mosaic.options.tiles[a],n=0;n<s.tiles.length;n+=1){if("field"===s.tiles[n].tile_type){var l=s.tiles[n].widget.split(".");switch(l=l[l.length-1]){case"TextWidget":case"TextFieldWidget":case"TextAreaWidget":case"TextAreaFieldWidget":case"TextLinesWidget":case"TextLinesFieldWidget":case"WysiwygWidget":case"WysiwygFieldWidget":case"RichTextWidget":case"RichTextFieldWidget":s.tiles[n].settings=!1;break;default:s.tiles[n].settings=!0}}if(s.tiles[n].name===t){i=s.tiles[n],o=!0;break}}if(o)break}return i?i:void c.error("Could not load tile config for tile type: "+t)},l.prototype.getHtmlBody=function(){var i="",t="",a=this.$el.attr("class").split(" ");t=this.getType(),a=e(a).filter(function(){switch(this){case"mosaic-new-tile":case"mosaic-helper-tile":case"mosaic-original-tile":case"mosaic-selected-tile":return!1;default:return!0}}).toArray();var o=this.getConfig();switch(o.tile_type){case"text":i+='          <div class="'+a.join(" ")+'">\n',i+='          <div class="mosaic-tile-content">\n',i+=this.$el.children(".mosaic-tile-content").html().replace(/^\s+|\s+$/g,"")+"\n",i+="          </div>\n",i+="          </div>\n";break;case"app":i+='          <div class="'+a.join(" ")+'">\n',i+='          <div class="mosaic-tile-content">\n',i+='          <div data-tile="'+this.getUrl()+'"></div>\n',i+="          </div>\n",i+="          </div>\n";break;case"field":i+='          <div class="'+a.join(" ")+'">\n',i+='          <div class="mosaic-tile-content">\n';var s="./@@plone.app.standardtiles.field?field="+t;i+='          <div data-tile="'+s+'"></div>\n',i+="          </div>\n",i+="          </div>\n",this.saveForm()}return i},l.prototype.isRichText=function(e){return void 0===e&&(e=this.getConfig()),e&&this.$el.hasClass("mosaic-read-only-tile")===!1&&!this.$el.hasClass("mosaic-tile-loading")&&("text"===e.tile_type&&e.rich_text||"app"===e.tile_type&&e.rich_text||"field"===e.tile_type&&e.read_only===!1&&("z3c.form.browser.text.TextWidget"===e.widget||"z3c.form.browser.text.TextFieldWidget"===e.widget||"z3c.form.browser.textarea.TextAreaWidget"===e.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===e.widget||"z3c.form.browser.textlines.TextLinesWidget"===e.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===e.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===e.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===e.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===e.widget||"plone.app.widgets.dx.RichTextWidget"===e.widget))?!0:!1},l.prototype.initialize=function(){var i=this.getConfig();i&&i.read_only&&this.$el.addClass("mosaic-read-only-tile"),this.isRichText()&&this.setupWysiwyg(),this.$el.prepend(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-inner-border"))),i&&this.$el.prepend(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-label").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-label-content").html(i.label)).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-label-left"))),this.makeMovable(),i&&i.settings&&this.$el.hasClass("mosaic-read-only-tile")===!1&&this.$el.prepend(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-info-icon"));var a=this;t.each(["top","bottom","right","left"],function(i){a.$el.prepend(e(e.mosaic.document.createElement("div")).addClass("mosaic-divider mosaic-divider-"+i).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-divider-dot")))})},l.prototype.makeMovable=function(){this.$el.hasClass("movable")&&e.mosaic.options.canChangeLayout&&!e.mosaic.hasContentLayout&&this.$el.prepend(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-drag-handle"))},l.prototype.initializeContent=function(){var i,t,a,o,s,n=this,c=e("body",e.mosaic.document).attr("data-base-url");c||(c=e("head > base",e.mosaic.document).attr("href"));var l=this.getUrl(),r=this.getConfig();if(r)if("field"===r.tile_type){switch(o="","IDublinCore-title"===r.name?(t='<h1 class="documentFirstHeading">',a="</h1>"):"IDublinCore-description"===r.name?(t='<p class="documentDescription">',a="</p>"):(t="<div>",a="</div>"),r.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":o=t+e("#"+r.id).find("input").attr("value")+a;break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":s=e("#"+r.id).find("textarea").val().split("\n"),o+=t;for(var d=0;d<s.length;d+=1)o+=s[d]+"<br/>";o+=a;break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":o=e("#"+r.id).find("textarea").val();break;default:o='<div class="discreet">Placeholder for field:<br/><b>'+r.label+"</b></div>"}n.fillContent(o)}else r&&(n.$el.addClass("mosaic-tile-loading"),i=c?[c,l].join("/").replace(/\/+\.\//g,"/"):l,i+=-1===i.indexOf("?")?"?":"&",i+="_layouteditor=true",e.ajax({type:"GET",url:i,success:function(t){n.$el.removeClass("mosaic-tile-loading"),t=e.mosaic.getDomTreeFromHtml(t),e.mosaic.addHeadTags(l,t);var a=t.find(".temp_body_tag").html();n.fillContent(a,i);var o=n.getType();"plone.app.standardtiles.rawhtml"===o&&(n.$el.data("lastSavedData")||n.$el.data("lastSavedData",n.getHtmlContent()),n.setupWysiwyg())},error:function(){n.$el.removeClass("mosaic-tile-loading")}}))},l.prototype.fillContent=function(e,i){var t=this.$el.find("[data-tile]").parent();t.html(e),o.scan(t);var a=this.$el.children(".mosaic-tile-content");i&&a.size()>0&&a.attr("data-tileUrl",i.replace(/&/gim,"&amp;"))},l.prototype.select=function(){if(this.$el.hasClass("mosaic-selected-tile")===!1&&this.$el.hasClass("mosaic-read-only-tile")===!1){var i=e(".mosaic-selected-tile",e.mosaic.document);if(1===i.size()){var t=new l(i);t.blur()}this.$el.addClass("mosaic-selected-tile"),this.focus()}},l.prototype._change=function(){e.mosaic.options.toolbar.trigger("selectedtilechange"),e.mosaic.options.panels.mosaicSetResizeHandleLocation(),this.saveForm()},l.prototype.blur=function(){this.$el.removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),this._change()},l.prototype.focus=function(){this.$el.children(".mosaic-tile-content").focus(),this._change()},l.prototype.saveForm=function(){var i,t,a,o,s=this.getType(),c=this.getConfig();if(c&&"field"===c.tile_type&&c.read_only===!1&&("z3c.form.browser.text.TextWidget"===c.widget||"z3c.form.browser.text.TextFieldWidget"===c.widget||"z3c.form.browser.textarea.TextAreaWidget"===c.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===c.widget||"z3c.form.browser.textlines.TextLinesWidget"===c.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===c.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===c.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===c.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===c.widget||"plone.app.widgets.dx.RichTextWidget"===c.widget))switch(c.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":var l=e(".mosaic-panel .mosaic-"+s+"-tile",e.mosaic.document);l.size()>1&&(l=l.filter(function(){return e(".mosaic-tile-control",this).length>0}));var r=l.find(".mosaic-tile-content > *").text();e("#"+c.id).find("input").attr("value",r);break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":a="",o="IDublinCore-description"===c.name?" ":"\n",e(".mosaic-panel .mosaic-"+s+"-tile",e.mosaic.document).find(".mosaic-tile-content > *").each(function(){a+=e(this).html().replace(/<br[^>]*>/gi,o).replace(/^\s+|\s+$/g,"")+o}),a=a.replace(/^\s+|\s+$/g,""),e("#"+c.id).find("textarea").val(a);break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":if(i=e(document.getElementById(c.id)).find("textarea").attr("id"),t=n.get(i)){var d=e(".mosaic-"+s+"-tile",e.mosaic.document).find(".mosaic-tile-content").html();t.setContent(d),e(document.getElementById(c.id)).find("textarea").val(d)}}},l.prototype.setupWysiwyg=function(){var i,t=this.$el.find(".mosaic-tile-content");try{t.data("pattern-tinymce").destroy(),t.removeData("pattern-tinymce")}catch(a){}for(var o=1+Math.floor(1e5*Math.random());e("#mosaic-rich-text-init-"+o,e.mosaic.document).length>0;)o=1+Math.floor(1e5*Math.random());var n="mosaic-rich-text-init-"+o;t.attr("id",n),t.siblings(".mosaic-rich-text-toolbar").remove();var c=e('<div class="mosaic-rich-text-toolbar"></div>').attr("id",t.attr("id")+"-panel");t.before(c);var r,d,m,p,u,h,f=this.getType();for(r=e.mosaic.options.default_available_actions,m=0;m<e.mosaic.options.tiles.length;m+=1)for(d=e.mosaic.options.tiles[m],p=0;p<d.tiles.length;p+=1)d.tiles[p].name===f&&(r=r.concat(d.tiles[p].available_actions));for(u=[],m=0;m<e.mosaic.options.richtext_toolbar.length;m+=1){for(d=e.mosaic.options.richtext_toolbar[m],p=0;p<d.actions.length;p+=1)e.inArray(d.actions[p].name,r)>-1&&u.push(d.actions[p].action);u.length&&"|"!=u[u.length-1]&&u.push("|")}for(u.length&&"|"==u[u.length-1]&&u.pop(),h=[],m=0;m<e.mosaic.options.richtext_contextmenu.length;m+=1){for(d=e.mosaic.options.richtext_contextmenu[m],p=0;p<d.actions.length;p+=1)e.inArray(d.actions[p].name,r)>-1&&h.push(d.actions[p].action);h.length&&"|"!=h[h.length-1]&&h.push("|")}h.length&&"|"==h[h.length-1]&&h.pop();var g=function(){0===t.text().replace(/^\s+|\s+$/g,"").length?(t.addClass("mosaic-tile-content-empty"),t.empty().append("<p></p>")):t.removeClass("mosaic-tile-content-empty")},v=0,y=function(){clearTimeout(v),v=setTimeout(g,100)};e("body").removeAttr("data-pat-tinymce"),this.$el.offset().left>e(window).width()/2&&c.css("right","0"),i=new s(t,e.extend(!0,{},e.mosaic.options.tinymce,{inline:!1,tiny:{body_id:n,selector:"#"+n,inline:!0,fixed_toolbar_container:"#"+c.attr("id"),theme_advanced_toolbar_align:"right",menubar:!1,toolbar:u.join(" ")||!1,statusbar:!1,contextmenu:h.join(" ")||!1,plugins:e.mosaic.options.tinymce.tiny.plugins.concat(h.length?["contextmenu"]:[]),setup:function(i){i.on("focus",function(i){if(i.target.id){var t=e("#"+i.target.id).parents(".mosaic-tile").first();if(t.size()>0){var a=new l(t);a.select()}}}),i.on("keyup",y),y()}}})),t.addClass("mosaic-rich-text")},l.validTile=function(i){var t=e(i);return t.is(".mosaic-tile")?!0:t.parents(".mosaic-tile").size()>0?!0:!1},l}),define("mosaic-url/mosaic.panel",["jquery","pat-logger","underscore"],function(e,i,t){"use strict";var a=i.getLogger("pat-mosaic"),o=function(i){this.$el=e(i)};return o.prototype.initialize=function(i){var t,a=this.$el.attr("data-panel"),o=e("[data-panel="+a+"]",e.mosaic.document);"content"===a&&0===o.length&&e("#"+a,e.mosaic.document).each(function(){o=e(this),o.attr("data-panel",a)}),"content"===a?(t=o.attr("id"),0===e(".mosaic-original-content",e.mosaic.document).size()?(o.before(e(document.createElement("div")).attr("id",t).attr("class",o.attr("class")).addClass("mosaic-panel").attr("data-panel","content").html(i.find("[data-panel="+a+"]").html())),o.removeAttr("data-panel").removeAttr("id").addClass("mosaic-original-content")):o.replaceWith(e(document.createElement("div")).attr("id",t).attr("class",o.attr("class")).addClass("mosaic-panel").attr("data-panel","content").html(i.find("[data-panel="+a+"]").html()))):(o.attr("class",i.find("[data-panel="+a+"]").attr("class")),o.addClass("mosaic-panel"),o.html(i.find("[data-panel="+a+"]").html()))},o.prototype.prefill=function(){this.$el.hasClass("mosaic-panel")||(a.info(e(this)),e(this).addClass("mosaic-panel"),e(this).children().wrap(e('<div class="mosaic-grid-row"><div class="mosaic-grid-cell mosaic-width-full mosaic-position-leftmost"><div class="movable removable mosaic-tile mosaic-text-tile"><div class="mosaic-tile-content"></div></div></div></div>')))},o}),define("mosaic-url/mosaic.layout",["jquery","mosaic-url/mosaic.tile","pat-logger","underscore","pat-registry","mockup-patterns-modal"],function(e,i,t,a,o,s){"use strict";function n(e){switch(e){case 25:return"mosaic-width-quarter";case 33:return"mosaic-width-third";case 50:return"mosaic-width-half";case 66:case 67:return"mosaic-width-two-thirds";case 75:return"mosaic-width-three-quarters";case 100:return"mosaic-width-full"}return"mosaic-width-full"}function c(e){switch(e){case 0:return"mosaic-position-leftmost";case 25:return"mosaic-position-quarter";case 33:return"mosaic-position-third";case 50:return"mosaic-position-half";case 66:case 67:return"mosaic-position-two-thirds";case 75:return"mosaic-position-three-quarters"}return"mosaic-position-leftmost"}return"undefined"==typeof e.mosaic&&(e.mosaic={}),e.mosaic.layout={widthClasses:["mosaic-width-quarter","mosaic-width-third","mosaic-width-half","mosaic-width-two-thirds","mosaic-width-three-quarters","mosaic-width-full"],positionClasses:["mosaic-position-leftmost","mosaic-position-quarter","mosaic-position-third","mosaic-position-half","mosaic-position-two-thirds","mosaic-position-three-quarters"]},e.fn.mosaicLayout=function(){var t=function(t){if(27===t.keyCode){var a=e(".mosaic-original-tile",e.mosaic.document);a.length>0?a.each(function(){e(this).addClass("mosaic-drag-cancel"),e(this).hasClass("mosaic-helper-tile-new")?e(document).trigger("mousedown"):e(document).trigger("mouseup")}):e(".mosaic-selected-tile",e.mosaic.document).each(function(){var e=new i(this);e.blur()}),e(".mosaic-resize-handle-helper",e.mosaic.document).each(function(){e(this).parents("[data-panel]").removeClass("mosaic-panel-resizing"),e(this).parent().removeClass("mosaic-row-resizing"),e(this).parent().children(".mosaic-resize-placeholder").remove(),e(this).remove()}),e.mosaic.overlay.app&&e.mosaic.overlay.app.hide()}};e(e.mosaic.document).off("keydown").on("keydown",t);var a=function(i){var t;if(i.target?t=i.target:i.srcElement&&(t=i.srcElement),!(e(t).parents(".mce-panel").length>0)){0===e(t).parents(".mosaic-tile").length&&0===e(t).parents(".mosaic-toolbar").length&&(e(".mosaic-selected-tile",e.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),e.mosaic.options.toolbar.trigger("selectedtilechange"),e.mosaic.options.panels.mosaicSetResizeHandleLocation());var a=e(".mosaic-helper-tile-new",e.mosaic.document);a.length>0&&a.each(function(){e(this).mosaicHandleDragEnd()})}};e(e.mosaic.document).off("mousedown").on("mousedown",a);var l=function(i){e(".mosaic-helper-tile-new",e.mosaic.document).each(function(){var t=e(this).parent().offset();e(this).css("top",i.pageY+3-t.top),e(this).css("left",i.pageX+3-t.left)}),e(".mosaic-resize-handle-helper",e.mosaic.document).each(function(){var t,a,o=e(this),s=o.parent(),l=parseFloat(i.pageX-s.offset().left-4),r=l/o.data("row_width")*100,d=25,m=1e3;if(e([25,33,50,67,75]).each(function(){a=Math.abs(this-r),m>a&&(d=this,m=a)}),2===o.data("nr_of_columns"))o.data("column_sizes").split(" ")[0]!==d&&(s.children(".mosaic-resize-placeholder").each(function(i){0===i?e(this).removeClass(e.mosaic.layout.widthClasses.join(" ")).addClass(n(parseInt(d,10))):(e(this).removeClass(e.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(e.mosaic.layout.widthClasses.join(" ")).addClass(n(parseInt(100-d,10))).addClass(c(parseInt(d,10)).replace("position","resize")),o.removeClass(e.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(c(parseInt(d,10)).replace("position","resize")))}),e(this).data("column_sizes",d+" "+(100-d)));else{var p=e(this).data("resize_handle_index");if(1===p){if(o.data("column_sizes").split(" ")[e(this).data("resize_handle_index")-1]!==d&&parseInt(d,10)<=50)switch(t=s.children(".mosaic-resize-placeholder"),t.removeClass(e.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(e.mosaic.layout.widthClasses.join(" ")),o.removeClass(e.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(c(parseInt(d,10)).replace("position","resize")),parseInt(d,10)){case 25:e(t.get(0)).addClass(c(0).replace("position","resize")+" "+n(25)),e(t.get(1)).addClass(c(25).replace("position","resize")+" "+n(50)),e(t.get(2)).addClass(c(75).replace("position","resize")+" "+n(25)),o.data("column_sizes","25 50 25");break;case 33:e(t.get(0)).addClass(c(0).replace("position","resize")+" "+n(33)),e(t.get(1)).addClass(c(33).replace("position","resize")+" "+n(33)),e(t.get(2)).addClass(c(66).replace("position","resize")+" "+n(33)),o.data("column_sizes","33 33 33");break;case 50:e(t.get(0)).addClass(c(0).replace("position","resize")+" "+n(50)),e(t.get(1)).addClass(c(50).replace("position","resize")+" "+n(25)),e(t.get(2)).addClass(c(75).replace("position","resize")+" "+n(25)),o.data("column_sizes","50 25 25")}}else if(o.data("column_sizes").split(" ")[e(this).data("resize_handle_index")]!==100-d&&parseInt(d,10)>=50)switch(t=s.children(".mosaic-resize-placeholder"),t.removeClass(e.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(e.mosaic.layout.widthClasses.join(" ")),o.removeClass(e.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(c(parseInt(d,10)).replace("position","resize")),parseInt(d,10)){case 50:e(t.get(0)).addClass(c(0).replace("position","resize")+" "+n(25)),e(t.get(1)).addClass(c(25).replace("position","resize")+" "+n(25)),e(t.get(2)).addClass(c(50).replace("position","resize")+" "+n(50)),o.data("column_sizes","25 25 50");break;case 66:case 67:e(t.get(0)).addClass(c(0).replace("position","resize")+" "+n(33)),e(t.get(1)).addClass(c(33).replace("position","resize")+" "+n(33)),e(t.get(2)).addClass(c(66).replace("position","resize")+" "+n(33)),o.data("column_sizes","33 33 33");break;case 75:e(t.get(0)).addClass(c(0).replace("position","resize")+" "+n(25)),e(t.get(1)).addClass(c(25).replace("position","resize")+" "+n(50)),e(t.get(2)).addClass(c(75).replace("position","resize")+" "+n(25)),o.data("column_sizes","25 50 25")}}})};e(e.mosaic.document).off("mousemove").on("mousemove",l),e(e.mosaic.document).off("dragover").on("dragover",l);var r=function(t){e(".mosaic-resize-handle-helper",e.mosaic.document).each(function(){var t=e(this).parents("[data-panel]"),a=e(this).data("column_sizes").split(" ");e(this).parent().children(".mosaic-grid-cell").each(function(i){for(var t=0,o=0;i>o;o+=1)t+=parseInt(a[o],10);e(this).removeClass(e.mosaic.layout.positionClasses.join(" ")).removeClass(e.mosaic.layout.widthClasses.join(" ")).addClass(c(t)+" "+n(parseInt(a[i],10)))}),t.removeClass("mosaic-panel-resizing"),e(this).parent().removeClass("mosaic-row-resizing"),e(this).parent().children(".mosaic-resize-placeholder").remove(),e(this).parent().mosaicSetResizeHandles(),t.mosaicSetResizeHandleLocation();var o=t.find(".mosaic-selected-tile");if(o.size()>0){var s=new i(o);s.focus()}e(this).remove()})};e(e.mosaic.document).off("mouseup").on("mouseup",r);var d=function(i){if(e(this).parents("[data-panel]").hasClass("mosaic-panel-dragging")&&(e(".mosaic-selected-divider",e.mosaic.document).removeClass("mosaic-selected-divider"),e(this).hasClass("mosaic-original-tile")===!1&&e(this).hasClass("mosaic-tile-align-left")===!1&&e(this).hasClass("mosaic-tile-align-right")===!1)){var t=e(this).mosaicGetDirection(i),a=e(this).children(".mosaic-divider-"+t);if("left"===t||"right"===t){var o=a.parent().parent().parent();o.children(".mosaic-grid-cell").length>1?(a.height(o.height()+5),a.css("top",o.offset().top-a.parent().offset().top-5)):(a.height(a.parent().height()+5),a.css("top",-5))}a.addClass("mosaic-selected-divider")}};e(e.mosaic.document).off("mousemove",".mosaic-tile").on("mousemove",".mosaic-tile",d),e(e.mosaic.document).off("dragover",".mosaic-tile").on("dragover",".mosaic-tile",d),e(e.mosaic.document).off("click",".mosaic-tile").on("click",".mosaic-tile",function(){var e=new i(this);e.select()}),e(e.mosaic.document).off("click",".mosaic-info-icon").on("click",".mosaic-info-icon",function(){var t=new i(e(this).parents(".mosaic-tile")),a=t.getConfig();if("app"===a.tile_type){var n=t.getEditUrl();e(this).parents(".mosaic-tile").addClass("mosaic-edited-tile"),e.mosaic.overlay.app=new s(e(".mosaic-toolbar"),{ajaxUrl:n,loadLinksWithinModal:!0,buttons:'.formControls > input[type="submit"], .actionButtons > input[type="submit"]'}),e.mosaic.overlay.app.$el.off("after-render"),e.mosaic.overlay.app.on("after-render",function(i){e('input[name*="cancel"]',e.mosaic.overlay.app.$modal).off("click").on("click",function(){e.mosaic.overlay.app.hide(),e.mosaic.overlay.app=null,e(".mosaic-edited-tile",e.mosaic.document).removeClass("mosaic-edited-tile")}),e.mosaic.hasContentLayout&&e("form",e.mosaic.overlay.app.$modal).append(e('<input type="hidden" name="X-Tile-Persistent" value="yes" />'))}),e.mosaic.overlay.app.show(),e.mosaic.overlay.app.$el.off("formActionSuccess"),e.mosaic.overlay.app.on("formActionSuccess",function(i,a,s,n,c){var l=n.getResponseHeader("X-Tile-Url"),r=e.mosaic.getDomTreeFromHtml(a);if(l){e.mosaic.removeHeadTags(l),e.mosaic.addHeadTags(l,r);var d=r.find(".temp_body_tag").html(),m=e(".mosaic-edited-tile .mosaic-tile-content",e.mosaic.document);m.html(d),t.fillContent(d,l),o.scan(m),e.mosaic.overlay.app.hide(),e.mosaic.overlay.app=null}e(".mosaic-edited-tile",e.mosaic.document).removeClass("mosaic-edited-tile")})}else e.mosaic.overlay.open("field",a)});var m=this.length;return this.each(function(t){var a=e(this);if(a.find(".mosaic-tile").each(function(){new i(this).initialize()}),a.find(".mosaic-tile").mosaicAddDrag(),a.mosaicAddEmptyRows(),a.children(".mosaic-grid-row").mosaicSetResizeHandles(),t===m-1){var o=0,s=0;e.mosaic.options.panels.each(function(i){e(this).width()>o&&(o=e(this).width(),s=i)});var n=e.mosaic.options.panels.eq(s).find(".mosaic-tile:first");if(n.size()>0){var c=new i(n);c.select()}}})},e.fn.mosaicAddMouseMoveEmptyRow=function(){return this.each(function(){e(this).mousemove(function(){var i=e(this).parents("[data-panel]");i.hasClass("mosaic-panel-dragging")&&(e(".mosaic-selected-divider",e.mosaic.document).removeClass("mosaic-selected-divider"),e(this).children("div").addClass("mosaic-selected-divider"))})})},e.fn.mosaicAddEmptyRows=function(){return this.each(function(){e(this).find(".mosaic-grid-row").each(function(i){e(this).children(".mosaic-grid-cell").length>1&&(0===i&&e(this).before(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(e(e.mosaic.document.createElement("div")).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow()),(0===e(this).nextAll(".mosaic-grid-row").length||e(this).next().children(".mosaic-grid-cell").length>1)&&e(this).after(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(e(e.mosaic.document.createElement("div")).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow()))}),0===e(this).find(".mosaic-grid-row").length&&e(this).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(e(e.mosaic.document.createElement("div")).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow())})},e.fn.mosaicGetWidthClass=function(){var i;for(i in e.mosaic.layout.widthClasses)if(e.mosaic.layout.widthClasses.hasOwnProperty(i)&&e(this).hasClass(e.mosaic.layout.widthClasses[i]))return e.mosaic.layout.widthClasses[i];for(i in e.mosaic.layout.widthClasses)if(e.mosaic.layout.widthClasses.hasOwnProperty(i)&&e(this).hasClass(e.mosaic.layout.widthClasses[i].replace("position","resize")))return e.mosaic.layout.widthClasses[i];return e.mosaic.layout.widthClasses[0]},e.fn.mosaicGetPositionClass=function(){var i;for(i in e.mosaic.layout.positionClasses)if(e(this).hasClass(e.mosaic.layout.positionClasses[i]))return e.mosaic.layout.positionClasses[i];for(i in e.mosaic.layout.positionClasses)if(e(this).hasClass(e.mosaic.layout.positionClasses[i].replace("position","resize")))return e.mosaic.layout.positionClasses[i];return e.mosaic.layout.positionClasses[0]},e.fn.mosaicAddDrag=function(){return this.each(function(){var i=e(this),t=function(i){var t=e(".mosaic-helper-tile",e.mosaic.document),a=t.parents("[data-panel]").offset();t.css("top",i.pageY+3-a.top),t.css("left",i.pageX+3-a.left)},a=function(){var i=e(".mosaic-helper-tile",e.mosaic.document);e(e.mosaic.document).unbind("mousemove",t).unbind("mouseup",a),i.mosaicHandleDragEnd(),i.remove()};return i.each(function(){i.find("div.mosaic-drag-handle").unbind("mousedown").bind("mousedown",function(i){var o=i.pageX,s=i.pageY,n=function(i){if(Math.max(Math.abs(o-i.pageX),Math.abs(s-i.pageY))>=1){e.mosaic.options.panels.addClass("mosaic-panel-dragging"),e(".mosaic-selected-tile",e.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur();var c=e(i.target).parents(".mosaic-tile"),l=c.clone(!0);c.addClass("mosaic-original-tile"),c.parents("[data-panel]").append(l),l.css({width:c.width(),position:"absolute",opacity:.5}).addClass("mosaic-helper-tile"),e(e.mosaic.document).mousemove(t),e(e.mosaic.document).mouseup(a),e(e.mosaic.document).unbind("mousemove",n)}};e(e.mosaic.document).bind("mousemove",n),e(e.mosaic.document).bind("mouseup",function(){e(e.mosaic.document).unbind("mousemove",n)})})})})},e.fn.mosaicHandleDragEnd=function(){e(this).parents("[data-panel]");e.mosaic.options.panels.removeClass("mosaic-panel-dragging mosaic-panel-dragging-new");var t=e(".mosaic-selected-divider",e.mosaic.document),o=t.parent(),s="";a.each(["top","bottom","left","right"],function(e){t.hasClass("mosaic-divider-"+e)&&(s=e)}),t.removeClass("mosaic-selected-divider");var n=e(".mosaic-helper-tile-new",e.mosaic.document).length>0,c=e(".mosaic-original-tile",e.mosaic.document);if((0===t.length||o.hasClass("mosaic-helper-tile"))&&c.addClass("mosaic-drag-cancel"),c.hasClass("mosaic-drag-cancel"))c.removeClass("mosaic-drag-cancel"),
e.mosaic.options.panels.find(".mosaic-empty-row").remove(),n||c.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");else if(o.hasClass("mosaic-empty-row"))o.removeClass("mosaic-empty-row").attr("class",c.parents(".mosaic-grid-row").first().attr("class")).unbind("mousemove"),o.children(".mosaic-grid-cell").children("div").remove(),o.children(".mosaic-grid-cell").append(c.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile")),e(".mosaic-empty-row",e.mosaic.document).remove();else if(o.hasClass("mosaic-tile")===!1)e(".mosaic-empty-row",e.mosaic.document).remove(),n||c.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");else if(4!==o.parent().parent().children(".mosaic-grid-cell").length||"left"!==s&&"right"!==s){if(e(".mosaic-empty-row",e.mosaic.document).remove(),"top"===s)o.before(c.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"));else if("bottom"===s)o.after(c.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"));else if("left"===s||"right"===s)if(1===o.parent().parent().children(".mosaic-grid-cell").length){var l=o.prevAll();l.length>0&&(o.parent().parent().before(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(e(l.get().reverse()).clone(!0).mosaicAddDrag()))),l.remove());var r=o.nextAll();r.length>0&&(o.parent().parent().after(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(r.clone(!0).mosaicAddDrag()))),r.remove()),o.parent().removeClass(e.mosaic.layout.widthClasses.join(" ")).removeClass(e.mosaic.layout.positionClasses.join(" ")).addClass("mosaic-width-half"),"left"===s?o.parent().addClass("mosaic-position-half").before(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-leftmost").append(c.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))):o.parent().addClass("mosaic-position-leftmost").after(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-half").append(c.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))),o.parent().parent().mosaicSetResizeHandles()}else"left"===s?o.parent().before(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell").append(c.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))):o.parent().after(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell").append(c.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))),o.parent().parent().mosaicSetColumnSizes(),o.parent().parent().mosaicSetResizeHandles()}else e(".mosaic-empty-row",e.mosaic.document).remove(),n||c.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");var d=c.parent().parent();e(".mosaic-original-tile",e.mosaic.document).remove(),d.mosaicCleanupRow(),e.mosaic.options.panels.mosaicAddEmptyRows();var m=e(".mosaic-new-tile",e.mosaic.document);m.removeClass("mosaic-new-tile");var p=new i(m);e(".mosaic-rich-text",m).size()>0&&p.setupWysiwyg(),n&&p.select()},e.fn.mosaicSetColumnSizes=function(){return this.each(function(){var i=e(this).children(".mosaic-grid-cell").length;e(this).children(".mosaic-grid-cell").each(function(t){switch(e(this).removeClass(e.mosaic.layout.widthClasses.join(" ")).removeClass(e.mosaic.layout.positionClasses.join(" ")),i){case 1:e(this).addClass("mosaic-width-full mosaic-position-leftmost");break;case 2:switch(t){case 0:e(this).addClass("mosaic-width-half mosaic-position-leftmost");break;case 1:e(this).addClass("mosaic-width-half mosaic-position-half")}break;case 3:switch(t){case 0:e(this).addClass("mosaic-width-third mosaic-position-leftmost");break;case 1:e(this).addClass("mosaic-width-third mosaic-position-third");break;case 2:e(this).addClass("mosaic-width-third mosaic-position-two-thirds")}break;case 4:switch(t){case 0:e(this).addClass("mosaic-width-quarter mosaic-position-leftmost");break;case 1:e(this).addClass("mosaic-width-quarter mosaic-position-quarter");break;case 2:e(this).addClass("mosaic-width-quarter mosaic-position-half");break;case 3:e(this).addClass("mosaic-width-quarter mosaic-position-three-quarters")}}})})},e.fn.mosaicSetResizeHandles=function(){return this.each(function(){e(this).children(".mosaic-resize-handle").remove();var i=e(this).children(".mosaic-grid-cell").length;switch(i){case 2:e(this).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-one "+e(e(this).children(".mosaic-grid-cell").get(1)).mosaicGetPositionClass().replace("position","resize")));break;case 3:e(this).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-one "+e(e(this).children(".mosaic-grid-cell").get(1)).mosaicGetPositionClass().replace("position","resize"))),e(this).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-two "+e(e(this).children(".mosaic-grid-cell").get(2)).mosaicGetPositionClass().replace("position","resize")))}e(this).children(".mosaic-resize-handle").mousedown(function(){var i=[];e(this).parent().children(".mosaic-grid-cell").each(function(){switch(e(this).mosaicGetWidthClass()){case"mosaic-width-half":i.push("50");break;case"mosaic-width-quarter":i.push("25");break;case"mosaic-width-third":i.push("33");break;case"mosaic-width-two-thirds":i.push("66");break;case"mosaic-width-three-quarters":i.push("75")}e(this).parent().append(e(e.mosaic.document.createElement("div")).addClass("mosaic-resize-placeholder "+e(this).mosaicGetWidthClass()+" "+e(this).mosaicGetPositionClass().replace("position","resize")).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-resize-placeholder-inner-border")))});var t=1;return e(this).hasClass("mosaic-resize-handle-two")&&(t=2),e(this).parent().append(e(e.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-helper").addClass(e(this).mosaicGetPositionClass().replace("position","resize")).data("row_width",e(this).parent().width()).data("nr_of_columns",e(this).parent().children(".mosaic-grid-cell").length).data("column_sizes",i.join(" ")).data("resize_handle_index",t)),e(this).parents("[data-panel]").addClass("mosaic-panel-resizing"),e(this).parent().addClass("mosaic-row-resizing"),e(".mosaic-selected-tile",e.mosaic.document).children(".mosaic-tile-content").blur(),!1})})},e.fn.mosaicCleanupRow=function(){return this.each(function(){var i=e(this);if(i.children(".mosaic-grid-cell").each(function(){0===e(this).children().length&&(e(this).remove(),i.mosaicSetColumnSizes())}),0===i.find(".mosaic-tile").length){var t=i;if(i.nextAll(".mosaic-grid-row").length>0)i=i.next(".mosaic-grid-row");else{if(!(i.prevAll(".mosaic-grid-row").length>0))return void i.remove();i=i.prev(".mosaic-grid-row")}t.remove()}i.prevAll(".mosaic-grid-row").length>0&&1===i.children(".mosaic-grid-cell").length&&1===i.prev().children(".mosaic-grid-cell").length&&(i.children(".mosaic-grid-cell").prepend(i.prev().children(".mosaic-grid-cell").children(".mosaic-tile").clone(!0).mosaicAddDrag()),i.prev().remove()),i.nextAll(".mosaic-grid-row").length>0&&1===i.children(".mosaic-grid-cell").length&&1===i.next().children(".mosaic-grid-cell").length&&(i.children(".mosaic-grid-cell").append(i.next().children(".mosaic-grid-cell").children(".mosaic-tile").clone(!0).mosaicAddDrag()),i.next().remove()),i.mosaicSetResizeHandles()})},e.fn.mosaicSetResizeHandleLocation=function(){var i=e(this);i.children(".mosaic-grid-row").each(function(){var i=e(this),t=i.children(".mosaic-grid-cell");(2===t.length||3===t.length)&&(i.children(".mosaic-resize-handle").removeClass("mosaic-resize-handle-left mosaic-resize-handle-center mosaic-resize-handle-right"),e(t.get(0)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(i.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-left"),i.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-center")):e(t.get(1)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(i.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-right"),i.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-left")):3===t.length&&e(t.get(2)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(i.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-center"),i.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-right")):(i.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-center"),i.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-center")))})},e.fn.mosaicGetDirection=function(i){var t=parseFloat(e(this).width()),a=parseFloat(e(this).height()),o=parseFloat(i.pageX-e(this).offset().left-t/2),s=parseFloat(i.pageY-e(this).offset().top-a/2),n=t/2,c=a/2;return 0>o?0>s?-1*n/(-1*c)>o/s?"top":"left":-1*n/c>o/s?"left":"bottom":0>s?1*n/(-1*c)>o/s?"right":"top":n/c>o/s?"bottom":"right"},e.mosaic.disableEditHtmlSource=function(){e(".mosaic-rich-text-textarea",e.mosaic.document).each(function(){var t,a;a=e(this).val(),t=e(this).parent(),t.html(a);var o=new i(e(this).parent());o.setupWysiwyg()})},e.mosaic.addAppTile=function(i,t){e.mosaic.overlay.app&&e.mosaic.overlay.app.hide(),e.ajax({type:"GET",url:t,success:function(a){a=e.mosaic.getDomTreeFromHtml(a),e.mosaic.addHeadTags(t,a),e.mosaic.addTile(i,a.find(".temp_body_tag").html(),t)}})},e.mosaic.addAppTileHTML=function(i,t,a){var o;o=e.mosaic.getDomTreeFromHtml(t),e.mosaic.addHeadTags(a,o),e.mosaic.addTile(i,o.find(".temp_body_tag").html(),a)},e.mosaic.editAppTile=function(i){e.mosaic.overlay.close(),window.parent.focus(),e.ajax({type:"GET",url:i,success:function(t){t=e.mosaic.getDomTreeFromHtml(t),e.mosaic.removeHeadTags(i),e.mosaic.addHeadTags(i,t);var a=e(".mosaic-selected-tile .mosaic-tile-content",e.mosaic.document);a.html(t.find(".temp_body_tag").html()),a.attr("data-tileUrl",i.replace(/&/gim,"&amp;"))}})},e.mosaic.addTile=function(t,a,o){e.mosaic.options.panels.addClass("mosaic-panel-dragging mosaic-panel-dragging-new"),e(e.mosaic.options.panels.get(0)).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-leftmost").append(e(e.mosaic.document.createElement("div")).addClass("movable removable mosaic-tile mosaic-"+t+"-tile").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-content").attr("data-tileUrl",o&&o.replace(/&/gim,"&amp;")).html(a)).addClass("mosaic-helper-tile mosaic-helper-tile-new mosaic-original-tile"))));var s=e.mosaic.options.panels.find(".mosaic-helper-tile-new"),n=0;e.mosaic.options.panels.each(function(){e(this).width()>n&&(n=e(this).width())}),s.width()<n/4?s.width(n/4):s.width(s.width()),new i(s).initialize()},e.mosaic.getDefaultValue=function(i){var t,a,o,s;switch("IDublinCore-title"===i.name?(o='<h1 class="documentFirstHeading">',s="</h1>"):"IDublinCore-description"===i.name?(o='<p class="documentDescription">',s="</p>"):(o="<div>",s="</div>"),i.tile_type){case"field":switch(i.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":return o+e("#"+i.id,e.mosaic.document).find("input").attr("value")+s;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":for(var n=e("#"+i.id,e.mosaic.document).find("textarea").val().split("\n"),c="",l=0;l<n.length;l+=1)c+=n[l]+"<br/>";return o+c+s;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":return t=e("#"+i.id).find("textarea").attr("id"),a=tinymce.get(t),a?a.getContent():"";default:return'<div class="discreet">Placeholder for field:<br/><b>'+i.label+"</b></div>"}break;default:return i.default_value}},e.mosaic.getPageContent=function(){var t,a=1,o=12,s="",n="",c="";return e.mosaic.disableEditHtmlSource(),s+="  <body>\n",e("[data-panel]",e.mosaic.document).each(function(){c=e(this).attr("data-panel"),s+='    <div data-panel="'+c+'">\n',e(this).children(".mosaic-grid-row").each(function(){e(this).hasClass("mosaic-empty-row")===!1&&(n=e(this).attr("class"),s+='      <div class="'+n+'"\n',s+='           data-grid=\'{"type": "row"}\'>\n',e(this).children(".mosaic-grid-cell").each(function(){switch(e(this).mosaicGetPositionClass()){case"mosaic-position-leftmost":a=1;break;case"mosaic-position-quarter":a=4;break;case"mosaic-position-third":a=5;break;case"mosaic-position-half":a=7;break;case"mosaic-position-two-thirds":a=9;break;case"mosaic-position-three-quarters":a=10}switch(e(this).mosaicGetWidthClass()){case"mosaic-width-half":o=6;break;case"mosaic-width-quarter":o=3;break;case"mosaic-width-third":o=4;break;case"mosaic-width-two-thirds":o=8;break;case"mosaic-width-three-quarters":o=9;break;case"mosaic-width-full":o=12}s+='        <div class="'+e(this).attr("class")+'"\n',s+='             data-grid=\'{"type": "cell", "info":{"xs": "true", "sm": "true", "lg": "true", "pos": {"x": '+a+', "width": '+o+"}}}'>\n",e(this).children(".mosaic-tile").each(function(){var e=new i(this);s+=e.getHtmlBody()}),s+="        </div>\n"}),s+="      </div>\n")}),s+="    </div>\n"}),s+="  </body>\n",t='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" data-layout="'+e.mosaic.options.layout+'">\n',t+=s,t+="</html>\n"},e.mosaic.saveTileFormData=function(){e("[data-panel]",e.mosaic.document).each(function(){e(this).find(".mosaic-tile").each(function(){var e=new i(this);e.saveForm()})})},e.mosaic.saveLayoutToForm=function(){e.mosaic.saveTileFormData();var i=e("#form-widgets-ILayoutAware-content, [name='form.widgets.ILayoutAware.content']");e.mosaic.hasContentLayout?i.val(""):i.val(e.mosaic.getPageContent())},{Tile:i}}),define("mosaic-url/mosaic.toolbar",["jquery","mosaic-url/mosaic.tile","mosaic-url/mosaic.layout"],function(e,i){"use strict";function t(i,t){var o;void 0!==typeof t.menu&&t.menu?t.icon?(o=e(document.createElement("label")),i.append(o.addClass("mosaic-icon-menu mosaic-icon-menu-"+a(t.name)+" mosaic-icon").html(t.label).attr("title",t.label).append(e(document.createElement("select")).addClass("mosaic-menu-"+a(t.name)).data("action",t.action).change(function(){e(this).mosaicExecAction()}).each(function(){var i,o,s;for(i in t.items)if(void 0!==t.items[i].items){e(this).append(e(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+a(t.items[i].value)).attr("label",t.items[i].label)),o=e(this).find(".mosaic-option-group-"+a(t.items[i].value));for(s in t.items[i].items)o.append(e(document.createElement("option")).attr("value",t.items[i].items[s].value).addClass("mosaic-option mosaic-option-"+a(t.items[i].items[s].value)).html(t.items[i].items[s].label))}else e(this).append(e(document.createElement("option")).attr("value",t.items[i].value).addClass("mosaic-option mosaic-option-"+a(t.items[i].value)).html(t.items[i].label))})))):(o=e(document.createElement("select")),i.append(o.addClass("mosaic-menu mosaic-menu-"+t.name.replace(/_/g,"-")).data("action",t.action).change(function(){e(this).mosaicExecAction()}).each(function(){var i,o,s;for(i=0;i<t.items.length;i+=1)if(void 0!==t.items[i].items){e(this).append(e(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+a(t.items[i].value)).attr("label",t.items[i].label)),o=e(this).find(".mosaic-option-group-"+a(t.items[i].value));for(s in t.items[i].items)o.append(e(document.createElement("option")).attr("value",t.items[i].items[s].value).addClass("mosaic-option mosaic-option-"+a(t.items[i].items[s].value)).html(t.items[i].items[s].label))}else e(this).append(e(document.createElement("option")).attr("value",t.items[i].value).addClass("mosaic-option mosaic-option-"+a(t.items[i].value)).html(t.items[i].label))}))):(o=e(document.createElement("button")),i.append(o.addClass("mosaic-button mosaic-button-"+a(t.name)+(t.icon?" mosaic-icon":"")).html(t.label).attr("title",t.label).attr("type","button").data("action",t.action).mousedown(function(){e(this).mosaicExecAction()}))),e.mosaic.actionManager.actions[t.name]&&(e.mosaic.actionManager.actions[t.name].visible()||o.hide())}"undefined"==typeof e.mosaic&&(e.mosaic={});var a=function(e){return e.replace(/(_|\.|\/)/g,"-")};e.fn._mosaicToolbarLayoutEditor=function(i){e(".mosaic-toolbar-secondary-functions",this).show();var o,s,n,c;if(void 0!==e.mosaic.options.formats)for(o=0;o<e.mosaic.options.formats.length;o+=1){for(n=e.mosaic.options.formats[o],i.primary_actions.append(e(document.createElement("fieldset")).addClass("mosaic-button-group mosaic-button-group-"+a(n.name))),c=i.primary_actions.children(".mosaic-button-group-"+n.name.replace(/_/g,"-")),s=0;s<n.actions.length;s+=1)n.actions[s].favorite&&t(c,n.actions[s]);0===c.children().length&&c.remove()}if(void 0!==e.mosaic.options.tiles){var l=i.secondary_actions.find(".mosaic-menu-insert");for(o=0;o<e.mosaic.options.tiles.length;o+=1){for(n=e.mosaic.options.tiles[o],l.append(e(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+a(n.name)).attr("label",n.label)),c=i.secondary_actions.find(".mosaic-option-group-"+a(n.name)),s=0;s<n.tiles.length;s+=1){var r=n.tiles[s];c.append(e(document.createElement("option")).addClass("mosaic-option mosaic-option-"+a(r.name)).attr("value",r.name).html(r.label))}0===c.children().length&&c.remove()}}if(void 0!==e.mosaic.options.formats){var d=i.secondary_actions.find(".mosaic-menu-format");for(o=0;o<e.mosaic.options.formats.length;o+=1){for(n=e.mosaic.options.formats[o],d.append(e(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+a(n.name)).attr("label",n.label)),c=i.secondary_actions.find(".mosaic-option-group-"+a(n.name)),s=0;s<n.actions.length;s+=1){var m=n.actions[s];m.favorite===!1&&c.append(e(document.createElement("option")).addClass("mosaic-option mosaic-option-"+a(m.name)).attr("value",m.name).html(m.label).data("action",m.action))}0===c.children().length&&c.remove()}}},e.fn.mosaicToolbar=function(){return this.each(function(){var o,s,n,c,l,r,d,m,p,u;o=e(this),o.html(""),o.append(e(document.createElement("div")).addClass("mosaic-inline-toolbar")),o=o.children(".mosaic-inline-toolbar"),o.append(e(document.createElement("div")).addClass("mosaic-toolbar-content")),s=o.children(".mosaic-toolbar-content"),n={},s.append(e(document.createElement("div")).addClass("mosaic-toolbar-primary-functions")),n.primary_actions=s.children(".mosaic-toolbar-primary-functions"),s.append(e(document.createElement("div")).addClass("mosaic-toolbar-secondary-functions")),n.secondary_actions=s.children(".mosaic-toolbar-secondary-functions");for(c in n)for(l=0;l<e.mosaic.options[c].length;l+=1)if(void 0===e.mosaic.options[c][l].actions)t(n[c],e.mosaic.options[c][l]);else for(r=e.mosaic.options[c][l],n[c].append(e(document.createElement("fieldset")).addClass("mosaic-button-group mosaic-button-group-"+a(e.mosaic.options[c][l].name))),d=n[c].children(".mosaic-button-group-"+a(e.mosaic.options[c][l].name)),m=0;m<r.actions.length;m+=1)t(d,r.actions[m]);o._mosaicToolbarLayoutEditor(n),e.mosaic.hasContentLayout&&e(".mosaic-toolbar-secondary-functions",this).hide(),p=function(){var i;parseInt(e(window).scrollTop(),10)>parseInt(o.parent().offset().top,10)?o.hasClass("mosaic-inline-toolbar")&&(i=o.offset().left,o.width(o.width()).css({left:i,"margin-left":"0px"}).removeClass("mosaic-inline-toolbar").addClass("mosaic-external-toolbar").parent().height(o.height())):o.hasClass("mosaic-external-toolbar")&&o.css({width:"",left:"","margin-left":""}).removeClass("mosaic-external-toolbar").addClass("mosaic-inline-toolbar").parent().css("height","")},e(window).bind("scroll",p),u=function(){var t,a,o,s,n,c;e.mosaic.disableEditHtmlSource(),t=e(this);var l=e(".mosaic-selected-tile",e.mosaic.document);if(l.length>0){var r=new i(l);a=r.getType()}for(o=e.mosaic.options.default_available_actions,s=0;s<e.mosaic.options.tiles.length;s+=1)for(n=e.mosaic.options.tiles[s],c=0;c<n.tiles.length;c+=1)n.tiles[c].name===a&&(o=o.concat(n.tiles[c].available_actions));l.hasClass("removable")||(o=e(o).filter(function(){return"remove"!==this})),t.find(".mosaic-option-group").show(),t.find(".mosaic-button").hide(),t.find(".mosaic-menu").hide(),t.find(".mosaic-icon-menu").hide(),t.find(".mosaic-menu-format").find(".mosaic-option").hide().attr("disabled","disabled"),e(t.find(".mosaic-menu-format").find(".mosaic-option").get(0)).show().removeAttr("disabled"),e(o).each(function(i,a){(!e.mosaic.actionManager.actions[a]||e.mosaic.actionManager.actions[a].visible())&&(t.find(".mosaic-button-"+a).show(),t.find(".mosaic-icon-menu-"+a).show(),t.find(".mosaic-menu-"+a).show(),t.find(".mosaic-option-"+a).show().removeAttr("disabled"))}),t.find(".mosaic-menu-insert").children(".mosaic-option-group-fields").children().each(function(){0===e.mosaic.options.panels.find(".mosaic-"+e(this).attr("value")+"-tile").length?e(this).show().removeAttr("disabled"):e(this).hide().attr("disabled","disabled")}),t.find(".mosaic-option-group").each(function(){0===e(this).children(":enabled").length&&e(this).hide()}),e(".mosaic-menu, .mosaic-icon-menu",e.mosaic.document).each(function(){1===e(this).find(".mosaic-option:enabled").length&&e(this).hide()})},e(".mosaic-button-remove").hover(function(){e(".mosaic-selected-tile .mosaic-tile-content").addClass("mosaic-remove-target")},function(){e(".mosaic-selected-tile .mosaic-tile-content").removeClass("mosaic-remove-target")}),e(this).bind("selectedtilechange",u),e(this).trigger("selectedtilechange"),e(".mosaic-menu").each(function(){e(this).select2({width:"style",dropdownCssClass:"mosaic-dropdown mosaic-dropdown-"+e(this).data("action"),dropdownAutoWidth:!0,minimumResultsForSearch:99})});var h=(new Date).getTime();e(this).on("selectedtilechange",function(){e.mosaic.overlay.app||(new Date).getTime()-h>6e3&&(e.mosaic.saveLayoutToForm(),setTimeout(function(){e("#form-widgets-ILayoutAware-content, [name='form.widgets.ILayoutAware.content']").blur()},1e3),h=(new Date).getTime())})})}}),define("mosaic-url/mosaic.actions",["jquery","mosaic-url/mosaic.tile","mockup-utils","mockup-patterns-modal"],function(e,i,t,a){"use strict";"undefined"==typeof e.mosaic&&(e.mosaic={}),e.mosaic.actionManager={actions:[],shortcuts:[]},e.mosaic.registerAction=function(i,t){t=e.extend({exec:function(){},shortcut:{ctrl:!1,alt:!1,shift:!1,key:""},visible:function(e){return!0},undoable:!1},t),e.mosaic.actionManager.actions[i]=t,""!==t.shortcut.key&&(t.shortcut.charCode=t.shortcut.key.toUpperCase().charCodeAt(0),t.shortcut.action=i,e.mosaic.actionManager.shortcuts.push(t.shortcut))},e.fn.mosaicExecAction=function(){return this.each(function(){if(""!==e(this).data("action")){var i=e.mosaic.actionManager;i.actions[e(this).data("action")].exec(this),i.actions[e(this).data("action")].undoable&&e.mosaic.undo.snapshot()}})},e.mosaic.fixWebkitSpan=function(){var i=e(".Apple-style-span",e.mosaic.document);i.after(i.html()),i.remove()},e.mosaic.getPrefixedClassName=function(e){return e.indexOf("-")>-1?"mosaic-"+e:"mosaic"+e.charAt(0).toUpperCase()+e.slice(1)},e.mosaic.initActions=function(){e.mosaic.registerAction("tile-toggle-class",{exec:function(){var i;arguments.length>0&&arguments[0].value&&(i=e.mosaic.getPrefixedClassName(arguments[0].value),e(".mosaic-selected-tile",e.mosaic.document).toggleClass(i))}}),e.mosaic.registerAction("tile-remove-format",{exec:function(){var i,t,a,o,s;for(i=0;i<e.mosaic.options.formats.length;i++)for(a=e.mosaic.options.formats[i],t=0;t<a.actions.length;t++)o=a.actions[t],"tile"===o.category&&(s=e.mosaic.getPrefixedClassName(o.name),e(".mosaic-selected-tile",e.mosaic.document).removeClass(s))}}),e.mosaic.registerAction("row-toggle-class",{exec:function(){var i;arguments.length>0&&arguments[0].value&&(i=e.mosaic.getPrefixedClassName(arguments[0].value),e(".mosaic-selected-tile",e.mosaic.document).parents(".mosaic-grid-row").first().toggleClass(i))}}),e.mosaic.registerAction("row-remove-format",{exec:function(){var i,t,a,o,s;for(i=0;i<e.mosaic.options.formats.length;i++)for(a=e.mosaic.options.formats[i],t=0;t<a.actions.length;t++)o=a.actions[t],"row"===o.category&&(s=e.mosaic.getPrefixedClassName(o.name),e(".mosaic-selected-tile",e.mosaic.document).parents(".mosaic-grid-row").first().removeClass(s))}}),e.mosaic.registerAction("tile-align-block",{exec:function(){e(".mosaic-selected-tile",e.mosaic.document).removeClass("mosaic-tile-align-right").removeClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"b"}}),e.mosaic.registerAction("tile-align-left",{exec:function(){e(".mosaic-selected-tile",e.mosaic.document).removeClass("mosaic-tile-align-right").addClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"l"}}),e.mosaic.registerAction("tile-align-right",{exec:function(){e(".mosaic-selected-tile",e.mosaic.document).removeClass("mosaic-tile-align-left").addClass("mosaic-tile-align-right")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"r"}}),e.mosaic.registerAction("save",{exec:function(){e.mosaic.options.toolbar.trigger("selectedtilechange"),e.mosaic.saveLayoutToForm(),e("#form-buttons-save").click()},shortcut:{ctrl:!0,alt:!1,shift:!1,key:"s"}}),e.mosaic.registerAction("cancel",{exec:function(){e("#form-buttons-cancel").click()}}),e.mosaic.registerAction("html",{exec:function(){var i,t,a;i=e(".mosaic-selected-tile",e.mosaic.document).children(".mosaic-tile-content"),0===i.find(".mosaic-rich-text-textarea").length&&(t=i.html(),a=i.height(),i.empty(),i.prepend(e(e.mosaic.document.createElement("textarea")).addClass("mosaic-rich-text-textarea").html(e.trim(t)).height(a)))}}),e.mosaic.registerAction("undo",{exec:function(){e.mosaic.undo.undo()}}),e.mosaic.registerAction("redo",{exec:function(){e.mosaic.undo.redo()}}),e.mosaic.registerAction("properties",{exec:function(){e.mosaic.overlay.open("all")}}),e.mosaic.registerAction("customizelayout",{exec:function(){e.mosaic.setSelectedContentLayout(""),e(".mosaic-toolbar-secondary-functions").show(),e(".mosaic-button-customizelayout").hide(),e(".mosaic-panel .mosaic-tile",e.mosaic.document).each(function(){var e=new i(this);e.makeMovable(),e.$el.mosaicAddDrag()})},visible:function(){return e.mosaic.hasContentLayout&&e.mosaic.options.canChangeLayout}}),e.mosaic.registerAction("changelayout",{exec:function(){var i=e.mosaic.hasContentLayout;i||(i=confirm("Changing your will destroy all existing custom layout settings you have in place. Are you sure you want to continue?")),i&&e.mosaic.selectLayout()},visible:function(){return e.mosaic.options.available_layouts.length>0}}),e.mosaic.registerAction("add-tile",{exec:function(){var i=new a(e(".mosaic-toolbar"),{ajaxUrl:e.mosaic.options.context_url+"/@@add-tile?form.button.Create=Create"});i.show()}}),e.mosaic.registerAction("format",{exec:function(i){e(i).find("[value="+e(i).val()+"]").mosaicExecAction(),e(i).select2("val","none")}}),e.mosaic.registerAction("remove",{exec:function(t){e(".mosaic-selected-tile",e.mosaic.document).each(function(){var t=new i(this),a=t.getConfig();if("app"===a.tile_type){var o=t.getUrl();e.mosaic.removeHeadTags(o);var s=o.split("?")[0];s=s.split("@@");var n=s[1].split("/");s=s[0]+"@@delete-tile/"+n[0]+"/"+n[1],s.match(/^\.\/.*/)&&(s=e.mosaic.options.context_url+s.replace(/^\./,"")),e.ajax({type:"GET",url:s,success:function(i){var t=e(i).find('[name="_authenticator"]').val();e.ajax({type:"POST",url:s,data:{"buttons.delete":"Delete",_authenticator:t},success:function(e){}})}})}e.mosaic.options.panels.find(".mosaic-empty-row").remove();var c=e(this).parent().parent();t.saveForm(),e(this).remove(),e.mosaic.undo.snapshot(),c.mosaicCleanupRow(),e.mosaic.options.panels.mosaicAddEmptyRows(),e.mosaic.options.toolbar.trigger("selectedtilechange"),e.mosaic.options.toolbar.mosaicSetResizeHandleLocation()})},visible:function(){return!e.mosaic.hasContentLayout}}),e.mosaic.registerAction("insert",{exec:function(i){var o,s,n,c,l;if("none"===e(i).val())return!1;for(n=e(i).val(),e(".mosaic-selected-tile",e.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),e.mosaic.options.panels.trigger("selectedtilechange"),c=0;c<e.mosaic.options.tiles.length;c+=1)for(s=e.mosaic.options.tiles[c],l=0;l<s.tiles.length;l+=1)s.tiles[l].name===n&&(o=s.tiles[l]);if("app"===o.tile_type){var r=!0;t.loading.show(),e.ajax({type:"GET",url:e.mosaic.options.context_url+"/@@add-tile?tiletype="+n+"&form.button.Create=Create",success:function(i,o){t.loading.hide();var s,c,l,d;s=e(i),c=s.find("#add_tile").attr("action"),l=s.find('[name="_authenticator"]').val(),d=function(i){e.mosaic.overlay.app=new a(e(".mosaic-toolbar"),{html:i,loadLinksWithinModal:!0,buttons:'.formControls > input[type="submit"], .actionButtons > input[type="submit"]'}),e.mosaic.overlay.app.$el.off("after-render"),e.mosaic.overlay.app.on("after-render",function(i){r&&(e(".field.error",e.mosaic.overlay.app.$modal).removeClass("error"),e(".fieldErrorBox,.portalMessage",e.mosaic.overlay.app.$modal).remove(),r=!1),e('input[name*="cancel"]',e.mosaic.overlay.app.$modal).off("click").on("click",function(){e.mosaic.overlay.app.hide(),e.mosaic.overlay.app=null})}),e.mosaic.overlay.app.show(),e.mosaic.overlay.app.$el.off("formActionSuccess"),e.mosaic.overlay.app.on("formActionSuccess",function(i,t,a,o){var s=o.getResponseHeader("X-Tile-Url");s&&(e.mosaic.addAppTileHTML(n,t,s),e.mosaic.overlay.app.hide(),e.mosaic.overlay.app=null)})},e("form .required",s).filter(function(){var i=e(this).parents(".field").first().find("input, select, textarea").not('[type="hidden"]').last().val();return null===i||0==i.length}).length>0?d(i):c&&e("form",s).ajaxSubmit({type:"POST",url:c,data:{"buttons.save":"Save",_authenticator:l},success:function(i,t,a){var o=a.getResponseHeader("X-Tile-Url");o?e.mosaic.addAppTileHTML(n,i,o):d(i)}})}})}else e.mosaic.addTile(n,e.mosaic.getDefaultValue(o));return e(i).select2("val","none"),!0}}),e(document).keypress(function(i){var t="";return e(e.mosaic.actionManager.shortcuts).each(function(){i.ctrlKey!==this.ctrl&&(-1===navigator.userAgent.toLowerCase().indexOf("macintosh")||i.metaKey!==this.ctrl)||i.altKey!==this.alt&&void 0!==i.altKey||i.shiftKey!==this.shift||!i.charCode||String.fromCharCode(i.charCode).toUpperCase().charCodeAt(0)!==this.charCode||(t=this.action)}),""!==t?(e.mosaic.actionManager.actions[t].exec(),e.mosaic.actionManager.actions[t].undoable&&e.mosaic.undo.snapshot(),
!1):!0})}}),define("mosaic-url/mosaic.core",["jquery","pat-logger","underscore","mosaic-url/mosaic.tile","mosaic-url/mosaic.panel","mockup-patterns-modal","mosaic-url/mosaic.toolbar","mosaic-url/mosaic.layout","mosaic-url/mosaic.actions"],function(e,i,t,a,o,s){"use strict";i.getLogger("pat-mosaic");"undefined"==typeof e.mosaic&&(e.mosaic={}),e.mosaic.loaded=!1,e.mosaic.selectLayoutTemplate=t.template('<div><h1>Select Layout</h1><div class="mosaic-select-layout"><ul><% _.each(available_layouts, function(layout){ var screenshot = layout.preview || layout.screenshot;if(!screenshot){screenshot = "++resource++plone.app.mosaic.images/default-layout-screenshot.png";} %><li><a href="#" data-value="<%- layout.path %>"><p><%- layout.title %></p><img src="<%- screenshot %>"></a></li><% }); %></ul></div><div class="buttons"><!-- <button class="plone-btn plone-btn-default">Select</button> --></div></div>'),e.mosaic.initialized=function(){e.mosaic.loaded||(e.mosaic.loaded=!0,e.mosaic.undo.snapshot())},e.mosaic.init=function(i){i=e.extend({url:window.document.location.href,type:"",ignore_context:!1},i),e.mosaic.document=window.document;var t;e.mosaic.initActions(),t=i.url.match(/^([\w#!:.?+=&%@!\-\/]+)\/edit$/),t&&(i.url=t[1]),t=i.url.match(/^([\w#:.?=%@!\-\/]+)\/\+\+add\+\+([\w#!:.?+=&%@!\-\/]+)$/),t&&(i.url=t[1],i.type=t[2],i.ignore_context=!0),e.mosaic.options=i.data,e.mosaic.options.url=i.url,e.mosaic.options.ignore_context=i.ignore_context,e.mosaic.options.tileheadelements=[],e.mosaic.hasContentLayout=!0;var a=e.mosaic.getSelectedContentLayout();if(a)e.mosaic.applyLayout(a);else{var o=e(e.mosaic.options.customContentLayout_field_selector).val();if(o){var s=e.mosaic.getDomTreeFromHtml(o);"no-layout"===s.attr("id")?e.mosaic.selectLayout(!0):(e("body").addClass("mosaic-layout-customized"),e.mosaic.hasContentLayout=!1,e.mosaic._init(s))}else e.mosaic.selectLayout(!0)}},e.mosaic.getSelectedContentLayout=function(){return e(e.mosaic.options.contentLayout_field_selector).val()},e.mosaic.setSelectedContentLayout=function(i){return i?(e.mosaic.hasContentLayout=!0,e(".mosaic-toolbar-secondary-functions",e.mosaic.document).hide(),e("body").removeClass("mosaic-layout-customized")):(e("body").addClass("mosaic-layout-customized"),e.mosaic.hasContentLayout=!1),e(e.mosaic.options.contentLayout_field_selector).attr("value",i)},e.mosaic._initPanels=function(i){e.mosaic.options.layout=i.attr("data-layout"),e("[data-panel] [data-panel]",e.mosaic.document).removeAttr("data-panel"),i.find("[data-panel]").each(function(){var e=new o(this);e.initialize(i)}),e("[data-panel]",e.mosaic.document).each(function(){var e=new o(this);e.prefill()}),e.mosaic.options.panels=e(".mosaic-panel",e.mosaic.document),e.mosaic.options.panels.find("[data-tile]").each(function(){if(a.validTile(this)){var i=new a(e(this).parent());i.initializeContent()}})},e.mosaic._init=function(i){e.mosaic._initPanels(i),e(".mosaic-original-content",e.mosaic.document).mosaicOverlay(),e("body").prepend(e(document.createElement("div")).addClass("mosaic-toolbar")),e.mosaic.options.toolbar=e(".mosaic-toolbar"),e.mosaic.options.toolbar.mosaicToolbar(),e.mosaic.options.panels.mosaicLayout(),e("*",e.mosaic.document).each(function(){var i;i=e(this),"block"===i.css("display")&&(i.hasClass("mosaic-panel")||i.hasClass("mosaic-toolbar")||i.hasClass("mosaic-notifications")||i.hasClass("mosaic-modal-wrapper")||"edit-zone"===i.attr("id")||0===i.parents(".mosaic-panel, .mosaic-toolbar").length&&0===i.find(".mosaic-panel, .mosaic-toolbar").length&&0!==i.parent().find(".mosaic-panel, .mosaic-toolbar").length&&i.addClass("mosaic-blur"))}),e.mosaic.undo.init(),e("body").addClass("mosaic-enabled"),e.mosaic.initialized()},e.mosaic.applyLayout=function(i,t){void 0===t&&(t=function(){}),e.ajax({url:e.mosaic.options.context_url+"/"+i}).done(function(t){var a=e.mosaic.getDomTreeFromHtml(t);e.mosaic.setSelectedContentLayout(i),e.mosaic.loaded?(e.mosaic._initPanels(a),e.mosaic.options.panels.mosaicLayout()):e.mosaic._init(a)})},e.mosaic.selectLayout=function(i){if(void 0!==i&&i&&1===e.mosaic.options.available_layouts.length){var a=e.mosaic.options.available_layouts[0],o="++contentlayout++"+a.directory+"/"+a.file;return void e.mosaic.applyLayout(o)}if(0===e.mosaic.options.available_layouts.length)return void e.mosaic.applyLayout("++contentlayout++default/basic.html");var n=e("<div/>").appendTo("body"),c=new s(n,{html:e.mosaic.selectLayoutTemplate(e.mosaic.options),content:null,buttons:".plone-btn"});c.on("shown",function(){e("li a",c.$modal).off("click").on("click",function(i){i.preventDefault();var a,o=e(this).attr("data-value");t.each(e.mosaic.options.available_layouts,function(e){e.path===o&&(a=e)});var s="++contentlayout++"+a.directory+"/"+a.file;c.hide(),e.mosaic.applyLayout(s)})}),c.show()},e.mosaic.getDomTreeFromHtml=function(i){return i=i.replace(/<!DOCTYPE[\w\s\- .\/\":]+>/,""),i=i.replace(/<html>/,'<div class="temp_html_tag">'),i=i.replace(/<\/html>/,"</div>"),i=i.replace(/<html\s/,'<div class="temp_html_tag" '),i=i.replace(/<\/html\s/,"</div "),i=i.replace(/<head>/,'<div class="temp_head_tag">'),i=i.replace(/<\/head>/,"</div>"),i=i.replace(/<head\s/,'<div class="temp_head_tag" '),i=i.replace(/<\/head\s/,"</div "),i=i.replace(/<body>/,'<div class="temp_body_tag">'),i=i.replace(/<\/body>/,"</div>"),i=i.replace(/<body\s/,'<div class="temp_body_tag" '),i=i.replace(/<\/body\s/,"</div "),e(e(i)[0])},e.mosaic.removeHeadTags=function(i){var t,a,o,s;if(i=i.split("?")[0],i=i.split("@@"),t=i[1].split("/"),i=i[0]+"@@delete-tile?type="+t[0]+"&id="+t[1]+"&confirm=true",a=t[0].replace(/\./g,"-")+"-"+t[1],o=e.mosaic.options.tileheadelements[a])for(s=0;s<o.length;s+=1)e(o[s],e.mosaic.document).remove();e.mosaic.options.tileheadelements[a]=[]},e.mosaic.addHeadTags=function(i,t){var a,o;i=i.split("?")[0],i=i.split("@@"),a=i[1].split("/"),o=a[0].replace(/\./g,"-")+"-"+a[1],e.mosaic.options.tileheadelements[o]=[],t.find(".temp_head_tag").children().each(function(){e.mosaic.options.tileheadelements[o].push(this),e("head",e.mosaic.document).append(this)})}}),define("mosaic-url/mosaic.upload",["jquery"],function($){"use strict";"undefined"==typeof $.mosaic&&($.mosaic={}),$.mosaic.initUpload=function(){$(".mosaic-panel",$.mosaic.document).bind("dragover",function(e){0===$(".mosaic-panel-dragging",$.mosaic.document).length&&($(".mosaic-selected-tile",$.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),$.mosaic.options.toolbar.trigger("selectedtilechange"),$.mosaic.options.panels.mosaicSetResizeHandleLocation(),$.mosaic.addTile("image",'<img src="++resource++plone.app.mosaic.images/files.png" border="0" />'))}),document.addEventListener("drop",function(event){var dt,first,i,files,newtile,file,img,tile,xhr,boundary,data;for(dt=event.dataTransfer,files=dt.files,event.stopPropagation(),event.preventDefault(),$($.mosaic.document).trigger("mousedown"),first=!0,i=0;i<files.length;i+=1)file=files.item(i),0===file.mediaType.indexOf("image")?(first?(img=$(".mosaic-selected-tile",$.mosaic.document).children(".mosaic-tile-content").children("img"),tile=$(".mosaic-selected-tile",$.mosaic.document),first=!1):(newtile=$($.mosaic.document.createElement("div")).addClass("movable removable mosaic-tile mosaic-image-tile").append($($.mosaic.document.createElement("div")).addClass("mosaic-tile-content").append($($.mosaic.document.createElement("img")).attr("border",0))),$(".mosaic-selected-tile",$.mosaic.document).after(newtile),newtile.mosaicInitTile(),newtile.mosaicAddDrag(),img=newtile.children(".mosaic-tile-content").children("img"),tile=newtile),tile.append($($.mosaic.document.createElement("div")).addClass("mosaic-tile-uploadprogress")),img.get(0).src=file.getAsDataURL(),xhr=new XMLHttpRequest,xhr.upload.log=img,xhr.addEventListener("load",function(event){var response=eval("("+event.target.responseText+")");1===response.status?$.plone.notify({type:"error",title:"Error",message:response.message,sticky:!0}):$(event.target.upload.log).attr({src:response.url,alt:response.title}).parents(".mosaic-tile").children(".mosaic-tile-uploadprogress").fadeOut("slow",function(){$(this).remove()})},!1),xhr.upload.addEventListener("error",function(e){$.plone.notify({type:"error",title:"Error",message:"Error uploading file: "+e,sticky:!0})},!1),boundary="AJAX---------------------------AJAX",xhr.open("POST",$.mosaic.options.url+"/@@mosaic-upload",!0),xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+boundary),data="--"+boundary+"\r\n",data+="Content-Disposition: form-data; ",data+='name="uploadfile"; ',data+='filename="'+file.fileName+'"\r\n',data+="Content-Type: "+file.mediaType,data+="\r\n\r\n",data+=file.getAsBinary()+"\r\n",data+="--"+boundary+"--\r\n",xhr.sendAsBinary(data)):$.plone.notify({type:"warning",title:"Warning",message:"The filetype of file "+file.fileName+" is unsupported",sticky:!0});first&&$(".mosaic-button.remove").mosaicExecAction()},!1)}}),define("mosaic-url/mosaic.editor",["jquery"],function(e){"use strict";"undefined"==typeof e.mosaic&&(e.mosaic={}),e.mosaic.editor={},e.mosaic.execCommand=function(e,i,t){tinymce.activeEditor&&tinymce.activeEditor.execCommand(e,i,t)},e.mosaic.editor.applyFormat=function(e){tinymce.activeEditor&&tinyMCE.activeEditor.formatter.apply(e)},e.mosaic.editor.registerFormat=function(e,i){tinymce.activeEditor&&tinymce.activeEditor.formatter.register(e,i)}}),define("mosaic-url/mosaic.undo",["jquery"],function(e){"use strict";"undefined"==typeof e.mosaic&&(e.mosaic={}),e.mosaic.undo=function(){},e.mosaic.undo.init=function(){function i(i){for(var t=0;t<i.length;t+=1)e("#"+i[t].target,e.mosaic.document).html(i[t].source)}e.mosaic.undo.undoManager=new e.mosaic.undo.UndoManager(10,i)},e.mosaic.undo.snapshot=function(){var i=[];e(".mosaic-panel",e.mosaic.document).each(function(){i.push({target:e(this).attr("id"),source:e(this).html()})}),"undefined"==typeof e.mosaic.undo.undoManager&&e.mosaic.undo.init(),e.mosaic.undo.undoManager.add(i)},e.mosaic.undo.hasInitial=function(){return e.mosaic.undo.undoManager.stack.size()>0?!0:!1},e.mosaic.undo.undo=function(){e.mosaic.undo.undoManager.undo()},e.mosaic.undo.redo=function(){e.mosaic.undo.undoManager.redo()},e.mosaic.undo.Stack=function(e){"undefined"==typeof e?this.maxsize=10:this.maxsize=e,this.stack=[]},e.mosaic.undo.Stack.prototype.size=function(){return this.stack.length},e.mosaic.undo.Stack.prototype.add=function(e){this.stack.length>=this.maxsize&&this.stack.pop(),this.stack.unshift(e)},e.mosaic.undo.Stack.prototype.get=function(e){return this.stack[e]},e.mosaic.undo.UndoManager=function(i,t,a){this.stack=new e.mosaic.undo.Stack(i),this.pointer=0,this.handler=t,"undefined"!=typeof a&&this.stack.add(a)},e.mosaic.undo.UndoManager.prototype.add=function(e){this.stack.add(e)},e.mosaic.undo.UndoManager.prototype.undo=function(){var e=this.stack.get(this.pointer+1);e&&(this.handler(e),this.pointer+=1)},e.mosaic.undo.UndoManager.prototype.redo=function(){var e=this.stack.get(this.pointer-1);e&&(this.handler(e),this.pointer-=1)}}),define("mosaic-url/mosaic.overlay",["jquery"],function(e){"use strict";"undefined"==typeof e.mosaic&&(e.mosaic={}),e.mosaic.overlay={},e.fn.mosaicOverlay=function(){return this.each(function(){var i=e(this);e(document.body,e.mosaic.document).append(i),i.addClass("mosaic-overlay");var t=e('<div class="mosaic-modal-wrapper" />');i.wrap(t),e(document.body,e.mosaic.document).prepend(e(document.createElement("div")).addClass("mosaic-overlay-blocker"))})},e.mosaic.overlay.open=function(i,t){var a,o,s,n,c,l,r,d;if(e(".mosaic-modal-wrapper").show().addClass("active"),e(".mosaic-overlay-blocker").show(),e("body").addClass("plone-modal-open"),a=e(".mosaic-overlay").find("form"),0===e(".mosaic-overlay-ok-button").length&&(e(".mosaic-overlay .formControls").children("input").hide(),e(".mosaic-overlay .formControls").append(e(document.createElement("input")).attr({type:"button",value:"Close"}).addClass("button-field context mosaic-overlay-ok-button").click(function(){e.mosaic.overlay.close()})),e(".mosaic-overlay").prepend(e(document.createElement("button")).attr({title:"Close"}).addClass("mosaic-overlay-close").html("&times;").click(function(){e.mosaic.overlay.close()}))),"all"===i){for(o=a.find("nav"),o.removeClass("mosaic-hidden"),a.find("fieldset").children().removeClass("mosaic-hidden"),a.find("fieldset").removeClass("active"),o.find("a").removeClass("active"),a.find(e.mosaic.options.customContentLayout_selector).addClass("mosaic-hidden"),a.find(e.mosaic.options.contentLayout_selector).addClass("mosaic-hidden"),e(".mosaic-IDublinCore-title-tile").size()>0?a.find("#formfield-form-widgets-IDublinCore-title").addClass("mosaic-hidden"):a.find("#formfield-form-widgets-IDublinCore-title").removeClass("mosaic-hidden"),e(".mosaic-IDublinCore-description-tile").size()>0?a.find("#formfield-form-widgets-IDublinCore-description").addClass("mosaic-hidden"):a.find("#formfield-form-widgets-IDublinCore-description").removeClass("mosaic-hidden"),n=0;n<e.mosaic.options.tiles.length;n+=1)"fields"===e.mosaic.options.tiles[n].name&&(s=e.mosaic.options.tiles[n]);for(n=0;n<s.tiles.length;n+=1)l=s.tiles[n],0!==e.mosaic.options.panels.find(".mosaic-"+l.name+"-tile").length&&e(e.mosaic.document.getElementById(l.id)).addClass("mosaic-hidden");a.find("fieldset").each(function(){0===e(this).children("div:not(.mosaic-hidden)").length&&e("a[href=#fieldsetlegend-"+e(this).attr("id").split("-")[1]+"]").addClass("mosaic-hidden")}),c=o.children(":not(.mosaic-hidden)"),c.eq(0).addClass("active");var m=a.find("#fieldset-"+c.eq(0).attr("href").split("-")[1]);0===m.size()&&(m=a.find("fieldset:not(.mosaic-hidden)").eq(0)),m.addClass("active")}else"field"===i&&(r=e("#"+t.id),d=r.parents("fieldset"),a.find("fieldset").hide(),d.show(),d.children().addClass("mosaic-hidden"),r.removeClass("mosaic-hidden"),a.find("nav").addClass("mosaic-hidden"))},e.mosaic.overlay.close=function(){e(".mosaic-modal-wrapper").hide().removeClass("active"),e(".mosaic-overlay-blocker").hide(),e("body").removeClass("plone-modal-open")}}),window.DEBUG=!0,require(["jquery","mockup-patterns-base","mosaic-url/mosaic.core","mosaic-url/mosaic.layout","mosaic-url/mosaic.toolbar","mosaic-url/mosaic.actions","mosaic-url/mosaic.upload","mosaic-url/mosaic.editor","mosaic-url/mosaic.undo","mosaic-url/mosaic.overlay"],function(e,i){"use strict";var t=i.extend({name:"layout",trigger:".pat-layout",parser:"mockup",defaults:{attribute:"class"},init:function(){var i=this;i.options.data.$el=i.$el,e.mosaic.init({data:i.options.data})}});return t}),define("mosaic.pattern",function(){});

//# sourceMappingURL=plone-mosaic.js.map
