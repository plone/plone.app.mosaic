define("mosaic-url/mosaic.tile",["jquery","pat-logger","underscore","mockup-utils","pat-registry","mockup-patterns-tinymce","tinymce","mockup-patterns-modal"],function(a,b,c,d,e,f,g,h){"use strict";var i=[],j=b.getLogger("pat-mosaic"),k=0,l=function(){clearTimeout(k),k=setTimeout(m,50)},m=function(){var b=a(".mosaic-rich-text-toolbar").filter(":visible");if(0!==b.size()&&0!==b.find(".mce-first").size()){var c=b.parent();b.removeClass("right"),c.offset().left>=a(window).width()/2&&b.addClass("right");var d=a(window);if(c.offset().top-b.height()<d.scrollTop()){if(!b.hasClass("sticky")){a("body").addClass("mce-sticky"),b.addClass("sticky");var e={top:a(".mosaic-toolbar").height()+b.height()};b.hasClass("right")?e.right=b.offset().right:e.left=b.offset().left,b.css(e)}}else b.removeClass("sticky"),b.removeAttr("style"),a("body").removeClass("mce-sticky")}};a(window).off("scroll",l).on("scroll",l);var n=function(b){var c=this;c.tinymce=null,c.$el=a(b),c.$el.is(".mosaic-tile")||(c.$el=c.$el.parents(".mosaic-tile")),c.focusCheckCount=0,c.$el.children(".mosaic-tile-content").off("blur").on("blur",function(){var b=c.getConfig();if(b&&"textapp"===b.tile_type){var e=c.getEditUrl();if(e){var f=c.getHtmlContent();if(f===c.$el.data("lastSavedData"))return;if(c.$el.data("activeSave"))return;c.$el.data("activeSave",!0);var g={_authenticator:d.getAuthenticator(),"buttons.save":"Save"};g[b.name+".content"]=f,a.ajax({url:e,method:"POST",data:g}).always(function(){c.$el.data("lastSavedData",f),c.$el.data("activeSave",!1)})}}})};return n.prototype.getDataTileEl=function(a,b){return this.$el.find("[data-tile]")},n.prototype.getContentEl=function(a,b){return this.$el.children(".mosaic-tile-content")},n.prototype.getHtmlContent=function(){return this.getContentEl().html()},n.prototype.getEditUrl=function(){var b=this.getUrl();if(b&&(b=b.replace(/@@/,"@@edit-tile/")))return b.match(/^\.\/.*/)&&(b=a.mosaic.options.context_url+b.replace(/^\./,"")),b},n.prototype.getDeleteUrl=function(){var b=this.getUrl(),c=b.split("?")[0];c=c.split("@@");var d=c[1].split("/");return c=c[0]+"@@delete-tile/"+d[0]+"/"+d[1],c.match(/^\.\/.*/)&&(c=a.mosaic.options.context_url+c.replace(/^\./,"")),c},n.prototype.getUrl=function(){var b=this.$el.find(".tileUrl").html();if(!b){var c=this.$el.find("[data-tileUrl]");c.size()>0&&(b=c.attr("data-tileUrl"))}return b||(b=this.$el.find("[data-tile]").attr("data-tile")),b&&(b=b.replace(a.mosaic.options.context_url,"./"),b=b.replace(/^\.\/\//,"./"),a.mosaic.hasContentLayout?-1===b.indexOf("X-Tile-Persistent")&&(b+=-1===b.indexOf("?")?"?":"&",b+="X-Tile-Persistent=yes"):-1!==b.indexOf("X-Tile-Persistent")&&(b=b.replace("X-Tile-Persistent=yes","").replace("&&","&"))),b},n.prototype.getType=function(){var b="",c=this.$el,d=c.attr("class"),e=[];return d&&(e=c.attr("class").split(" "),a(e).each(function(){var a;a=this.match(/^mosaic-([\w.\-]+)-tile$/),null!==a&&"selected"!==a[1]&&"new"!==a[1]&&"read-only"!==a[1]&&"helper"!==a[1]&&"original"!==a[1]&&"edited"!==a[1]&&(b=a[1])})),b||j.error("Could not find tile type on element with classes: "+e.join(", ")),b},n.prototype.deprecatedHTMLTiles=["table","numbers","bullets","text","subheading","heading"],n.prototype.getConfig=function(){for(var b,c=this.getType(),d=0;d<a.mosaic.options.tiles.length;d+=1){for(var e=!1,f=a.mosaic.options.tiles[d],g=0;g<f.tiles.length;g+=1){if("field"===f.tiles[g].tile_type){var h=f.tiles[g].widget.split(".");switch(h=h[h.length-1]){case"TextWidget":case"TextFieldWidget":case"TextAreaWidget":case"TextAreaFieldWidget":case"TextLinesWidget":case"TextLinesFieldWidget":case"WysiwygWidget":case"WysiwygFieldWidget":case"RichTextWidget":case"RichTextFieldWidget":f.tiles[g].settings=!1;break;default:f.tiles[g].settings=!0}}if(f.tiles[g].name===c){b=f.tiles[g],e=!0;break}}if(e)break}return b||(-1===i.indexOf(c)&&(j.error("Could not load tile config for tile type: "+c+" falling back to b/w compatible tile type."),i.push(c)),b={tile_type:"app",name:c,label:"Unknown",read_only:!0,favorite:!1,settings:!1,weight:0,rich_text:!1},-1!==this.deprecatedHTMLTiles.indexOf(c)&&(b.category="structure",b.read_only=!1,b.label=c,b.tile_type="text",b.rich_text=!0)),b},n.prototype.getHtmlBody=function(b){var c="",d="",e=this.$el.attr("class").split(" ");d=this.getType(),e=a(e).filter(function(){switch(this){case"mosaic-new-tile":case"mosaic-helper-tile":case"mosaic-original-tile":case"mosaic-selected-tile":case"mosaic-edited-tile":return!1;default:return!0}}).toArray();var f,h=this.getConfig();switch(h.tile_type){case"text":f=g.get(this.$el.children(".mosaic-tile-content").attr("id")),c+='          <div class="'+e.join(" ")+'">\n',c+='          <div class="mosaic-tile-content">\n',c+=(f?f.getContent():this.$el.children(".mosaic-tile-content").html()).replace(/^\s+|\s+$/g,"")+"\n",c+="          </div>\n",c+="          </div>\n";break;case"app":case"textapp":var i=this.getUrl();if(b){f=g.get(this.$el.children(".mosaic-tile-content").attr("id"));var j=(f?f.getContent():this.$el.children(".mosaic-tile-content").html()).replace(/^\s+|\s+$/g,"")+"\n";i+=-1===i.indexOf("?")?"?":"&",i+="content="+encodeURI(j)}c+='          <div class="'+e.join(" ")+'">\n',c+='          <div class="mosaic-tile-content">\n',c+='          <div data-tile="'+i+'"></div>\n',c+="          </div>\n",c+="          </div>\n";break;case"field":c+='          <div class="'+e.join(" ")+'">\n',c+='          <div class="mosaic-tile-content">\n';var k="./@@plone.app.standardtiles.field?field="+d;c+='          <div data-tile="'+k+'"></div>\n',c+="          </div>\n",c+="          </div>\n",this.saveForm()}return c},n.prototype.isRichText=function(a){return void 0===a&&(a=this.getConfig()),!(!a||this.$el.hasClass("mosaic-read-only-tile")!==!1||!("text"===a.tile_type&&a.rich_text||"textapp"===a.tile_type&&a.rich_text||"app"===a.tile_type&&a.rich_text||"field"===a.tile_type&&a.read_only===!1&&("z3c.form.browser.text.TextWidget"===a.widget||"z3c.form.browser.text.TextFieldWidget"===a.widget||"z3c.form.browser.textarea.TextAreaWidget"===a.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===a.widget||"z3c.form.browser.textlines.TextLinesWidget"===a.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===a.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===a.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===a.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===a.widget||"plone.app.widgets.dx.RichTextWidget"===a.widget)))},n.prototype.initialize=function(){var b=this.getConfig();b&&b.read_only&&this.$el.addClass("mosaic-read-only-tile"),this.isRichText()&&this.setupWysiwyg(),this.$el.prepend(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-inner-border"))),b&&this.$el.prepend(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-label").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-label-content").html(b.label)).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-label-left"))),this.makeMovable(),this.initializeButtons();var d=this;c.each(["top","bottom","right","left"],function(b){d.$el.prepend(a(a.mosaic.document.createElement("div")).addClass("mosaic-divider mosaic-divider-"+b).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-divider-dot")))})},n.prototype.initializeButtons=function(){var b=[],c=this.getConfig();this.$el.find(".mosaic-tile-buttons").remove();var d=function(c,d,e){var f=document.createElement("button");return f.className="mosaic-btn-"+d,f.textContent=c,b.push(f),a(f).on("click",e),f};if(c&&c.settings&&this.$el.hasClass("mosaic-read-only-tile")===!1&&d("Edit","settings",this.settingsClicked.bind(this)),!a.mosaic.hasContentLayout){d("Delete","delete",this.deleteClicked.bind(this));var e=d("Confirm delete","confirm",this.confirmClicked.bind(this));a(e).hide();var f=d("Cancel","cancel",this.cancelClicked.bind(this));a(f).hide()}if(b.length>0){var g=a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-buttons");this.$el.prepend(g),b.forEach(function(a){g.append(a)})}},n.prototype.cancelClicked=function(b){b.preventDefault(),a(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).show(),a(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).hide()},n.prototype.deleteClicked=function(b){b.preventDefault(),a(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).hide(),a(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).show()},n.prototype.confirmClicked=function(b){b.preventDefault();var c=this.getConfig();if("app"===c.tile_type){var e=this.getUrl();e&&"undefined"!==e&&(a.mosaic.removeHeadTags(e),a.ajax({type:"POST",url:this.getDeleteUrl(),data:{"buttons.delete":"Delete",_authenticator:d.getAuthenticator()}}))}a.mosaic.options.panels.find(".mosaic-empty-row").remove();var f=this.$el.parent().parent();this.saveForm(),this.$el.remove(),a.mosaic.undo.snapshot(),f.mosaicCleanupRow(),a.mosaic.options.panels.mosaicAddEmptyRows(),a.mosaic.options.toolbar.trigger("selectedtilechange"),a.mosaic.options.toolbar.mosaicSetResizeHandleLocation()},n.prototype.settingsClicked=function(b){b.preventDefault();var c=this,d=c.getConfig();if("app"===d.tile_type){var e=c.getEditUrl();a.mosaic.overlay.app=new h(a(".mosaic-toolbar"),{ajaxUrl:e,loadLinksWithinModal:!0,buttons:'.formControls > input[type="submit"], .actionButtons > input[type="submit"]'}),a.mosaic.overlay.app.$el.off("after-render"),a.mosaic.overlay.app.on("after-render",function(b){a('input[name*="cancel"]',a.mosaic.overlay.app.$modal).off("click").on("click",function(){a.mosaic.overlay.app.hide(),a.mosaic.overlay.app=null}),a.mosaic.hasContentLayout&&a("form",a.mosaic.overlay.app.$modal).append(a('<input type="hidden" name="X-Tile-Persistent" value="yes" />'))}),a.mosaic.overlay.app.show(),a.mosaic.overlay.app.$el.off("formActionSuccess"),a.mosaic.overlay.app.on("formActionSuccess",function(b,d,e,f,g){var h=f.getResponseHeader("X-Tile-Url"),i=a.mosaic.getDomTreeFromHtml(d);if(h){a.mosaic.removeHeadTags(h),a.mosaic.addHeadTags(h,i);var j=i.find(".temp_body_tag").html();c.fillContent(j,h),a.mosaic.overlay.app.hide(),a.mosaic.overlay.app=null}})}else a.mosaic.overlay.open("field",d)},n.prototype.makeMovable=function(){this.$el.hasClass("movable")&&a.mosaic.options.canChangeLayout&&!a.mosaic.hasContentLayout&&this.$el.prepend(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-drag-handle"))},n.prototype.initializeContent=function(){var b,c,d,e,f,g=this,h=a("body",a.mosaic.document).attr("data-base-url");h||(h=a("head > base",a.mosaic.document).attr("href"));var i=this.getUrl(),k=this.getConfig();if("field"===k.tile_type){switch(e="","IDublinCore-title"===k.name?(c='<h1 class="documentFirstHeading">',d="</h1>"):"IDublinCore-description"===k.name?(c='<p class="documentDescription">',d="</p>"):(c="<div>",d="</div>"),k.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":e=c+a("#"+k.id).find("input").attr("value")+d;break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":f=a("#"+k.id).find("textarea").val().split("\n"),e+=c;for(var l=0;l<f.length;l+=1)e+=f[l]+"<br/>";e+=d;break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":e=a("#"+k.id).find("textarea").val();break;default:e='<div class="discreet">Placeholder for field:<br/><b>'+k.label+"</b></div>"}g.fillContent(e)}else k&&(g.$el.addClass("mosaic-tile-loading"),b=h?[h,i].join("/").replace(/\/+\.\//g,"/"):i,b+=-1===b.indexOf("?")?"?":"&",-1===b.indexOf("_layouteditor")&&(b+="_layouteditor=true"),a.ajax({type:"GET",url:b,success:function(c){g.$el.removeClass("mosaic-tile-loading"),c=a.mosaic.getDomTreeFromHtml(c),a.mosaic.addHeadTags(i,c);var d=c.find(".temp_body_tag").html();g.fillContent(d,b);var e=g.getType();if("plone.app.standardtiles.html"===e){g.$el.data("lastSavedData")||g.$el.data("lastSavedData",g.getHtmlContent());var f=0,h=function(){if(!(f>20)){if(!g.tinymce)return setTimeout(h,20),void(f+=1);try{g.tinymce.focus()}catch(a){}g.blur()}};g.setupWysiwyg(),h()}},error:function(){g.$el.removeClass("mosaic-tile-loading"),j.error("Error getting data for the tile "+k.label+"("+k.name+"). Please read documentation on how to correctly register tiles: https://pypi.python.org/pypi/plone.tiles")}}))},n.prototype.fillContent=function(a,b){var c,d=this.getDataTileEl();if(d.length>0?(d.parent().html(a),c=this.getContentEl()):(c=this.getContentEl(),c.html(a)),b&&c.size()>0){for(b=b.replace(/&/gim,"&amp;");-1!==b.indexOf("&amp;&amp;");)b=b.replace("&amp;&amp;","&amp;");c.attr("data-tileUrl",b)}this.cacheHtml(a),this.scanRegistry()},n.prototype.cacheHtml=function(a){if(!this.isRichText()){var b=this.$el.children(".mosaic-tile-content");0!==b.size()&&(void 0===a&&(a=b.html()),b[0]._preScanHTML=a)}},n.prototype.scanRegistry=function(){if(!this.isRichText()){var b=this.$el.find(".mosaic-tile-content");0!==b.size()&&(b[0]._preScanHTML&&b.html(b[0]._preScanHTML),e.scan(b),a("a",b).on("click",function(a){a.preventDefault(),a.stopPropagation()}))}},n.prototype.select=function(){if(this.$el.hasClass("mosaic-selected-tile")===!1&&this.$el.hasClass("mosaic-read-only-tile")===!1){var b=a(".mosaic-selected-tile",a.mosaic.document);if(1===b.size()){var c=new n(b);c.blur()}this.focus()}},n.prototype._change=function(){a.mosaic.options.toolbar.trigger("selectedtilechange"),a.mosaic.options.panels.mosaicSetResizeHandleLocation(),this.saveForm()},n.prototype.blur=function(){this.$el.removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),this.$el.find(".mce-edit-focus").removeClass("mce-edit-focus"),this._change()},n.prototype._focus=function(){var a=this;this.$el.addClass("mosaic-selected-tile"),this.$el.children(".mosaic-tile-content").focus(),this._change(),this.initializeButtons();var b=function(){a.focusCheckTimeout&&clearTimeout(a.focusCheckTimeout),a.focusCheckTimeout=setTimeout(function(){if(a.focusCheckCount+=1,a.$el.hasClass("mosaic-selected-tile")){var b=a.$el.find(".mosaic-rich-text");b.hasClass("mce-edit-focus")||(a.$el.removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),a.$el.find(".mce-edit-focus").removeClass("mce-edit-focus"),a._focus())}},50)};a.isRichText()&&a.focusCheckCount<30&&b()},n.prototype.focus=function(){this.isRichText()&&this.$el.data("tinymce-loaded")!==!0?this.$el.data("delayed-focus",!0):this._focus()},n.prototype.saveForm=function(){var b,c,d,e,f=this.getType(),h=this.getConfig();if(h&&"field"===h.tile_type&&h.read_only===!1&&("z3c.form.browser.text.TextWidget"===h.widget||"z3c.form.browser.text.TextFieldWidget"===h.widget||"z3c.form.browser.textarea.TextAreaWidget"===h.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===h.widget||"z3c.form.browser.textlines.TextLinesWidget"===h.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===h.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===h.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===h.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===h.widget||"plone.app.widgets.dx.RichTextWidget"===h.widget))switch(h.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":var i=a(".mosaic-panel .mosaic-"+f+"-tile",a.mosaic.document);i.size()>1&&(i=i.filter(function(){return a(".mosaic-tile-control",this).length>0}));var j=i.find(".mosaic-tile-content > *").text();a("#"+h.id).find("input").attr("value",j);break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":d="",e="IDublinCore-description"===h.name?" ":"\n",a(".mosaic-panel .mosaic-"+f+"-tile",a.mosaic.document).find(".mosaic-tile-content > *").each(function(){d+=a(this).html().replace(/<br[^>]*>/gi,e).replace("&nbsp;","").replace(/^\s+|\s+$/g,"")+e}),d=d.replace(/^\s+|\s+$/g,""),a("#"+h.id).find("textarea").val(d);break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":var k=a(document.getElementById(h.id)).find("textarea");b=k.attr("id"),c=g.get(b);var l=a(".mosaic-"+f+"-tile",a.mosaic.document).find(".mosaic-tile-content").html();k.val(l),c&&c.setContent(l)}},n.prototype.setupWysiwyg=function(){var b,c=this,d=c.$el.find(".mosaic-tile-content");try{d.data("pattern-tinymce").destroy(),d.removeData("pattern-tinymce"),c.$el.data("tinymce-loaded",!1)}catch(e){}for(var g=1+Math.floor(1e5*Math.random());a("#mosaic-rich-text-init-"+g,a.mosaic.document).length>0;)g=1+Math.floor(1e5*Math.random());var h="mosaic-rich-text-init-"+g;d.attr("id",h),d.siblings(".mosaic-rich-text-toolbar").remove();var i=a('<div class="mosaic-rich-text-toolbar"></div>').attr("id",d.attr("id")+"-panel");d.before(i);var j,k,m,o,p,q,r=c.getType();for(-1!==this.deprecatedHTMLTiles.indexOf(r)&&(r="plone.app.standardtiles.html"),j=a.mosaic.options.default_available_actions,m=0;m<a.mosaic.options.tiles.length;m+=1)for(k=a.mosaic.options.tiles[m],o=0;o<k.tiles.length;o+=1)k.tiles[o].name===r&&(j=j.concat(k.tiles[o].available_actions));for(p=[],m=0;m<a.mosaic.options.richtext_toolbar.length;m+=1){for(k=a.mosaic.options.richtext_toolbar[m],o=0;o<k.actions.length;o+=1)a.inArray(k.actions[o].name,j)>-1&&p.push(k.actions[o].action);p.length&&"|"!=p[p.length-1]&&p.push("|")}for(p.length&&"|"==p[p.length-1]&&p.pop(),q=[],m=0;m<a.mosaic.options.richtext_contextmenu.length;m+=1){for(k=a.mosaic.options.richtext_contextmenu[m],o=0;o<k.actions.length;o+=1)a.inArray(k.actions[o].name,j)>-1&&q.push(k.actions[o].action);q.length&&"|"!=q[q.length-1]&&q.push("|")}q.length&&"|"==q[q.length-1]&&q.pop();var s=function(){var a=d.find("p > *");(0===a.length||1===a.length&&a.is("br"))&&0===d.text().replace(/^\s+|\s+$/g,"").length?(d.addClass("mosaic-tile-content-empty"),0===d.find("p").length&&d.empty().append("<p></p>")):d.removeClass("mosaic-tile-content-empty")},t=0,u=function(){clearTimeout(t),t=setTimeout(s,100)};b=new f(d,a.extend(!0,{},a.mosaic.options.tinymce,{inline:!1,tiny:{body_id:h,selector:"#"+h,inline:!0,fixed_toolbar_container:"#"+i.attr("id"),theme_advanced_toolbar_align:"right",menubar:!1,toolbar:p.join(" ")||!1,statusbar:!1,contextmenu:q.join(" ")||!1,plugins:a.mosaic.options.tinymce.tiny.plugins.concat(q.length?["contextmenu"]:[]),setup:function(b){c.tinymce=b,b.on("focus",function(b){b.target.id&&(0===a(".mosaic-helper-tile").length?(c.select(),l()):setTimeout(function(){a(".mce-edit-focus").each(function(){var b=new n(a(this).parent());b.blur();var c=window.tinyMCE.get(this.getAttribute("id"));c&&c.hide()})},10))}),0===p.length&&b.on("keydown",function(a){return 13===a.keyCode?void a.preventDefault():void 0}),b.on("keyup change",u),u(),b.on("init",function(){c.$el.data("tinymce-loaded",!0),c.$el.data("delayed-focus")===!0&&(c.$el.data("delayed-focus",!1),setTimeout(function(){c._focus()},100))})}}})),d.addClass("mosaic-rich-text")},n.validTile=function(b){var c=a(b);return c.is(".mosaic-tile")?!0:c.parents(".mosaic-tile").size()>0},n}),define("mosaic-url/mosaic.panel",["jquery","pat-logger","underscore"],function(a,b,c){"use strict";var d=b.getLogger("pat-mosaic"),e=function(b){this.$el=a(b)};return e.prototype.initialize=function(b){var c,d=this.$el.data("panel"),e=a("[data-panel="+d+"]",a.mosaic.document),f=this.$el.data("max-columns")||4;"content"===d&&0===e.length&&a("#"+d,a.mosaic.document).each(function(){e=a(this),e.attr("data-panel",d)}),"content"===d?(c=e.attr("id"),0===a(".mosaic-original-content",a.mosaic.document).size()?(e.before(a(document.createElement("div")).attr("id",c).attr("class",e.attr("class")).addClass("mosaic-panel").attr("data-panel","content").attr("data-max-columns",f).html(b.find("[data-panel="+d+"]").html())),e.removeAttr("data-panel").removeAttr("id").addClass("mosaic-original-content")):e.replaceWith(a(document.createElement("div")).attr("id",c).attr("class",e.attr("class")).addClass("mosaic-panel").attr("data-panel","content").attr("data-max-columns",f).html(b.find("[data-panel="+d+"]").html()))):(e.attr("class",b.find("[data-panel="+d+"]").attr("class")),e.addClass("mosaic-panel"),e.html(b.find("[data-panel="+d+"]").html()))},e.prototype.prefill=function(){this.$el.hasClass("mosaic-panel")||(d.info(a(this)),a(this).addClass("mosaic-panel"),a(this).children().wrap(a('<div class="mosaic-grid-row"><div class="mosaic-grid-cell mosaic-width-full mosaic-position-leftmost"><div class="movable removable mosaic-tile mosaic-text-tile"><div class="mosaic-tile-content"></div></div></div></div>')))},e}),define("mosaic-url/mosaic.layout",["jquery","mosaic-url/mosaic.tile","pat-logger","underscore","pat-registry","mockup-patterns-modal"],function(a,b,c,d,e,f){"use strict";function g(a){switch(a){case 25:return"mosaic-width-quarter";case 33:return"mosaic-width-third";case 50:return"mosaic-width-half";case 66:case 67:return"mosaic-width-two-thirds";case 75:return"mosaic-width-three-quarters";case 100:return"mosaic-width-full"}return"mosaic-width-full"}function h(a){switch(a){case 0:return"mosaic-position-leftmost";case 25:return"mosaic-position-quarter";case 33:return"mosaic-position-third";case 50:return"mosaic-position-half";case 66:case 67:return"mosaic-position-two-thirds";case 75:return"mosaic-position-three-quarters"}return"mosaic-position-leftmost"}return"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.layout={widthClasses:["mosaic-width-quarter","mosaic-width-third","mosaic-width-half","mosaic-width-two-thirds","mosaic-width-three-quarters","mosaic-width-full"],positionClasses:["mosaic-position-leftmost","mosaic-position-quarter","mosaic-position-third","mosaic-position-half","mosaic-position-two-thirds","mosaic-position-three-quarters"]},a.fn.mosaicLayout=function(){var c=function(c){if(27===c.keyCode){var d=a(".mosaic-original-tile",a.mosaic.document);d.length>0?d.each(function(){a(this).addClass("mosaic-drag-cancel"),a(this).hasClass("mosaic-helper-tile-new")?a(document).trigger("mousedown"):a(document).trigger("mouseup")}):a(".mosaic-selected-tile",a.mosaic.document).each(function(){var a=new b(this);a.blur()}),a(".mosaic-resize-handle-helper",a.mosaic.document).each(function(){a(this).parents("[data-panel]").removeClass("mosaic-panel-resizing"),a(this).parent().removeClass("mosaic-row-resizing"),a(this).parent().children(".mosaic-resize-placeholder").remove(),a(this).remove()}),a.mosaic.overlay.app&&a.mosaic.overlay.app.hide()}};a(a.mosaic.document).off("keydown").on("keydown",c);var d=function(b){var c;if(b.target?c=b.target:b.srcElement&&(c=b.srcElement),!(a(c).parents(".mce-panel").length>0)){0===a(c).parents(".mosaic-tile").length&&0===a(c).parents(".mosaic-toolbar").length&&(a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),a.mosaic.options.toolbar.trigger("selectedtilechange"),a.mosaic.options.panels.mosaicSetResizeHandleLocation());var d=a(".mosaic-helper-tile-new",a.mosaic.document);d.length>0&&d.each(function(){a(this).mosaicHandleDragEnd()})}};a(a.mosaic.document).off("mousedown").on("mousedown",d);var e=function(b){a(".mosaic-helper-tile-new",a.mosaic.document).each(function(){var c=a(this).parent().offset();a(this).css("top",b.pageY+3-c.top),a(this).css("left",b.pageX+3-c.left)}),a(".mosaic-resize-handle-helper",a.mosaic.document).each(function(){var c,d,e=a(this),f=e.parent(),i=parseFloat(b.pageX-f.offset().left-4),j=i/e.data("row_width")*100,k=25,l=1e3;if(a([25,33,50,67,75]).each(function(){d=Math.abs(this-j),l>d&&(k=this,l=d)}),2===e.data("nr_of_columns"))e.data("column_sizes").split(" ")[0]!==k&&(f.children(".mosaic-resize-placeholder").each(function(b){0===b?a(this).removeClass(a.mosaic.layout.widthClasses.join(" ")).addClass(g(parseInt(k,10))):(a(this).removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(a.mosaic.layout.widthClasses.join(" ")).addClass(g(parseInt(100-k,10))).addClass(h(parseInt(k,10)).replace("position","resize")),e.removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(h(parseInt(k,10)).replace("position","resize")))}),a(this).data("column_sizes",k+" "+(100-k)));else{var m=a(this).data("resize_handle_index");if(1===m){if(e.data("column_sizes").split(" ")[a(this).data("resize_handle_index")-1]!==k&&parseInt(k,10)<=50)switch(c=f.children(".mosaic-resize-placeholder"),c.removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(a.mosaic.layout.widthClasses.join(" ")),e.removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(h(parseInt(k,10)).replace("position","resize")),parseInt(k,10)){case 25:a(c.get(0)).addClass(h(0).replace("position","resize")+" "+g(25)),a(c.get(1)).addClass(h(25).replace("position","resize")+" "+g(50)),a(c.get(2)).addClass(h(75).replace("position","resize")+" "+g(25)),e.data("column_sizes","25 50 25");break;case 33:a(c.get(0)).addClass(h(0).replace("position","resize")+" "+g(33)),a(c.get(1)).addClass(h(33).replace("position","resize")+" "+g(33)),a(c.get(2)).addClass(h(66).replace("position","resize")+" "+g(33)),e.data("column_sizes","33 33 33");break;case 50:a(c.get(0)).addClass(h(0).replace("position","resize")+" "+g(50)),a(c.get(1)).addClass(h(50).replace("position","resize")+" "+g(25)),a(c.get(2)).addClass(h(75).replace("position","resize")+" "+g(25)),e.data("column_sizes","50 25 25")}}else if(e.data("column_sizes").split(" ")[a(this).data("resize_handle_index")]!==100-k&&parseInt(k,10)>=50)switch(c=f.children(".mosaic-resize-placeholder"),c.removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(a.mosaic.layout.widthClasses.join(" ")),e.removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(h(parseInt(k,10)).replace("position","resize")),parseInt(k,10)){case 50:a(c.get(0)).addClass(h(0).replace("position","resize")+" "+g(25)),a(c.get(1)).addClass(h(25).replace("position","resize")+" "+g(25)),a(c.get(2)).addClass(h(50).replace("position","resize")+" "+g(50)),e.data("column_sizes","25 25 50");break;case 66:case 67:a(c.get(0)).addClass(h(0).replace("position","resize")+" "+g(33)),a(c.get(1)).addClass(h(33).replace("position","resize")+" "+g(33)),a(c.get(2)).addClass(h(66).replace("position","resize")+" "+g(33)),e.data("column_sizes","33 33 33");break;case 75:a(c.get(0)).addClass(h(0).replace("position","resize")+" "+g(25)),a(c.get(1)).addClass(h(25).replace("position","resize")+" "+g(50)),a(c.get(2)).addClass(h(75).replace("position","resize")+" "+g(25)),e.data("column_sizes","25 50 25")}}})};a(a.mosaic.document).off("mousemove").on("mousemove",e),a(a.mosaic.document).off("dragover").on("dragover",e);var f=function(c){a(".mosaic-resize-handle-helper",a.mosaic.document).each(function(){var c=a(this).parents("[data-panel]"),d=a(this).data("column_sizes").split(" ");a(this).parent().children(".mosaic-grid-cell").each(function(b){for(var c=0,e=0;b>e;e+=1)c+=parseInt(d[e],10);a(this).removeClass(a.mosaic.layout.positionClasses.join(" ")).removeClass(a.mosaic.layout.widthClasses.join(" ")).addClass(h(c)+" "+g(parseInt(d[b],10)))}),c.removeClass("mosaic-panel-resizing"),a(this).parent().removeClass("mosaic-row-resizing"),a(this).parent().children(".mosaic-resize-placeholder").remove(),a(this).parent().mosaicSetResizeHandles(),c.mosaicSetResizeHandleLocation();var e=c.find(".mosaic-selected-tile");if(e.size()>0){var f=new b(e);f.select()}a(this).remove()})};a(a.mosaic.document).off("mouseup").on("mouseup",f);var i=function(b){if(a(this).parents("[data-panel]").hasClass("mosaic-panel-dragging")&&(a(".mosaic-selected-divider",a.mosaic.document).removeClass("mosaic-selected-divider"),a(this).hasClass("mosaic-original-tile")===!1&&a(this).hasClass("mosaic-tile-align-left")===!1&&a(this).hasClass("mosaic-tile-align-right")===!1)){var c=a(this).mosaicGetDirection(b),d=a(this).children(".mosaic-divider-"+c);if("left"===c||"right"===c){var e=d.parent().parent().parent();if(e.children(".mosaic-grid-cell").length>=a(".mosaic-panel").data("max-columns"))return;e.children(".mosaic-grid-cell").length>1?(d.height(e.height()+5),d.css("top",e.offset().top-d.parent().offset().top-5)):(d.height(d.parent().height()+5),d.css("top",-5))}d.addClass("mosaic-selected-divider")}};a(a.mosaic.document).off("mousemove",".mosaic-tile").on("mousemove",".mosaic-tile",i),a(a.mosaic.document).off("dragover",".mosaic-tile").on("dragover",".mosaic-tile",i),a(a.mosaic.document).off("click",".mosaic-tile").on("click",".mosaic-tile",function(){if(0===a(".mosaic-helper-tile-new",a.mosaic.document).length){var c=new b(this);c.select()}});var j=this.length;return this.each(function(c){var d=a(this);if(d.find(".mosaic-tile").each(function(){var a=new b(this);a.initialize(),a.scanRegistry()}),d.find(".mosaic-tile").mosaicAddDrag(),d.mosaicAddEmptyRows(),d.children(".mosaic-grid-row").mosaicSetResizeHandles(),c===j-1){var e=0,f=0;a.mosaic.options.panels.each(function(b){a(this).width()>e&&(e=a(this).width(),f=b)});var g=a.mosaic.options.panels.eq(f).find(".mosaic-tile:first");if(g.size()>0){var h=new b(g);h.select()}}})},a.fn.mosaicAddMouseMoveEmptyRow=function(){return this.each(function(){a(this).mousemove(function(){var b=a(this).parents("[data-panel]");b.hasClass("mosaic-panel-dragging")&&(a(".mosaic-selected-divider",a.mosaic.document).removeClass("mosaic-selected-divider"),a(this).children("div").addClass("mosaic-selected-divider"))})})},a.fn.mosaicAddEmptyRows=function(){return this.each(function(){a(this).find(".mosaic-grid-row").each(function(b){a(this).children(".mosaic-grid-cell").length>1&&(0===b&&a(this).before(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(a(a.mosaic.document.createElement("div")).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow()),(0===a(this).nextAll(".mosaic-grid-row").length||a(this).next().children(".mosaic-grid-cell").length>1)&&a(this).after(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(a(a.mosaic.document.createElement("div")).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow()))}),0===a(this).find(".mosaic-grid-row").length&&a(this).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(a(a.mosaic.document.createElement("div")).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow())})},a.fn.mosaicGetWidthClass=function(){var b;for(b in a.mosaic.layout.widthClasses)if(a.mosaic.layout.widthClasses.hasOwnProperty(b)&&a(this).hasClass(a.mosaic.layout.widthClasses[b]))return a.mosaic.layout.widthClasses[b];for(b in a.mosaic.layout.widthClasses)if(a.mosaic.layout.widthClasses.hasOwnProperty(b)&&a(this).hasClass(a.mosaic.layout.widthClasses[b].replace("position","resize")))return a.mosaic.layout.widthClasses[b];
return a.mosaic.layout.widthClasses[0]},a.fn.mosaicGetPositionClass=function(){var b;for(b in a.mosaic.layout.positionClasses)if(a(this).hasClass(a.mosaic.layout.positionClasses[b]))return a.mosaic.layout.positionClasses[b];for(b in a.mosaic.layout.positionClasses)if(a(this).hasClass(a.mosaic.layout.positionClasses[b].replace("position","resize")))return a.mosaic.layout.positionClasses[b];return a.mosaic.layout.positionClasses[0]},a.fn.mosaicAddDrag=function(){return this.each(function(){var b=a(this),c=function(b){var c=a(".mosaic-helper-tile",a.mosaic.document),d=c.parents("[data-panel]").offset();c.css("top",b.pageY+3-d.top),c.css("left",b.pageX+3-d.left)},d=function(){var b=a(".mosaic-helper-tile",a.mosaic.document);a(a.mosaic.document).unbind("mousemove",c).unbind("mouseup",d),b.mosaicHandleDragEnd(),b.remove()};return b.each(function(){b.find("div.mosaic-drag-handle").unbind("mousedown").bind("mousedown",function(b){var e=b.pageX,f=b.pageY,g=function(b){if(Math.max(Math.abs(e-b.pageX),Math.abs(f-b.pageY))>=1){a.mosaic.options.panels.addClass("mosaic-panel-dragging"),a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur();var h=a(b.target).parents(".mosaic-tile"),i=h.clone(!0);h.addClass("mosaic-original-tile"),h.parents("[data-panel]").append(i),i.css({width:h.width(),position:"absolute",opacity:.5}).addClass("mosaic-helper-tile"),a(a.mosaic.document).mousemove(c),a(a.mosaic.document).mouseup(d),a(a.mosaic.document).unbind("mousemove",g)}};a(a.mosaic.document).bind("mousemove",g),a(a.mosaic.document).bind("mouseup",function(){a(a.mosaic.document).unbind("mousemove",g)})})})})},a.fn.mosaicHandleDragEnd=function(){var c=a(this).parents("[data-panel]");a.mosaic.options.panels.removeClass("mosaic-panel-dragging mosaic-panel-dragging-new");var e=a(".mosaic-selected-divider",a.mosaic.document),f=e.parent(),g="";d.each(["top","bottom","left","right"],function(a){e.hasClass("mosaic-divider-"+a)&&(g=a)}),e.removeClass("mosaic-selected-divider");var h=a(".mosaic-helper-tile-new",a.mosaic.document).length>0,i=a(".mosaic-original-tile",a.mosaic.document);if((0===e.length||f.hasClass("mosaic-helper-tile"))&&i.addClass("mosaic-drag-cancel"),i.hasClass("mosaic-drag-cancel"))i.removeClass("mosaic-drag-cancel"),a.mosaic.options.panels.find(".mosaic-empty-row").remove(),h||i.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");else if(f.hasClass("mosaic-empty-row"))f.removeClass("mosaic-empty-row").attr("class",i.parents(".mosaic-grid-row").first().attr("class")).unbind("mousemove"),f.children(".mosaic-grid-cell").children("div").remove(),f.children(".mosaic-grid-cell").append(i.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile")),a(".mosaic-empty-row",a.mosaic.document).remove();else if(f.hasClass("mosaic-tile")===!1)a(".mosaic-empty-row",a.mosaic.document).remove(),h||i.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");else if(f.parent().parent().children(".mosaic-grid-cell").length>=c.data("max-columns")&&("left"===g||"right"===g))a(".mosaic-empty-row",a.mosaic.document).remove(),h||i.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");else if(a(".mosaic-empty-row",a.mosaic.document).remove(),"top"===g)f.before(i.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"));else if("bottom"===g)f.after(i.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"));else if("left"===g||"right"===g)if(1===f.parent().parent().children(".mosaic-grid-cell").length){var j=f.prevAll();j.length>0&&(f.parent().parent().before(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(a(j.get().reverse()).clone(!0).mosaicAddDrag()))),j.remove());var k=f.nextAll();k.length>0&&(f.parent().parent().after(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(k.clone(!0).mosaicAddDrag()))),k.remove()),f.parent().removeClass(a.mosaic.layout.widthClasses.join(" ")).removeClass(a.mosaic.layout.positionClasses.join(" ")).addClass("mosaic-width-half"),"left"===g?f.parent().addClass("mosaic-position-half").before(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-leftmost").append(i.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))):f.parent().addClass("mosaic-position-leftmost").after(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-half").append(i.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))),f.parent().parent().mosaicSetResizeHandles()}else"left"===g?f.parent().before(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell").append(i.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))):f.parent().after(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell").append(i.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))),f.parent().parent().mosaicSetColumnSizes(),f.parent().parent().mosaicSetResizeHandles();var l=i.parent().parent();a(".mosaic-original-tile",a.mosaic.document).remove(),l.mosaicCleanupRow(),a.mosaic.options.panels.mosaicAddEmptyRows();var m=a(".mosaic-new-tile",a.mosaic.document);m.removeClass("mosaic-new-tile");var n=new b(m),o=i.find(".mosaic-tile-content");o.size()>0&&o[0]._preScanHTML&&n.cacheHtml(o[0]._preScanHTML),n.isRichText()||n.scanRegistry(),a('.mosaic-tile:not(".mosaic-helper-tile") .mosaic-tile-content.mosaic-rich-text').each(function(){var c=new b(a(this).parent());c.setupWysiwyg()}),n.blur(),h&&n.focus()},a.fn.mosaicSetColumnSizes=function(){return this.each(function(){var b=a(this).children(".mosaic-grid-cell").length;a(this).children(".mosaic-grid-cell").each(function(c){switch(a(this).removeClass(a.mosaic.layout.widthClasses.join(" ")).removeClass(a.mosaic.layout.positionClasses.join(" ")),b){case 1:a(this).addClass("mosaic-width-full mosaic-position-leftmost");break;case 2:switch(c){case 0:a(this).addClass("mosaic-width-half mosaic-position-leftmost");break;case 1:a(this).addClass("mosaic-width-half mosaic-position-half")}break;case 3:switch(c){case 0:a(this).addClass("mosaic-width-third mosaic-position-leftmost");break;case 1:a(this).addClass("mosaic-width-third mosaic-position-third");break;case 2:a(this).addClass("mosaic-width-third mosaic-position-two-thirds")}break;case 4:switch(c){case 0:a(this).addClass("mosaic-width-quarter mosaic-position-leftmost");break;case 1:a(this).addClass("mosaic-width-quarter mosaic-position-quarter");break;case 2:a(this).addClass("mosaic-width-quarter mosaic-position-half");break;case 3:a(this).addClass("mosaic-width-quarter mosaic-position-three-quarters")}}})})},a.fn.mosaicSetResizeHandles=function(){return this.each(function(){a(this).children(".mosaic-resize-handle").remove();var b=a(this).children(".mosaic-grid-cell").length;switch(b){case 2:a(this).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-one "+a(a(this).children(".mosaic-grid-cell").get(1)).mosaicGetPositionClass().replace("position","resize")));break;case 3:a(this).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-one "+a(a(this).children(".mosaic-grid-cell").get(1)).mosaicGetPositionClass().replace("position","resize"))),a(this).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-two "+a(a(this).children(".mosaic-grid-cell").get(2)).mosaicGetPositionClass().replace("position","resize")))}a(this).children(".mosaic-resize-handle").mousedown(function(){var b=[];a(this).parent().children(".mosaic-grid-cell").each(function(){switch(a(this).mosaicGetWidthClass()){case"mosaic-width-half":b.push("50");break;case"mosaic-width-quarter":b.push("25");break;case"mosaic-width-third":b.push("33");break;case"mosaic-width-two-thirds":b.push("66");break;case"mosaic-width-three-quarters":b.push("75")}a(this).parent().append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-placeholder "+a(this).mosaicGetWidthClass()+" "+a(this).mosaicGetPositionClass().replace("position","resize")).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-placeholder-inner-border")))});var c=1;return a(this).hasClass("mosaic-resize-handle-two")&&(c=2),a(this).parent().append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-helper").addClass(a(this).mosaicGetPositionClass().replace("position","resize")).data("row_width",a(this).parent().width()).data("nr_of_columns",a(this).parent().children(".mosaic-grid-cell").length).data("column_sizes",b.join(" ")).data("resize_handle_index",c)),a(this).parents("[data-panel]").addClass("mosaic-panel-resizing"),a(this).parent().addClass("mosaic-row-resizing"),a(".mosaic-selected-tile",a.mosaic.document).children(".mosaic-tile-content").blur(),!1})})},a.fn.mosaicCleanupRow=function(){return this.each(function(){var b=a(this);if(b.children(".mosaic-grid-cell").each(function(){0===a(this).children().length&&(a(this).remove(),b.mosaicSetColumnSizes())}),0===b.find(".mosaic-tile").length){var c=b;if(b.nextAll(".mosaic-grid-row").length>0)b=b.next(".mosaic-grid-row");else{if(!(b.prevAll(".mosaic-grid-row").length>0))return void b.remove();b=b.prev(".mosaic-grid-row")}c.remove()}b.mosaicSetResizeHandles()})},a.fn.mosaicSetResizeHandleLocation=function(){var b=a(this);b.children(".mosaic-grid-row").each(function(){var b=a(this),c=b.children(".mosaic-grid-cell");2!==c.length&&3!==c.length||(b.children(".mosaic-resize-handle").removeClass("mosaic-resize-handle-left mosaic-resize-handle-center mosaic-resize-handle-right"),a(c.get(0)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(b.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-left"),b.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-center")):a(c.get(1)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(b.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-right"),b.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-left")):3===c.length&&a(c.get(2)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(b.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-center"),b.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-right")):(b.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-center"),b.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-center")))})},a.fn.mosaicGetDirection=function(b){var c=parseFloat(a(this).width()),d=parseFloat(a(this).height()),e=parseFloat(b.pageX-a(this).offset().left-c/2),f=parseFloat(b.pageY-a(this).offset().top-d/2),g=c/2,h=d/2;return 0>e?0>f?-1*g/(-1*h)>e/f?"top":"left":-1*g/h>e/f?"left":"bottom":0>f?1*g/(-1*h)>e/f?"right":"top":g/h>e/f?"bottom":"right"},a.mosaic.disableEditHtmlSource=function(){a(".mosaic-rich-text-textarea",a.mosaic.document).each(function(){var c,d;d=a(this).val(),c=a(this).parent(),c.html(d);var e=new b(a(this).parent());e.setupWysiwyg()})},a.mosaic.addAppTile=function(b,c){a.mosaic.overlay.app&&a.mosaic.overlay.app.hide(),a.ajax({type:"GET",url:c,success:function(d){d=a.mosaic.getDomTreeFromHtml(d),a.mosaic.addHeadTags(c,d),a.mosaic.addTile(b,d.find(".temp_body_tag").html(),c)}})},a.mosaic.addAppTileHTML=function(b,c,d){var e;e=a.mosaic.getDomTreeFromHtml(c),a.mosaic.addHeadTags(d,e),a.mosaic.addTile(b,e.find(".temp_body_tag").html(),d)},a.mosaic.editAppTile=function(b){a.mosaic.overlay.close(),window.parent.focus(),a.ajax({type:"GET",url:b,success:function(c){c=a.mosaic.getDomTreeFromHtml(c),a.mosaic.removeHeadTags(b),a.mosaic.addHeadTags(b,c);var d=a(".mosaic-selected-tile .mosaic-tile-content",a.mosaic.document);d.html(c.find(".temp_body_tag").html()),d.attr("data-tileUrl",b.replace(/&/gim,"&amp;"))}})},a.mosaic.addTile=function(c,d,e){a.mosaic.options.panels.addClass("mosaic-panel-dragging mosaic-panel-dragging-new"),a(a.mosaic.options.panels.get(0)).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-leftmost").append(a(a.mosaic.document.createElement("div")).addClass("movable removable mosaic-tile mosaic-"+c+"-tile").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-content").attr("data-tileUrl",e&&e.replace(/&/gim,"&amp;")).html(d)).addClass("mosaic-helper-tile mosaic-helper-tile-new mosaic-original-tile"))));var f=a.mosaic.options.panels.find(".mosaic-helper-tile-new"),g=0;a.mosaic.options.panels.each(function(){a(this).width()>g&&(g=a(this).width())}),f.width()<g/4?f.width(g/4):f.width(f.width());var h=new b(f);h.initialize(),h.cacheHtml(),h.scanRegistry()},a.mosaic.getDefaultValue=function(b){var c,d,e,f;switch("IDublinCore-title"===b.name?(e='<h1 class="documentFirstHeading">',f="</h1>"):"IDublinCore-description"===b.name?(e='<p class="documentDescription">',f="</p>"):(e="<div>",f="</div>"),b.tile_type){case"field":switch(b.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":return e+a("#"+b.id,a.mosaic.document).find("input").attr("value")+f;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":for(var g=a("#"+b.id,a.mosaic.document).find("textarea").val().split("\n"),h="",i=0;i<g.length;i+=1)h+=g[i]+"<br/>";return e+h+f;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":if(c=a("#"+b.id).find("textarea").attr("id"),d=tinymce.get(c),!d)return"";try{return d.getContent()}catch(j){return'<div class="discreet">Placeholder for field:<br/><b>'+b.label+"</b></div>"}break;default:return'<div class="discreet">Placeholder for field:<br/><b>'+b.label+"</b></div>"}break;default:return b.default_value}},a.mosaic.getPageContent=function(c){var d,e=1,f=12,g="",h="";return a.mosaic.disableEditHtmlSource(),g+="  <body>\n",a("[data-panel]",a.mosaic.document).each(function(){g+='    <div data-panel="'+a(this).data("panel")+'"',g+='         data-max-columns="'+a(this).data("max-columns")+'">\n',a(this).children(".mosaic-grid-row").each(function(){a(this).hasClass("mosaic-empty-row")===!1&&(h=a(this).attr("class"),g+='      <div class="'+h+'">\n',a(this).children(".mosaic-grid-cell").each(function(){switch(a(this).mosaicGetPositionClass()){case"mosaic-position-leftmost":e=1;break;case"mosaic-position-quarter":e=4;break;case"mosaic-position-third":e=5;break;case"mosaic-position-half":e=7;break;case"mosaic-position-two-thirds":e=9;break;case"mosaic-position-three-quarters":e=10}switch(a(this).mosaicGetWidthClass()){case"mosaic-width-half":f=6;break;case"mosaic-width-quarter":f=3;break;case"mosaic-width-third":f=4;break;case"mosaic-width-two-thirds":f=8;break;case"mosaic-width-three-quarters":f=9;break;case"mosaic-width-full":f=12}g+='        <div class="'+a(this).attr("class")+'">\n',a(this).children(".mosaic-tile").each(function(){var a=new b(this);g+=a.getHtmlBody(c)}),g+="        </div>\n"}),g+="      </div>\n")}),g+="    </div>\n"}),g+="  </body>\n",d='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" data-layout="'+a.mosaic.options.layout+'">\n',d+=g,d+="</html>\n"},a.mosaic.saveTileFormData=function(){a("[data-panel]",a.mosaic.document).each(function(){a(this).find(".mosaic-tile").each(function(){var a=new b(this);a.saveForm()})})},a.mosaic.saveLayoutToForm=function(){a.mosaic.saveTileFormData();var b=a("#form-widgets-ILayoutAware-content, [name='form.widgets.ILayoutAware.content']");a.mosaic.hasContentLayout?b.val(""):b.val(a.mosaic.getPageContent())},{Tile:b}}),define("mosaic-url/mosaic.toolbar",["jquery","mosaic-url/mosaic.tile","mosaic-url/mosaic.layout"],function(a,b){"use strict";function c(b,c){var e;void 0!==typeof c.menu&&c.menu?c.icon?(e=a(document.createElement("label")),b.append(e.addClass("mosaic-icon-menu mosaic-icon-menu-"+d(c.name)+" mosaic-icon").html(c.label).attr("title",c.label).append(a(document.createElement("select")).addClass("mosaic-menu-"+d(c.name)).data("action",c.action).change(function(){a(this).mosaicExecAction()}).each(function(){var b,e,f;for(b in c.items)if(void 0!==c.items[b].items){a(this).append(a(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+d(c.items[b].value)).attr("label",c.items[b].label)),e=a(this).find(".mosaic-option-group-"+d(c.items[b].value));for(f in c.items[b].items)e.append(a(document.createElement("option")).attr("value",c.items[b].items[f].value).addClass("mosaic-option mosaic-option-"+d(c.items[b].items[f].value)).html(c.items[b].items[f].label))}else a(this).append(a(document.createElement("option")).attr("value",c.items[b].value).addClass("mosaic-option mosaic-option-"+d(c.items[b].value)).html(c.items[b].label))})))):(e=a(document.createElement("select")),b.append(e.addClass("mosaic-menu mosaic-menu-"+c.name.replace(/_/g,"-")).data("action",c.action).change(function(){a(this).mosaicExecAction()}).each(function(){var b,e,f;for(b=0;b<c.items.length;b+=1)if(void 0!==c.items[b].items){a(this).append(a(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+d(c.items[b].value)).attr("label",c.items[b].label)),e=a(this).find(".mosaic-option-group-"+d(c.items[b].value));for(f in c.items[b].items)e.append(a(document.createElement("option")).attr("value",c.items[b].items[f].value).addClass("mosaic-option mosaic-option-"+d(c.items[b].items[f].value)).html(c.items[b].items[f].label))}else a(this).append(a(document.createElement("option")).attr("value",c.items[b].value).addClass("mosaic-option mosaic-option-"+d(c.items[b].value)).html(c.items[b].label))}))):(e=a(document.createElement("button")),b.append(e.addClass("mosaic-button mosaic-button-"+d(c.name)+(c.icon?" mosaic-icon":"")).html(c.label).attr("title",c.label).attr("type","button").data("action",c.action).mousedown(function(){a(this).mosaicExecAction()}))),a.mosaic.actionManager.actions[c.name]&&(a.mosaic.actionManager.actions[c.name].visible()||e.hide())}"undefined"==typeof a.mosaic&&(a.mosaic={});var d=function(a){return a.replace(/(_|\.|\/)/g,"-").toLowerCase()};a.fn._mosaicToolbarLayoutEditor=function(b){a(".mosaic-toolbar-secondary-functions",this).show();var e,f,g,h;if(void 0!==a.mosaic.options.formats)for(e=0;e<a.mosaic.options.formats.length;e+=1){for(g=a.mosaic.options.formats[e],b.primary_actions.append(a(document.createElement("fieldset")).addClass("mosaic-button-group mosaic-button-group-"+d(g.name))),h=b.primary_actions.children(".mosaic-button-group-"+g.name.replace(/_/g,"-")),f=0;f<g.actions.length;f+=1)g.actions[f].favorite&&c(h,g.actions[f]);0===h.children().length&&h.remove()}if(void 0!==a.mosaic.options.tiles){var i=b.secondary_actions.find(".mosaic-menu-insert");for(e=0;e<a.mosaic.options.tiles.length;e+=1){for(g=a.mosaic.options.tiles[e],i.append(a(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+d(g.name)).attr("label",g.label)),h=b.secondary_actions.find(".mosaic-option-group-"+d(g.name)),f=0;f<g.tiles.length;f+=1){var j=g.tiles[f];h.append(a(document.createElement("option")).addClass("mosaic-option mosaic-option-"+d(j.name)).attr("value",j.name).html(j.label))}0===h.children().length&&h.remove()}}if(void 0!==a.mosaic.options.formats){var k=b.secondary_actions.find(".mosaic-menu-format");for(e=0;e<a.mosaic.options.formats.length;e+=1){for(g=a.mosaic.options.formats[e],k.append(a(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+d(g.name)).attr("label",g.label)),h=b.secondary_actions.find(".mosaic-option-group-"+d(g.name)),f=0;f<g.actions.length;f+=1){var l=g.actions[f];l.favorite===!1&&h.append(a(document.createElement("option")).addClass("mosaic-option mosaic-option-"+d(l.name)).attr("value",l.name).html(l.label).data("action",l.action))}0===h.children().length&&h.remove()}}},a.fn.mosaicToolbar=function(){return this.each(function(){var e,f,g,h,i,j,k,l,m;e=a(this),e.html(""),e.append(a(document.createElement("div")).addClass("mosaic-inline-toolbar")),e=e.children(".mosaic-inline-toolbar"),e.append(a(document.createElement("div")).addClass("mosaic-toolbar-content")),f=e.children(".mosaic-toolbar-content"),g={},f.append(a(document.createElement("div")).addClass("mosaic-toolbar-primary-functions")),g.primary_actions=f.children(".mosaic-toolbar-primary-functions"),f.append(a(document.createElement("div")).addClass("mosaic-toolbar-secondary-functions")),g.secondary_actions=f.children(".mosaic-toolbar-secondary-functions");for(h in g)for(i=0;i<a.mosaic.options[h].length;i+=1)if(void 0===a.mosaic.options[h][i].actions)c(g[h],a.mosaic.options[h][i]);else{j=a.mosaic.options[h][i];var n=d(a.mosaic.options[h][i].name),o=a(document.createElement("div")).addClass("mosaic-button-group mosaic-button-group-"+n);o.append(c(o,a.extend({},!0,j,{action:j.name.toLowerCase(),name:j.name.toLowerCase()})));var p=a(document.createElement("div")).addClass("btn-container");for(o.append(p),g[h].append(o),k=0;k<j.actions.length;k+=1)c(p,j.actions[k])}e._mosaicToolbarLayoutEditor(g),a.mosaic.hasContentLayout&&a(".mosaic-toolbar-secondary-functions",this).hide(),l=function(){var b;parseInt(a(window).scrollTop(),10)>parseInt(e.parent().offset().top,10)?e.hasClass("mosaic-inline-toolbar")&&(b=e.offset().left,e.width(e.width()).css({left:b,"margin-left":"0px"}).removeClass("mosaic-inline-toolbar").addClass("mosaic-external-toolbar").parent().height(e.height())):e.hasClass("mosaic-external-toolbar")&&e.css({width:"",left:"","margin-left":""}).removeClass("mosaic-external-toolbar").addClass("mosaic-inline-toolbar").parent().css("height","")},a(window).bind("scroll",l),m=function(){var c,d,e,f,g,h;a.mosaic.disableEditHtmlSource(),c=a(this);var i=a(".mosaic-selected-tile",a.mosaic.document);if(i.length>0){var j=new b(i);d=j.getType()}for(e=a.mosaic.options.default_available_actions,f=0;f<a.mosaic.options.tiles.length;f+=1)for(g=a.mosaic.options.tiles[f],h=0;h<g.tiles.length;h+=1)g.tiles[h].name===d&&(e=e.concat(g.tiles[h].available_actions));i.hasClass("removable")||(e=a(e).filter(function(){return"remove"!==this})),c.find(".mosaic-option-group").show(),c.find(".mosaic-button").hide(),c.find(".mosaic-menu").hide(),c.find(".mosaic-icon-menu").hide(),c.find(".mosaic-menu-format").find(".mosaic-option").hide().attr("disabled","disabled"),a(c.find(".mosaic-menu-format").find(".mosaic-option").get(0)).show().removeAttr("disabled"),a(e).each(function(b,d){a.mosaic.actionManager.actions[d]&&!a.mosaic.actionManager.actions[d].visible()||(c.find(".mosaic-button-"+d).show(),c.find(".mosaic-icon-menu-"+d).show(),c.find(".select2-container.mosaic-menu-"+d).show(),c.find(".mosaic-option-"+d).show().removeAttr("disabled"))}),a.mosaic.actionManager.actions.layout.visible()&&a(".mosaic-button-layout").show(),c.find(".mosaic-menu-insert").children(".mosaic-option-group-fields").children().each(function(){0===a.mosaic.options.panels.find(".mosaic-"+a(this).attr("value")+"-tile").length?a(this).show().removeAttr("disabled"):a(this).hide().attr("disabled","disabled")}),c.find(".mosaic-option-group").each(function(){0===a(this).children(":enabled").length&&a(this).hide()}),a(".mosaic-menu, .mosaic-icon-menu",a.mosaic.document).each(function(){1===a(this).find(".mosaic-option:enabled").length&&a(this).hide()}),!a.mosaic.hasContentLayout&&a.mosaic.options.canChangeLayout?a(".mosaic-button-savelayout").show():a(".mosaic-button-savelayout").hide()},a(this).bind("selectedtilechange",m),a(this).trigger("selectedtilechange"),a(".mosaic-menu").each(function(){a(this).select2({width:"style",dropdownCssClass:"mosaic-dropdown mosaic-dropdown-"+a(this).data("action"),dropdownAutoWidth:!0,minimumResultsForSearch:99})});var q=(new Date).getTime();a(this).on("selectedtilechange",function(){a.mosaic.overlay.app||(new Date).getTime()-q>6e3&&(a.mosaic.saveLayoutToForm(),setTimeout(function(){a("#form-widgets-ILayoutAware-contentLayout, [name='form.widgets.ILayoutAware.contentLayout']").blur()},1e3),q=(new Date).getTime())})})}}),define("mosaic-url/mosaic.actions",["jquery","mosaic-url/mosaic.tile","mockup-utils","mockup-patterns-modal"],function(a,b,c,d){"use strict";"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.actionManager={actions:[],shortcuts:[]},a.mosaic.registerAction=function(b,c){c=a.extend({exec:function(){},shortcut:{ctrl:!1,alt:!1,shift:!1,key:""},visible:function(a){return!0},undoable:!1},c),a.mosaic.actionManager.actions[b]=c,""!==c.shortcut.key&&(c.shortcut.charCode=c.shortcut.key.toUpperCase().charCodeAt(0),c.shortcut.action=b,a.mosaic.actionManager.shortcuts.push(c.shortcut))},a.fn.mosaicExecAction=function(){return this.each(function(){if(""!==a(this).data("action")){var b=a.mosaic.actionManager;b.actions[a(this).data("action")].exec(this),b.actions[a(this).data("action")].undoable&&a.mosaic.undo.snapshot()}})},a.mosaic.fixWebkitSpan=function(){var b=a(".Apple-style-span",a.mosaic.document);b.after(b.html()),b.remove()},a.mosaic.getPrefixedClassName=function(a){return a.indexOf("-")>-1?"mosaic-"+a:"mosaic"+a.charAt(0).toUpperCase()+a.slice(1)},a.mosaic.initActions=function(){a.mosaic.registerAction("tile-toggle-class",{exec:function(){var b;arguments.length>0&&arguments[0].value&&(b=a.mosaic.getPrefixedClassName(arguments[0].value),a(".mosaic-selected-tile",a.mosaic.document).toggleClass(b))}}),a.mosaic.registerAction("tile-remove-format",{exec:function(){var b,c,d,e,f;for(b=0;b<a.mosaic.options.formats.length;b++)for(d=a.mosaic.options.formats[b],c=0;c<d.actions.length;c++)e=d.actions[c],"tile"===e.category&&(f=a.mosaic.getPrefixedClassName(e.name),a(".mosaic-selected-tile",a.mosaic.document).removeClass(f))}}),a.mosaic.registerAction("row-toggle-class",{exec:function(){var b;arguments.length>0&&arguments[0].value&&(b=a.mosaic.getPrefixedClassName(arguments[0].value),a(".mosaic-selected-tile",a.mosaic.document).parents(".mosaic-grid-row").first().toggleClass(b))}}),a.mosaic.registerAction("row-remove-format",{exec:function(){var b,c,d,e,f;for(b=0;b<a.mosaic.options.formats.length;b++)for(d=a.mosaic.options.formats[b],c=0;c<d.actions.length;c++)e=d.actions[c],"row"===e.category&&(f=a.mosaic.getPrefixedClassName(e.name),a(".mosaic-selected-tile",a.mosaic.document).parents(".mosaic-grid-row").first().removeClass(f))}}),a.mosaic.registerAction("tile-align-block",{exec:function(){a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-tile-align-right").removeClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"b"}}),a.mosaic.registerAction("tile-align-left",{exec:function(){a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-tile-align-right").addClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"l"}}),a.mosaic.registerAction("tile-align-right",{exec:function(){a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-tile-align-left").addClass("mosaic-tile-align-right")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"r"}}),a.mosaic.registerAction("save",{exec:function(){a.mosaic.options.toolbar.trigger("selectedtilechange"),a.mosaic.saveLayoutToForm(),a("#form-buttons-save").click()},shortcut:{ctrl:!0,alt:!1,shift:!1,key:"s"}}),a.mosaic.registerAction("cancel",{exec:function(){a("#form-buttons-cancel").click()}}),a.mosaic.registerAction("html",{exec:function(){var b,c,d;b=a(".mosaic-selected-tile",a.mosaic.document).children(".mosaic-tile-content"),0===b.find(".mosaic-rich-text-textarea").length&&(c=b.html(),d=b.height(),b.empty(),b.prepend(a(a.mosaic.document.createElement("textarea")).addClass("mosaic-rich-text-textarea").html(a.trim(c)).height(d)))}}),a.mosaic.registerAction("undo",{exec:function(){a.mosaic.undo.undo()}}),a.mosaic.registerAction("redo",{exec:function(){a.mosaic.undo.redo()}}),a.mosaic.registerAction("properties",{exec:function(){a.mosaic.overlay.open("all")}}),a.mosaic.registerAction("layout",{exec:function(){var b=a(".mosaic-button-group-layout");b.toggleClass("active")},visible:function(){return!0}}),a.mosaic.registerAction("customizelayout",{exec:function(){a.mosaic.setSelectedContentLayout(""),a(".mosaic-toolbar-secondary-functions").show(),a(".mosaic-button-customizelayout").hide(),a(".mosaic-button-savelayout").show(),a(".mosaic-panel .mosaic-tile",a.mosaic.document).each(function(){var a=new b(this);a.makeMovable(),a.$el.mosaicAddDrag()}),a(".mosaic-button-group-layout").removeClass("active")},visible:function(){return a.mosaic.hasContentLayout&&a.mosaic.options.canChangeLayout}}),a.mosaic.registerAction("changelayout",{exec:function(){var b=a.mosaic.hasContentLayout;b||(b=confirm("Changing your layout will destroy all existing custom layout settings you have in place. Are you sure you want to continue?")),b&&a.mosaic.selectLayout(),a(".mosaic-button-group-layout").removeClass("active")},visible:function(){return a.mosaic.options.available_layouts.length>0}}),a.mosaic.registerAction("savelayout",{exec:function(){a.mosaic.saveLayout(),a(".mosaic-button-group-layout").removeClass("active")},visible:function(){return!0}}),a.mosaic.registerAction("add-tile",{exec:function(){var b=new d(a(".mosaic-toolbar"),{ajaxUrl:a.mosaic.options.context_url+"/@@add-tile?form.button.Create=Create"});b.show()}}),a.mosaic.registerAction("format",{exec:function(b){a(b).find("[value="+a(b).val()+"]").mosaicExecAction(),a(b).select2("val","none")}}),a.mosaic.registerAction("insert",{exec:function(b){var e,f,g,h,i;if("none"===a(b).val())return!1;for(g=a(b).val(),a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),a.mosaic.options.panels.trigger("selectedtilechange"),h=0;h<a.mosaic.options.tiles.length;h+=1)for(f=a.mosaic.options.tiles[h],i=0;i<f.tiles.length;i+=1)f.tiles[i].name===g&&(e=f.tiles[i]);if("textapp"===e.tile_type){var j="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)}),k=a.mosaic.options.context_url+"/@@"+g+"/"+j,l="<html><body>"+a.mosaic.getDefaultValue(e)+"</body></html>";a.mosaic.addAppTileHTML(g,l,k)}else if("app"===e.tile_type){var m=!0;c.loading.show(),a.ajax({type:"GET",url:a.mosaic.options.context_url+"/@@add-tile?tiletype="+g+"&form.button.Create=Create",
success:function(b,e){c.loading.hide();var f,h,i,j;f=a(b),h=f.find("#add_tile").attr("action"),i=f.find('[name="_authenticator"]').val(),j=function(b){a.mosaic.overlay.app=new d(a(".mosaic-toolbar"),{html:b,loadLinksWithinModal:!0,buttons:'.formControls > input[type="submit"], .actionButtons > input[type="submit"]'}),a.mosaic.overlay.app.$el.off("after-render"),a.mosaic.overlay.app.on("after-render",function(b){m&&(a(".field.error",a.mosaic.overlay.app.$modal).removeClass("error"),a(".fieldErrorBox,.portalMessage",a.mosaic.overlay.app.$modal).remove(),m=!1),a('input[name*="cancel"]',a.mosaic.overlay.app.$modal).off("click").on("click",function(){a.mosaic.overlay.app.hide(),a.mosaic.overlay.app=null})}),a.mosaic.overlay.app.show(),a.mosaic.overlay.app.$el.off("formActionSuccess"),a.mosaic.overlay.app.on("formActionSuccess",function(b,c,d,e){var f=e.getResponseHeader("X-Tile-Url");f&&(a.mosaic.addAppTileHTML(g,c,f),a.mosaic.overlay.app.hide(),a.mosaic.overlay.app=null)})},a("form .required",f).filter(function(){var b=a(this).parents(".field").first().find("input, select, textarea").not('[type="hidden"]').last().val();return null===b||0===b.length}).length>0?j(b):h&&a("form",f).ajaxSubmit({type:"POST",url:h,data:{"buttons.save":"Save",_authenticator:i},success:function(b,c,d){var e=d.getResponseHeader("X-Tile-Url");e?a.mosaic.addAppTileHTML(g,b,e):j(b)}})}})}else a.mosaic.addTile(g,a.mosaic.getDefaultValue(e));return a(b).select2("val","none"),!0}}),a(document).keypress(function(b){var c="";return a(a.mosaic.actionManager.shortcuts).each(function(){b.ctrlKey!==this.ctrl&&(-1===navigator.userAgent.toLowerCase().indexOf("macintosh")||b.metaKey!==this.ctrl)||b.altKey!==this.alt&&void 0!==b.altKey||b.shiftKey!==this.shift||!b.charCode||String.fromCharCode(b.charCode).toUpperCase().charCodeAt(0)!==this.charCode||(c=this.action)}),""!==c?(a.mosaic.actionManager.actions[c].exec(),a.mosaic.actionManager.actions[c].undoable&&a.mosaic.undo.snapshot(),!1):!0})}}),define("mosaic-url/mosaic.core",["jquery","pat-logger","underscore","mosaic-url/mosaic.tile","mosaic-url/mosaic.panel","mockup-patterns-modal","mockup-utils","mosaic-url/mosaic.toolbar","mosaic-url/mosaic.layout","mosaic-url/mosaic.actions"],function(a,b,c,d,e,f,g){"use strict";b.getLogger("pat-mosaic");"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.loaded=!1,a.mosaic.selectLayoutTemplate=c.template('<div><h1>Select Layout</h1><div class="mosaic-select-layout"><div class="global-layouts"><ul><% _.each(available_layouts, function(layout){ var screenshot = layout.preview || layout.screenshot;if(!screenshot){screenshot = "++plone++mosaic/img/default-layout-screenshot.png";} %><li><a href="#" data-value="<%- layout.path %>"><p><%- layout.title %></p><img src="<%- portal_url %>/<%- screenshot %>"></a></li><% }); %></ul></div><% if(user_layouts.length > 0){ %><div class="user-layouts"><h4>My Layouts</h4><ul><% _.each(user_layouts, function(layout){ var screenshot = layout.preview || layout.screenshot;if(!screenshot){screenshot = "++plone++mosaic/img/default-layout-screenshot.png";} %><li><a href="#" data-value="<%- layout.path %>"><p><%- layout.title %></p><img src="<%- portal_url %>/<%- screenshot %>"></a></li><% }); %></ul></div><% } %><% if(hasCustomLayouts) { %><p class="manage-custom-layouts"><a href="#" class="plone-btn plone-btn-default">Manage custom layouts</a></p><% } %></div><div class="buttons"><!-- <button class="plone-btn plone-btn-default">Select</button> --></div></div>'),a.mosaic.saveLayoutTemplate=c.template('<div><h1>Save Layout</h1><div class="mosaic-save-layout"><p>This process takes a copy of the existing layout and saves it to a new, resuable layout.</p><div class="form-group field"><label for="layoutNameField">Name</label><input type="text" name="name" class="form-control" id="layoutNameField" /></div><div class="field form-group"><span class="option"><input id="globalLayout" type="checkbox"><label for="globalLayout"><span class="label">Global</span></label></span><div class="formHelp">Should this layout be available for all users on the site?</div></div></div><div class="buttons"><button class="plone-btn plone-btn-primary">Save</button></div></div>'),a.mosaic.manageLayoutsTemplate=c.template('<div><h1>Manage custom layouts</h1><div class="mosaic-manage-custom-layouts"><table><thead><tr><th>Name</th><th>Path</th><th>Actions</th></tr></thead><tbody><% _.each(available_layouts.concat(user_layouts), function(layout){ %><% if(layout.path.indexOf("custom/") !== -1){ %><tr><td><%- layout.title %></td><td><%- layout.path %></td><td><a href="#" class="btn btn-danger delete-layout" data-layout="<%- layout.path %>">Delete</a></td></tr><% } %><% }); %></tbody></table></div></div>'),a.mosaic.deleteLayoutTemplate=c.template('<div><h1>Delete layout</h1><div class="mosaic-delete-layout"><% if(existing.length === 0 && !selected){  %><div class="portalMessage warning"><strong>Warning</strong>Are you certain you want to delete this layout? This can not be undone.</div><% } else { %><div class="portalMessage error"><strong>Warning</strong>Are you certain you want to delete this layout? This can not be undone. <% if(existing.length > 0) { %>There are currently <%- existing.length %> items assigned to this layout. <% } %>You need to provide a replacement layout for the existing items in order to delete this for items currently assigned to this.</div><div class="form-group field"><label for="layoutField">Replacement Layout</label><select name="layout" class="form-control" id="layoutField"><% _.each(available_layouts.concat(user_layouts), function(l){ %><% if(l.path !== layout.path){ %><option value="<%- l.path %>"><%- l.title %></option><% } %><% }); %></select></div><% } %></div><div class="buttons"><button class="plone-btn plone-btn-danger delete">Yes, delete</button><button class="plone-btn plone-btn-default cancel">No</button></div></div>'),a.mosaic.initialized=function(){a.mosaic.loaded||(a.mosaic.loaded=!0,a.mosaic.undo.snapshot())},a.mosaic.init=function(b){b=a.extend({url:window.document.location.href,type:"",ignore_context:!1},b),a.mosaic.document=window.document;var c;a.mosaic.initActions(),c=b.url.match(/^([\w#!:.?+=&%@!\-\/]+)\/edit$/),c&&(b.url=c[1]),c=b.url.match(/^([\w#:.?=%@!\-\/]+)\/\+\+add\+\+([\w#!:.?+=&%@!\-\/]+)$/),c&&(b.url=c[1],b.type=c[2],b.ignore_context=!0),a.mosaic.options=b.data,a.mosaic.options.url=b.url,a.mosaic.options.ignore_context=b.ignore_context,a.mosaic.options.tileheadelements=[],a.mosaic.hasContentLayout=!0;var d=a.mosaic.getSelectedContentLayout();if(d)a.mosaic.applyLayout(d);else{var e=a(a.mosaic.options.customContentLayout_field_selector).val();if(e){var f=a.mosaic.getDomTreeFromHtml(e);"no-layout"===f.attr("id")?a.mosaic.selectLayout(!0):(a("body").addClass("mosaic-layout-customized"),a.mosaic.hasContentLayout=!1,a.mosaic._init(f));var g=a(".mosaic-helper-tile-new");g.length>0&&g.parents(".mosaic-grid-row").remove()}else a.mosaic.selectLayout(!0)}},a.mosaic.getSelectedContentLayout=function(){return a(a.mosaic.options.contentLayout_field_selector).val()},a.mosaic.setSelectedContentLayout=function(b){return b?(a.mosaic.hasContentLayout=!0,a(".mosaic-toolbar-secondary-functions",a.mosaic.document).hide(),a("body").removeClass("mosaic-layout-customized")):(a("body").addClass("mosaic-layout-customized"),a.mosaic.hasContentLayout=!1),a(a.mosaic.options.contentLayout_field_selector).attr("value",b)},a.mosaic._initPanels=function(b){a.mosaic.options.layout=b.attr("data-layout"),a("[data-panel] [data-panel]",a.mosaic.document).removeAttr("data-panel"),b.find("[data-panel]").each(function(){var a=new e(this);a.initialize(b)}),a("[data-panel]",a.mosaic.document).each(function(){var a=new e(this);a.prefill()}),a.mosaic.options.panels=a(".mosaic-panel",a.mosaic.document),a.mosaic.options.panels.find("[data-tile]").each(function(){if(d.validTile(this)){var b=new d(a(this).parent());b.initializeContent()}})},a.mosaic._init=function(b){a.mosaic._initPanels(b),a(".mosaic-original-content",a.mosaic.document).mosaicOverlay(),a("body").prepend(a(document.createElement("div")).addClass("mosaic-toolbar")),a.mosaic.options.toolbar=a(".mosaic-toolbar"),a.mosaic.options.toolbar.mosaicToolbar(),a.mosaic.options.panels.mosaicLayout(),a("*",a.mosaic.document).each(function(){var b;b=a(this),"block"===b.css("display")&&(b.hasClass("mosaic-panel")||b.hasClass("mosaic-toolbar")||b.hasClass("mosaic-notifications")||b.hasClass("mosaic-modal-wrapper")||"edit-zone"===b.attr("id")||0===b.parents(".mosaic-panel, .mosaic-toolbar").length&&0===b.find(".mosaic-panel, .mosaic-toolbar").length&&0!==b.parent().find(".mosaic-panel, .mosaic-toolbar").length&&b.addClass("mosaic-blur"))}),a.mosaic.undo.init(),a("body").addClass("mosaic-enabled"),a.mosaic.initialized()},a.mosaic.applyLayout=function(b,c){void 0===c&&(c=function(){}),g.loading.show(),a.ajax({url:a("body").attr("data-portal-url")+"/"+b}).done(function(c){var d=a.mosaic.getDomTreeFromHtml(c);a.mosaic.setSelectedContentLayout(b),a.mosaic.loaded?(a.mosaic._initPanels(d),a.mosaic.options.panels.mosaicLayout()):a.mosaic._init(d)}).fail(function(b,c,d){"Not Found"===d?window.alert("Specified layout can not be found. Loading default layout."):window.alert("Error loading layout specified for this content. Falling back to basic layout."),a.mosaic.applyLayout("++contentlayout++default/basic.html")}).always(function(){g.loading.hide()})};var h=function(){return a.mosaic.options.user_layouts.length>0?!0:c.filter(a.mosaic.options.available_layouts,function(a){return-1!==a.path.indexOf("custom/")}).length>0};a.mosaic._deleteLayout=function(b,c,d){var e=a("<div/>").appendTo("body"),h=new f(e,{html:a.mosaic.deleteLayoutTemplate(a.extend({},!0,{existing:c,layout:b,selected:a.mosaic.getSelectedContentLayout()==="++contentlayout++"+b.path},a.mosaic.options)),content:null,buttons:".plone-btn"});h.on("shown",function(){a("button.delete:visible",h.$modal).off("click").on("click",function(c){c.preventDefault(),g.loading.show();var e=a("#layoutField",h.$modal).val();a.ajax({url:a("body").attr("data-base-url")+"/@@manage-layouts-from-editor",data:{action:"deletelayout",layout:b.path,replacement:e,_authenticator:g.getAuthenticator()}}).done(function(c){h.hide(),d(c),e&&a.mosaic.getSelectedContentLayout()==="++contentlayout++"+b.path&&a.mosaic.applyLayout("++contentlayout++"+e)}).fail(function(){window.alert("Error deleting layout")}).always(function(){g.loading.hide()})}),a("button.cancel:visible",h.$modal).off("click").on("click",function(a){a.preventDefault(),h.hide()})}),h.show()},a.mosaic.deleteLayout=function(b,c){g.loading.show(),a.ajax({url:a("body").attr("data-base-url")+"/@@manage-layouts-from-editor",data:{action:"existing",layout:b.path}}).done(function(d){a.mosaic._deleteLayout(b,d.data,c)}).fail(function(){window.alert("Error loading data for existing assignments")}).always(function(){g.loading.hide()})},a.mosaic.manageCustomLayouts=function(){var b=a("<div/>").appendTo("body"),d=new f(b,{html:a.mosaic.manageLayoutsTemplate(a.extend({},!0,{},a.mosaic.options)),content:null,buttons:".plone-btn"});d.on("shown",function(){a(".delete-layout",d.$modal).off("click").on("click",function(b){b.preventDefault();var e=a(this).attr("data-layout");c.each(a.mosaic.options.available_layouts.concat(a.mosaic.options.user_layouts),function(b){return b.path===e?a.mosaic.deleteLayout(b,function(b){a.mosaic.options.available_layouts=b.available_layouts,a.mosaic.options.user_layouts=b.user_layouts,d.hide(),a.mosaic.manageCustomLayouts()}):void 0})})}),d.show()},a.mosaic.selectLayout=function(b){if(void 0!==b&&b&&1===a.mosaic.options.available_layouts.length){var d=a.mosaic.options.available_layouts[0],e="++contentlayout++"+d.directory+"/"+d.file;return void a.mosaic.applyLayout(e)}if(0===a.mosaic.options.available_layouts.length)return void a.mosaic.applyLayout("++contentlayout++default/basic.html");var g=a("<div/>").appendTo("body"),i=new f(g,{html:a.mosaic.selectLayoutTemplate(a.extend({},!0,{hasCustomLayouts:h(),portal_url:a("body").attr("data-portal-url")},a.mosaic.options)),content:null,buttons:".plone-btn"});i.on("shown",function(){a(".manage-custom-layouts a",i.$modal).off("click").on("click",function(b){b.preventDefault(),i.hide(),a.mosaic.manageCustomLayouts()}),a("li a",i.$modal).off("click").on("click",function(b){b.preventDefault();var d,e=a(this).attr("data-value");c.each(a.mosaic.options.available_layouts.concat(a.mosaic.options.user_layouts),function(a){a.path===e&&(d=a)});var f="++contentlayout++"+d.path;i.hide(),a.mosaic.applyLayout(f)})}),i.show()},a.mosaic.saveLayout=function(b){var c=a("<div/>").appendTo("body"),d=new f(c,{html:a.mosaic.saveLayoutTemplate(a.extend({},!0,{hasCustomLayouts:h()},a.mosaic.options)),content:null,buttons:".plone-btn"});d.on("shown",function(){a(".plone-btn:visible",d.$modal).off("click").on("click",function(b){g.loading.show(),b.preventDefault();var c="false";a("#globalLayout",d.$modal)[0].checked&&(c="true"),a.ajax({url:a("body").attr("data-base-url")+"/@@manage-layouts-from-editor",method:"POST",data:{action:"save",_authenticator:g.getAuthenticator(),global:c,name:a("#layoutNameField",d.$modal).val(),layout:a.mosaic.getPageContent(!0)}}).done(function(b){b.success&&(a.mosaic.options.available_layouts=b.available_layouts,a.mosaic.options.user_layouts=b.user_layouts,a.mosaic.applyLayout(b.layout))}).fail(function(){window.alert("Error saving layout")}).always(function(){g.loading.hide(),d.hide()})})}),d.show()},a.mosaic.getDomTreeFromHtml=function(b){return b=b.replace(/<!DOCTYPE[\w\s\- .\/\":]+>/,""),b=b.replace(/<html>/,'<div class="temp_html_tag">'),b=b.replace(/<\/html>/,"</div>"),b=b.replace(/<html\s/,'<div class="temp_html_tag" '),b=b.replace(/<\/html\s/,"</div "),b=b.replace(/<head>/,'<div class="temp_head_tag">'),b=b.replace(/<\/head>/,"</div>"),b=b.replace(/<head\s/,'<div class="temp_head_tag" '),b=b.replace(/<\/head\s/,"</div "),b=b.replace(/<body>/,'<div class="temp_body_tag">'),b=b.replace(/<\/body>/,"</div>"),b=b.replace(/<body\s/,'<div class="temp_body_tag" '),b=b.replace(/<\/body\s/,"</div "),a(a(b)[0])},a.mosaic.removeHeadTags=function(b){if(b&&"undefined"!==b){var c,d,e,f;if(b=b.split("?")[0],b=b.split("@@"),c=b[1].split("/"),b=b[0]+"@@delete-tile?type="+c[0]+"&id="+c[1]+"&confirm=true",d=c[0].replace(/\./g,"-")+"-"+c[1],e=a.mosaic.options.tileheadelements[d])for(f=0;f<e.length;f+=1)a(e[f],a.mosaic.document).remove();a.mosaic.options.tileheadelements[d]=[]}},a.mosaic.addHeadTags=function(b,c){var d,e;b=b.split("?")[0],b=b.split("@@"),d=b[1].split("/"),e=d[0].replace(/\./g,"-")+"-"+d[1],a.mosaic.options.tileheadelements[e]=[],c.find(".temp_head_tag").children().each(function(){a.mosaic.options.tileheadelements[e].push(this),a("head",a.mosaic.document).append(this)})}}),define("mosaic-url/mosaic.upload",["jquery"],function($){"use strict";"undefined"==typeof $.mosaic&&($.mosaic={}),$.mosaic.initUpload=function(){$(".mosaic-panel",$.mosaic.document).bind("dragover",function(a){0===$(".mosaic-panel-dragging",$.mosaic.document).length&&($(".mosaic-selected-tile",$.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),$.mosaic.options.toolbar.trigger("selectedtilechange"),$.mosaic.options.panels.mosaicSetResizeHandleLocation(),$.mosaic.addTile("image",'<img src="++resource++plone.app.mosaic.images/files.png" border="0" />'))}),document.addEventListener("drop",function(event){var dt,first,i,files,newtile,file,img,tile,xhr,boundary,data;for(dt=event.dataTransfer,files=dt.files,event.stopPropagation(),event.preventDefault(),$($.mosaic.document).trigger("mousedown"),first=!0,i=0;i<files.length;i+=1)file=files.item(i),0===file.mediaType.indexOf("image")?(first?(img=$(".mosaic-selected-tile",$.mosaic.document).children(".mosaic-tile-content").children("img"),tile=$(".mosaic-selected-tile",$.mosaic.document),first=!1):(newtile=$($.mosaic.document.createElement("div")).addClass("movable removable mosaic-tile mosaic-image-tile").append($($.mosaic.document.createElement("div")).addClass("mosaic-tile-content").append($($.mosaic.document.createElement("img")).attr("border",0))),$(".mosaic-selected-tile",$.mosaic.document).after(newtile),newtile.mosaicInitTile(),newtile.mosaicAddDrag(),img=newtile.children(".mosaic-tile-content").children("img"),tile=newtile),tile.append($($.mosaic.document.createElement("div")).addClass("mosaic-tile-uploadprogress")),img.get(0).src=file.getAsDataURL(),xhr=new XMLHttpRequest,xhr.upload.log=img,xhr.addEventListener("load",function(event){var response=eval("("+event.target.responseText+")");1===response.status?$.plone.notify({type:"error",title:"Error",message:response.message,sticky:!0}):$(event.target.upload.log).attr({src:response.url,alt:response.title}).parents(".mosaic-tile").children(".mosaic-tile-uploadprogress").fadeOut("slow",function(){$(this).remove()})},!1),xhr.upload.addEventListener("error",function(a){$.plone.notify({type:"error",title:"Error",message:"Error uploading file: "+a,sticky:!0})},!1),boundary="AJAX---------------------------AJAX",xhr.open("POST",$.mosaic.options.url+"/@@mosaic-upload",!0),xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+boundary),data="--"+boundary+"\r\n",data+="Content-Disposition: form-data; ",data+='name="uploadfile"; ',data+='filename="'+file.fileName+'"\r\n',data+="Content-Type: "+file.mediaType,data+="\r\n\r\n",data+=file.getAsBinary()+"\r\n",data+="--"+boundary+"--\r\n",xhr.sendAsBinary(data)):$.plone.notify({type:"warning",title:"Warning",message:"The filetype of file "+file.fileName+" is unsupported",sticky:!0});first&&$(".mosaic-button.remove").mosaicExecAction()},!1)}}),define("mosaic-url/mosaic.editor",["jquery"],function(a){"use strict";"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.editor={},a.mosaic.execCommand=function(a,b,c){tinymce.activeEditor&&tinymce.activeEditor.execCommand(a,b,c)},a.mosaic.editor.applyFormat=function(a){tinymce.activeEditor&&tinyMCE.activeEditor.formatter.apply(a)},a.mosaic.editor.registerFormat=function(a,b){tinymce.activeEditor&&tinymce.activeEditor.formatter.register(a,b)}}),define("mosaic-url/mosaic.undo",["jquery"],function(a){"use strict";"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.undo=function(){},a.mosaic.undo.init=function(){function b(b){for(var c=0;c<b.length;c+=1)a("#"+b[c].target,a.mosaic.document).html(b[c].source)}a.mosaic.undo.undoManager=new a.mosaic.undo.UndoManager(10,b)},a.mosaic.undo.snapshot=function(){var b=[];a(".mosaic-panel",a.mosaic.document).each(function(){b.push({target:a(this).attr("id"),source:a(this).html()})}),"undefined"==typeof a.mosaic.undo.undoManager&&a.mosaic.undo.init(),a.mosaic.undo.undoManager.add(b)},a.mosaic.undo.hasInitial=function(){return a.mosaic.undo.undoManager.stack.size()>0},a.mosaic.undo.undo=function(){a.mosaic.undo.undoManager.undo()},a.mosaic.undo.redo=function(){a.mosaic.undo.undoManager.redo()},a.mosaic.undo.Stack=function(a){"undefined"==typeof a?this.maxsize=10:this.maxsize=a,this.stack=[]},a.mosaic.undo.Stack.prototype.size=function(){return this.stack.length},a.mosaic.undo.Stack.prototype.add=function(a){this.stack.length>=this.maxsize&&this.stack.pop(),this.stack.unshift(a)},a.mosaic.undo.Stack.prototype.get=function(a){return this.stack[a]},a.mosaic.undo.UndoManager=function(b,c,d){this.stack=new a.mosaic.undo.Stack(b),this.pointer=0,this.handler=c,"undefined"!=typeof d&&this.stack.add(d)},a.mosaic.undo.UndoManager.prototype.add=function(a){this.stack.add(a)},a.mosaic.undo.UndoManager.prototype.undo=function(){var a=this.stack.get(this.pointer+1);a&&(this.handler(a),this.pointer+=1)},a.mosaic.undo.UndoManager.prototype.redo=function(){var a=this.stack.get(this.pointer-1);a&&(this.handler(a),this.pointer-=1)}}),define("mosaic-url/mosaic.overlay",["jquery"],function(a){"use strict";"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.overlay={},a.fn.mosaicOverlay=function(){return"undefined"==typeof a.mosaic.overlay_hide_fields&&(a.mosaic.overlay_hide_fields=!0),this.each(function(){var b=a(this),c=a("form",b),d=a("h1",b),e=a('<div class="plone-modal-wrapper mosaic-overlay"><div class="mosaic-modal fade in" style="position: absolute; padding: 20px;"><div class="plone-modal-dialog"><div class="plone-modal-content"><div class="plone-modal-header"><a class="plone-modal-close"></a></div><div class="plone-modal-body"></div><div class="plone-modal-footer"><div class="pattern-modal-buttons"></div></div></div></div></div></div>');a(".plone-modal-header",e).append("<h2>"+d.text()+"</h2>"),a(".plone-modal-body",e).append(c),a(document.body,a.mosaic.document).append(e),b.hide(),a(document.body,a.mosaic.document).prepend(a(document.createElement("div")).addClass("mosaic-overlay-blocker"))})},a.mosaic.overlay.open=function(b,c){var d,e,f,g,h,i,j,k;if(a(".mosaic-overlay").show().addClass("active"),a(".mosaic-overlay-blocker").show(),a("body").addClass("plone-modal-open"),d=a(".mosaic-overlay").find("form"),0===a(".mosaic-overlay-ok-button").length&&(a(".mosaic-overlay .formControls").children("input").hide(),a(".mosaic-overlay .pattern-modal-buttons").append(a(document.createElement("input")).attr({type:"button",value:"Done"}).addClass("mosaic-overlay-ok-button plone-btn plone-btn-primary").click(function(){a.mosaic.overlay.close()})),a(".mosaic-overlay .plone-modal-close").off("click").on("click",function(b){b.preventDefault(),a.mosaic.overlay.close()}),a(".mosaic-overlay .plone-modal-header h2").html("Properties")),"all"===b&&a.mosaic.overlay_hide_fields){for(e=d.find("nav"),e.removeClass("mosaic-hidden"),d.find("fieldset").children().removeClass("mosaic-hidden"),d.find("fieldset").removeClass("active"),e.find("a").removeClass("active"),d.find(a.mosaic.options.customContentLayout_selector).addClass("mosaic-hidden"),d.find(a.mosaic.options.contentLayout_selector).addClass("mosaic-hidden"),a(".mosaic-IDublinCore-title-tile").size()>0?d.find("#formfield-form-widgets-IDublinCore-title").addClass("mosaic-hidden"):d.find("#formfield-form-widgets-IDublinCore-title").removeClass("mosaic-hidden"),a(".mosaic-IDublinCore-description-tile").size()>0?d.find("#formfield-form-widgets-IDublinCore-description").addClass("mosaic-hidden"):d.find("#formfield-form-widgets-IDublinCore-description").removeClass("mosaic-hidden"),g=0;g<a.mosaic.options.tiles.length;g+=1)"fields"===a.mosaic.options.tiles[g].name&&(f=a.mosaic.options.tiles[g]);for(g=0;g<f.tiles.length;g+=1)i=f.tiles[g],0!==a.mosaic.options.panels.find(".mosaic-"+i.name+"-tile").length&&a(a.mosaic.document.getElementById(i.id)).addClass("mosaic-hidden");d.find("fieldset").each(function(){0===a(this).children("div:not(.mosaic-hidden)").length&&a("a[href=#fieldsetlegend-"+a(this).attr("id").split("-")[1]+"]").addClass("mosaic-hidden")}),h=e.children(":not(.mosaic-hidden)"),h.eq(0).addClass("active");var l=d.find("#fieldset-"+h.eq(0).attr("href").split("-")[1]);0===l.size()&&(l=d.find("fieldset:not(.mosaic-hidden)").eq(0)),l.addClass("active")}else"field"===b&&(j=a("#"+c.id),k=j.parents("fieldset"),d.find("fieldset").hide(),k.show(),k.children().addClass("mosaic-hidden"),j.removeClass("mosaic-hidden"),d.find("nav").addClass("mosaic-hidden"))},a.mosaic.overlay.close=function(){a(".mosaic-overlay").hide().removeClass("active"),a(".mosaic-overlay-blocker").hide(),a("body").removeClass("plone-modal-open")}}),window.DEBUG=!0,require(["jquery","mockup-patterns-base","mosaic-url/mosaic.core","mosaic-url/mosaic.layout","mosaic-url/mosaic.toolbar","mosaic-url/mosaic.actions","mosaic-url/mosaic.upload","mosaic-url/mosaic.editor","mosaic-url/mosaic.undo","mosaic-url/mosaic.overlay"],function(a,b){"use strict";var c=b.extend({name:"layout",trigger:".pat-layout",parser:"mockup",defaults:{attribute:"class"},init:function(){var b=this;b.options.data.$el=b.$el,a.mosaic.init({data:b.options.data})}});return c}),define("/Users/vangheem/code/coredev5/src/plone.app.mosaic/src/plone/app/mosaic/browser/static/js/mosaic.pattern.js",function(){});
//# sourceMappingURL=plone-mosaic.js.map