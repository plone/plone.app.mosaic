(function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&g>f;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=t(d,f,4);var g=!A(c)&&s.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function b(a){return function(b,c,d){c=u(c,d);for(var e=z(b),f=a>0?0:e-1;f>=0&&e>f;f+=a)if(c(b[f],f,b))return f;return-1}}function c(a,b,c){return function(d,e,f){var g=0,h=z(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(k.call(d,g,h),s.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&h>f;f+=a)if(d[f]===e)return f;return-1}}function d(a,b){var c=F.length,d=a.constructor,e=s.isFunction(d)&&d.prototype||h,f="constructor";for(s.has(a,f)&&!s.contains(b,f)&&b.push(f);c--;)f=F[c],f in a&&a[f]!==e[f]&&!s.contains(b,f)&&b.push(f)}var e=this,f=e._,g=Array.prototype,h=Object.prototype,i=Function.prototype,j=g.push,k=g.slice,l=h.toString,m=h.hasOwnProperty,n=Array.isArray,o=Object.keys,p=i.bind,q=Object.create,r=function(){},s=function(a){return a instanceof s?a:this instanceof s?void(this._wrapped=a):new s(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports._=s):e._=s,s.VERSION="1.8.3";var t=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},u=function(a,b,c){return null==a?s.identity:s.isFunction(a)?t(a,b,c):s.isObject(a)?s.matcher(a):s.property(a)};s.iteratee=function(a,b){return u(a,b,1/0)};var v=function(a,b){return function(c){var d=arguments.length;if(2>d||null==c)return c;for(var e=1;d>e;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;h>i;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},w=function(a){if(!s.isObject(a))return{};if(q)return q(a);r.prototype=a;var b=new r;return r.prototype=null,b},x=function(a){return function(b){return null==b?void 0:b[a]}},y=Math.pow(2,53)-1,z=x("length"),A=function(a){var b=z(a);return"number"==typeof b&&b>=0&&y>=b};s.each=s.forEach=function(a,b,c){b=t(b,c);var d,e;if(A(a))for(d=0,e=a.length;e>d;d++)b(a[d],d,a);else{var f=s.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},s.map=s.collect=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=Array(e),g=0;e>g;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},s.reduce=s.foldl=s.inject=a(1),s.reduceRight=s.foldr=a(-1),s.find=s.detect=function(a,b,c){var d;return d=A(a)?s.findIndex(a,b,c):s.findKey(a,b,c),void 0!==d&&-1!==d?a[d]:void 0},s.filter=s.select=function(a,b,c){var d=[];return b=u(b,c),s.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},s.reject=function(a,b,c){return s.filter(a,s.negate(u(b)),c)},s.every=s.all=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},s.some=s.any=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},s.contains=s.includes=s.include=function(a,b,c,d){return A(a)||(a=s.values(a)),("number"!=typeof c||d)&&(c=0),s.indexOf(a,b,c)>=0},s.invoke=function(a,b){var c=k.call(arguments,2),d=s.isFunction(b);return s.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},s.pluck=function(a,b){return s.map(a,s.property(b))},s.where=function(a,b){return s.filter(a,s.matcher(b))},s.findWhere=function(a,b){return s.find(a,s.matcher(b))},s.max=function(a,b,c){var d,e,f=-(1/0),g=-(1/0);if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],d>f&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-(1/0)&&f===-(1/0))&&(f=a,g=e)});return f},s.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],f>d&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(g>e||e===1/0&&f===1/0)&&(f=a,g=e)});return f},s.shuffle=function(a){for(var b,c=A(a)?a:s.values(a),d=c.length,e=Array(d),f=0;d>f;f++)b=s.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},s.sample=function(a,b,c){return null==b||c?(A(a)||(a=s.values(a)),a[s.random(a.length-1)]):s.shuffle(a).slice(0,Math.max(0,b))},s.sortBy=function(a,b,c){return b=u(b,c),s.pluck(s.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var B=function(a){return function(b,c,d){var e={};return c=u(c,d),s.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};s.groupBy=B(function(a,b,c){s.has(a,c)?a[c].push(b):a[c]=[b]}),s.indexBy=B(function(a,b,c){a[c]=b}),s.countBy=B(function(a,b,c){s.has(a,c)?a[c]++:a[c]=1}),s.toArray=function(a){return a?s.isArray(a)?k.call(a):A(a)?s.map(a,s.identity):s.values(a):[]},s.size=function(a){return null==a?0:A(a)?a.length:s.keys(a).length},s.partition=function(a,b,c){b=u(b,c);var d=[],e=[];return s.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},s.first=s.head=s.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:s.initial(a,a.length-b)},s.initial=function(a,b,c){return k.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},s.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:s.rest(a,Math.max(0,a.length-b))},s.rest=s.tail=s.drop=function(a,b,c){return k.call(a,null==b||c?1:b)},s.compact=function(a){return s.filter(a,s.identity)};var C=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=z(a);h>g;g++){var i=a[g];if(A(i)&&(s.isArray(i)||s.isArguments(i))){b||(i=C(i,b,c));var j=0,k=i.length;for(e.length+=k;k>j;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};s.flatten=function(a,b){return C(a,b,!1)},s.without=function(a){return s.difference(a,k.call(arguments,1))},s.uniq=s.unique=function(a,b,c,d){s.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=u(c,d));for(var e=[],f=[],g=0,h=z(a);h>g;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?s.contains(f,j)||(f.push(j),e.push(i)):s.contains(e,i)||e.push(i)}return e},s.union=function(){return s.uniq(C(arguments,!0,!0))},s.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=z(a);e>d;d++){var f=a[d];if(!s.contains(b,f)){for(var g=1;c>g&&s.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},s.difference=function(a){var b=C(arguments,!0,!0,1);return s.filter(a,function(a){return!s.contains(b,a)})},s.zip=function(){return s.unzip(arguments)},s.unzip=function(a){for(var b=a&&s.max(a,z).length||0,c=Array(b),d=0;b>d;d++)c[d]=s.pluck(a,d);return c},s.object=function(a,b){for(var c={},d=0,e=z(a);e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},s.findIndex=b(1),s.findLastIndex=b(-1),s.sortedIndex=function(a,b,c,d){c=u(c,d,1);for(var e=c(b),f=0,g=z(a);g>f;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},s.indexOf=c(1,s.findIndex,s.sortedIndex),s.lastIndexOf=c(-1,s.findLastIndex),s.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var D=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=w(a.prototype),g=a.apply(f,e);return s.isObject(g)?g:f};s.bind=function(a,b){if(p&&a.bind===p)return p.apply(a,k.call(arguments,1));if(!s.isFunction(a))throw new TypeError("Bind must be called on a function");var c=k.call(arguments,2),d=function(){return D(a,d,b,this,c.concat(k.call(arguments)))};return d},s.partial=function(a){var b=k.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;e>g;g++)f[g]=b[g]===s?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return D(a,c,this,this,f)};return c},s.bindAll=function(a){var b,c,d=arguments.length;if(1>=d)throw new Error("bindAll must be passed function names");for(b=1;d>b;b++)c=arguments[b],a[c]=s.bind(a[c],a);return a},s.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return s.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},s.delay=function(a,b){var c=k.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},s.defer=s.partial(s.delay,s,1),s.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:s.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=s.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},s.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=s.now()-g;b>j&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=s.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},s.wrap=function(a,b){return s.partial(b,a)},s.negate=function(a){return function(){return!a.apply(this,arguments)}},s.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},s.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},s.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),1>=a&&(b=null),c}},s.once=s.partial(s.before,2);var E=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];s.keys=function(a){if(!s.isObject(a))return[];if(o)return o(a);var b=[];for(var c in a)s.has(a,c)&&b.push(c);return E&&d(a,b),b},s.allKeys=function(a){if(!s.isObject(a))return[];var b=[];for(var c in a)b.push(c);return E&&d(a,b),b},s.values=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},s.mapObject=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=e.length,g={},h=0;f>h;h++)d=e[h],g[d]=b(a[d],d,a);return g},s.pairs=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},s.invert=function(a){for(var b={},c=s.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},s.functions=s.methods=function(a){var b=[];for(var c in a)s.isFunction(a[c])&&b.push(c);return b.sort()},s.extend=v(s.allKeys),s.extendOwn=s.assign=v(s.keys),s.findKey=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=0,g=e.length;g>f;f++)if(d=e[f],b(a[d],d,a))return d},s.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;s.isFunction(b)?(e=s.allKeys(g),d=t(b,c)):(e=C(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;i>h;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},s.omit=function(a,b,c){if(s.isFunction(b))b=s.negate(b);else{var d=s.map(C(arguments,!1,!1,1),String);b=function(a,b){return!s.contains(d,b)}}return s.pick(a,b,c)},s.defaults=v(s.allKeys,!0),s.create=function(a,b){var c=w(a);return b&&s.extendOwn(c,b),c},s.clone=function(a){return s.isObject(a)?s.isArray(a)?a.slice():s.extend({},a):a},s.tap=function(a,b){return b(a),a},s.isMatch=function(a,b){var c=s.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;d>f;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof s&&(a=a._wrapped),b instanceof s&&(b=b._wrapped);var e=l.call(a);if(e!==l.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(s.isFunction(g)&&g instanceof g&&s.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if(i=a.length,i!==b.length)return!1;for(;i--;)if(!G(a[i],b[i],c,d))return!1}else{var j,k=s.keys(a);if(i=k.length,s.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!s.has(b,j)||!G(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};s.isEqual=function(a,b){return G(a,b)},s.isEmpty=function(a){return null==a?!0:A(a)&&(s.isArray(a)||s.isString(a)||s.isArguments(a))?0===a.length:0===s.keys(a).length},s.isElement=function(a){return!(!a||1!==a.nodeType)},s.isArray=n||function(a){return"[object Array]"===l.call(a)},s.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},s.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){s["is"+a]=function(b){return l.call(b)==="[object "+a+"]"}}),s.isArguments(arguments)||(s.isArguments=function(a){return s.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(s.isFunction=function(a){return"function"==typeof a||!1}),s.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},s.isNaN=function(a){return s.isNumber(a)&&a!==+a},s.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===l.call(a)},s.isNull=function(a){return null===a},s.isUndefined=function(a){return void 0===a},s.has=function(a,b){return null!=a&&m.call(a,b)},s.noConflict=function(){return e._=f,this},s.identity=function(a){return a},s.constant=function(a){return function(){return a}},s.noop=function(){},s.property=x,s.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},s.matcher=s.matches=function(a){return a=s.extendOwn({},a),function(b){return s.isMatch(b,a)}},s.times=function(a,b,c){var d=Array(Math.max(0,a));b=t(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},s.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},s.now=Date.now||function(){return(new Date).getTime()};var H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=s.invert(H),J=function(a){var b=function(b){return a[b]},c="(?:"+s.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};s.escape=J(H),s.unescape=J(I),s.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),s.isFunction(d)?d.call(a):d};var K=0;s.uniqueId=function(a){var b=++K+"";return a?a+b:b},s.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\u2028|\u2029/g,O=function(a){return"\\"+M[a]};s.template=function(a,b,c){!b&&c&&(b=c),b=s.defaults({},b,s.templateSettings);var d=RegExp([(b.escape||L).source,(b.interpolate||L).source,(b.evaluate||L).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(N,O),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,s)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},s.chain=function(a){var b=s(a);return b._chain=!0,b};var P=function(a,b){return a._chain?s(b).chain():b};s.mixin=function(a){s.each(s.functions(a),function(b){var c=s[b]=a[b];s.prototype[b]=function(){var a=[this._wrapped];return j.apply(a,arguments),P(this,c.apply(s,a))}})},s.mixin(s),s.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=g[a];s.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],P(this,c)}}),s.each(["concat","join","slice"],function(a){var b=g[a];s.prototype[a]=function(){return P(this,b.apply(this._wrapped,arguments))}}),s.prototype.value=function(){return this._wrapped},s.prototype.valueOf=s.prototype.toJSON=s.prototype.value,s.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return s})}).call(this),function(){function a(){}function b(){}function c(a,b){this._loggers={},this.name=a||"",this._parent=b||null,b||(this._enabled=!0,this._level=h.WARN)}function d(){return g}function e(a){g=a}Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e});var f,g,h={DEBUG:10,INFO:20,WARN:30,ERROR:40,FATAL:50};a.prototype={output:function(a,b,c){if("undefined"!=typeof window.console&&"undefined"!=typeof console.log){a&&c.unshift(a+":");var d=c.join(" ");if(void 0===typeof console.info){var e;e=b<=h.DEBUG?"DEBUG":b<=h.INFO?"INFO":b<=h.WARN?"WARN":b<=h.ERROR?"ERROR":"FATAL",console.log("["+e+"] "+d)}else b<=h.DEBUG?(d="[DEBUG] "+d,console.log(d)):b<=h.INFO?console.info(d):b<=h.WARN?console.warn(d):console.error(d)}}},b.prototype={output:function(a,b,c){a&&c.unshift(a+":"),b<=h.DEBUG?(c.unshift("[DEBUG]"),console.log.apply(console,c)):b<=h.INFO?console.info.apply(console,c):b<=h.WARN?console.warn.apply(console,c):console.error.apply(console,c)}},c.prototype={getLogger:function(a){for(var b=a.split("."),d=this,e=this.name?[this.name]:[];b.length;){var f=b.shift();e.push(f),f in d._loggers||(d._loggers[f]=new c(e.join("."),d)),d=d._loggers[f]}return d},_getFlag:function(a){var b=this;for(a="_"+a;null!==b;){if(void 0!==b[a])return b[a];b=b._parent}return null},setEnabled:function(a){this._enabled=!!a},isEnabled:function(){this._getFlag("enabled")},setLevel:function(a){"number"==typeof a?this._level=a:"string"==typeof a&&(a=a.toUpperCase(),a in h&&(this._level=h[a]))},getLevel:function(){return this._getFlag("level")},log:function(a,b){!b.length||!this._getFlag("enabled")||a<this._getFlag("level")||(b=Array.prototype.slice.call(b),g.output(this.name,a,b))},debug:function(){this.log(h.DEBUG,arguments)},info:function(){this.log(h.INFO,arguments)},warn:function(){this.log(h.WARN,arguments)},error:function(){this.log(h.ERROR,arguments)},fatal:function(){this.log(h.FATAL,arguments)}},e(window.console&&window.console.log&&"function"==typeof window.console.log.apply?new b:new a),f=new c;for(var i,j=/loglevel(|-[^=]+)=([^&]+)/g;null!==(i=j.exec(window.location.search));){var k=""===i[1]?f:f.getLogger(i[1].slice(1));k.setLevel(i[2].toUpperCase())}var l={Level:h,getLogger:f.getLogger.bind(f),setEnabled:f.setEnabled.bind(f),isEnabled:f.isEnabled.bind(f),setLevel:f.setLevel.bind(f),getLevel:f.getLevel.bind(f),debug:f.debug.bind(f),info:f.info.bind(f),warn:f.warn.bind(f),error:f.error.bind(f),fatal:f.fatal.bind(f),getWriter:d,setWriter:e};"function"==typeof define?define("logging",[],function(){return l}):window.logging=l}(),define("pat-logger",["logging"],function(a){var b=a.getLogger("patterns");return b}),define("pat-utils",["jquery"],function(a){function b(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}}function c(a){var b=typeof a;return"function"===b||"object"===b&&!!a}function d(a){if(!c(a))return a;for(var b,d,e=1,f=arguments.length;f>e;e++){b=arguments[e];for(d in b)hasOwnProperty.call(b,d)&&(a[d]=b[d])}return a}function e(a,b){return-1!==b.indexOf("://")||"/"===b[0]?b:a.slice(0,a.lastIndexOf("/")+1)+b}function f(b){for(var c,d=b.parentNode;d&&11!==d.nodeType;d=d.parentNode)if("LABEL"===d.tagName)return d;return b.id&&(c=a('label[for="'+b.id+'"]')),c&&0===c.length&&b.form&&(c=a('label[for="'+b.name+'"]',b.form)),c&&c.length?c[0]:null}function g(a){var b=a.getBoundingClientRect(),c=document.documentElement,d=window.innerWidth||c.clientWidth,e=window.innerHeight||c.clientHeight;return b.right<0||b.bottom<0||b.left>d||b.top>e?!1:!0}function h(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function i(b,c){if(-1===c.indexOf("*"))b.removeClass(c);else{var d=c.replace(/[\-\[\]{}()+?.,\\\^$|#\s]/g,"\\$&");d=d.replace(/[*]/g,".*"),d=new RegExp("^"+d+"$"),b.filter("[class]").each(function(){for(var b=a(this),c=b.attr("class").split(/\s+/),e=[],f=0;f<c.length;f++)d.test(c[f])||e.push(c[f]);e.length?b.attr("class",e.join(" ")):b.removeAttr("class")})}}function j(a,b,c,d){var e="css"===c.transition||"none"===c.transition?null:c.effect.duration;a.removeClass("visible hidden in-progress");var f=function(){a.removeClass("in-progress").addClass(b?"visible":"hidden").trigger("pat-update",{pattern:d,transition:"complete"})};if(e){var g=o[c.transition];a.addClass("in-progress").trigger("pat-update",{pattern:d,transition:"start"}),a[b?g.show:g.hide]({duration:e,easing:c.effect.easing,complete:f})}else"css"!==c.transition&&a[b?"show":"hide"](),f()}function k(a,b,c){var d=new RegExp("(\\?|\\&)"+b+"=.*?(?=(&|$))"),e=a.toString().split("#"),f=e[0],g=e[1],h=/\?.+$/,i=f;return i=d.test(f)?f.replace(d,"$1"+b+"="+c):h.test(f)?f+"&"+b+"="+c:f+"?"+b+"="+c,g&&(i+="#"+g),i}a.fn.safeClone=function(){var b=this.clone();return void 0!==a.browser.msie&&b.findInclusive(":input[placeholder]").each(function(b,c){var d=a(c);d.attr("placeholder")===d.val()&&d.val("")}),b},Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null===this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;f>d;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}});var l=function(b,c,d){var e=this;return e.each(function(){var e,f=a(this);if(e=b.init(f,d),c){if(void 0===e[c])return a.error("Method "+c+" does not exist on jQuery."+b.name),!1;if("_"===c.charAt(0))return a.error("Method "+c+" is private on jQuery."+b.name),!1;e[c].apply(e,[d])}}),e},m=function(b,c,d){var e=this;if(c){if(b[c])return b[c].apply(e,[e].concat([d]));a.error("Method "+c+" does not exist on jQuery."+b.name)}else b.init.apply(e,[e].concat([d]));return e},n=function(a){return function(b,c){var d=this;return 0===d.length?d:("object"==typeof b&&(c=b,b=void 0),"function"==typeof a?l.call(this,a,b,c):m.call(this,a,b,c))}},o={none:{hide:"hide",show:"show"},fade:{hide:"fadeOut",show:"fadeIn"},slide:{hide:"slideUp",show:"slideDown"}},p={jqueryPlugin:n,debounce:b,escapeRegExp:h,isObject:c,extend:d,rebaseURL:e,findLabel:f,elementInViewport:g,removeWildcardClass:i,hideOrShow:j,addURLQueryParameter:k};return p}),define("pat-compat",[],function(){Array.prototype.every||(Array.prototype.every=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=arguments[1],e=0;c>e;e++)if(e in b&&!a.call(d,b[e],e,b))return!1;return!0}),Array.prototype.filter||(Array.prototype.filter=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],e=arguments[1],f=0;c>f;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null===this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("[object Function]"!=={}.toString.call(a))throw new TypeError(a+" is not a function");for(b&&(c=b),d=0;f>d;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==1/0&&d!==-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=c;arguments.length>1&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==1/0&&d!==-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d))));for(var e=d>=0?Math.min(d,c-1):c-Math.abs(d);e>=0;e--)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.map||(Array.prototype.map=function(a,b){var c,d,e;if(null===this)throw new TypeError(" this is null or not defined");var f=Object(this),g=f.length>>>0;if("[object Function]"!=={}.toString.call(a))throw new TypeError(a+" is not a function");for(b&&(c=b),d=new Array(g),e=0;g>e;){var h,i;e in f&&(h=f[e],i=a.call(c,h,e,f),d[e]=i),e++}return d}),Array.prototype.reduce||(Array.prototype.reduce=function(a){if(null===this||void 0===this)throw new TypeError("Object is null or undefined");var b,c=0,d=this.length>>0;if("function"!=typeof a)throw new TypeError("First argument is not callable");if(arguments.length<2){if(0===d)throw new TypeError("Array length is 0 and no second argument");b=this[0],c=1}else b=arguments[1];for(;d>c;)c in this&&(b=a.call(void 0,b,this[c],c,this)),++c;return b}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;if(0===c&&1===arguments.length)throw new TypeError;var d,e=c-1;if(arguments.length>=2)d=arguments[1];else for(;;){if(e in this){d=this[e--];break}if(--e<0)throw new TypeError}for(;e>=0;)e in b&&(d=a.call(void 0,d,b[e],e,b)),e--;return d}),Array.prototype.some||(Array.prototype.some=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=arguments[1],e=0;c>e;e++)if(e in b&&a.call(d,b[e],e,b))return!0;return!1}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var f=[];for(var g in e)a.call(e,g)&&f.push(g);if(b)for(var h=0;d>h;h++)a.call(e,c[h])&&f.push(c[h]);return f}}())}),define("pat-jquery-ext",["jquery"],function(a){var b={init:function(c){var d={time:3,initialTime:8,exceptionAreas:[]};return this.each(function(){var e=a(this),f=e.data("timeout");f||(c&&a.extend(d,c),e.data("timeout",{lastEvent:new Date,trueTime:d.time,time:d.initialTime,untouched:!0,inExceptionArea:!1}),e.bind("mouseover.timeout",b.mouseMoved),e.bind("mouseenter.timeout",b.mouseMoved),a(d.exceptionAreas).each(function(){e.find(this).live("mouseover.timeout",{parent:e},b.enteredException).live("mouseleave.timeout",{parent:e},b.leftException)}),d.initialTime>0?e.timeout("startTimer"):e.addClass("timeout"))})},enteredException:function(a){var b=a.data.parent.data("timeout");b.inExceptionArea=!0,a.data.parent.data("timeout",b),a.data.parent.trigger("mouseover")},leftException:function(a){var b=a.data.parent.data("timeout");b.inExceptionArea=!1,a.data.parent.data("timeout",b)},destroy:function(){return this.each(function(){var b=a(this),c=b.data("timeout");a(window).unbind(".timeout"),c.timeout.remove(),b.removeData("timeout")})},mouseMoved:function(){var b=a(this),c=b.data("timeout");b.hasClass("timeout")?(b.removeClass("timeout"),b.timeout("startTimer")):c.untouched&&(c.untouched=!1,c.time=c.trueTime),c.lastEvent=new Date,b.data("timeout",c)},startTimer:function(){var b=a(this),c=b.data("timeout"),d=function(){var a=b.data("timeout");if(a&&a.lastEvent)if(a.inExceptionArea)setTimeout(d,Math.floor(1e3*a.time));else{var c=new Date,e=Math.floor(1e3*a.time)-(c-a.lastEvent);e>0?setTimeout(d,e+100):b.addClass("timeout")}};setTimeout(d,Math.floor(1e3*c.time))}};a.fn.timeout=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" does not exist on jQuery.timeout"):b.init.apply(this,arguments)},a.extend(a.expr[":"],{scrollable:function(b){var c,d;return"scroll"===a(b).css("overflow")||"scroll"===a(b).css("overflowX")||"scroll"===a(b).css("overflowY")?!0:(c=b.clientHeight<b.scrollHeight&&(-1!==a.inArray(a(b).css("overflowY"),["scroll","auto"])||-1!==a.inArray(a(b).css("overflow"),["scroll","auto"])))?!0:d=b.clientWidth<b.scrollWidth&&(-1!==a.inArray(a(b).css("overflowX"),["scroll","auto"])||-1!==a.inArray(a(b).css("overflow"),["scroll","auto"]))}}),a.fn.makeVisibleInScroll=function(b){var c=null;return"string"==typeof b?c=a("#"+b):b&&(c=a(b)),this.each(function(){var b,d=a(this);c?b=c:(b=d.parents(":scrollable"),b=a(b.length>0?b[0]:window));var e=d.position().top,f=d.height()+e,g=b.scrollTop(),h=b.height()+g;g>e?b.scrollTop(e):f>h-b.height()/2&&b.scrollTop(e-(b.height()-d.height())/2)})},a.fn.setPositionAbsolute=function(b,c,d){return this.each(function(){var e=a(this),f=a(this).width(),g=b.offset(),h=b.width(),i=b.height(),j=g.left+h-f+d,k=g.top+i+c;e.css({"z-index":1,position:"absolute",marginLeft:0,marginTop:0,left:j+"px",top:k+"px",width:f}),e.remove().appendTo("body").show()})},a.fn.positionAncestor=function(b){var c=0,d=0;return this.each(function(){var e=a(this).closest(b);if(e.length&&"static"!==e.css("position")){var f=a(this),g=f.offset().left-parseInt(f.css("marginLeft"),10),h=f.offset().top-parseInt(f.css("marginTop"),10),i=e.offset().left+parseInt(e.css("borderLeftWidth"),10),j=e.offset().top+parseInt(e.css("borderTopWidth"),10);return c=g-i,d=h-j,!1}}),{left:c,top:d}},String.prototype.startsWith=function(a){return null!==this.match("^"+a)},String.prototype.endsWith=function(a){return null!==this.match(a+"$")},a.simplePlaceholder={placeholder_class:null,hide_placeholder:function(){var b=a(this);b.val()===b.attr("placeholder")&&b.val("").removeClass(a.simplePlaceholder.placeholder_class)},show_placeholder:function(){var b=a(this);""===b.val()&&b.val(b.attr("placeholder")).addClass(a.simplePlaceholder.placeholder_class)},prevent_placeholder_submit:function(){return a(this).find(".simple-placeholder").each(function(){var b=a(this);b.val()===b.attr("placeholder")&&b.val("")}),!0}},a.fn.simplePlaceholder=function(b){if(void 0===document.createElement("input").placeholder){var c={placeholder_class:"placeholding"};b&&a.extend(c,b),a.simplePlaceholder.placeholder_class=c.placeholder_class,this.each(function(){var b=a(this);b.focus(a.simplePlaceholder.hide_placeholder),b.blur(a.simplePlaceholder.show_placeholder),""===b.val()&&(b.val(b.attr("placeholder")),b.addClass(a.simplePlaceholder.placeholder_class)),b.addClass("simple-placeholder"),a(this.form).submit(a.simplePlaceholder.prevent_placeholder_submit)})}return this},a.fn.findInclusive=function(a){return this.find("*").addBack().filter(a)},a.fn.slideIn=function(a,b,c){return this.animate({width:"show"},a,b,c)},a.fn.slideOut=function(a,b,c){return this.animate({width:"hide"},a,b,c)},a.expr[":"].Contains=function(b,c,d){return a(b).text().toUpperCase().indexOf(d[3].toUpperCase())>=0},a.fn.scopedFind=function(b){return b.startsWith("#")?a(b):this.find(b)}}),define("pat-registry",["jquery","underscore","pat-logger","pat-utils","pat-compat","pat-jquery-ext"],function(a,b,c,d){
for(var e,f=3,g=8,h=c.getLogger("registry"),i=/patterns-disable=([^&]+)/g,j=/patterns-dont-catch/g,k=!1,l={};null!==(e=i.exec(window.location.search));)l[e[1]]=!0,h.info("Pattern disabled via url config:",e[1]);for(;null!==(e=j.exec(window.location.search));)k=!0,h.info("I will not catch init exceptions");var m={patterns:{},initialized:!1,init:function(){a(document).ready(function(){h.info("loaded: "+Object.keys(m.patterns).sort().join(", ")),m.scan(document.body),m.initialized=!0,h.info("finished initial scan.")})},clear:function(){this.patterns={}},transformPattern:function(b,c){if(l[b])return void h.debug("Skipping disabled pattern:",b);var d=m.patterns[b];if(d.transform)try{d.transform(a(c))}catch(e){if(k)throw e;h.error("Transform error for pattern"+b,e)}},initPattern:function(b,d,e){var f=a(d),g=m.patterns[b];if(g.init&&(plog=c.getLogger("pat."+b),f.is(g.trigger))){plog.debug("Initialising:",f);try{g.init(f,null,e),plog.debug("done.")}catch(h){if(k)throw h;plog.error("Caught error:",h)}}},orderPatterns:function(a){return b.contains(a,"validation")&&b.contains(a,"inject")&&(a.splice(a.indexOf("validation"),1),a.unshift("validation")),a},scan:function(c,d,e){var f,g=[];d=this.orderPatterns(d||Object.keys(m.patterns)),d.forEach(b.partial(this.transformPattern,b,c)),d=b.each(d,function(a){var b=m.patterns[a];b.trigger&&g.unshift(b.trigger)}),f=a(c).findInclusive(g.join(",")),f=f.filter(function(){return 0===a(this).parents("pre").length}),f=f.filter(":not(.cant-touch-this)"),f.toArray().reduceRight(function(a,c){d.forEach(b.partial(this.initPattern,b,c,e))}.bind(this),null),a("body").addClass("patterns-loaded")},register:function(b,c){var e;return(c=c||b.name)?m.patterns[c]?(h.error("Already have a pattern called: "+c),!1):(m.patterns[c]=b,b.jquery_plugin&&(e=("pat-"+c).replace(/-([a-zA-Z])/g,function(a,b){return b.toUpperCase()}),a.fn[e]=d.jqueryPlugin(b),a.fn[e.replace(/^pat/,"pattern")]=a.fn[e]),h.debug("Registered pattern:",c,b),m.initialized&&m.scan(document.body,[c]),!0):(h.error("Pattern lacks a name:",b),!1)}};return a(document).on("patterns-injected.patterns",function(b,c,d,e){e.nodeType!==f&&e!==g&&(m.scan(e,null,{type:"injection",element:d}),a(e).trigger("patterns-injected-scanned"))}),m}),define("pat-mockup-parser",["jquery"],function(a){"use strict";var b={getOptions:function c(b,d,e){e=e||{},0===b.length||a.nodeName(b[0],"body")||(e=c(b.parent(),d,e));var f={};if(0!==b.length&&(f=b.data("pat-"+d),f&&"string"==typeof f)){var g={};a.each(f.split(";"),function(a,b){b=b.split(":"),b.reverse();var c=b.pop();c=c.replace(/^\s+|\s+$/g,""),b.reverse();var d=b.join(":");d=d.replace(/^\s+|\s+$/g,""),g[c]=d}),f=g}return a.extend(!0,{},e,f)}};return b}),define("pat-base",["jquery","pat-registry","pat-mockup-parser","pat-logger"],function(a,b,c,d){"use strict";var e=d.getLogger("Patternslib Base"),f=function(a,e,f){var g=this.prototype.name,h=d.getLogger("pat."+g),i=a.data("pattern-"+g);if(void 0===i&&b.patterns[g]){try{e="mockup"===this.prototype.parser?c.getOptions(a,g,e):e,i=new b.patterns[g](a,e,f)}catch(j){h.error("Failed while initializing '"+g+"' pattern.",j)}a.data("pattern-"+g,i)}return i},g=function(b,c,d){this.$el=b,this.options=a.extend(!0,{},this.defaults||{},c||{}),this.init(b,c,d),this.emit("init")};return g.prototype={constructor:g,on:function(a,b){this.$el.on(a+"."+this.name+".patterns",b)},emit:function(a,b){void 0===b&&(b=[]),this.$el.trigger(a+"."+this.name+".patterns",b)}},g.extend=function(c){var d,h=this;if(!c)throw new Error("Pattern configuration properties required when calling Base.extend");d=c.hasOwnProperty("constructor")?c.constructor:function(){h.apply(this,arguments)},d.extend=g.extend,d.init=f,d.jquery_plugin=!0,d.trigger=c.trigger;var i=function(){this.constructor=d};return i.prototype=h.prototype,d.prototype=new i,a.extend(!0,d.prototype,c),d.__super__=h.prototype,c.name?c.trigger?b.register(d,c.name):e.warn("The pattern '"+c.name+"' does not have a trigger attribute, it will not be registered."):e.warn("This pattern without a name attribute will not be registered!"),d},g}),define("mockup-patterns-base",["jquery","pat-base"],function(a,b){"use strict";var c=function(){return b.apply(this,arguments)};for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c.prototype=b.prototype,c.prototype.constructor=c,c.extend=function(){console.log("Usage of the mockup-patterns-base pattern is deprecated and it will eventually be removed.Instead, use pat-base and explicitly set parser to 'mockup' when calling extend.");var a=b.extend.apply(this,arguments);return a.prototype.parser="mockup",a},c}),define("mockup-patterns-backdrop",["jquery","pat-base"],function(a,b){"use strict";var c=b.extend({name:"backdrop",trigger:".pat-backdrop",parser:"mockup",defaults:{zIndex:null,opacity:.8,className:"plone-backdrop",classActiveName:"plone-backdrop-active",closeOnEsc:!0,closeOnClick:!0},init:function(){var b=this;b.$backdrop=a("> ."+b.options.className,b.$el),0===b.$backdrop.size()&&(b.$backdrop=a("<div/>").hide().appendTo(b.$el).addClass(b.options.className),null!==b.options.zIndex&&b.$backdrop.css("z-index",b.options.zIndex)),b.options.closeOnEsc===!0&&a(document).on("keydown",function(a,c){b.$el.is("."+b.options.classActiveName)&&27===a.keyCode&&b.hide()}),b.options.closeOnClick===!0&&b.$backdrop.on("click",function(){b.$el.is("."+b.options.classActiveName)&&b.hide()})},show:function(){var a=this;a.$el.hasClass(a.options.classActiveName)||(a.emit("show"),a.$backdrop.css("opacity","0").show(),a.$el.addClass(a.options.classActiveName),a.$backdrop.animate({opacity:a.options.opacity},500),a.emit("shown"))},hide:function(){var a=this;a.$el.hasClass(a.options.classActiveName)&&(a.emit("hide"),a.$backdrop.animate({opacity:"0"},500).hide(),a.$el.removeClass(a.options.classActiveName),a.emit("hidden"))}});return c}),function(a,b){if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(c,d,e){a.Backbone=b(a,e,c,d)});else if("undefined"!=typeof exports){var c=require("underscore");b(a,exports,c)}else a.Backbone=b(a,{},a._,a.jQuery||a.Zepto||a.ender||a.$)}(this,function(a,b,c,d){var e=a.Backbone,f=[],g=(f.push,f.slice);f.splice;b.VERSION="1.1.2",b.$=d,b.noConflict=function(){return a.Backbone=e,this},b.emulateHTTP=!1,b.emulateJSON=!1;var h=b.Events={on:function(a,b,c){if(!j(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,d){if(!j(this,"once",a,[b,d])||!b)return this;var e=this,f=c.once(function(){e.off(a,f),b.apply(this,arguments)});return f._callback=b,this.on(a,f,d)},off:function(a,b,d){var e,f,g,h,i,k,l,m;if(!this._events||!j(this,"off",a,[b,d]))return this;if(!a&&!b&&!d)return this._events=void 0,this;for(h=a?[a]:c.keys(this._events),i=0,k=h.length;k>i;i++)if(a=h[i],g=this._events[a]){if(this._events[a]=e=[],b||d)for(l=0,m=g.length;m>l;l++)f=g[l],(b&&b!==f.callback&&b!==f.callback._callback||d&&d!==f.context)&&e.push(f);e.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=g.call(arguments,1);if(!j(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&k(c,b),d&&k(d,arguments),this},stopListening:function(a,b,d){var e=this._listeningTo;if(!e)return this;var f=!b&&!d;d||"object"!=typeof b||(d=this),a&&((e={})[a._listenId]=a);for(var g in e)a=e[g],a.off(b,d,this),(f||c.isEmpty(a._events))&&delete this._listeningTo[g];return this}},i=/\s+/,j=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(i.test(c)){for(var f=c.split(i),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},k=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}},l={listenTo:"on",listenToOnce:"once"};c.each(l,function(a,b){h[b]=function(b,d,e){var f=this._listeningTo||(this._listeningTo={}),g=b._listenId||(b._listenId=c.uniqueId("l"));return f[g]=b,e||"object"!=typeof d||(e=this),b[a](d,e,this),this}}),h.bind=h.on,h.unbind=h.off,c.extend(b,h);var m=b.Model=function(a,b){var d=a||{};b||(b={}),this.cid=c.uniqueId("c"),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(d=this.parse(d,b)||{}),d=c.defaults({},d,c.result(this,"defaults")),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)};c.extend(m.prototype,h,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return c.clone(this.attributes)},sync:function(){return b.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return c.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,d){var e,f,g,h,i,j,k,l;if(null==a)return this;if("object"==typeof a?(f=a,d=b):(f={})[a]=b,d||(d={}),!this._validate(f,d))return!1;g=d.unset,i=d.silent,h=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=c.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in f&&(this.id=f[this.idAttribute]);for(e in f)b=f[e],c.isEqual(l[e],b)||h.push(e),c.isEqual(k[e],b)?delete this.changed[e]:this.changed[e]=b,g?delete l[e]:l[e]=b;if(!i){h.length&&(this._pending=d);for(var m=0,n=h.length;n>m;m++)this.trigger("change:"+h[m],this,l[h[m]],d)}if(j)return this;if(!i)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,c.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var d in this.attributes)b[d]=void 0;return this.set(b,c.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!c.isEmpty(this.changed):c.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?c.clone(this.changed):!1;var b,d=!1,e=this._changing?this._previousAttributes:this.attributes;for(var f in a)c.isEqual(e[f],b=a[f])||((d||(d={}))[f]=b);return d},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,d=a.success;return a.success=function(c){return b.set(b.parse(c,a),a)?(d&&d(b,c,a),void b.trigger("sync",b,c,a)):!1},L(this,a),this.sync("read",this,a)},save:function(a,b,d){var e,f,g,h=this.attributes;if(null==a||"object"==typeof a?(e=a,d=b):(e={})[a]=b,d=c.extend({validate:!0},d),e&&!d.wait){if(!this.set(e,d))return!1}else if(!this._validate(e,d))return!1;e&&d.wait&&(this.attributes=c.extend({},h,e)),void 0===d.parse&&(d.parse=!0);var i=this,j=d.success;return d.success=function(a){i.attributes=h;var b=i.parse(a,d);return d.wait&&(b=c.extend(e||{},b)),c.isObject(b)&&!i.set(b,d)?!1:(j&&j(i,a,d),void i.trigger("sync",i,a,d))},L(this,d),f=this.isNew()?"create":d.patch?"patch":"update","patch"===f&&(d.attrs=e),g=this.sync(f,this,d),e&&d.wait&&(this.attributes=h),g},destroy:function(a){a=a?c.clone(a):{};var b=this,d=a.success,e=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(c){(a.wait||b.isNew())&&e(),d&&d(b,c,a),b.isNew()||b.trigger("sync",b,c,a)},this.isNew())return a.success(),!1;L(this,a);var f=this.sync("delete",this,a);return a.wait||e(),f},url:function(){var a=c.result(this,"urlRoot")||c.result(this.collection,"url")||K();return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},c.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=c.extend({},this.attributes,a);var d=this.validationError=this.validate(a,b)||null;return d?(this.trigger("invalid",this,d,c.extend(b,{validationError:d})),!1):!0}});var n=["keys","values","pairs","invert","pick","omit"];c.each(n,function(a){m.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.attributes),c[a].apply(c,b)}});var o=b.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,c.extend({silent:!0},b))},p={add:!0,remove:!0,merge:!0},q={add:!0,remove:!1};c.extend(o.prototype,h,{model:m,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,c.extend({merge:!1},b,q))},remove:function(a,b){var d=!c.isArray(a);a=d?[a]:c.clone(a),b||(b={});var e,f,g,h;for(e=0,f=a.length;f>e;e++)h=a[e]=this.get(a[e]),h&&(delete this._byId[h.id],delete this._byId[h.cid],g=this.indexOf(h),this.models.splice(g,1),this.length--,b.silent||(b.index=g,h.trigger("remove",h,this,b)),this._removeReference(h,b));return d?a[0]:a},set:function(a,b){b=c.defaults({},b,p),b.parse&&(a=this.parse(a,b));var d=!c.isArray(a);a=d?a?[a]:[]:c.clone(a);var e,f,g,h,i,j,k,l=b.at,n=this.model,o=this.comparator&&null==l&&b.sort!==!1,q=c.isString(this.comparator)?this.comparator:null,r=[],s=[],t={},u=b.add,v=b.merge,w=b.remove,x=!o&&u&&w?[]:!1;for(e=0,f=a.length;f>e;e++){if(i=a[e]||{},g=i instanceof m?h=i:i[n.prototype.idAttribute||"id"],j=this.get(g))w&&(t[j.cid]=!0),v&&(i=i===h?h.attributes:i,b.parse&&(i=j.parse(i,b)),j.set(i,b),o&&!k&&j.hasChanged(q)&&(k=!0)),a[e]=j;else if(u){if(h=a[e]=this._prepareModel(i,b),!h)continue;r.push(h),this._addReference(h,b)}h=j||h,!x||!h.isNew()&&t[h.id]||x.push(h),t[h.id]=!0}if(w){for(e=0,f=this.length;f>e;++e)t[(h=this.models[e]).cid]||s.push(h);s.length&&this.remove(s,b)}if(r.length||x&&x.length)if(o&&(k=!0),this.length+=r.length,null!=l)for(e=0,f=r.length;f>e;e++)this.models.splice(l+e,0,r[e]);else{x&&(this.models.length=0);var y=x||r;for(e=0,f=y.length;f>e;e++)this.models.push(y[e])}if(k&&this.sort({silent:!0}),!b.silent){for(e=0,f=r.length;f>e;e++)(h=r[e]).trigger("add",h,this,b);(k||x&&x.length)&&this.trigger("sort",this,b)}return d?a[0]:a},reset:function(a,b){b||(b={});for(var d=0,e=this.models.length;e>d;d++)this._removeReference(this.models[d],b);return b.previousModels=this.models,this._reset(),a=this.add(a,c.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,c.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return this.add(a,c.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(){return g.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a]||this._byId[a.id]||this._byId[a.cid]},at:function(a){return this.models[a]},where:function(a,b){return c.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),c.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(c.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return c.invoke(this.models,"get",a)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,d=this;return a.success=function(c){var e=a.reset?"reset":"set";d[e](c,a),b&&b(d,c,a),d.trigger("sync",d,c,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?c.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var d=this,e=b.success;return b.success=function(a,c){b.wait&&d.add(a,b),e&&e(a,c,b)},a.save(null,b),a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof m)return a;b=b?c.clone(b):{},b.collection=this;var d=new this.model(a,b);return d.validationError?(this.trigger("invalid",this,d.validationError,b),!1):d},_addReference:function(a,b){this._byId[a.cid]=a,null!=a.id&&(this._byId[a.id]=a),a.collection||(a.collection=this),a.on("all",this._onModelEvent,this)},_removeReference:function(a,b){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var r=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];c.each(r,function(a){o.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.models),c[a].apply(c,b)}});var s=["groupBy","countBy","sortBy","indexBy"];c.each(s,function(a){o.prototype[a]=function(b,d){var e=c.isFunction(b)?b:function(a){return a.get(b)};return c[a](this.models,e,d)}});var t=b.View=function(a){this.cid=c.uniqueId("view"),a||(a={}),c.extend(this,c.pick(a,v)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},u=/^(\S+)\s*(.*)$/,v=["model","collection","el","id","attributes","className","tagName","events"];c.extend(t.prototype,h,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(a,c){return this.$el&&this.undelegateEvents(),this.$el=a instanceof b.$?a:b.$(a),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=c.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var d=a[b];if(c.isFunction(d)||(d=this[a[b]]),d){var e=b.match(u),f=e[1],g=e[2];d=c.bind(d,this),f+=".delegateEvents"+this.cid,""===g?this.$el.on(f,d):this.$el.on(f,g,d)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"),!1);else{var a=c.extend({},c.result(this,"attributes"));this.id&&(a.id=c.result(this,"id")),this.className&&(a["class"]=c.result(this,"className"));var d=b.$("<"+c.result(this,"tagName")+">").attr(a);this.setElement(d,!1)}}}),b.sync=function(a,d,e){var f=x[a];c.defaults(e||(e={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON});var g={type:f,dataType:"json"};if(e.url||(g.url=c.result(d,"url")||K()),null!=e.data||!d||"create"!==a&&"update"!==a&&"patch"!==a||(g.contentType="application/json",g.data=JSON.stringify(e.attrs||d.toJSON(e))),e.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),e.emulateHTTP&&("PUT"===f||"DELETE"===f||"PATCH"===f)){g.type="POST",e.emulateJSON&&(g.data._method=f);var h=e.beforeSend;e.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",f),h?h.apply(this,arguments):void 0}}"GET"===g.type||e.emulateJSON||(g.processData=!1),"PATCH"===g.type&&w&&(g.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=e.xhr=b.ajax(c.extend(g,e));return d.trigger("request",d,i,e),i};var w=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var y=b.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},z=/\((.*?)\)/g,A=/(\(\?)?:\w+/g,B=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(y.prototype,h,{initialize:function(){},route:function(a,d,e){c.isRegExp(a)||(a=this._routeToRegExp(a)),c.isFunction(d)&&(e=d,d=""),e||(e=this[d]);var f=this;return b.history.route(a,function(c){var g=f._extractParameters(a,c);f.execute(e,g),f.trigger.apply(f,["route:"+d].concat(g)),f.trigger("route",d,g),b.history.trigger("route",f,d,g)}),this},execute:function(a,b){a&&a.apply(this,b)},navigate:function(a,c){return b.history.navigate(a,c),this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,b=c.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(C,"\\$&").replace(z,"(?:$1)?").replace(A,function(a,b){return b?a:"([^/?]+)"}).replace(B,"([^?]*?)"),new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(a,b){var d=a.exec(b).slice(1);return c.map(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}});var D=b.History=function(){this.handlers=[],c.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},E=/^[#\/]|\s+$/g,F=/^\/+|\/+$/g,G=/msie [\w.]+/,H=/\/$/,I=/#.*$/;D.started=!1,c.extend(D.prototype,h,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=decodeURI(this.location.pathname+this.location.search);var c=this.root.replace(H,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(E,"")},start:function(a){if(D.started)throw new Error("Backbone.history has already been started");D.started=!0,this.options=c.extend({root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var d=this.getFragment(),e=document.documentMode,f=G.exec(navigator.userAgent.toLowerCase())&&(!e||7>=e);if(this.root=("/"+this.root+"/").replace(F,"/"),f&&this._wantsHashChange){var g=b.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=g.hide().appendTo("body")[0].contentWindow,this.navigate(d)}this._hasPushState?b.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!f?b.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=d;var h=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&h.hash&&(this.fragment=this.getHash().replace(E,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){b.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),D.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();return b===this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe))),b===this.fragment?!1:(this.iframe&&this.navigate(b),void this.loadUrl())},loadUrl:function(a){return a=this.fragment=this.getFragment(a),c.any(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})},navigate:function(a,b){if(!D.started)return!1;b&&b!==!0||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));if(a=a.replace(I,""),this.fragment!==a){if(this.fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),b.history=new D;var J=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.__super__=e.prototype,d};m.extend=o.extend=y.extend=t.extend=D.extend=J;var K=function(){throw new Error('A "url" property or function must be specified')},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}};return b}),define("mockup-router",["jquery","underscore","backbone"],function(a,b,c){"use strict";var d=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},e=c.Router.extend({actions:[],redirects:{},addRoute:function(a,c,e,f,g,h){void 0===b.findWhere(this.patterns,{patternName:a,id:c})&&this.actions.push({patternName:a,id:c,callback:e,context:f,pathExp:g,expReplace:h});var i=new RegExp("("+d(a)+":"+d(c)+")");this.route(i,"handleRoute")},addRedirect:function(a,b){this.redirects[a]=b},handleRoute:function(a){var c=a.split(":"),d=c[0],e=c[1],f=b.findWhere(this.actions,{patternName:d,id:e});f&&f.callback.call(f.context)},redirect:function(){var a,c,d,e=window.parent.location.pathname;if(b.some(this.actions,function(b){if(b.pathExp&&(c=new RegExp(b.pathExp),e.match(c))){d="!/"+b.patternName+":"+b.id;var f="";return b.expReplace&&(f=b.expReplace),a=e.replace(c,f),!0}},this),void 0===d)for(var f in this.redirects)if(c=new RegExp(f),e.match(c)){d="!/"+this.redirects[f],a=e.replace(c,"");break}void 0!==d&&this._changeLocation.apply(this,[a,d])},_changeLocation:function(a,b){window.parent.location.hash=b,window.parent.location.pathname=a},start:function(){c.history.start()},reset:function(){this.actions=[]}});return new e}),define("mockup-utils",["jquery"],function(a){"use strict";var b=function(b){var c=this,d={pattern:null,vocabularyUrl:null,searchParam:"SearchableText",attributes:["UID","Title","Description","getURL","portal_type"],batchSize:10,baseCriteria:[],sort_on:"is_folderish",sort_order:"reverse",pathDepth:1};return c.options=a.extend({},d,b),c.pattern=c.options.pattern,(void 0===c.pattern||null===c.pattern)&&(c.pattern={browsing:!1,basePath:"/"}),c.options.url&&!c.options.vocabularyUrl?c.options.vocabularyUrl=c.options.url:c.pattern.vocabularyUrl&&(c.options.vocabularyUrl=c.pattern.vocabularyUrl),void 0!==c.options.vocabularyUrl&&null!==c.options.vocabularyUrl?c.valid=!0:c.valid=!1,c.getCurrentPath=function(){var a,b=c.pattern;a=c.currentPath?c.currentPath:b.currentPath,"function"==typeof a&&(a=a());var d=a;return d||(d=b.basePath?b.basePath:b.options.basePath?b.options.basePath:"/"),d},c.getCriterias=function(b,d){void 0===d&&(d={}),d=a.extend({},{useBaseCriteria:!0,additionalCriterias:[]},d);var e=[];return d.useBaseCriteria&&(e=c.options.baseCriteria.slice(0)),b&&(b+="*",e.push({i:c.options.searchParam,o:"plone.app.querystring.operation.string.contains",v:b})),d.searchPath?e.push({i:"path",o:"plone.app.querystring.operation.string.path",v:d.searchPath+"::"+c.options.pathDepth}):c.pattern.browsing&&e.push({i:"path",o:"plone.app.querystring.operation.string.path",v:c.getCurrentPath()+"::"+c.options.pathDepth}),e=e.concat(d.additionalCriterias)},c.getBatch=function(a){return a||(a=1),{page:a,size:c.options.batchSize}},c.selectAjax=function(){return{url:c.options.vocabularyUrl,dataType:"JSON",quietMillis:100,data:function(a,b){return c.getQueryData(a,b)},results:function(a,b){var c=10*b<a.total;return{results:a.results,more:c}}}},c.getUrl=function(){var b=c.options.vocabularyUrl;return b+=-1===b.indexOf("?")?"?":"&",b+a.param(c.getQueryData())},c.getQueryData=function(a,b){var d={query:JSON.stringify({criteria:c.getCriterias(a),sort_on:c.options.sort_on,sort_order:c.options.sort_order}),attributes:JSON.stringify(c.options.attributes)};return b&&(d.batch=JSON.stringify(c.getBatch(b))),d},c.search=function(b,d,e,f,g,h){void 0===g&&(g=!0),void 0===h&&(h="GET");var i=[];g&&(i=c.options.baseCriteria.slice(0)),i.push({i:b,o:d,v:e});var j={query:JSON.stringify({criteria:i}),attributes:JSON.stringify(c.options.attributes)};a.ajax({url:c.options.vocabularyUrl,dataType:"JSON",data:j,type:h,success:f})},c},c=function(b){var c=this;c.className="plone-loader";var d={backdrop:null,zIndex:10005};return b||(b={}),c.options=a.extend({},d,b),c.init=function(){c.$el=a("."+c.className),0===c.$el.length&&(c.$el=a("<div><div></div></div>"),c.$el.addClass(c.className).hide().appendTo("body"))},c.show=function(b){c.init(),c.$el.show();var d=c.options.zIndex;"function"==typeof d?d=Math.max(d(),10005):(d=10005,a(".plone-modal-wrapper,.plone-modal-backdrop").each(function(){d=Math.max(d,a(this).css("zIndex")||10005)}),d+=1),c.$el.css("zIndex",d),void 0===b&&(b=!0),c.options.backdrop&&(c.options.backdrop.closeOnClick=b,c.options.backdrop.closeOnEsc=b,c.options.backdrop.init(),c.options.backdrop.show())},c.hide=function(){c.init(),c.$el.hide()},c},d=function(a){return void 0===a&&(a="id"),a+Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return{generateId:d,parseBodyTag:function(b){return a(/<body[^>]*>((.|[\n\r])*)<\/body>/im.exec(b)[0].replace("<body","<div").replace("</body>","</div>")).eq(0).html()},setId:function(a,b){void 0===b&&(b="id");var c=a.attr("id");return c=void 0===c?d(b):c.replace(/\./g,"-"),a.attr("id",c),c},bool:function(b){return"string"==typeof b&&(b=a.trim(b).toLowerCase()),-1!==["true",!0,1].indexOf(b)},QueryHelper:b,Loading:c,loading:new c,getAuthenticator:function(){var b=a('input[name="_authenticator"]');return 0===b.length?(b=a('a[href*="_authenticator"]'),b.length>0?b.attr("href").split("_authenticator=")[1]:""):b.val()},featureSupport:{dragAndDrop:function(){return"draggable"in document.createElement("span")},fileApi:function(){return"undefined"!=typeof FileReader},history:function(){return!(!window.history||!window.history.pushState)}}}}),define("mockup-i18n",["jquery"],function(a){"use strict";var b=function(){var b=this;b.baseUrl=a("body").attr("data-i18ncatalogurl"),b.baseUrl||(b.baseUrl="/plonejsi18n"),b.currentLanguage=a("html").attr("lang")||"en-us",b.storage=null,b.catalogs={},b.ttl=864e5,Date.now||(Date.now=function(){return(new Date).valueOf()});try{"localStorage"in window&&null!==window.localStorage&&"JSON"in window&&null!==window.JSON&&(b.storage=window.localStorage)}catch(c){}b.configure=function(a){for(var c in a)b[c]=a[c]},b._setCatalog=function(a,c,d){a in b.catalogs?b.catalogs[a][c]=d:(b.catalogs[a]={},b.catalogs[a][c]=d)},b._storeCatalog=function(a,c,d){var e=a+"-"+c;null!==b.storage&&null!==d&&(b.storage.setItem(e,JSON.stringify(d)),b.storage.setItem(e+"-updated",Date.now()))},b.getUrl=function(a,c){return b.baseUrl+"?domain="+a+"&language="+c},b.loadCatalog=function(c,d){if(void 0===d&&(d=b.currentLanguage),null!==b.storage){var e=c+"-"+d;if(e in b.storage&&Date.now()-parseInt(b.storage.getItem(e+"-updated"),10)<b.ttl){var f=JSON.parse(b.storage.getItem(e));return void b._setCatalog(c,d,f)}}a.getJSON(b.getUrl(c,d),function(a){null!==a&&(b._setCatalog(c,d,a),b._storeCatalog(c,d,a))})},b.MessageFactory=function(a,c){return c=c||b.currentLanguage,function(d,e){var f;if(f=a in b.catalogs&&c in b.catalogs[a]&&d in b.catalogs[a][c]?b.catalogs[a][c][d]:d,e){var g,h;for(h in e)e.hasOwnProperty(h)&&(g=new RegExp("\\$\\{"+h+"\\}","g"),f=f.replace(g,e[h]))}return f}}};return b}),define("translate",["mockup-i18n"],function(a){"use strict";var b=null;
return function(c,d){if(null===b){var e=new a;e.loadCatalog("widgets"),b=e.MessageFactory("widgets")}return b(c,d)}}),function(a){"function"==typeof define&&define.amd?define("jquery.form",["jquery"],a):a("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(a){"use strict";function b(b){var c=b.data;b.isDefaultPrevented()||(b.preventDefault(),a(b.target).ajaxSubmit(c))}function c(b){var c=b.target,d=a(c);if(!d.is("[type=submit],[type=image]")){var e=d.closest("[type=submit]");if(0===e.length)return;c=e[0]}var f=this;if(f.clk=c,"image"==c.type)if(void 0!==b.offsetX)f.clk_x=b.offsetX,f.clk_y=b.offsetY;else if("function"==typeof a.fn.offset){var g=d.offset();f.clk_x=b.pageX-g.left,f.clk_y=b.pageY-g.top}else f.clk_x=b.pageX-c.offsetLeft,f.clk_y=b.pageY-c.offsetTop;setTimeout(function(){f.clk=f.clk_x=f.clk_y=null},100)}function d(){if(a.fn.ajaxSubmit.debug){var b="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(b):window.opera&&window.opera.postError&&window.opera.postError(b)}}var e={};e.fileapi=void 0!==a("<input type='file'/>").get(0).files,e.formdata=void 0!==window.FormData;var f=!!a.fn.prop;a.fn.attr2=function(){if(!f)return this.attr.apply(this,arguments);var a=this.prop.apply(this,arguments);return a&&a.jquery||"string"==typeof a?a:this.attr.apply(this,arguments)},a.fn.ajaxSubmit=function(b){function c(c){var d,e,f=a.param(c,b.traditional).split("&"),g=f.length,h=[];for(d=0;g>d;d++)f[d]=f[d].replace(/\+/g," "),e=f[d].split("="),h.push([decodeURIComponent(e[0]),decodeURIComponent(e[1])]);return h}function g(d){for(var e=new FormData,f=0;f<d.length;f++)e.append(d[f].name,d[f].value);if(b.extraData){var g=c(b.extraData);for(f=0;f<g.length;f++)g[f]&&e.append(g[f][0],g[f][1])}b.data=null;var h=a.extend(!0,{},a.ajaxSettings,b,{contentType:!1,processData:!1,cache:!1,type:i||"POST"});b.uploadProgress&&(h.xhr=function(){var c=a.ajaxSettings.xhr();return c.upload&&c.upload.addEventListener("progress",function(a){var c=0,d=a.loaded||a.position,e=a.total;a.lengthComputable&&(c=Math.ceil(d/e*100)),b.uploadProgress(a,d,e,c)},!1),c}),h.data=null;var j=h.beforeSend;return h.beforeSend=function(a,c){b.formData?c.data=b.formData:c.data=e,j&&j.call(this,a,c)},a.ajax(h)}function h(c){function e(a){var b=null;try{a.contentWindow&&(b=a.contentWindow.document)}catch(c){d("cannot get iframe.contentWindow document: "+c)}if(b)return b;try{b=a.contentDocument?a.contentDocument:a.document}catch(c){d("cannot get iframe.contentDocument: "+c),b=a.document}return b}function g(){function b(){try{var a=e(r).readyState;d("state = "+a),a&&"uninitialized"==a.toLowerCase()&&setTimeout(b,50)}catch(c){d("Server abort: ",c," (",c.name,")"),h(A),w&&clearTimeout(w),w=void 0}}var c=l.attr2("target"),f=l.attr2("action");x.setAttribute("target",o),(!i||/post/i.test(i))&&x.setAttribute("method","POST"),f!=m.url&&x.setAttribute("action",m.url),m.skipEncodingOverride||i&&!/post/i.test(i)||l.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),m.timeout&&(w=setTimeout(function(){v=!0,h(z)},m.timeout));var g=[];try{if(m.extraData)for(var j in m.extraData)m.extraData.hasOwnProperty(j)&&(a.isPlainObject(m.extraData[j])&&m.extraData[j].hasOwnProperty("name")&&m.extraData[j].hasOwnProperty("value")?g.push(a('<input type="hidden" name="'+m.extraData[j].name+'">').val(m.extraData[j].value).appendTo(x)[0]):g.push(a('<input type="hidden" name="'+j+'">').val(m.extraData[j]).appendTo(x)[0]));m.iframeTarget||q.appendTo("body"),r.attachEvent?r.attachEvent("onload",h):r.addEventListener("load",h,!1),setTimeout(b,15);try{x.submit()}catch(k){var n=document.createElement("form").submit;n.apply(x)}}finally{x.setAttribute("action",f),c?x.setAttribute("target",c):l.removeAttr("target"),a(g).remove()}}function h(b){if(!s.aborted&&!F){if(E=e(r),E||(d("cannot access response document"),b=A),b===z&&s)return s.abort("timeout"),void y.reject(s,"timeout");if(b==A&&s)return s.abort("server abort"),void y.reject(s,"error","server abort");if(E&&E.location.href!=m.iframeSrc||v){r.detachEvent?r.detachEvent("onload",h):r.removeEventListener("load",h,!1);var c,f="success";try{if(v)throw"timeout";var g="xml"==m.dataType||E.XMLDocument||a.isXMLDoc(E);if(d("isXml="+g),!g&&window.opera&&(null===E.body||!E.body.innerHTML)&&--G)return d("requeing onLoad callback, DOM not available"),void setTimeout(h,250);var i=E.body?E.body:E.documentElement;s.responseText=i?i.innerHTML:null,s.responseXML=E.XMLDocument?E.XMLDocument:E,g&&(m.dataType="xml"),s.getResponseHeader=function(a){var b={"content-type":m.dataType};return b[a.toLowerCase()]},i&&(s.status=Number(i.getAttribute("status"))||s.status,s.statusText=i.getAttribute("statusText")||s.statusText);var j=(m.dataType||"").toLowerCase(),k=/(json|script|text)/.test(j);if(k||m.textarea){var l=E.getElementsByTagName("textarea")[0];if(l)s.responseText=l.value,s.status=Number(l.getAttribute("status"))||s.status,s.statusText=l.getAttribute("statusText")||s.statusText;else if(k){var o=E.getElementsByTagName("pre")[0],p=E.getElementsByTagName("body")[0];o?s.responseText=o.textContent?o.textContent:o.innerText:p&&(s.responseText=p.textContent?p.textContent:p.innerText)}}else"xml"==j&&!s.responseXML&&s.responseText&&(s.responseXML=H(s.responseText));try{D=J(s,j,m)}catch(t){f="parsererror",s.error=c=t||f}}catch(t){d("error caught: ",t),f="error",s.error=c=t||f}s.aborted&&(d("upload aborted"),f=null),s.status&&(f=s.status>=200&&s.status<300||304===s.status?"success":"error"),"success"===f?(m.success&&m.success.call(m.context,D,"success",s),y.resolve(s.responseText,"success",s),n&&a.event.trigger("ajaxSuccess",[s,m])):f&&(void 0===c&&(c=s.statusText),m.error&&m.error.call(m.context,s,f,c),y.reject(s,"error",c),n&&a.event.trigger("ajaxError",[s,m,c])),n&&a.event.trigger("ajaxComplete",[s,m]),n&&!--a.active&&a.event.trigger("ajaxStop"),m.complete&&m.complete.call(m.context,s,f),F=!0,m.timeout&&clearTimeout(w),setTimeout(function(){m.iframeTarget?q.attr("src",m.iframeSrc):q.remove(),s.responseXML=null},100)}}}var j,k,m,n,o,q,r,s,t,u,v,w,x=l[0],y=a.Deferred();if(y.abort=function(a){s.abort(a)},c)for(k=0;k<p.length;k++)j=a(p[k]),f?j.prop("disabled",!1):j.removeAttr("disabled");if(m=a.extend(!0,{},a.ajaxSettings,b),m.context=m.context||m,o="jqFormIO"+(new Date).getTime(),m.iframeTarget?(q=a(m.iframeTarget),u=q.attr2("name"),u?o=u:q.attr2("name",o)):(q=a('<iframe name="'+o+'" src="'+m.iframeSrc+'" />'),q.css({position:"absolute",top:"-1000px",left:"-1000px"})),r=q[0],s={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(b){var c="timeout"===b?"timeout":"aborted";d("aborting upload... "+c),this.aborted=1;try{r.contentWindow.document.execCommand&&r.contentWindow.document.execCommand("Stop")}catch(e){}q.attr("src",m.iframeSrc),s.error=c,m.error&&m.error.call(m.context,s,c,b),n&&a.event.trigger("ajaxError",[s,m,c]),m.complete&&m.complete.call(m.context,s,c)}},n=m.global,n&&0===a.active++&&a.event.trigger("ajaxStart"),n&&a.event.trigger("ajaxSend",[s,m]),m.beforeSend&&m.beforeSend.call(m.context,s,m)===!1)return m.global&&a.active--,y.reject(),y;if(s.aborted)return y.reject(),y;t=x.clk,t&&(u=t.name,u&&!t.disabled&&(m.extraData=m.extraData||{},m.extraData[u]=t.value,"image"==t.type&&(m.extraData[u+".x"]=x.clk_x,m.extraData[u+".y"]=x.clk_y)));var z=1,A=2,B=a("meta[name=csrf-token]").attr("content"),C=a("meta[name=csrf-param]").attr("content");C&&B&&(m.extraData=m.extraData||{},m.extraData[C]=B),m.forceSync?g():setTimeout(g,10);var D,E,F,G=50,H=a.parseXML||function(a,b){return window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml"),b&&b.documentElement&&"parsererror"!=b.documentElement.nodeName?b:null},I=a.parseJSON||function(a){return window.eval("("+a+")")},J=function(b,c,d){var e=b.getResponseHeader("content-type")||"",f="xml"===c||!c&&e.indexOf("xml")>=0,g=f?b.responseXML:b.responseText;return f&&"parsererror"===g.documentElement.nodeName&&a.error&&a.error("parsererror"),d&&d.dataFilter&&(g=d.dataFilter(g,c)),"string"==typeof g&&("json"===c||!c&&e.indexOf("json")>=0?g=I(g):("script"===c||!c&&e.indexOf("javascript")>=0)&&a.globalEval(g)),g};return y}if(!this.length)return d("ajaxSubmit: skipping submit process - no element selected"),this;var i,j,k,l=this;"function"==typeof b?b={success:b}:void 0===b&&(b={}),i=b.type||this.attr2("method"),j=b.url||this.attr2("action"),k="string"==typeof j?a.trim(j):"",k=k||window.location.href||"",k&&(k=(k.match(/^([^#]+)/)||[])[1]),b=a.extend(!0,{url:k,success:a.ajaxSettings.success,type:i||a.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},b);var m={};if(this.trigger("form-pre-serialize",[this,b,m]),m.veto)return d("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(b.beforeSerialize&&b.beforeSerialize(this,b)===!1)return d("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var n=b.traditional;void 0===n&&(n=a.ajaxSettings.traditional);var o,p=[],q=this.formToArray(b.semantic,p);if(b.data&&(b.extraData=b.data,o=a.param(b.data,n)),b.beforeSubmit&&b.beforeSubmit(q,this,b)===!1)return d("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[q,this,b,m]),m.veto)return d("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var r=a.param(q,n);o&&(r=r?r+"&"+o:o),"GET"==b.type.toUpperCase()?(b.url+=(b.url.indexOf("?")>=0?"&":"?")+r,b.data=null):b.data=r;var s=[];if(b.resetForm&&s.push(function(){l.resetForm()}),b.clearForm&&s.push(function(){l.clearForm(b.includeHidden)}),!b.dataType&&b.target){var t=b.success||function(){};s.push(function(c){var d=b.replaceTarget?"replaceWith":"html";a(b.target)[d](c).each(t,arguments)})}else b.success&&s.push(b.success);if(b.success=function(a,c,d){for(var e=b.context||this,f=0,g=s.length;g>f;f++)s[f].apply(e,[a,c,d||l,l])},b.error){var u=b.error;b.error=function(a,c,d){var e=b.context||this;u.apply(e,[a,c,d,l])}}if(b.complete){var v=b.complete;b.complete=function(a,c){var d=b.context||this;v.apply(d,[a,c,l])}}var w=a("input[type=file]:enabled",this).filter(function(){return""!==a(this).val()}),x=w.length>0,y="multipart/form-data",z=l.attr("enctype")==y||l.attr("encoding")==y,A=e.fileapi&&e.formdata;d("fileAPI :"+A);var B,C=(x||z)&&!A;b.iframe!==!1&&(b.iframe||C)?b.closeKeepAlive?a.get(b.closeKeepAlive,function(){B=h(q)}):B=h(q):B=(x||z)&&A?g(q):a.ajax(b),l.removeData("jqxhr").data("jqxhr",B);for(var D=0;D<p.length;D++)p[D]=null;return this.trigger("form-submit-notify",[this,b]),this},a.fn.ajaxForm=function(e){if(e=e||{},e.delegation=e.delegation&&a.isFunction(a.fn.on),!e.delegation&&0===this.length){var f={s:this.selector,c:this.context};return!a.isReady&&f.s?(d("DOM not ready, queuing ajaxForm"),a(function(){a(f.s,f.c).ajaxForm(e)}),this):(d("terminating; zero elements found by selector"+(a.isReady?"":" (DOM not ready)")),this)}return e.delegation?(a(document).off("submit.form-plugin",this.selector,b).off("click.form-plugin",this.selector,c).on("submit.form-plugin",this.selector,e,b).on("click.form-plugin",this.selector,e,c),this):this.ajaxFormUnbind().bind("submit.form-plugin",e,b).bind("click.form-plugin",e,c)},a.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},a.fn.formToArray=function(b,c){var d=[];if(0===this.length)return d;var f=this[0],g=b?f.getElementsByTagName("*"):f.elements;if(!g)return d;var h,i,j,k,l,m,n;for(h=0,m=g.length;m>h;h++)if(l=g[h],j=l.name,j&&!l.disabled)if(b&&f.clk&&"image"==l.type)f.clk==l&&(d.push({name:j,value:a(l).val(),type:l.type}),d.push({name:j+".x",value:f.clk_x},{name:j+".y",value:f.clk_y}));else if(k=a.fieldValue(l,!0),k&&k.constructor==Array)for(c&&c.push(l),i=0,n=k.length;n>i;i++)d.push({name:j,value:k[i]});else if(e.fileapi&&"file"==l.type){c&&c.push(l);var o=l.files;if(o.length)for(i=0;i<o.length;i++)d.push({name:j,value:o[i],type:l.type});else d.push({name:j,value:"",type:l.type})}else null!==k&&"undefined"!=typeof k&&(c&&c.push(l),d.push({name:j,value:k,type:l.type,required:l.required}));if(!b&&f.clk){var p=a(f.clk),q=p[0];j=q.name,j&&!q.disabled&&"image"==q.type&&(d.push({name:j,value:p.val()}),d.push({name:j+".x",value:f.clk_x},{name:j+".y",value:f.clk_y}))}return d},a.fn.formSerialize=function(b){return a.param(this.formToArray(b))},a.fn.fieldSerialize=function(b){var c=[];return this.each(function(){var d=this.name;if(d){var e=a.fieldValue(this,b);if(e&&e.constructor==Array)for(var f=0,g=e.length;g>f;f++)c.push({name:d,value:e[f]});else null!==e&&"undefined"!=typeof e&&c.push({name:this.name,value:e})}}),a.param(c)},a.fn.fieldValue=function(b){for(var c=[],d=0,e=this.length;e>d;d++){var f=this[d],g=a.fieldValue(f,b);null===g||"undefined"==typeof g||g.constructor==Array&&!g.length||(g.constructor==Array?a.merge(c,g):c.push(g))}return c},a.fieldValue=function(b,c){var d=b.name,e=b.type,f=b.tagName.toLowerCase();if(void 0===c&&(c=!0),c&&(!d||b.disabled||"reset"==e||"button"==e||("checkbox"==e||"radio"==e)&&!b.checked||("submit"==e||"image"==e)&&b.form&&b.form.clk!=b||"select"==f&&-1==b.selectedIndex))return null;if("select"==f){var g=b.selectedIndex;if(0>g)return null;for(var h=[],i=b.options,j="select-one"==e,k=j?g+1:i.length,l=j?g:0;k>l;l++){var m=i[l];if(m.selected){var n=m.value;if(n||(n=m.attributes&&m.attributes.value&&!m.attributes.value.specified?m.text:m.value),j)return n;h.push(n)}}return h}return a(b).val()},a.fn.clearForm=function(b){return this.each(function(){a("input,select,textarea",this).clearFields(b)})},a.fn.clearFields=a.fn.clearInputs=function(b){var c=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var d=this.type,e=this.tagName.toLowerCase();c.test(d)||"textarea"==e?this.value="":"checkbox"==d||"radio"==d?this.checked=!1:"select"==e?this.selectedIndex=-1:"file"==d?/MSIE/.test(navigator.userAgent)?a(this).replaceWith(a(this).clone(!0)):a(this).val(""):b&&(b===!0&&/hidden/.test(d)||"string"==typeof b&&a(this).is(b))&&(this.value="")})},a.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},a.fn.enable=function(a){return void 0===a&&(a=!0),this.each(function(){this.disabled=!a})},a.fn.selected=function(b){return void 0===b&&(b=!0),this.each(function(){var c=this.type;if("checkbox"==c||"radio"==c)this.checked=b;else if("option"==this.tagName.toLowerCase()){var d=a(this).parent("select");b&&d[0]&&"select-one"==d[0].type&&d.find("option").selected(!1),this.selected=b}})},a.fn.ajaxSubmit.debug=!1}),define("mockup-patterns-modal",["jquery","underscore","pat-base","mockup-patterns-backdrop","pat-registry","mockup-router","mockup-utils","translate","jquery.form"],function(a,b,c,d,e,f,g,h){"use strict";var i=c.extend({name:"plone-modal",trigger:".pat-plone-modal",parser:"mockup",createModal:null,$model:null,defaults:{width:"",height:"",margin:20,position:"center middle",triggers:[],backdrop:"body",backdropOptions:{zIndex:"1040",opacity:"0.85",className:"plone-modal-backdrop",classActiveName:"plone-backdrop-active",closeOnEsc:!0,closeOnClick:!0},title:null,titleSelector:"h1:first",buttons:'.formControls > input[type="submit"]',content:"#content",automaticallyAddButtonActions:!0,loadLinksWithinModal:!0,prependContent:".portalMessage",templateOptions:{className:"plone-modal fade",classDialog:"plone-modal-dialog",classModal:"plone-modal-content",classHeaderName:"plone-modal-header",classBodyName:"plone-modal-body",classFooterName:"plone-modal-footer",classWrapperName:"plone-modal-wrapper",classWrapperInnerName:"modal-wrapper-inner",classActiveName:"in",classPrependName:"",classContentName:"",template:'<div class="<%= options.className %>">  <div class="<%= options.classDialog %>">    <div class="<%= options.classModal %>">      <div class="<%= options.classHeaderName %>">        <a class="plone-modal-close">&times;</a>        <% if (title) { %><h2 class="plone-modal-title"><%= title %></h2><% } %>      </div>      <div class="<%= options.classBodyName %>">        <div class="<%= options.classPrependName %>"><%= prepend %></div>         <div class="<%= options.classContentName %>"><%= content %></div>      </div>      <div class="<%= options.classFooterName %>">         <% if (buttons) { %><%= buttons %><% } %>      </div>    </div>  </div></div>'},actions:{},actionOptions:{eventType:"click",disableAjaxFormSubmit:!1,target:null,ajaxUrl:null,modalFunction:null,isForm:!1,timeout:5e3,displayInModal:!0,reloadWindowOnClose:!0,error:".portalMessage.error",formFieldError:".field.error",onSuccess:null,onError:null,onFormError:null,onTimeout:null,redirectOnResponse:!1,redirectToUrl:function(a,b,c){var d;return d=/<body.*data-view-url=[\"'](.*)[\"'].*/im.exec(b),d&&d.length>1?d[1].split('"')[0]:(d=/<body.*data-base-url=[\"'](.*)[\"'].*/im.exec(b),d&&d.length>1?d[1].split('"')[0]:(d=/<base.*href=[\"'](.*)[\"'].*/im.exec(b),d&&d.length>1?d[1]:""))}},routerOptions:{id:null,pathExp:null},form:function(c){var d=this,e=d.$modal;d.options.automaticallyAddButtonActions&&(c[d.options.buttons]={}),c.a={},a.each(c,function(c,f){var g=b.union(b.keys(d.options.actionOptions),["templateOptions"]),h=a.extend(!0,{},d.options.actionOptions,b.pick(f,g));f.templateOptions=a.extend(!0,f.templateOptions,d.options.templateOptions);var i=b.union(b.keys(d.options.actionOptions),["actions","actionOptions"]),j=a.extend(!0,b.omit(f,i),d.options);a(c,a("."+f.templateOptions.classBodyName,e)).each(function(b){var c=a(this);c.on(h.eventType,function(b){b.stopPropagation(),b.preventDefault(),d.loading.show(!1),null!==h.modalFunction?d[h.modalFunction]():a.nodeName(c[0],"input")||a.nodeName(c[0],"button")||f.isForm===!0?d.options.handleFormAction.apply(d,[c,h,j]):(null!==f.ajaxUrl||a.nodeName(c[0],"a"))&&d.options.handleLinkAction.apply(d,[c,h,j])})})})},handleFormAction:function(b,c,d){var e=this,f={};f[b.attr("name")]=b.attr("value");var g;g=a.nodeName(b[0],"form")?b:b.parents("form:not(.disableAutoSubmit)");var i;return i=null!==c.ajaxUrl?"function"==typeof c.ajaxUrl?c.ajaxUrl.apply(e,[b,c]):c.ajaxUrl:b.parents("form").attr("action"),c.disableAjaxFormSubmit?(b.attr("name")&&b.attr("value")&&g.append(a('<input type="hidden" name="'+b.attr("name")+'" value="'+b.attr("value")+'" />')),void g.trigger("submit")):(g.on("submit",function(a){a.preventDefault()}),g.trigger("submit"),e.loading.show(!1),void g.ajaxSubmit({timeout:c.timeout,data:f,url:i,error:function(a,b,d){e.loading.hide(),"timeout"===b&&c.onTimeout?c.onTimeout.apply(e,a,d):c.onError?c.onError(a,b,d):(window.alert(h("There was an error submitting the form.")),console.log("error happened do something")),e.emit("formActionError",[a,b,d])},success:function(f,g,h,i){return e.loading.hide(),0!==a(c.error,f).size()||0!==a(c.formFieldError,f).size()?void(c.onFormError?c.onFormError(e,f,g,h,i):e.redraw(f,d)):c.redirectOnResponse===!0?void("function"==typeof c.redirectToUrl?window.parent.location.href=c.redirectToUrl.apply(e,[b,f,c]):window.parent.location.href=c.redirectToUrl):(c.onSuccess&&c.onSuccess(e,f,g,h,i),c.displayInModal===!0?e.redraw(f,d):(b.trigger("destroy.plone-modal.patterns"),c.reloadWindowOnClose&&e.reloadWindow()),void e.emit("formActionSuccess",[f,g,h,i]))}}))},handleLinkAction:function(b,c,d){var e,f=this;return e=c.ajaxUrl?"function"==typeof c.ajaxUrl?c.ajaxUrl.apply(f,[b,c]):c.ajaxUrl:b.attr("href"),c.displayInModal===!1?void(window.parent.location.href=e):void a.ajax({url:e}).fail(function(a,b,d){"timeout"===b&&c.onTimeout?c.onTimeout(f.$modal,a,d):c.onError?c.onError(a,b,d):window.alert(h("There was an error loading modal.")),f.emit("linkActionError",[a,b,d])}).done(function(a,b,e){f.redraw(a,d),c.onSuccess&&c.onSuccess(f,a,b,e),f.emit("linkActionSuccess",[a,b,e])}).always(function(){f.loading.hide()})},render:function(c){var d=this;if(d.emit("before-render"),d.$raw){var e=d.$raw.clone();a("input:checked",e).each(function(){this.setAttribute&&this.setAttribute("checked","checked")});var f={title:"",prepend:"<div />",content:"",buttons:'<div class="pattern-modal-buttons"></div>',options:c.templateOptions};if(null===c.title){var g=a(c.titleSelector,e);f.title=g.html(),a(c.titleSelector,e).remove()}else f.title=c.title;c.prependContent&&(f.prepend=a("<div />").append(a(c.prependContent,e).clone()).html(),a(c.prependContent,e).remove()),c.content?f.content=a(c.content,e).html():f.content=e.html(),d.$modal=a(b.template(d.options.templateOptions.template)(f)),d.$modalDialog=a("> ."+d.options.templateOptions.classDialog,d.$modal),d.$modalContent=a("> ."+d.options.templateOptions.classModal,d.$modalDialog),a("form",d.$modal).on("keydown",function(b){13===b.keyCode&&"TEXTAREA"!==b.target.nodeName&&(b.preventDefault(),a("input[type=submit], button[type=submit], button:not(type)",this).eq(0).trigger("click"))}),a(c.buttons,d.$modal).each(function(){var b=a(this);b.on("click",function(a){a.stopPropagation(),a.preventDefault()}).clone().appendTo(a(".pattern-modal-buttons",d.$modal)).off("click").on("click",function(a){a.stopPropagation(),a.preventDefault(),b.trigger("click")}),b.hide()}),d.emit("before-events-setup"),a(".plone-modal-header > a.plone-modal-close, .plone-modal-footer > a.plone-modal-close",d.$modal).off("click").on("click",function(b){b.stopPropagation(),b.preventDefault(),a(b.target).trigger("destroy.plone-modal.patterns")}),a(".row",d.$modal).removeClass("row"),c.form&&c.form.apply(d,[c.actions]),d.$modal.addClass(d.options.templateOptions.className).on("destroy.plone-modal.patterns",function(a){a.stopPropagation(),d.hide()}).on("resize.plone-modal.patterns",function(a){a.stopPropagation(),a.preventDefault(),d.positionModal()}).appendTo(d.$wrapperInner),d.options.loadLinksWithinModal&&d.$modal.on("click",function(b){b.stopPropagation(),a.nodeName(b.target,"a")&&b.preventDefault(),d.$modal.trigger("modal-click")}),d.$modal.data("pattern-"+d.name,d),d.emit("after-render")}}},reloadWindow:function(){window.parent.location.reload()},init:function(){var b=this;b.options.loadLinksWithinModal=a.parseJSON(b.options.loadLinksWithinModal),null!==b.options.routerOptions.id&&f.addRoute("modal",b.options.routerOptions.id,function(){this.show()},b,b.options.routerOptions.pathExp,b.options.routerOptions.expReplace),b.options.backdropOptions.closeOnEsc===!0&&a(document).on("keydown",function(a,c){b.$el.is("."+b.options.templateOptions.classActiveName)&&27===a.keyCode&&b.hide()}),a(window.parent).resize(function(){b.positionModal()}),b.options.triggers&&a.each(b.options.triggers,function(c,d){var e=d.substring(0,d.indexOf(" ")),f=d.substring(d.indexOf(" "),d.length);a(f||b.$el).on(e,function(a){a.stopPropagation(),a.preventDefault(),b.show()})}),b.$el.is("a")&&(b.$el.attr("href")&&!b.options.image&&(b.options.target||"#"!==b.$el.attr("href").substr(0,1)||(b.options.target=b.$el.attr("href"),b.options.content=""),b.options.ajaxUrl||"#"===b.$el.attr("href").substr(0,1)||(b.options.ajaxUrl=b.$el.attr("href"))),b.$el.on("click",function(a){a.stopPropagation(),a.preventDefault(),b.show()})),b.initModal()},createAjaxModal:function(){var b=this;b.emit("before-ajax"),b.loading.show(),b.ajaxXHR=a.ajax({url:b.options.ajaxUrl,type:b.options.ajaxType}).done(function(c,d,e){b.ajaxXHR=void 0,b.$raw=a("<div />").append(a(g.parseBodyTag(c))),b.emit("after-ajax",b,d,e),b._show()}).fail(function(a,c,d){var e=b.options.actionOptions;"timeout"===c&&e.onTimeout?e.onTimeout(b.$modal,a,d):e.onError?e.onError(a,c,d):(window.alert(h("There was an error loading modal.")),b.hide()),b.emit("linkActionError",[a,c,d])}).always(function(){b.loading.hide()})},createTargetModal:function(){var b=this;b.$raw=a(b.options.target).clone(),b._show()},createBasicModal:function(){var b=this;b.$raw=a("<div/>").html(b.$el.clone()),b._show()},createHtmlModal:function(){var b=this,c=a(b.options.html);b.$raw=c,b._show()},createImageModal:function(){var b=this;b.$wrapper.addClass("image-modal");var c=b.$el.attr("href");b.$raw=a('<div><h1>Image</h1><div id="content"><div class="modal-image"><img src="'+c+'" /></div></div></div>'),b._show()},initModal:function(){var a=this;a.options.ajaxUrl?a.createModal=a.createAjaxModal:a.options.target?a.createModal=a.createTargetModal:a.options.html?a.createModal=a.createHtmlModal:a.options.image?a.createModal=a.createImageModal:a.createModal=a.createBasicModal},findPosition:function(a,b,c,d,e,f,g){var h,i,j,k,l={};return k=j=h=j="auto","left"===a?(j=c+"px",d>f&&(j="0px"),l.left=j):"right"===a?(k=c+"px",d>f&&(k="0px"),l.right=k,l.left="auto"):(j=f/2-d/2-c+"px",d>f&&(j="0px"),l.left=j),"top"===b?(h=c+"px",e>g&&(h="0px"),l.top=h):"bottom"===b?(i=c+"px",e>g&&(i="0px"),l.bottom=i,l.top="auto"):(h=g/2-e/2-c+"px",e>g&&(h="0px"),l.top=h),l},modalInitialized:function(){var a=this;return null!==a.$modal&&void 0!==a.$modal},positionModal:function(){var b=this;if(b.modalInitialized()){b.$modal.removeAttr("style"),b.$wrapper.parent().is("body")&&b.$wrapper.height(a(window.parent).height());var c="function"==typeof b.options.margin?b.options.margin():b.options.margin;b.$modal.css({position:"absolute",padding:c}),b.$modalDialog.css({margin:"0",padding:"0",width:b.options.width,height:b.options.height}),b.$modalContent.css({width:b.options.width});var d=b.options.position.split(" "),e=d[0],f=d[1],g=b.$modalDialog.outerWidth(!0),h=b.$modalDialog.outerHeight(!0),i=b.$wrapperInner.width(),j=b.$wrapperInner.height(),k=b.findPosition(e,f,c,g,h,i,j);for(var l in k)b.$modalDialog.css(l,k[l])}},render:function(a){var b=this;b.emit("render"),b.options.render.apply(b,[a]),b.emit("rendered")},show:function(){var a=this;a.backdrop=a.createBackdrop(),a.createModal()},createBackdrop:function(){var b=this,c=new d(b.$el.parents(b.options.backdrop),b.options.backdropOptions),e=null!==b.options.backdropOptions.zIndex?parseInt(b.options.backdropOptions.zIndex,10)+1:1041;return b.$wrapper=a("<div/>").hide().css({"z-index":e,"overflow-y":"auto",position:"fixed",height:"100%",width:"100%",bottom:"0",left:"0",right:"0",top:"0"}).addClass(b.options.templateOptions.classWrapperName).insertBefore(c.$backdrop).on("click",function(a){b.options.backdropOptions.closeOnClick&&(a.stopPropagation(),a.preventDefault(),c.hide())}),c.on("hidden",function(a){void 0!==b.$modal&&b.$modal.hasClass(b.options.templateOptions.classActiveName)&&b.hide()}),b.loading=new g.Loading({backdrop:c}),b.$wrapperInner=a("<div/>").addClass(b.options.classWrapperInnerName).css({position:"absolute",bottom:"0",left:"0",right:"0",top:"0"}).appendTo(b.$wrapper),c},_show:function(){var b=this;b.render.apply(b,[b.options]),b.emit("show"),b.backdrop.show(),b.$wrapper.show(),b.loading.hide(),b.$el.addClass(b.options.templateOptions.classActiveName),b.$modal.addClass(b.options.templateOptions.classActiveName),e.scan(b.$modal),b.positionModal(),a("img",b.$modal).load(function(){b.positionModal()}),a(window.parent).on("resize.plone-modal.patterns",function(){b.positionModal()}),a("body").addClass("plone-modal-open"),b.emit("shown")},hide:function(){var b=this;b.ajaxXHR&&b.ajaxXHR.abort(),b.emit("hide"),(!b._suppressHide||window.confirm(b._suppressHide))&&(a(".plone-modal",b.$wrapper).size()<2&&(b.backdrop.hide(),b.$wrapper.remove(),a("body").removeClass("plone-modal-open")),b.loading.hide(),b.$el.removeClass(b.options.templateOptions.classActiveName),void 0!==b.$modal&&(b.$modal.remove(),b.initModal()),a(window.parent).off("resize.plone-modal.patterns"),b.emit("hidden"))},redraw:function(b,c){var d=this;d.emit("beforeDraw"),d.$modal.remove(),d.$raw=a("<div />").append(a(g.parseBodyTag(b))),d.render.apply(d,[c||d.options]),d.$modal.addClass(d.options.templateOptions.classActiveName),d.positionModal(),e.scan(d.$modal),d.emit("afterDraw")}});return i}),function(a){define("select2",[],function(){return function(){!function(a){"undefined"==typeof a.fn.each2&&a.extend(a.fn,{each2:function(b){for(var c=a([0]),d=-1,e=this.length;++d<e&&(c.context=c[0]=this[d])&&b.call(c[0],d,c)!==!1;);return this}})}(jQuery),function(a,b){"use strict";function c(b){var c=a(document.createTextNode(""));b.before(c),c.before(b),c.remove()}function d(a){function b(a){return O[a]||a}return a.replace(/[^\u0000-\u007E]/g,b)}function e(a,b){for(var c=0,d=b.length;d>c;c+=1)if(g(a,b[c]))return c;return-1}function f(){var b=a(N);b.appendTo("body");var c={width:b.width()-b[0].clientWidth,height:b.height()-b[0].clientHeight};return b.remove(),c}function g(a,c){return a===c?!0:a===b||c===b?!1:null===a||null===c?!1:a.constructor===String?a+""==c+"":c.constructor===String?c+""==a+"":!1}function h(b,c){var d,e,f;if(null===b||b.length<1)return[];for(d=b.split(c),e=0,f=d.length;f>e;e+=1)d[e]=a.trim(d[e]);return d}function i(a){return a.outerWidth(!1)-a.width()}function j(c){var d="keyup-change-value";c.on("keydown",function(){a.data(c,d)===b&&a.data(c,d,c.val())}),c.on("keyup",function(){var e=a.data(c,d);e!==b&&c.val()!==e&&(a.removeData(c,d),c.trigger("keyup-change"))})}function k(c){c.on("mousemove",function(c){var d=M;(d===b||d.x!==c.pageX||d.y!==c.pageY)&&a(c.target).trigger("mousemove-filtered",c)})}function l(a,c,d){d=d||b;var e;return function(){var b=arguments;window.clearTimeout(e),e=window.setTimeout(function(){c.apply(d,b)},a)}}function m(a,b){var c=l(a,function(a){b.trigger("scroll-debounced",a)});b.on("scroll",function(a){e(a.target,b.get())>=0&&c(a)})}function n(a){a[0]!==document.activeElement&&window.setTimeout(function(){var b,c=a[0],d=a.val().length;a.focus();var e=c.offsetWidth>0||c.offsetHeight>0;e&&c===document.activeElement&&(c.setSelectionRange?c.setSelectionRange(d,d):c.createTextRange&&(b=c.createTextRange(),b.collapse(!1),b.select()))},0)}function o(b){b=a(b)[0];var c=0,d=0;if("selectionStart"in b)c=b.selectionStart,d=b.selectionEnd-c;else if("selection"in document){b.focus();var e=document.selection.createRange();d=document.selection.createRange().text.length,e.moveStart("character",-b.value.length),c=e.text.length-d}return{offset:c,length:d}}function p(a){a.preventDefault(),a.stopPropagation()}function q(a){a.preventDefault(),a.stopImmediatePropagation()}function r(b){if(!J){var c=b[0].currentStyle||window.getComputedStyle(b[0],null);J=a(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:c.fontSize,fontFamily:c.fontFamily,fontStyle:c.fontStyle,fontWeight:c.fontWeight,letterSpacing:c.letterSpacing,textTransform:c.textTransform,whiteSpace:"nowrap"}),J.attr("class","select2-sizer"),a("body").append(J)}return J.text(b.val()),J.width()}function s(b,c,d){var e,f,g=[];e=a.trim(b.attr("class")),e&&(e=""+e,a(e.split(/\s+/)).each2(function(){0===this.indexOf("select2-")&&g.push(this)})),e=a.trim(c.attr("class")),e&&(e=""+e,a(e.split(/\s+/)).each2(function(){0!==this.indexOf("select2-")&&(f=d(this),f&&g.push(f))})),b.attr("class",g.join(" "))}function t(a,b,c,e){var f=d(a.toUpperCase()).indexOf(d(b.toUpperCase())),g=b.length;return 0>f?void c.push(e(a)):(c.push(e(a.substring(0,f))),c.push("<span class='select2-match'>"),c.push(e(a.substring(f,f+g))),c.push("</span>"),void c.push(e(a.substring(f+g,a.length))))}function u(a){var b={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return String(a).replace(/[&<>"'\/\\]/g,function(a){return b[a]})}function v(c){var d,e=null,f=c.quietMillis||100,g=c.url,h=this;return function(i){window.clearTimeout(d),d=window.setTimeout(function(){var d=c.data,f=g,j=c.transport||a.fn.select2.ajaxDefaults.transport,k={type:c.type||"GET",cache:c.cache||!1,jsonpCallback:c.jsonpCallback||b,dataType:c.dataType||"json"},l=a.extend({},a.fn.select2.ajaxDefaults.params,k);d=d?d.call(h,i.term,i.page,i.context):null,f="function"==typeof f?f.call(h,i.term,i.page,i.context):f,e&&"function"==typeof e.abort&&e.abort(),c.params&&(a.isFunction(c.params)?a.extend(l,c.params.call(h)):a.extend(l,c.params)),
a.extend(l,{url:f,dataType:c.dataType,data:d,success:function(a){var b=c.results(a,i.page,i);i.callback(b)},error:function(a,b,c){var d={hasError:!0,jqXHR:a,textStatus:b,errorThrown:c};i.callback(d)}}),e=j.call(h,l)},f)}}function w(b){var c,d,e=b,f=function(a){return""+a.text};a.isArray(e)&&(d=e,e={results:d}),a.isFunction(e)===!1&&(d=e,e=function(){return d});var g=e();return g.text&&(f=g.text,a.isFunction(f)||(c=g.text,f=function(a){return a[c]})),function(b){var c,d=b.term,g={results:[]};return""===d?void b.callback(e()):(c=function(e,g){var h,i;if(e=e[0],e.children){h={};for(i in e)e.hasOwnProperty(i)&&(h[i]=e[i]);h.children=[],a(e.children).each2(function(a,b){c(b,h.children)}),(h.children.length||b.matcher(d,f(h),e))&&g.push(h)}else b.matcher(d,f(e),e)&&g.push(e)},a(e().results).each2(function(a,b){c(b,g.results)}),void b.callback(g))}}function x(c){var d=a.isFunction(c);return function(e){var f=e.term,g={results:[]},h=d?c(e):c;a.isArray(h)&&(a(h).each(function(){var a=this.text!==b,c=a?this.text:this;(""===f||e.matcher(f,c))&&g.results.push(a?this:{id:this,text:this})}),e.callback(g))}}function y(b,c){if(a.isFunction(b))return!0;if(!b)return!1;if("string"==typeof b)return!0;throw new Error(c+" must be a string, function, or falsy value")}function z(b,c){if(a.isFunction(b)){var d=Array.prototype.slice.call(arguments,2);return b.apply(c,d)}return b}function A(b){var c=0;return a.each(b,function(a,b){b.children?c+=A(b.children):c++}),c}function B(a,c,d,e){var f,h,i,j,k,l=a,m=!1;if(!e.createSearchChoice||!e.tokenSeparators||e.tokenSeparators.length<1)return b;for(;;){for(h=-1,i=0,j=e.tokenSeparators.length;j>i&&(k=e.tokenSeparators[i],h=a.indexOf(k),!(h>=0));i++);if(0>h)break;if(f=a.substring(0,h),a=a.substring(h+k.length),f.length>0&&(f=e.createSearchChoice.call(this,f,c),f!==b&&null!==f&&e.id(f)!==b&&null!==e.id(f))){for(m=!1,i=0,j=c.length;j>i;i++)if(g(e.id(f),e.id(c[i]))){m=!0;break}m||d(f)}}return l!==a?a:void 0}function C(){var b=this;a.each(arguments,function(a,c){b[c].remove(),b[c]=null})}function D(b,c){var d=function(){};return d.prototype=new b,d.prototype.constructor=d,d.prototype.parent=b.prototype,d.prototype=a.extend(d.prototype,c),d}if(window.Select2===b){var E,F,G,H,I,J,K,L,M={x:0,y:0},E={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(a){switch(a=a.which?a.which:a){case E.LEFT:case E.RIGHT:case E.UP:case E.DOWN:return!0}return!1},isControl:function(a){var b=a.which;switch(b){case E.SHIFT:case E.CTRL:case E.ALT:return!0}return a.metaKey?!0:!1},isFunctionKey:function(a){return a=a.which?a.which:a,a>=112&&123>=a}},N="<div class='select2-measure-scrollbar'></div>",O={"":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"AA","":"AE","":"AE","":"AE","":"AO","":"AU","":"AV","":"AV","":"AY","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"DZ","":"DZ","":"Dz","":"Dz","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"F","":"F","":"F","":"F","":"F","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"J","":"J","":"J","":"J","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"LJ","":"Lj","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"NJ","":"Nj","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"OI","":"OO","":"OU","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"Q","":"Q","":"Q","":"Q","":"Q","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"TZ","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"VY","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"X","":"X","":"X","":"X","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"aa","":"ae","":"ae","":"ae","":"ao","":"au","":"av","":"av","":"ay","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"dz","":"dz","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"f","":"f","":"f","":"f","":"f","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"hv","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"j","":"j","":"j","":"j","":"j","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"lj","":"m","":"m","":"m","":"m","":"m","":"m","":"m","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"nj","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"oi","":"ou","":"oo","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"q","":"q","":"q","":"q","":"q","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"tz","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"vy","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"x","":"x","":"x","":"x","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};K=a(document),I=function(){var a=1;return function(){return a++}}(),F=D(Object,{bind:function(a){var b=this;return function(){a.apply(b,arguments)}},init:function(c){var d,e,g=".select2-results";this.opts=c=this.prepareOpts(c),this.id=c.id,c.element.data("select2")!==b&&null!==c.element.data("select2")&&c.element.data("select2").destroy(),this.container=this.createContainer(),this.liveRegion=a("<span>",{role:"status","aria-live":"polite"}).addClass("select2-hidden-accessible").appendTo(document.body),this.containerId="s2id_"+(c.element.attr("id")||"autogen"+I()),this.containerEventName=this.containerId.replace(/([.])/g,"_").replace(/([;&,\-\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId),this.container.attr("title",c.element.attr("title")),this.body=a("body"),s(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.attr("style",c.element.attr("style")),this.container.css(z(c.containerCss,this.opts.element)),this.container.addClass(z(c.containerCssClass,this.opts.element)),this.elementTabIndex=this.opts.element.attr("tabindex"),this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container).on("click.select2",p),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),s(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(z(c.dropdownCssClass,this.opts.element)),this.dropdown.data("select2",this),this.dropdown.on("click",p),this.results=d=this.container.find(g),this.search=e=this.container.find("input.select2-input"),this.queryCount=0,this.resultsPage=0,this.context=null,this.initContainer(),this.container.on("click",p),k(this.results),this.dropdown.on("mousemove-filtered",g,this.bind(this.highlightUnderEvent)),this.dropdown.on("touchstart touchmove touchend",g,this.bind(function(a){this._touchEvent=!0,this.highlightUnderEvent(a)})),this.dropdown.on("touchmove",g,this.bind(this.touchMoved)),this.dropdown.on("touchstart touchend",g,this.bind(this.clearTouchMoved)),this.dropdown.on("click",this.bind(function(a){this._touchEvent&&(this._touchEvent=!1,this.selectHighlighted())})),m(80,this.results),this.dropdown.on("scroll-debounced",g,this.bind(this.loadMoreIfNeeded)),a(this.container).on("change",".select2-input",function(a){a.stopPropagation()}),a(this.dropdown).on("change",".select2-input",function(a){a.stopPropagation()}),a.fn.mousewheel&&d.mousewheel(function(a,b,c,e){var f=d.scrollTop();e>0&&0>=f-e?(d.scrollTop(0),p(a)):0>e&&d.get(0).scrollHeight-d.scrollTop()+e<=d.height()&&(d.scrollTop(d.get(0).scrollHeight-d.height()),p(a))}),j(e),e.on("keyup-change input paste",this.bind(this.updateResults)),e.on("focus",function(){e.addClass("select2-focused")}),e.on("blur",function(){e.removeClass("select2-focused")}),this.dropdown.on("mouseup",g,this.bind(function(b){a(b.target).closest(".select2-result-selectable").length>0&&(this.highlightUnderEvent(b),this.selectHighlighted(b))})),this.dropdown.on("click mouseup mousedown touchstart touchend focusin",function(a){a.stopPropagation()}),this.nextSearchTerm=b,a.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),null!==c.maximumInputLength&&this.search.attr("maxlength",c.maximumInputLength);var h=c.element.prop("disabled");h===b&&(h=!1),this.enable(!h);var i=c.element.prop("readonly");i===b&&(i=!1),this.readonly(i),L=L||f(),this.autofocus=c.element.prop("autofocus"),c.element.prop("autofocus",!1),this.autofocus&&this.focus(),this.search.attr("placeholder",c.searchInputPlaceholder)},destroy:function(){var a=this.opts.element,c=a.data("select2"),d=this;this.close(),a.length&&a[0].detachEvent&&a.each(function(){this.detachEvent("onpropertychange",d._sync)}),this.propertyObserver&&(this.propertyObserver.disconnect(),this.propertyObserver=null),this._sync=null,c!==b&&(c.container.remove(),c.liveRegion.remove(),c.dropdown.remove(),a.removeClass("select2-offscreen").removeData("select2").off(".select2").prop("autofocus",this.autofocus||!1),this.elementTabIndex?a.attr({tabindex:this.elementTabIndex}):a.removeAttr("tabindex"),a.show()),C.call(this,"container","liveRegion","dropdown","results","search")},optionToData:function(a){return a.is("option")?{id:a.prop("value"),text:a.text(),element:a.get(),css:a.attr("class"),disabled:a.prop("disabled"),locked:g(a.attr("locked"),"locked")||g(a.data("locked"),!0)}:a.is("optgroup")?{text:a.attr("label"),children:[],element:a.get(),css:a.attr("class")}:void 0},prepareOpts:function(c){var d,e,f,i,j=this;if(d=c.element,"select"===d.get(0).tagName.toLowerCase()&&(this.select=e=c.element),e&&a.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in c)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),c=a.extend({},{populateResults:function(d,e,f){var g,h=this.opts.id,i=this.liveRegion;(g=function(d,e,k){var l,m,n,o,p,q,r,s,t,u;d=c.sortResults(d,e,f);var v=[];for(l=0,m=d.length;m>l;l+=1)n=d[l],p=n.disabled===!0,o=!p&&h(n)!==b,q=n.children&&n.children.length>0,r=a("<li></li>"),r.addClass("select2-results-dept-"+k),r.addClass("select2-result"),r.addClass(o?"select2-result-selectable":"select2-result-unselectable"),p&&r.addClass("select2-disabled"),q&&r.addClass("select2-result-with-children"),r.addClass(j.opts.formatResultCssClass(n)),r.attr("role","presentation"),s=a(document.createElement("div")),s.addClass("select2-result-label"),s.attr("id","select2-result-label-"+I()),s.attr("role","option"),u=c.formatResult(n,s,f,j.opts.escapeMarkup),u!==b&&(s.html(u),r.append(s)),q&&(t=a("<ul></ul>"),t.addClass("select2-result-sub"),g(n.children,t,k+1),r.append(t)),r.data("select2-data",n),v.push(r[0]);e.append(v),i.text(c.formatMatches(d.length))})(e,d,0)}},a.fn.select2.defaults,c),"function"!=typeof c.id&&(f=c.id,c.id=function(a){return a[f]}),a.isArray(c.element.data("select2Tags"))){if("tags"in c)throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+c.element.attr("id");c.tags=c.element.data("select2Tags")}if(e?(c.query=this.bind(function(a){var c,e,f,g={results:[],more:!1},h=a.term;f=function(b,c){var d;b.is("option")?a.matcher(h,b.text(),b)&&c.push(j.optionToData(b)):b.is("optgroup")&&(d=j.optionToData(b),b.children().each2(function(a,b){f(b,d.children)}),d.children.length>0&&c.push(d))},c=d.children(),this.getPlaceholder()!==b&&c.length>0&&(e=this.getPlaceholderOption(),e&&(c=c.not(e))),c.each2(function(a,b){f(b,g.results)}),a.callback(g)}),c.id=function(a){return a.id}):"query"in c||("ajax"in c?(i=c.element.data("ajax-url"),i&&i.length>0&&(c.ajax.url=i),c.query=v.call(c.element,c.ajax)):"data"in c?c.query=w(c.data):"tags"in c&&(c.query=x(c.tags),c.createSearchChoice===b&&(c.createSearchChoice=function(b){return{id:a.trim(b),text:a.trim(b)}}),c.initSelection===b&&(c.initSelection=function(b,d){var e=[];a(h(b.val(),c.separator)).each(function(){var b={id:this,text:this},d=c.tags;a.isFunction(d)&&(d=d()),a(d).each(function(){return g(this.id,b.id)?(b=this,!1):void 0}),e.push(b)}),d(e)}))),"function"!=typeof c.query)throw"query function not defined for Select2 "+c.element.attr("id");if("top"===c.createSearchChoicePosition)c.createSearchChoicePosition=function(a,b){a.unshift(b)};else if("bottom"===c.createSearchChoicePosition)c.createSearchChoicePosition=function(a,b){a.push(b)};else if("function"!=typeof c.createSearchChoicePosition)throw"invalid createSearchChoicePosition option must be 'top', 'bottom' or a custom function";return c},monitorSource:function(){var c,d=this.opts.element,e=this;d.on("change.select2",this.bind(function(a){this.opts.element.data("select2-change-triggered")!==!0&&this.initSelection()})),this._sync=this.bind(function(){var a=d.prop("disabled");a===b&&(a=!1),this.enable(!a);var c=d.prop("readonly");c===b&&(c=!1),this.readonly(c),s(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.addClass(z(this.opts.containerCssClass,this.opts.element)),s(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(z(this.opts.dropdownCssClass,this.opts.element))}),d.length&&d[0].attachEvent&&d.each(function(){this.attachEvent("onpropertychange",e._sync)}),c=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,c!==b&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),this.propertyObserver=new c(function(b){a.each(b,e._sync)}),this.propertyObserver.observe(d.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(b){var c=a.Event("select2-selecting",{val:this.id(b),object:b,choice:b});return this.opts.element.trigger(c),!c.isDefaultPrevented()},triggerChange:function(b){b=b||{},b=a.extend({},b,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(b),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return this.enabledInterface===!0},enableInterface:function(){var a=this._enabled&&!this._readonly,b=!a;return a===this.enabledInterface?!1:(this.container.toggleClass("select2-container-disabled",b),this.close(),this.enabledInterface=a,!0)},enable:function(a){a===b&&(a=!0),this._enabled!==a&&(this._enabled=a,this.opts.element.prop("disabled",!a),this.enableInterface())},disable:function(){this.enable(!1)},readonly:function(a){a===b&&(a=!1),this._readonly!==a&&(this._readonly=a,this.opts.element.prop("readonly",a),this.enableInterface())},opened:function(){return this.container?this.container.hasClass("select2-dropdown-open"):!1},positionDropdown:function(){var b,c,d,e,f,g=this.dropdown,h=this.container.offset(),i=this.container.outerHeight(!1),j=this.container.outerWidth(!1),k=g.outerHeight(!1),l=a(window),m=l.width(),n=l.height(),o=l.scrollLeft()+m,p=l.scrollTop()+n,q=h.top+i,r=h.left,s=p>=q+k,t=h.top-k>=l.scrollTop(),u=g.outerWidth(!1),v=o>=r+u,w=g.hasClass("select2-drop-above");w?(c=!0,!t&&s&&(d=!0,c=!1)):(c=!1,!s&&t&&(d=!0,c=!0)),d&&(g.hide(),h=this.container.offset(),i=this.container.outerHeight(!1),j=this.container.outerWidth(!1),k=g.outerHeight(!1),o=l.scrollLeft()+m,p=l.scrollTop()+n,q=h.top+i,r=h.left,u=g.outerWidth(!1),v=o>=r+u,g.show(),this.focusSearch()),this.opts.dropdownAutoWidth?(f=a(".select2-results",g)[0],g.addClass("select2-drop-auto-width"),g.css("width",""),u=g.outerWidth(!1)+(f.scrollHeight===f.clientHeight?0:L.width),u>j?j=u:u=j,k=g.outerHeight(!1),v=o>=r+u):this.container.removeClass("select2-drop-auto-width"),"static"!==this.body.css("position")&&(b=this.body.offset(),q-=b.top,r-=b.left),v||(r=h.left+this.container.outerWidth(!1)-u),e={left:r,width:j},c?(e.top=h.top-k,e.bottom="auto",this.container.addClass("select2-drop-above"),g.addClass("select2-drop-above")):(e.top=q,e.bottom="auto",this.container.removeClass("select2-drop-above"),g.removeClass("select2-drop-above")),e=a.extend(e,z(this.opts.dropdownCss,this.opts.element)),g.css(e)},shouldOpen:function(){var b;return this.opened()?!1:this._enabled===!1||this._readonly===!0?!1:(b=a.Event("select2-opening"),this.opts.element.trigger(b),!b.isDefaultPrevented())},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return this.shouldOpen()?(this.opening(),K.on("mousemove.select2Event",function(a){M.x=a.pageX,M.y=a.pageY}),!0):!1},opening:function(){var b,d=this.containerEventName,e="scroll."+d,f="resize."+d,g="orientationchange."+d;this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.clearDropdownAlignmentPreference(),this.dropdown[0]!==this.body.children().last()[0]&&this.dropdown.detach().appendTo(this.body),b=a("#select2-drop-mask"),0==b.length&&(b=a(document.createElement("div")),b.attr("id","select2-drop-mask").attr("class","select2-drop-mask"),b.hide(),b.appendTo(this.body),b.on("mousedown touchstart click",function(d){c(b);var e,f=a("#select2-drop");f.length>0&&(e=f.data("select2"),e.opts.selectOnBlur&&e.selectHighlighted({noFocus:!0}),e.close(),d.preventDefault(),d.stopPropagation())})),this.dropdown.prev()[0]!==b[0]&&this.dropdown.before(b),a("#select2-drop").removeAttr("id"),this.dropdown.attr("id","select2-drop"),b.show(),this.positionDropdown(),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("select2-drop-active");var h=this;this.container.parents().add(window).each(function(){a(this).on(f+" "+e+" "+g,function(a){h.opened()&&h.positionDropdown()})})},close:function(){if(this.opened()){var b=this.containerEventName,c="scroll."+b,d="resize."+b,e="orientationchange."+b;this.container.parents().add(window).each(function(){a(this).off(c).off(d).off(e)}),this.clearDropdownAlignmentPreference(),a("#select2-drop-mask").hide(),this.dropdown.removeAttr("id"),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active"),this.results.empty(),K.off("mousemove.select2Event"),this.clearSearch(),this.search.removeClass("select2-active"),this.opts.element.trigger(a.Event("select2-close"))}},externalSearch:function(a){this.open(),this.search.val(a),this.updateResults(!1)},clearSearch:function(){},getMaximumSelectionSize:function(){return z(this.opts.maximumSelectionSize,this.opts.element)},ensureHighlightVisible:function(){var b,c,d,e,f,g,h,i,j=this.results;if(c=this.highlight(),!(0>c)){if(0==c)return void j.scrollTop(0);b=this.findHighlightableChoices().find(".select2-result-label"),d=a(b[c]),i=(d.offset()||{}).top||0,e=i+d.outerHeight(!0),c===b.length-1&&(h=j.find("li.select2-more-results"),h.length>0&&(e=h.offset().top+h.outerHeight(!0))),f=j.offset().top+j.outerHeight(!0),e>f&&j.scrollTop(j.scrollTop()+(e-f)),g=i-j.offset().top,0>g&&"none"!=d.css("display")&&j.scrollTop(j.scrollTop()+g)}},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-disabled):not(.select2-selected)")},moveHighlight:function(b){for(var c=this.findHighlightableChoices(),d=this.highlight();d>-1&&d<c.length;){d+=b;var e=a(c[d]);if(e.hasClass("select2-result-selectable")&&!e.hasClass("select2-disabled")&&!e.hasClass("select2-selected")){this.highlight(d);break}}},highlight:function(b){var c,d,f=this.findHighlightableChoices();return 0===arguments.length?e(f.filter(".select2-highlighted")[0],f.get()):(b>=f.length&&(b=f.length-1),0>b&&(b=0),this.removeHighlight(),c=a(f[b]),c.addClass("select2-highlighted"),this.search.attr("aria-activedescendant",c.find(".select2-result-label").attr("id")),this.ensureHighlightVisible(),this.liveRegion.text(c.text()),d=c.data("select2-data"),void(d&&this.opts.element.trigger({type:"select2-highlight",val:this.id(d),choice:d})))},removeHighlight:function(){this.results.find(".select2-highlighted").removeClass("select2-highlighted")},touchMoved:function(){this._touchMoved=!0},clearTouchMoved:function(){this._touchMoved=!1},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(b){var c=a(b.target).closest(".select2-result-selectable");if(c.length>0&&!c.is(".select2-highlighted")){var d=this.findHighlightableChoices();this.highlight(d.index(c))}else 0==c.length&&this.removeHighlight()},loadMoreIfNeeded:function(){var a,b=this.results,c=b.find("li.select2-more-results"),d=this.resultsPage+1,e=this,f=this.search.val(),g=this.context;0!==c.length&&(a=c.offset().top-b.offset().top-b.height(),a<=this.opts.loadMorePadding&&(c.addClass("select2-active"),this.opts.query({element:this.opts.element,term:f,page:d,context:g,matcher:this.opts.matcher,callback:this.bind(function(a){e.opened()&&(e.opts.populateResults.call(this,b,a.results,{term:f,page:d,context:g}),e.postprocessResults(a,!1,!1),a.more===!0?(c.detach().appendTo(b).text(z(e.opts.formatLoadMore,e.opts.element,d+1)),window.setTimeout(function(){e.loadMoreIfNeeded()},10)):c.remove(),e.positionDropdown(),e.resultsPage=d,e.context=a.context,this.opts.element.trigger({type:"select2-loaded",items:a}))})})))},tokenize:function(){},updateResults:function(c){function d(){j.removeClass("select2-active"),m.positionDropdown(),k.find(".select2-no-results,.select2-selection-limit,.select2-searching").length?m.liveRegion.text(k.text()):m.liveRegion.text(m.opts.formatMatches(k.find(".select2-result-selectable").length))}function e(a){k.html(a),d()}var f,h,i,j=this.search,k=this.results,l=this.opts,m=this,n=j.val(),o=a.data(this.container,"select2-last-term");if((c===!0||!o||!g(n,o))&&(a.data(this.container,"select2-last-term",n),c===!0||this.showSearchInput!==!1&&this.opened())){i=++this.queryCount;var p=this.getMaximumSelectionSize();if(p>=1&&(f=this.data(),a.isArray(f)&&f.length>=p&&y(l.formatSelectionTooBig,"formatSelectionTooBig")))return void e("<li class='select2-selection-limit'>"+z(l.formatSelectionTooBig,l.element,p)+"</li>");if(j.val().length<l.minimumInputLength)return e(y(l.formatInputTooShort,"formatInputTooShort")?"<li class='select2-no-results'>"+z(l.formatInputTooShort,l.element,j.val(),l.minimumInputLength)+"</li>":""),void(c&&this.showSearch&&this.showSearch(!0));if(l.maximumInputLength&&j.val().length>l.maximumInputLength)return void e(y(l.formatInputTooLong,"formatInputTooLong")?"<li class='select2-no-results'>"+z(l.formatInputTooLong,l.element,j.val(),l.maximumInputLength)+"</li>":"");l.formatSearching&&0===this.findHighlightableChoices().length&&e("<li class='select2-searching'>"+z(l.formatSearching,l.element)+"</li>"),j.addClass("select2-active"),this.removeHighlight(),h=this.tokenize(),h!=b&&null!=h&&j.val(h),this.resultsPage=1,l.query({element:l.element,term:j.val(),page:this.resultsPage,context:null,matcher:l.matcher,callback:this.bind(function(f){var h;if(i==this.queryCount){if(!this.opened())return void this.search.removeClass("select2-active");if(f.hasError!==b&&y(l.formatAjaxError,"formatAjaxError"))return void e("<li class='select2-ajax-error'>"+z(l.formatAjaxError,l.element,f.jqXHR,f.textStatus,f.errorThrown)+"</li>");if(this.context=f.context===b?null:f.context,this.opts.createSearchChoice&&""!==j.val()&&(h=this.opts.createSearchChoice.call(m,j.val(),f.results),h!==b&&null!==h&&m.id(h)!==b&&null!==m.id(h)&&0===a(f.results).filter(function(){return g(m.id(this),m.id(h))}).length&&this.opts.createSearchChoicePosition(f.results,h)),0===f.results.length&&y(l.formatNoMatches,"formatNoMatches"))return void e("<li class='select2-no-results'>"+z(l.formatNoMatches,l.element,j.val())+"</li>");k.empty(),m.opts.populateResults.call(this,k,f.results,{term:j.val(),page:this.resultsPage,context:null}),f.more===!0&&y(l.formatLoadMore,"formatLoadMore")&&(k.append("<li class='select2-more-results'>"+l.escapeMarkup(z(l.formatLoadMore,l.element,this.resultsPage))+"</li>"),window.setTimeout(function(){m.loadMoreIfNeeded()},10)),this.postprocessResults(f,c),d(),this.opts.element.trigger({type:"select2-loaded",items:f})}})})}},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0}),this.close(),this.container.removeClass("select2-container-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){n(this.search)},selectHighlighted:function(a){if(this._touchMoved)return void this.clearTouchMoved();var b=this.highlight(),c=this.results.find(".select2-highlighted"),d=c.closest(".select2-result").data("select2-data");d?(this.highlight(b),this.onSelect(d,a)):a&&a.noFocus&&this.close()},getPlaceholder:function(){var a;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||((a=this.getPlaceholderOption())!==b?a.text():b)},getPlaceholderOption:function(){if(this.select){var c=this.select.children("option").first();if(this.opts.placeholderOption!==b)return"first"===this.opts.placeholderOption&&c||"function"==typeof this.opts.placeholderOption&&this.opts.placeholderOption(this.select);if(""===a.trim(c.text())&&""===c.val())return c}},initContainerWidth:function(){function c(){var c,d,e,f,g,h;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px";if("copy"===this.opts.width||"resolve"===this.opts.width){if(c=this.opts.element.attr("style"),c!==b)for(d=c.split(";"),f=0,g=d.length;g>f;f+=1)if(h=d[f].replace(/\s/g,""),e=h.match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i),null!==e&&e.length>=1)return e[1];return"resolve"===this.opts.width?(c=this.opts.element.css("width"),c.indexOf("%")>0?c:0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px"):null}return a.isFunction(this.opts.width)?this.opts.width():this.opts.width}var d=c.call(this);null!==d&&this.container.css("width",d)}}),G=D(F,{createContainer:function(){var b=a(document.createElement("div")).attr({"class":"select2-container"}).html(["<a href='javascript:void(0)' class='select2-choice' tabindex='-1'>","   <span class='select2-chosen'>&#160;</span><abbr class='select2-search-choice-close'></abbr>","   <span class='select2-arrow' role='presentation'><b role='presentation'></b></span>","</a>","<label for='' class='select2-offscreen'></label>","<input class='select2-focusser select2-offscreen' type='text' aria-haspopup='true' role='button' />","<div class='select2-drop select2-display-none'>","   <div class='select2-search'>","       <label for='' class='select2-offscreen'></label>","       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input' role='combobox' aria-expanded='true'","       aria-autocomplete='list' />","   </div>","   <ul class='select2-results' role='listbox'>","   </ul>","</div>"].join(""));return b},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop("disabled",!this.isInterfaceEnabled())},opening:function(){var c,d,e;this.opts.minimumResultsForSearch>=0&&this.showSearch(!0),this.parent.opening.apply(this,arguments),this.showSearchInput!==!1&&this.search.val(this.focusser.val()),this.opts.shouldFocusInput(this)&&(this.search.focus(),c=this.search.get(0),c.createTextRange?(d=c.createTextRange(),d.collapse(!1),d.select()):c.setSelectionRange&&(e=this.search.val().length,
c.setSelectionRange(e,e))),""===this.search.val()&&this.nextSearchTerm!=b&&(this.search.val(this.nextSearchTerm),this.search.select()),this.focusser.prop("disabled",!0).val(""),this.updateResults(!0),this.opts.element.trigger(a.Event("select2-open"))},close:function(){this.opened()&&(this.parent.close.apply(this,arguments),this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus())},focus:function(){this.opened()?this.close():(this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus())},isFocused:function(){return this.container.hasClass("select2-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments),this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus()},destroy:function(){a("label[for='"+this.focusser.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments),C.call(this,"selection","focusser")},initContainer:function(){var b,d,e=this.container,f=this.dropdown,g=I();this.opts.minimumResultsForSearch<0?this.showSearch(!1):this.showSearch(!0),this.selection=b=e.find(".select2-choice"),this.focusser=e.find(".select2-focusser"),b.find(".select2-chosen").attr("id","select2-chosen-"+g),this.focusser.attr("aria-labelledby","select2-chosen-"+g),this.results.attr("id","select2-results-"+g),this.search.attr("aria-owns","select2-results-"+g),this.focusser.attr("id","s2id_autogen"+g),d=a("label[for='"+this.opts.element.attr("id")+"']"),this.focusser.prev().text(d.text()).attr("for",this.focusser.attr("id"));var h=this.opts.element.attr("title");this.opts.element.attr("title",h||d.text()),this.focusser.attr("tabindex",this.elementTabIndex),this.search.attr("id",this.focusser.attr("id")+"_search"),this.search.prev().text(a("label[for='"+this.focusser.attr("id")+"']").text()).attr("for",this.search.attr("id")),this.search.on("keydown",this.bind(function(a){if(this.isInterfaceEnabled()&&229!=a.keyCode){if(a.which===E.PAGE_UP||a.which===E.PAGE_DOWN)return void p(a);switch(a.which){case E.UP:case E.DOWN:return this.moveHighlight(a.which===E.UP?-1:1),void p(a);case E.ENTER:return this.selectHighlighted(),void p(a);case E.TAB:return void this.selectHighlighted({noFocus:!0});case E.ESC:return this.cancel(a),void p(a)}}})),this.search.on("blur",this.bind(function(a){document.activeElement===this.body.get(0)&&window.setTimeout(this.bind(function(){this.opened()&&this.search.focus()}),0)})),this.focusser.on("keydown",this.bind(function(a){if(this.isInterfaceEnabled()&&a.which!==E.TAB&&!E.isControl(a)&&!E.isFunctionKey(a)&&a.which!==E.ESC){if(this.opts.openOnEnter===!1&&a.which===E.ENTER)return void p(a);if(a.which==E.DOWN||a.which==E.UP||a.which==E.ENTER&&this.opts.openOnEnter){if(a.altKey||a.ctrlKey||a.shiftKey||a.metaKey)return;return this.open(),void p(a)}return a.which==E.DELETE||a.which==E.BACKSPACE?(this.opts.allowClear&&this.clear(),void p(a)):void 0}})),j(this.focusser),this.focusser.on("keyup-change input",this.bind(function(a){if(this.opts.minimumResultsForSearch>=0){if(a.stopPropagation(),this.opened())return;this.open()}})),b.on("mousedown touchstart","abbr",this.bind(function(a){this.isInterfaceEnabled()&&(this.clear(),q(a),this.close(),this.selection.focus())})),b.on("mousedown touchstart",this.bind(function(d){c(b),this.container.hasClass("select2-container-active")||this.opts.element.trigger(a.Event("select2-focus")),this.opened()?this.close():this.isInterfaceEnabled()&&this.open(),p(d)})),f.on("mousedown touchstart",this.bind(function(){this.opts.shouldFocusInput(this)&&this.search.focus()})),b.on("focus",this.bind(function(a){p(a)})),this.focusser.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(a.Event("select2-focus")),this.container.addClass("select2-container-active")})).on("blur",this.bind(function(){this.opened()||(this.container.removeClass("select2-container-active"),this.opts.element.trigger(a.Event("select2-blur")))})),this.search.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(a.Event("select2-focus")),this.container.addClass("select2-container-active")})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.setPlaceholder()},clear:function(b){var c=this.selection.data("select2-data");if(c){var d=a.Event("select2-clearing");if(this.opts.element.trigger(d),d.isDefaultPrevented())return;var e=this.getPlaceholderOption();this.opts.element.val(e?e.val():""),this.selection.find(".select2-chosen").empty(),this.selection.removeData("select2-data"),this.setPlaceholder(),b!==!1&&(this.opts.element.trigger({type:"select2-removed",val:this.id(c),choice:c}),this.triggerChange({removed:c}))}},initSelection:function(){if(this.isPlaceholderOptionSelected())this.updateSelection(null),this.close(),this.setPlaceholder();else{var a=this;this.opts.initSelection.call(null,this.opts.element,function(c){c!==b&&null!==c&&(a.updateSelection(c),a.close(),a.setPlaceholder(),a.nextSearchTerm=a.opts.nextSearchTerm(c,a.search.val()))})}},isPlaceholderOptionSelected:function(){var a;return this.getPlaceholder()===b?!1:(a=this.getPlaceholderOption())!==b&&a.prop("selected")||""===this.opts.element.val()||this.opts.element.val()===b||null===this.opts.element.val()},prepareOpts:function(){var b=this.parent.prepareOpts.apply(this,arguments),c=this;return"select"===b.element.get(0).tagName.toLowerCase()?b.initSelection=function(a,b){var d=a.find("option").filter(function(){return this.selected&&!this.disabled});b(c.optionToData(d))}:"data"in b&&(b.initSelection=b.initSelection||function(c,d){var e=c.val(),f=null;b.query({matcher:function(a,c,d){var h=g(e,b.id(d));return h&&(f=d),h},callback:a.isFunction(d)?function(){d(f)}:a.noop})}),b},getPlaceholder:function(){return this.select&&this.getPlaceholderOption()===b?b:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var a=this.getPlaceholder();if(this.isPlaceholderOptionSelected()&&a!==b){if(this.select&&this.getPlaceholderOption()===b)return;this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(a)),this.selection.addClass("select2-default"),this.container.removeClass("select2-allowclear")}},postprocessResults:function(a,b,c){var d=0,e=this;if(this.findHighlightableChoices().each2(function(a,b){return g(e.id(b.data("select2-data")),e.opts.element.val())?(d=a,!1):void 0}),c!==!1&&(b===!0&&d>=0?this.highlight(d):this.highlight(0)),b===!0){var f=this.opts.minimumResultsForSearch;f>=0&&this.showSearch(A(a.results)>=f)}},showSearch:function(b){this.showSearchInput!==b&&(this.showSearchInput=b,this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!b),this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!b),a(this.dropdown,this.container).toggleClass("select2-with-searchbox",b))},onSelect:function(a,b){if(this.triggerSelect(a)){var c=this.opts.element.val(),d=this.data();this.opts.element.val(this.id(a)),this.updateSelection(a),this.opts.element.trigger({type:"select2-selected",val:this.id(a),choice:a}),this.nextSearchTerm=this.opts.nextSearchTerm(a,this.search.val()),this.close(),b&&b.noFocus||!this.opts.shouldFocusInput(this)||this.focusser.focus(),g(c,this.id(a))||this.triggerChange({added:a,removed:d})}},updateSelection:function(a){var c,d,e=this.selection.find(".select2-chosen");this.selection.data("select2-data",a),e.empty(),null!==a&&(c=this.opts.formatSelection(a,e,this.opts.escapeMarkup)),c!==b&&e.append(c),d=this.opts.formatSelectionCssClass(a,e),d!==b&&e.addClass(d),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==b&&this.container.addClass("select2-allowclear")},val:function(){var a,c=!1,d=null,e=this,f=this.data();if(0===arguments.length)return this.opts.element.val();if(a=arguments[0],arguments.length>1&&(c=arguments[1]),this.select)this.select.val(a).find("option").filter(function(){return this.selected}).each2(function(a,b){return d=e.optionToData(b),!1}),this.updateSelection(d),this.setPlaceholder(),c&&this.triggerChange({added:d,removed:f});else{if(!a&&0!==a)return void this.clear(c);if(this.opts.initSelection===b)throw new Error("cannot call val() if initSelection() is not defined");this.opts.element.val(a),this.opts.initSelection(this.opts.element,function(a){e.opts.element.val(a?e.id(a):""),e.updateSelection(a),e.setPlaceholder(),c&&e.triggerChange({added:a,removed:f})})}},clearSearch:function(){this.search.val(""),this.focusser.val("")},data:function(a){var c,d=!1;return 0===arguments.length?(c=this.selection.data("select2-data"),c==b&&(c=null),c):(arguments.length>1&&(d=arguments[1]),void(a?(c=this.data(),this.opts.element.val(a?this.id(a):""),this.updateSelection(a),d&&this.triggerChange({added:a,removed:c})):this.clear(d)))}}),H=D(F,{createContainer:function(){var b=a(document.createElement("div")).attr({"class":"select2-container select2-container-multi"}).html(["<ul class='select2-choices'>","  <li class='select2-search-field'>","    <label for='' class='select2-offscreen'></label>","    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi select2-display-none'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return b},prepareOpts:function(){var b=this.parent.prepareOpts.apply(this,arguments),c=this;return"select"===b.element.get(0).tagName.toLowerCase()?b.initSelection=function(a,b){var d=[];a.find("option").filter(function(){return this.selected&&!this.disabled}).each2(function(a,b){d.push(c.optionToData(b))}),b(d)}:"data"in b&&(b.initSelection=b.initSelection||function(c,d){var e=h(c.val(),b.separator),f=[];b.query({matcher:function(c,d,h){var i=a.grep(e,function(a){return g(a,b.id(h))}).length;return i&&f.push(h),i},callback:a.isFunction(d)?function(){for(var a=[],c=0;c<e.length;c++)for(var h=e[c],i=0;i<f.length;i++){var j=f[i];if(g(h,b.id(j))){a.push(j),f.splice(i,1);break}}d(a)}:a.noop})}),b},selectChoice:function(a){var b=this.container.find(".select2-search-choice-focus");b.length&&a&&a[0]==b[0]||(b.length&&this.opts.element.trigger("choice-deselected",b),b.removeClass("select2-search-choice-focus"),a&&a.length&&(this.close(),a.addClass("select2-search-choice-focus"),this.opts.element.trigger("choice-selected",a)))},destroy:function(){a("label[for='"+this.search.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments),C.call(this,"searchContainer","selection")},initContainer:function(){var b,c=".select2-choices";this.searchContainer=this.container.find(".select2-search-field"),this.selection=b=this.container.find(c);var d=this;this.selection.on("click",".select2-search-choice:not(.select2-locked)",function(b){d.search[0].focus(),d.selectChoice(a(this))}),this.search.attr("id","s2id_autogen"+I()),this.search.prev().text(a("label[for='"+this.opts.element.attr("id")+"']").text()).attr("for",this.search.attr("id")),this.search.on("input paste",this.bind(function(){this.search.attr("placeholder")&&0==this.search.val().length||this.isInterfaceEnabled()&&(this.opened()||this.open())})),this.search.attr("tabindex",this.elementTabIndex),this.keydowns=0,this.search.on("keydown",this.bind(function(a){if(this.isInterfaceEnabled()){++this.keydowns;var c=b.find(".select2-search-choice-focus"),d=c.prev(".select2-search-choice:not(.select2-locked)"),e=c.next(".select2-search-choice:not(.select2-locked)"),f=o(this.search);if(c.length&&(a.which==E.LEFT||a.which==E.RIGHT||a.which==E.BACKSPACE||a.which==E.DELETE||a.which==E.ENTER)){var g=c;return a.which==E.LEFT&&d.length?g=d:a.which==E.RIGHT?g=e.length?e:null:a.which===E.BACKSPACE?this.unselect(c.first())&&(this.search.width(10),g=d.length?d:e):a.which==E.DELETE?this.unselect(c.first())&&(this.search.width(10),g=e.length?e:null):a.which==E.ENTER&&(g=null),this.selectChoice(g),p(a),void(g&&g.length||this.open())}if((a.which===E.BACKSPACE&&1==this.keydowns||a.which==E.LEFT)&&0==f.offset&&!f.length)return this.selectChoice(b.find(".select2-search-choice:not(.select2-locked)").last()),void p(a);if(this.selectChoice(null),this.opened())switch(a.which){case E.UP:case E.DOWN:return this.moveHighlight(a.which===E.UP?-1:1),void p(a);case E.ENTER:return this.selectHighlighted(),void p(a);case E.TAB:return this.selectHighlighted({noFocus:!0}),void this.close();case E.ESC:return this.cancel(a),void p(a)}if(a.which!==E.TAB&&!E.isControl(a)&&!E.isFunctionKey(a)&&a.which!==E.BACKSPACE&&a.which!==E.ESC){if(a.which===E.ENTER){if(this.opts.openOnEnter===!1)return;if(a.altKey||a.ctrlKey||a.shiftKey||a.metaKey)return}this.open(),(a.which===E.PAGE_UP||a.which===E.PAGE_DOWN)&&p(a),a.which===E.ENTER&&p(a)}}})),this.search.on("keyup",this.bind(function(a){this.keydowns=0,this.resizeSearch()})),this.search.on("blur",this.bind(function(b){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.selectChoice(null),this.opened()||this.clearSearch(),b.stopImmediatePropagation(),this.opts.element.trigger(a.Event("select2-blur"))})),this.container.on("click",c,this.bind(function(b){this.isInterfaceEnabled()&&(a(b.target).closest(".select2-search-choice").length>0||(this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass("select2-container-active")||this.opts.element.trigger(a.Event("select2-focus")),this.open(),this.focusSearch(),b.preventDefault()))})),this.container.on("focus",c,this.bind(function(){this.isInterfaceEnabled()&&(this.container.hasClass("select2-container-active")||this.opts.element.trigger(a.Event("select2-focus")),this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.search.prop("disabled",!this.isInterfaceEnabled())},initSelection:function(){if(""===this.opts.element.val()&&""===this.opts.element.text()&&(this.updateSelection([]),this.close(),this.clearSearch()),this.select||""!==this.opts.element.val()){var a=this;this.opts.initSelection.call(null,this.opts.element,function(c){c!==b&&null!==c&&(a.updateSelection(c),a.close(),a.clearSearch())})}},clearSearch:function(){var a=this.getPlaceholder(),c=this.getMaxSearchWidth();a!==b&&0===this.getVal().length&&this.search.hasClass("select2-focused")===!1?(this.search.val(a).addClass("select2-default"),this.search.width(c>0?c:this.container.css("width"))):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},opening:function(){this.clearPlaceholder(),this.resizeSearch(),this.parent.opening.apply(this,arguments),this.focusSearch(),""===this.search.val()&&this.nextSearchTerm!=b&&(this.search.val(this.nextSearchTerm),this.search.select()),this.updateResults(!0),this.opts.shouldFocusInput(this)&&this.search.focus(),this.opts.element.trigger(a.Event("select2-open"))},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(b){var c=[],d=[],f=this;a(b).each(function(){e(f.id(this),c)<0&&(c.push(f.id(this)),d.push(this))}),b=d,this.selection.find(".select2-search-choice").remove(),a(b).each(function(){f.addSelectedChoice(this)}),f.postprocessResults()},tokenize:function(){var a=this.search.val();a=this.opts.tokenizer.call(this,a,this.data(),this.bind(this.onSelect),this.opts),null!=a&&a!=b&&(this.search.val(a),a.length>0&&this.open())},onSelect:function(a,c){this.triggerSelect(a)&&""!==a.text&&(this.addSelectedChoice(a),this.opts.element.trigger({type:"selected",val:this.id(a),choice:a}),this.nextSearchTerm=this.opts.nextSearchTerm(a,this.search.val()),this.clearSearch(),this.updateResults(),(this.select||!this.opts.closeOnSelect)&&this.postprocessResults(a,!1,this.opts.closeOnSelect===!0),this.opts.closeOnSelect?(this.close(),this.search.width(10)):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()?this.updateResults(!0):this.nextSearchTerm!=b&&(this.search.val(this.nextSearchTerm),this.updateResults(),this.search.select()),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:a}),c&&c.noFocus||this.focusSearch())},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(c){var d,e,f=!c.locked,g=a("<li class='select2-search-choice'>    <div></div>    <a href='#' class='select2-search-choice-close' tabindex='-1'></a></li>"),h=a("<li class='select2-search-choice select2-locked'><div></div></li>"),i=f?g:h,j=this.id(c),k=this.getVal();d=this.opts.formatSelection(c,i.find("div"),this.opts.escapeMarkup),d!=b&&i.find("div").replaceWith("<div>"+d+"</div>"),e=this.opts.formatSelectionCssClass(c,i.find("div")),e!=b&&i.addClass(e),f&&i.find(".select2-search-choice-close").on("mousedown",p).on("click dblclick",this.bind(function(b){this.isInterfaceEnabled()&&(this.unselect(a(b.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),p(b),this.close(),this.focusSearch())})).on("focus",this.bind(function(){this.isInterfaceEnabled()&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))})),i.data("select2-data",c),i.insertBefore(this.searchContainer),k.push(j),this.setVal(k)},unselect:function(b){var c,d,f=this.getVal();if(b=b.closest(".select2-search-choice"),0===b.length)throw"Invalid argument: "+b+". Must be .select2-search-choice";if(c=b.data("select2-data")){var g=a.Event("select2-removing");if(g.val=this.id(c),g.choice=c,this.opts.element.trigger(g),g.isDefaultPrevented())return!1;for(;(d=e(this.id(c),f))>=0;)f.splice(d,1),this.setVal(f),this.select&&this.postprocessResults();return b.remove(),this.opts.element.trigger({type:"select2-removed",val:this.id(c),choice:c}),this.triggerChange({removed:c}),!0}},postprocessResults:function(a,b,c){var d=this.getVal(),f=this.results.find(".select2-result"),g=this.results.find(".select2-result-with-children"),h=this;f.each2(function(a,b){var c=h.id(b.data("select2-data"));e(c,d)>=0&&(b.addClass("select2-selected"),b.find(".select2-result-selectable").addClass("select2-selected"))}),g.each2(function(a,b){b.is(".select2-result-selectable")||0!==b.find(".select2-result-selectable:not(.select2-selected)").length||b.addClass("select2-selected")}),-1==this.highlight()&&c!==!1&&h.highlight(0),!this.opts.createSearchChoice&&!f.filter(".select2-result:not(.select2-selected)").length>0&&(!a||a&&!a.more&&0===this.results.find(".select2-no-results").length)&&y(h.opts.formatNoMatches,"formatNoMatches")&&this.results.append("<li class='select2-no-results'>"+z(h.opts.formatNoMatches,h.opts.element,h.search.val())+"</li>")},getMaxSearchWidth:function(){return this.selection.width()-i(this.search)},resizeSearch:function(){var a,b,c,d,e,f=i(this.search);a=r(this.search)+10,b=this.search.offset().left,c=this.selection.width(),d=this.selection.offset().left,e=c-(b-d)-f,a>e&&(e=c-f),40>e&&(e=c-f),0>=e&&(e=a),this.search.width(Math.floor(e))},getVal:function(){var a;return this.select?(a=this.select.val(),null===a?[]:a):(a=this.opts.element.val(),h(a,this.opts.separator))},setVal:function(b){var c;this.select?this.select.val(b):(c=[],a(b).each(function(){e(this,c)<0&&c.push(this)}),this.opts.element.val(0===c.length?"":c.join(this.opts.separator)))},buildChangeDetails:function(a,b){for(var b=b.slice(0),a=a.slice(0),c=0;c<b.length;c++)for(var d=0;d<a.length;d++)g(this.opts.id(b[c]),this.opts.id(a[d]))&&(b.splice(c,1),c>0&&c--,a.splice(d,1),d--);return{added:b,removed:a}},val:function(c,d){var e,f=this;if(0===arguments.length)return this.getVal();if(e=this.data(),e.length||(e=[]),!c&&0!==c)return this.opts.element.val(""),this.updateSelection([]),this.clearSearch(),void(d&&this.triggerChange({added:this.data(),removed:e}));if(this.setVal(c),this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),d&&this.triggerChange(this.buildChangeDetails(e,this.data()));else{if(this.opts.initSelection===b)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(b){var c=a.map(b,f.id);f.setVal(c),f.updateSelection(b),f.clearSearch(),d&&f.triggerChange(f.buildChangeDetails(e,f.data()))})}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var b=[],c=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){b.push(c.opts.id(a(this).data("select2-data")))}),this.setVal(b),this.triggerChange()},data:function(b,c){var d,e,f=this;return 0===arguments.length?this.selection.children(".select2-search-choice").map(function(){return a(this).data("select2-data")}).get():(e=this.data(),b||(b=[]),d=a.map(b,function(a){return f.opts.id(a)}),this.setVal(d),this.updateSelection(b),this.clearSearch(),c&&this.triggerChange(this.buildChangeDetails(e,this.data())),void 0)}}),a.fn.select2=function(){var c,d,f,g,h,i=Array.prototype.slice.call(arguments,0),j=["val","destroy","opened","open","close","focus","isFocused","container","dropdown","onSortStart","onSortEnd","enable","disable","readonly","positionDropdown","data","search"],k=["opened","isFocused","container","dropdown"],l=["val","data"],m={search:"externalSearch"};return this.each(function(){if(0===i.length||"object"==typeof i[0])c=0===i.length?{}:a.extend({},i[0]),c.element=a(this),"select"===c.element.get(0).tagName.toLowerCase()?h=c.element.prop("multiple"):(h=c.multiple||!1,"tags"in c&&(c.multiple=h=!0)),d=h?new window.Select2["class"].multi:new window.Select2["class"].single,d.init(c);else{if("string"!=typeof i[0])throw"Invalid arguments to select2 plugin: "+i;if(e(i[0],j)<0)throw"Unknown method: "+i[0];if(g=b,d=a(this).data("select2"),d===b)return;if(f=i[0],"container"===f?g=d.container:"dropdown"===f?g=d.dropdown:(m[f]&&(f=m[f]),g=d[f].apply(d,i.slice(1))),e(i[0],k)>=0||e(i[0],l)>=0&&1==i.length)return!1}}),g===b?this:g},a.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(a,b,c,d){var e=[];return t(a.text,c.term,e,d),e.join("")},formatSelection:function(a,c,d){return a?d(a.text):b},sortResults:function(a,b,c){return a},formatResultCssClass:function(a){return a.css},formatSelectionCssClass:function(a,c){return b},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(a){return a==b?null:a.id},matcher:function(a,b){return d(""+b).toUpperCase().indexOf(d(""+a).toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:B,escapeMarkup:u,blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(a){return a},adaptDropdownCssClass:function(a){return null},nextSearchTerm:function(a,c){return b},searchInputPlaceholder:"",createSearchChoicePosition:"top",shouldFocusInput:function(a){var b="ontouchstart"in window||navigator.msMaxTouchPoints>0;return b&&a.opts.minimumResultsForSearch<0?!1:!0}},a.fn.select2.locales=[],a.fn.select2.locales.en={formatMatches:function(a){return 1===a?"One result is available, press enter to select it.":a+" results are available, use up and down arrow keys to navigate."},formatNoMatches:function(){return"No matches found"},formatAjaxError:function(a,b,c){return"Loading failed"},formatInputTooShort:function(a,b){var c=b-a.length;return"Please enter "+c+" or more character"+(1==c?"":"s")},formatInputTooLong:function(a,b){var c=a.length-b;return"Please delete "+c+" character"+(1==c?"":"s")},formatSelectionTooBig:function(a){return"You can only select "+a+" item"+(1==a?"":"s")},formatLoadMore:function(a){return"Loading more results"},formatSearching:function(){return"Searching"}},a.extend(a.fn.select2.defaults,a.fn.select2.locales.en),a.fn.select2.ajaxDefaults={transport:a.ajax,params:{type:"GET",cache:!1,dataType:"json"}},window.Select2={query:{ajax:v,local:w,tags:x},util:{debounce:l,markMatch:t,escapeMarkup:u,stripDiacritics:d},"class":{"abstract":F,single:G,multi:H}}}}(jQuery)}.apply(a,arguments)})}(this),function(a){define("jquery.event.drag",["jquery"],function(){return function(){!function(a){a.fn.drag=function(b,c,d){var e="string"==typeof b?b:"",f=a.isFunction(b)?b:a.isFunction(c)?c:null;return 0!==e.indexOf("drag")&&(e="drag"+e),d=(b==f?c:d)||{},f?this.bind(e,d,f):this.trigger(e)};var b=a.event,c=b.special,d=c.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(b){var c=a.data(this,d.datakey),e=b.data||{};c.related+=1,a.each(d.defaults,function(a,b){void 0!==e[a]&&(c[a]=e[a])})},remove:function(){a.data(this,d.datakey).related-=1},setup:function(){if(!a.data(this,d.datakey)){var c=a.extend({related:0},d.defaults);a.data(this,d.datakey,c),b.add(this,"touchstart mousedown",d.init,c),this.attachEvent&&this.attachEvent("ondragstart",d.dontstart)}},teardown:function(){var c=a.data(this,d.datakey)||{};c.related||(a.removeData(this,d.datakey),b.remove(this,"touchstart mousedown",d.init),d.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",d.dontstart))},init:function(e){if(!d.touched){var f,g=e.data;if(!(0!=e.which&&g.which>0&&e.which!=g.which)&&!a(e.target).is(g.not)&&(!g.handle||a(e.target).closest(g.handle,e.currentTarget).length)&&(d.touched="touchstart"==e.type?this:null,g.propagates=1,g.mousedown=this,g.interactions=[d.interaction(this,g)],g.target=e.target,g.pageX=e.pageX,g.pageY=e.pageY,g.dragging=null,f=d.hijack(e,"draginit",g),g.propagates))return f=d.flatten(f),f&&f.length&&(g.interactions=[],a.each(f,function(){g.interactions.push(d.interaction(this,g))})),g.propagates=g.interactions.length,g.drop!==!1&&c.drop&&c.drop.handler(e,g),d.textselect(!1),d.touched?b.add(d.touched,"touchmove touchend",d.handler,g):b.add(document,"mousemove mouseup",d.handler,g),!d.touched||g.live?!1:void 0}},interaction:function(b,c){var e=a(b)[c.relative?"position":"offset"]()||{top:0,left:0};return{drag:b,callback:new d.callback,droppable:[],offset:e}},handler:function(e){var f=e.data;switch(e.type){case!f.dragging&&"touchmove":e.preventDefault();case!f.dragging&&"mousemove":if(Math.pow(e.pageX-f.pageX,2)+Math.pow(e.pageY-f.pageY,2)<Math.pow(f.distance,2))break;e.target=f.target,d.hijack(e,"dragstart",f),f.propagates&&(f.dragging=!0);case"touchmove":e.preventDefault();case"mousemove":if(f.dragging){if(d.hijack(e,"drag",f),f.propagates){f.drop!==!1&&c.drop&&c.drop.handler(e,f);break}e.type="mouseup"}case"touchend":case"mouseup":default:d.touched?b.remove(d.touched,"touchmove touchend",d.handler):b.remove(document,"mousemove mouseup",d.handler),f.dragging&&(f.drop!==!1&&c.drop&&c.drop.handler(e,f),d.hijack(e,"dragend",f)),d.textselect(!0),f.click===!1&&f.dragging&&a.data(f.mousedown,"suppress.click",(new Date).getTime()+5),f.dragging=d.touched=!1}},hijack:function(c,e,f,g,h){if(f){var i,j,k,l={event:c.originalEvent,type:c.type},m=e.indexOf("drop")?"drag":"drop",n=g||0,o=isNaN(g)?f.interactions.length:g;c.type=e,c.originalEvent=null,f.results=[];do if(j=f.interactions[n]){if("dragend"!==e&&j.cancelled)continue;k=d.properties(c,f,j),j.results=[],a(h||j[m]||f.droppable).each(function(g,h){return k.target=h,c.isPropagationStopped=function(){return!1},i=h?b.dispatch.call(h,c,k):null,i===!1?("drag"==m&&(j.cancelled=!0,f.propagates-=1),"drop"==e&&(j[m][g]=null)):"dropinit"==e&&j.droppable.push(d.element(i)||h),"dragstart"==e&&(j.proxy=a(d.element(i)||j.drag)[0]),j.results.push(i),delete c.result,"dropinit"!==e?i:void 0}),f.results[n]=d.flatten(j.results),"dropinit"==e&&(j.droppable=d.flatten(j.droppable)),"dragstart"!=e||j.cancelled||k.update()}while(++n<o);return c.type=l.type,c.originalEvent=l.event,d.flatten(f.results)}},properties:function(a,b,c){var e=c.callback;return e.drag=c.drag,e.proxy=c.proxy||c.drag,e.startX=b.pageX,e.startY=b.pageY,e.deltaX=a.pageX-b.pageX,e.deltaY=a.pageY-b.pageY,e.originalX=c.offset.left,e.originalY=c.offset.top,e.offsetX=e.originalX+e.deltaX,e.offsetY=e.originalY+e.deltaY,e.drop=d.flatten((c.drop||[]).slice()),e.available=d.flatten((c.droppable||[]).slice()),e},element:function(a){return a&&(a.jquery||1==a.nodeType)?a:void 0},flatten:function(b){return a.map(b,function(b){return b&&b.jquery?a.makeArray(b):b&&b.length?d.flatten(b):b})},textselect:function(b){a(document)[b?"unbind":"bind"]("selectstart",d.dontstart).css("MozUserSelect",b?"":"none"),document.unselectable=b?"off":"on"},dontstart:function(){return!1},callback:function(){}};d.callback.prototype={update:function(){c.drop&&this.available.length&&a.each(this.available,function(a){c.drop.locate(this,a)})}};var e=b.dispatch;b.dispatch=function(b){return a.data(this,"suppress."+b.type)-(new Date).getTime()>0?void a.removeData(this,"suppress."+b.type):e.apply(this,arguments)};var f=b.fixHooks.touchstart=b.fixHooks.touchmove=b.fixHooks.touchend=b.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(b,c){if(c){var d=c.touches&&c.touches[0]||c.changedTouches&&c.changedTouches[0]||null;d&&a.each(f.props,function(a,c){b[c]=d[c]})}return b}};c.draginit=c.dragstart=c.dragend=d}(jQuery)}.apply(a,arguments)})}(this),function(a){define("jquery.event.drop",["jquery"],function(){return function(){return function(a){a.fn.drop=function(b,c,d){var e="string"==typeof b?b:"",f=a.isFunction(b)?b:a.isFunction(c)?c:null;return 0!==e.indexOf("drop")&&(e="drop"+e),d=(b==f?c:d)||{},f?this.bind(e,d,f):this.trigger(e)},a.drop=function(b){b=b||{},d.multi=b.multi===!0?1/0:b.multi===!1?1:isNaN(b.multi)?d.multi:b.multi,d.delay=b.delay||d.delay,d.tolerance=a.isFunction(b.tolerance)?b.tolerance:null===b.tolerance?null:d.tolerance,d.mode=b.mode||d.mode||"intersect"};var b=a.event,c=b.special,d=a.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",noBubble:!0,add:function(b){var c=a.data(this,d.datakey);c.related+=1},remove:function(){a.data(this,d.datakey).related-=1},setup:function(){if(!a.data(this,d.datakey)){var b={related:0,active:[],anyactive:0,winner:0,location:{}};a.data(this,d.datakey,b),d.targets.push(this)}},teardown:function(){var b=a.data(this,d.datakey)||{};if(!b.related){a.removeData(this,d.datakey);var c=this;d.targets=a.grep(d.targets,function(a){return a!==c})}},handler:function(b,e){var f;if(e)switch(b.type){case"mousedown":case"touchstart":f=a(d.targets),"string"==typeof e.drop&&(f=f.filter(e.drop)),f.each(function(){var b=a.data(this,d.datakey);b.active=[],b.anyactive=0,b.winner=0}),e.droppable=f,c.drag.hijack(b,"dropinit",e);break;case"mousemove":case"touchmove":d.event=b,d.timer||d.tolerate(e);break;case"mouseup":case"touchend":d.timer=clearTimeout(d.timer),e.propagates&&(c.drag.hijack(b,"drop",e),c.drag.hijack(b,"dropend",e))}},locate:function(b,c){var e=a.data(b,d.datakey),f=a(b),g=f.offset()||{},h=f.outerHeight(),i=f.outerWidth(),j={elem:b,width:i,height:h,top:g.top,left:g.left,right:g.left+i,bottom:g.top+h};return e&&(e.location=j,e.index=c,e.elem=b),j},contains:function(a,b){return(b[0]||b.left)>=a.left&&(b[0]||b.right)<=a.right&&(b[1]||b.top)>=a.top&&(b[1]||b.bottom)<=a.bottom},modes:{intersect:function(a,b,c){return this.contains(c,[a.pageX,a.pageY])?1e9:this.modes.overlap.apply(this,arguments)},overlap:function(a,b,c){return Math.max(0,Math.min(c.bottom,b.bottom)-Math.max(c.top,b.top))*Math.max(0,Math.min(c.right,b.right)-Math.max(c.left,b.left));
},fit:function(a,b,c){return this.contains(c,b)?1:0},middle:function(a,b,c){return this.contains(c,[b.left+.5*b.width,b.top+.5*b.height])?1:0}},sort:function(a,b){return b.winner-a.winner||a.index-b.index},tolerate:function(b){var e,f,g,h,i,j,k,l,m=0,n=b.interactions.length,o=[d.event.pageX,d.event.pageY],p=d.tolerance||d.modes[d.mode];do if(l=b.interactions[m]){if(!l)return;l.drop=[],i=[],j=l.droppable.length,p&&(g=d.locate(l.proxy)),e=0;do if(k=l.droppable[e]){if(h=a.data(k,d.datakey),f=h.location,!f)continue;h.winner=p?p.call(d,d.event,g,f):d.contains(f,o)?1:0,i.push(h)}while(++e<j);i.sort(d.sort),e=0;do(h=i[e])&&(h.winner&&l.drop.length<d.multi?(h.active[m]||h.anyactive||(c.drag.hijack(d.event,"dropstart",b,m,h.elem)[0]!==!1?(h.active[m]=1,h.anyactive+=1):h.winner=0),h.winner&&l.drop.push(h.elem)):h.active[m]&&1==h.anyactive&&(c.drag.hijack(d.event,"dropend",b,m,h.elem),h.active[m]=0,h.anyactive-=1));while(++e<j)}while(++m<n);d.last&&o[0]==d.last.pageX&&o[1]==d.last.pageY?delete d.timer:d.timer=setTimeout(function(){d.tolerate(b)},d.delay),d.last=d.event}};c.dropinit=c.dropstart=c.dropend=d}(jQuery),$.drop}.apply(a,arguments)})}(this),define("mockup-patterns-select2",["jquery","pat-base","select2","jquery.event.drag","jquery.event.drop"],function(a,b){"use strict";var c=b.extend({name:"select2",trigger:".pat-select2",parser:"mockup",defaults:{separator:","},initializeValues:function(){var b=this;b.options.initialValues&&(b.options.id=function(a){return a.id},b.options.initSelection=function(c,d){var e=[],f=c.val(),g=b.options.initialValues;"string"==typeof b.options.initialValues&&""!==b.options.initialValues&&("{"===b.options.initialValues[0]?g=JSON.parse(b.options.initialValues):(g={},a(b.options.initialValues.split(b.options.separator)).each(function(){var b=this.split(":"),c=a.trim(b[0]),d=a.trim(b[1]);g[c]=d}))),a(f.split(b.options.separator)).each(function(){var a=this;g[this]&&(a=g[this]),e.push({id:this,text:a})}),d(e)})},initializeTags:function(){var b=this;b.options.tags&&"string"==typeof b.options.tags&&("["===b.options.tags.substr(0,1)?b.options.tags=JSON.parse(b.options.tags):b.options.tags=b.options.tags.split(b.options.separator)),b.options.tags&&!b.options.allowNewItems&&(b.options.data=a.map(b.options.tags,function(a,b){return{id:a,text:a}}),b.options.multiple=!0,delete b.options.tags)},initializeOrdering:function(){var b=this;if(b.options.orderable){var c=function(a,b){return a?a.text:void 0};b.options.formatSelection&&(c=b.options.formatSelection),b.options.formatSelection=function(d,e){return e.parents("li").drag("start",function(c,d){return a(this).addClass("select2-choice-dragging"),b.$el.select2("onSortStart"),a.drop({tolerance:function(b,c,d){var e=b.pageY>d.top+d.height/2;return a.data(d.elem,"drop+reorder",e?"insertAfter":"insertBefore"),this.contains(d,[b.pageX,b.pageY])}}),a(this).clone().addClass("dragging").css({opacity:.75,position:"absolute"}).appendTo(document.body)}).drag(function(b,c){a(c.proxy).css({top:c.offsetY,left:c.offsetX});var d=c.drop[0],e=a.data(d||{},"drop+reorder");!d||d==c.current&&e==c.method||(a(this)[e](d),c.current=d,c.method=e,c.update())}).drag("end",function(c,d){a(this).removeClass("select2-choice-dragging"),b.$el.select2("onSortEnd"),a(d.proxy).remove()}).drop("init",function(a,b){return this==b.drag?!1:!0}),c(d,e)}}},initializeSelect2:function(){var a=this;a.$el.select2(a.options),a.$select2=a.$el.parent().find(".select2-container"),a.$el.parent().off("close.plone-modal.patterns"),a.options.orderable&&a.$select2.addClass("select2-orderable")},init:function(){var b=this;if(b.options.allowNewItems=b.options.hasOwnProperty("allowNewItems")?JSON.parse(b.options.allowNewItems):!0,b.options.ajax||b.options.vocabularyUrl){b.options.vocabularyUrl&&(b.options.multiple=void 0===b.options.multiple?!0:b.options.multiple,b.options.ajax=b.options.ajax||{},b.options.ajax.url=b.options.vocabularyUrl,b.options.initSelection=function(c,d){var e=[],f=c.val();a(f.split(b.options.separator)).each(function(){e.push({id:this,text:this})}),d(e)});var c="";b.options.ajax=a.extend({quietMillis:300,data:function(a,b){return c=a,{query:a,page_limit:10,page:b}},results:function(d,e){var f=d.results;if(b.options.vocabularyUrl){var g=[];a.each(d.results,function(a,b){g.push(b.id)}),f=[];var h=""===c||a.inArray(c,g)>=0;b.options.allowNewItems&&!h&&f.push({id:c,text:c}),a.each(d.results,function(a,b){f.push(b)})}return{results:f}}},b.options.ajax)}else if(b.options.multiple&&b.$el.is("select")){var d=b.$el.val()||[],e=a.map(b.$el.find("option"),function(b){return{text:a(b).html(),id:b.value}}),f=a('<input type="hidden" />');f.val(d.join(b.options.separator)),f.attr("class",b.$el.attr("class")),f.attr("name",b.$el.attr("name")),f.attr("id",b.$el.attr("id")),b.$orig=b.$el,b.$el.replaceWith(f),b.$el=f,b.options.data=e}b.initializeValues(),b.initializeTags(),b.initializeOrdering(),b.initializeSelect2()}});return c}),function(a){define("jqtree",["jquery"],function(){return function(){(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=[].slice,A={}.hasOwnProperty,B=function(a,b){function c(){this.constructor=a}for(var d in b)A.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};x="0.22.0",a=this.jQuery,r=function(){function b(b,c){this.$el=a(b),this.options=a.extend({},this.defaults,c)}return b.prototype.defaults={},b.prototype.destroy=function(){return this._deinit()},b.prototype._init=function(){return null},b.prototype._deinit=function(){return null},b.register=function(c,d){var e,f,g,h,i;return h=function(){return"simple_widget_"+d},i=function(c,d){var e;return e=a.data(c,d),e&&e instanceof b?e:null},f=function(b,d){var e,f,g,j,k,l;for(e=h(),k=0,l=b.length;l>k;k++)f=b[k],g=i(f,e),g||(j=new c(f,d),a.data(f,e)||a.data(f,e,j),j._init());return b},g=function(b){var c,d,e,f,g,j;for(c=h(),j=[],f=0,g=b.length;g>f;f++)d=b[f],e=i(d,c),e&&e.destroy(),j.push(a.removeData(d,c));return j},e=function(c,d,e){var f,g,i,j,k,l;for(g=null,k=0,l=c.length;l>k;k++)f=c[k],i=a.data(f,h()),i&&i instanceof b&&(j=i[d],j&&"function"==typeof j&&(g=j.apply(i,e)));return g},a.fn[d]=function(){var a,b,c,d,h;return c=arguments[0],b=2<=arguments.length?z.call(arguments,1):[],a=this,void 0===c||"object"==typeof c?(h=c,f(a,h)):"string"==typeof c&&"_"!==c[0]?(d=c,"destroy"===d?g(a):e(a,d,b)):void 0}},b}(),this.SimpleWidget=r,k=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return B(c,b),c.is_mouse_handled=!1,c.prototype._init=function(){return this.$el.bind("mousedown.mousewidget",a.proxy(this._mouseDown,this)),this.$el.bind("touchstart.mousewidget",a.proxy(this._touchStart,this)),this.is_mouse_started=!1,this.mouse_delay=0,this._mouse_delay_timer=null,this._is_mouse_delay_met=!0,this.mouse_down_info=null},c.prototype._deinit=function(){var b;return this.$el.unbind("mousedown.mousewidget"),this.$el.unbind("touchstart.mousewidget"),b=a(document),b.unbind("mousemove.mousewidget"),b.unbind("mouseup.mousewidget")},c.prototype._mouseDown=function(a){var b;if(1===a.which)return b=this._handleMouseDown(a,this._getPositionInfo(a)),b&&a.preventDefault(),b},c.prototype._handleMouseDown=function(a,b){return!c.is_mouse_handled&&(this.is_mouse_started&&this._handleMouseUp(b),this.mouse_down_info=b,this._mouseCapture(b))?(this._handleStartMouse(),this.is_mouse_handled=!0,!0):void 0},c.prototype._handleStartMouse=function(){var b;return b=a(document),b.bind("mousemove.mousewidget",a.proxy(this._mouseMove,this)),b.bind("touchmove.mousewidget",a.proxy(this._touchMove,this)),b.bind("mouseup.mousewidget",a.proxy(this._mouseUp,this)),b.bind("touchend.mousewidget",a.proxy(this._touchEnd,this)),this.mouse_delay?this._startMouseDelayTimer():void 0},c.prototype._startMouseDelayTimer=function(){return this._mouse_delay_timer&&clearTimeout(this._mouse_delay_timer),this._mouse_delay_timer=setTimeout(function(a){return function(){return a._is_mouse_delay_met=!0}}(this),this.mouse_delay),this._is_mouse_delay_met=!1},c.prototype._mouseMove=function(a){return this._handleMouseMove(a,this._getPositionInfo(a))},c.prototype._handleMouseMove=function(a,b){return this.is_mouse_started?(this._mouseDrag(b),a.preventDefault()):this.mouse_delay&&!this._is_mouse_delay_met?!0:(this.is_mouse_started=this._mouseStart(this.mouse_down_info)!==!1,this.is_mouse_started?this._mouseDrag(b):this._handleMouseUp(b),!this.is_mouse_started)},c.prototype._getPositionInfo=function(a){return{page_x:a.pageX,page_y:a.pageY,target:a.target,original_event:a}},c.prototype._mouseUp=function(a){return this._handleMouseUp(this._getPositionInfo(a))},c.prototype._handleMouseUp=function(b){var c;c=a(document),c.unbind("mousemove.mousewidget"),c.unbind("touchmove.mousewidget"),c.unbind("mouseup.mousewidget"),c.unbind("touchend.mousewidget"),this.is_mouse_started&&(this.is_mouse_started=!1,this._mouseStop(b))},c.prototype._mouseCapture=function(a){return!0},c.prototype._mouseStart=function(a){return null},c.prototype._mouseDrag=function(a){return null},c.prototype._mouseStop=function(a){return null},c.prototype.setMouseDelay=function(a){return this.mouse_delay=a},c.prototype._touchStart=function(a){var b;if(!(a.originalEvent.touches.length>1))return b=a.originalEvent.changedTouches[0],this._handleMouseDown(a,this._getPositionInfo(b))},c.prototype._touchMove=function(a){var b;if(!(a.originalEvent.touches.length>1))return b=a.originalEvent.changedTouches[0],this._handleMouseMove(a,this._getPositionInfo(b))},c.prototype._touchEnd=function(a){var b;if(!(a.originalEvent.touches.length>1))return b=a.originalEvent.changedTouches[0],this._handleMouseUp(this._getPositionInfo(b))},c}(r),this.Tree={},a=this.jQuery,n={getName:function(a){return n.strings[a-1]},nameToIndex:function(a){var b,c,d;for(b=c=1,d=n.strings.length;d>=1?d>=c:c>=d;b=d>=1?++c:--c)if(n.strings[b-1]===a)return b;return 0}},n.BEFORE=1,n.AFTER=2,n.INSIDE=3,n.NONE=4,n.strings=["before","after","inside","none"],this.Tree.Position=n,l=function(){function b(a,c,d){null==c&&(c=!1),null==d&&(d=b),this.setData(a),this.children=[],this.parent=null,c&&(this.id_mapping={},this.tree=this,this.node_class=d)}return b.prototype.setData=function(a){var b,c,d;if("object"!=typeof a)return this.name=a;d=[];for(b in a)c=a[b],"label"===b?d.push(this.name=c):d.push(this[b]=c);return d},b.prototype.initFromData=function(a){var b,c;return c=function(a){return function(c){return a.setData(c),c.children?b(c.children):void 0}}(this),b=function(a){return function(b){var c,d,e,f;for(e=0,f=b.length;f>e;e++)c=b[e],d=new a.tree.node_class(""),d.initFromData(c),a.addChild(d);return null}}(this),c(a),null},b.prototype.loadFromData=function(a){var b,c,d,e;for(this.removeChildren(),d=0,e=a.length;e>d;d++)c=a[d],b=new this.tree.node_class(c),this.addChild(b),"object"==typeof c&&c.children&&b.loadFromData(c.children);return null},b.prototype.addChild=function(a){return this.children.push(a),a._setParent(this)},b.prototype.addChildAtPosition=function(a,b){return this.children.splice(b,0,a),a._setParent(this)},b.prototype._setParent=function(a){return this.parent=a,this.tree=a.tree,this.tree.addNodeToIndex(this)},b.prototype.removeChild=function(a){return a.removeChildren(),this._removeChild(a)},b.prototype._removeChild=function(a){return this.children.splice(this.getChildIndex(a),1),this.tree.removeNodeFromIndex(a)},b.prototype.getChildIndex=function(b){return a.inArray(b,this.children)},b.prototype.hasChildren=function(){return 0!==this.children.length},b.prototype.isFolder=function(){return this.hasChildren()||this.load_on_demand},b.prototype.iterate=function(a){var b;return b=function(c){return function(d,e){var f,g,h,i,j;if(d.children){for(j=d.children,h=0,i=j.length;i>h;h++)f=j[h],g=a(f,e),c.hasChildren()&&g&&b(f,e+1);return null}}}(this),b(this,0),null},b.prototype.moveNode=function(a,b,c){return a.isParentOf(b)?void 0:(a.parent._removeChild(a),c===n.AFTER?b.parent.addChildAtPosition(a,b.parent.getChildIndex(b)+1):c===n.BEFORE?b.parent.addChildAtPosition(a,b.parent.getChildIndex(b)):c===n.INSIDE?b.addChildAtPosition(a,0):void 0)},b.prototype.getData=function(){var a;return(a=function(b){return function(b){var c,d,e,f,g,h,i;for(c=[],h=0,i=b.length;i>h;h++){e=b[h],f={};for(d in e)g=e[d],"parent"!==d&&"children"!==d&&"element"!==d&&"tree"!==d&&Object.prototype.hasOwnProperty.call(e,d)&&(f[d]=g);e.hasChildren()&&(f.children=a(e.children)),c.push(f)}return c}}(this))(this.children)},b.prototype.getNodeByName=function(a){var b;return b=null,this.iterate(function(c){return c.name===a?(b=c,!1):!0}),b},b.prototype.addAfter=function(a){var b,c;return this.parent?(c=new this.tree.node_class(a),b=this.parent.getChildIndex(this),this.parent.addChildAtPosition(c,b+1),c):null},b.prototype.addBefore=function(a){var b,c;return this.parent?(c=new this.tree.node_class(a),b=this.parent.getChildIndex(this),this.parent.addChildAtPosition(c,b),c):null},b.prototype.addParent=function(a){var b,c,d,e,f,g;if(this.parent){for(c=new this.tree.node_class(a),c._setParent(this.tree),d=this.parent,g=d.children,e=0,f=g.length;f>e;e++)b=g[e],c.addChild(b);return d.children=[],d.addChild(c),c}return null},b.prototype.remove=function(){return this.parent?(this.parent.removeChild(this),this.parent=null):void 0},b.prototype.append=function(a){var b;return b=new this.tree.node_class(a),this.addChild(b),b},b.prototype.prepend=function(a){var b;return b=new this.tree.node_class(a),this.addChildAtPosition(b,0),b},b.prototype.isParentOf=function(a){var b;for(b=a.parent;b;){if(b===this)return!0;b=b.parent}return!1},b.prototype.getLevel=function(){var a,b;for(a=0,b=this;b.parent;)a+=1,b=b.parent;return a},b.prototype.getNodeById=function(a){return this.id_mapping[a]},b.prototype.addNodeToIndex=function(a){return null!=a.id?this.id_mapping[a.id]=a:void 0},b.prototype.removeNodeFromIndex=function(a){return null!=a.id?delete this.id_mapping[a.id]:void 0},b.prototype.removeChildren=function(){return this.iterate(function(a){return function(b){return a.tree.removeNodeFromIndex(b),!0}}(this)),this.children=[]},b.prototype.getPreviousSibling=function(){var a;return this.parent?(a=this.parent.getChildIndex(this)-1,a>=0?this.parent.children[a]:null):null},b.prototype.getNextSibling=function(){var a;return this.parent?(a=this.parent.getChildIndex(this)+1,a<this.parent.children.length?this.parent.children[a]:null):null},b.prototype.getNodesByProperty=function(a,b){return this.filter(function(c){return c[a]===b})},b.prototype.filter=function(a){var b;return b=[],this.iterate(function(c){return a(c)&&b.push(c),!0}),b},b}(),this.Tree.Node=l,e=function(){function b(a){this.tree_widget=a,this.opened_icon_element=this.createButtonElement(a.options.openedIcon),this.closed_icon_element=this.createButtonElement(a.options.closedIcon)}return b.prototype.render=function(a){return a&&a.parent?this.renderFromNode(a):this.renderFromRoot()},b.prototype.renderNode=function(b){var c,d,e;return a(b.element).remove(),d=new m(b.parent,this.tree_widget),c=this.createLi(b),this.attachNodeData(b,c),e=b.getPreviousSibling(),e?a(e.element).after(c):d.getUl().prepend(c),b.children?this.renderFromNode(b):void 0},b.prototype.renderFromRoot=function(){var a;return a=this.tree_widget.element,a.empty(),this.createDomElements(a[0],this.tree_widget.tree.children,!0,!0)},b.prototype.renderFromNode=function(a){var b;return b=this.tree_widget._getNodeElementForNode(a),b.getUl().remove(),this.createDomElements(b.$element[0],a.children,!1,!1)},b.prototype.createDomElements=function(a,b,c,d){var e,f,g,h,i;for(g=this.createUl(c),a.appendChild(g),h=0,i=b.length;i>h;h++)e=b[h],f=this.createLi(e),g.appendChild(f),this.attachNodeData(e,f),e.hasChildren()&&this.createDomElements(f,e.children,!1,e.is_open);return null},b.prototype.attachNodeData=function(b,c){return b.element=c,a(c).data("node",b)},b.prototype.createUl=function(a){var b,c;return b=a?"jqtree-tree":"",c=document.createElement("ul"),c.className="jqtree_common "+b,c},b.prototype.createLi=function(b){var c;return c=b.isFolder()?this.createFolderLi(b):this.createNodeLi(b),this.tree_widget.options.onCreateLi&&this.tree_widget.options.onCreateLi(b,a(c)),c},b.prototype.createFolderLi=function(a){var b,c,d,e,f,g,h,i;return b=this.getButtonClasses(a),f=this.getFolderClasses(a),e=this.escapeIfNecessary(a.name),g=a.is_open?this.opened_icon_element:this.closed_icon_element,h=document.createElement("li"),h.className="jqtree_common "+f,d=document.createElement("div"),d.className="jqtree-element jqtree_common",h.appendChild(d),c=document.createElement("a"),c.className="jqtree_common "+b,c.appendChild(g.cloneNode()),d.appendChild(c),i=document.createElement("span"),i.className="jqtree_common jqtree-title jqtree-title-folder",d.appendChild(i),i.innerHTML=e,h},b.prototype.createNodeLi=function(a){var b,c,d,e,f,g;return f=["jqtree_common"],this.tree_widget.select_node_handler&&this.tree_widget.select_node_handler.isNodeSelected(a)&&f.push("jqtree-selected"),b=f.join(" "),d=this.escapeIfNecessary(a.name),e=document.createElement("li"),e.className=b,c=document.createElement("div"),c.className="jqtree-element jqtree_common",e.appendChild(c),g=document.createElement("span"),g.className="jqtree-title jqtree_common",g.innerHTML=d,c.appendChild(g),e},b.prototype.getButtonClasses=function(a){var b;return b=["jqtree-toggler"],a.is_open||b.push("jqtree-closed"),b.join(" ")},b.prototype.getFolderClasses=function(a){var b;return b=["jqtree-folder"],a.is_open||b.push("jqtree-closed"),this.tree_widget.select_node_handler&&this.tree_widget.select_node_handler.isNodeSelected(a)&&b.push("jqtree-selected"),b.join(" ")},b.prototype.escapeIfNecessary=function(a){return this.tree_widget.options.autoEscape?u(a):a},b.prototype.createButtonElement=function(b){var c;return"string"==typeof b?(c=document.createElement("div"),c.innerHTML=b,document.createTextNode(c.innerHTML)):a(b)[0]},b}(),i=function(b){function d(){return d.__super__.constructor.apply(this,arguments)}return B(d,b),d.prototype.defaults={autoOpen:!1,saveState:!1,dragAndDrop:!1,selectable:!0,useContextMenu:!0,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,onLoadFailed:null,autoEscape:!0,dataUrl:null,closedIcon:"&#x25ba;",openedIcon:"&#x25bc;",slide:!0,nodeClass:l,dataFilter:null,keyboardSupport:!0,openFolderDelay:500},d.prototype.toggle=function(a,b){return null==b&&(b=null),null===b&&(b=this.options.slide),a.is_open?this.closeNode(a,b):this.openNode(a,b)},d.prototype.getTree=function(){return this.tree},d.prototype.selectNode=function(a){return this._selectNode(a,!1)},d.prototype._selectNode=function(a,b){var c,d,e,f;if(null==b&&(b=!1),this.select_node_handler){if(c=function(b){return function(){return b.options.onCanSelectNode?b.options.selectable&&b.options.onCanSelectNode(a):b.options.selectable}}(this),e=function(b){return function(){var c;return c=a.parent,c&&c.parent&&!c.is_open?b.openNode(c,!1):void 0}}(this),f=function(a){return function(){return a.options.saveState?a.save_state_handler.saveState():void 0}}(this),!a)return this._deselectCurrentNode(),void f();if(c())return this.select_node_handler.isNodeSelected(a)?b&&(this._deselectCurrentNode(),this._triggerEvent("tree.select",{node:null,previous_node:a})):(d=this.getSelectedNode(),this._deselectCurrentNode(),this.addToSelection(a),this._triggerEvent("tree.select",{node:a,deselected_node:d}),e()),f()}},d.prototype.getSelectedNode=function(){return this.select_node_handler.getSelectedNode()},d.prototype.toJson=function(){return JSON.stringify(this.tree.getData())},d.prototype.loadData=function(a,b){return this._loadData(a,b)},d.prototype.loadDataFromUrl=function(b,c,d){return"string"!==a.type(b)&&(d=c,c=b,b=null),this._loadDataFromUrl(b,c,d)},d.prototype.reload=function(){return this.loadDataFromUrl()},d.prototype._loadDataFromUrl=function(b,c,d){var e,g,h,i,j,k;if(e=null,g=function(a){return function(){var b;return c?(b=new f(c,a),e=b.getLi()):e=a.element,e.addClass("jqtree-loading")}}(this),k=function(a){return function(){return e?e.removeClass("jqtree-loading"):void 0}}(this),j=function(c){return function(){return"string"===a.type(b)&&(b={url:b}),b.method?void 0:b.method="get"}}(this),h=function(b){return function(e){return k(),b._loadData(e,c),d&&a.isFunction(d)?d():void 0}}(this),i=function(c){return function(){return j(),a.ajax({url:b.url,data:b.data,type:b.method.toUpperCase(),cache:!1,dataType:"json",success:function(b){var d;return d=a.isArray(b)||"object"==typeof b?b:a.parseJSON(b),c.options.dataFilter&&(d=c.options.dataFilter(d)),h(d)},error:function(a){return k(),c.options.onLoadFailed?c.options.onLoadFailed(a):void 0}})}}(this),b||(b=this._getDataUrlInfo(c)),g(),b){if(!a.isArray(b))return i();h(b)}else k()},d.prototype._loadData=function(a,b){var c,d,e,f;if(a){if(this._triggerEvent("tree.load_data",{tree_data:a}),b){for(d=this.select_node_handler.getSelectedNodesUnder(b),e=0,f=d.length;f>e;e++)c=d[e],this.select_node_handler.removeFromSelection(c);b.loadFromData(a),b.load_on_demand=!1,this._refreshElements(b.parent)}else this._initTree(a);return this.isDragging()?this.dnd_handler.refresh():void 0}},d.prototype.getNodeById=function(a){return this.tree.getNodeById(a)},d.prototype.getNodeByName=function(a){return this.tree.getNodeByName(a)},d.prototype.openNode=function(a,b){return null==b&&(b=null),null===b&&(b=this.options.slide),this._openNode(a,b)},d.prototype._openNode=function(a,b,c){var d,e;if(null==b&&(b=!0),d=function(a){return function(b,c,d){var e;return e=new f(b,a),e.open(d,c)}}(this),a.isFolder()){if(a.load_on_demand)return this._loadFolderOnDemand(a,b,c);for(e=a.parent;e&&!e.is_open;)e.parent&&d(e,!1,null),e=e.parent;return d(a,b,c),this._saveState()}},d.prototype._loadFolderOnDemand=function(a,b,c){return null==b&&(b=!0),this._loadDataFromUrl(null,a,function(d){return function(){return d._openNode(a,b,c)}}(this))},d.prototype.closeNode=function(a,b){return null==b&&(b=null),null===b&&(b=this.options.slide),a.isFolder()?(new f(a,this).close(b),this._saveState()):void 0},d.prototype.isDragging=function(){return this.dnd_handler?this.dnd_handler.is_dragging:!1},d.prototype.refreshHitAreas=function(){return this.dnd_handler.refresh()},d.prototype.addNodeAfter=function(a,b){var c;return c=b.addAfter(a),this._refreshElements(b.parent),c},d.prototype.addNodeBefore=function(a,b){var c;return c=b.addBefore(a),this._refreshElements(b.parent),c},d.prototype.addParentNode=function(a,b){var c;return c=b.addParent(a),this._refreshElements(c.parent),c},d.prototype.removeNode=function(a){var b;return b=a.parent,b?(this.select_node_handler.removeFromSelection(a,!0),a.remove(),this._refreshElements(b.parent)):void 0},d.prototype.appendNode=function(a,b){var c,d;return b||(b=this.tree),c=b.isFolder(),d=b.append(a),c?this._refreshElements(b):this._refreshElements(b.parent),d},d.prototype.prependNode=function(a,b){var c;return b||(b=this.tree),c=b.prepend(a),this._refreshElements(b),c},d.prototype.updateNode=function(a,b){var c;return c=b.id&&b.id!==a.id,c&&this.tree.removeNodeFromIndex(a),a.setData(b),c&&this.tree.addNodeToIndex(a),this.renderer.renderNode(a),this._selectCurrentNode()},d.prototype.moveNode=function(a,b,c){var d;return d=n.nameToIndex(c),this.tree.moveNode(a,b,d),this._refreshElements()},d.prototype.getStateFromStorage=function(){return this.save_state_handler.getStateFromStorage()},d.prototype.addToSelection=function(a){return a?(this.select_node_handler.addToSelection(a),this._getNodeElementForNode(a).select(),this._saveState()):void 0},d.prototype.getSelectedNodes=function(){return this.select_node_handler.getSelectedNodes()},d.prototype.isNodeSelected=function(a){return this.select_node_handler.isNodeSelected(a)},d.prototype.removeFromSelection=function(a){return this.select_node_handler.removeFromSelection(a),this._getNodeElementForNode(a).deselect(),this._saveState()},d.prototype.scrollToNode=function(b){var c,d;return c=a(b.element),d=c.offset().top-this.$el.offset().top,this.scroll_handler.scrollTo(d)},d.prototype.getState=function(){return this.save_state_handler.getState()},d.prototype.setState=function(a){return this.save_state_handler.setState(a),this._refreshElements()},d.prototype.setOption=function(a,b){return this.options[a]=b},d.prototype.getVersion=function(){return x},d.prototype._init=function(){return d.__super__._init.call(this),this.element=this.$el,this.mouse_delay=300,this.is_initialized=!1,this.renderer=new e(this),"undefined"!=typeof o&&null!==o?this.save_state_handler=new o(this):this.options.saveState=!1,"undefined"!=typeof q&&null!==q&&(this.select_node_handler=new q(this)),"undefined"!=typeof c&&null!==c?this.dnd_handler=new c(this):this.options.dragAndDrop=!1,"undefined"!=typeof p&&null!==p&&(this.scroll_handler=new p(this)),"undefined"!=typeof j&&null!==j&&"undefined"!=typeof q&&null!==q&&(this.key_handler=new j(this)),this._initData(),this.element.click(a.proxy(this._click,this)),this.element.dblclick(a.proxy(this._dblclick,this)),this.options.useContextMenu?this.element.bind("contextmenu",a.proxy(this._contextmenu,this)):void 0},d.prototype._deinit=function(){return this.element.empty(),this.element.unbind(),this.key_handler.deinit(),this.tree=null,d.__super__._deinit.call(this)},d.prototype._initData=function(){return this.options.data?this._loadData(this.options.data):this._loadDataFromUrl(this._getDataUrlInfo())},d.prototype._getDataUrlInfo=function(b){var c,d;return c=this.options.dataUrl||this.element.data("url"),d=function(a){return function(){var d,e,f;return f={url:c},b&&b.id?(d={node:b.id},f.data=d):(e=a._getNodeIdToBeSelected(),e&&(d={selected_node:e},f.data=d)),f}}(this),a.isFunction(c)?c(b):"string"===a.type(c)?d():c},d.prototype._getNodeIdToBeSelected=function(){return this.options.saveState?this.save_state_handler.getNodeIdToBeSelected():null},d.prototype._initTree=function(a){return this.tree=new this.options.nodeClass(null,!0,this.options.nodeClass),this.select_node_handler&&this.select_node_handler.clear(),this.tree.loadFromData(a),this._openNodes(),this._refreshElements(),this.is_initialized?void 0:(this.is_initialized=!0,this._triggerEvent("tree.init"))},d.prototype._openNodes=function(){var a;if(!(this.options.saveState&&this.save_state_handler.restoreState()||this.options.autoOpen===!1))return a=this.options.autoOpen===!0?-1:parseInt(this.options.autoOpen),this.tree.iterate(function(b,c){return b.hasChildren()&&(b.is_open=!0),c!==a})},d.prototype._refreshElements=function(a){return null==a&&(a=null),this.renderer.render(a),this._triggerEvent("tree.refresh")},d.prototype._click=function(a){var b,c,d;if(b=this._getClickTarget(a.target)){if("button"===b.type)return this.toggle(b.node,this.options.slide),a.preventDefault(),a.stopPropagation();if("label"===b.type&&(d=b.node,c=this._triggerEvent("tree.click",{node:d,click_event:a}),!c.isDefaultPrevented()))return this._selectNode(d,!0)}},d.prototype._dblclick=function(a){var b;return b=this._getClickTarget(a.target),b&&"label"===b.type?this._triggerEvent("tree.dblclick",{node:b.node,click_event:a}):void 0},d.prototype._getClickTarget=function(b){var c,d,e,f;if(e=a(b),c=e.closest(".jqtree-toggler"),c.length){if(f=this._getNode(c))return{type:"button",node:f}}else if(d=e.closest(".jqtree-element"),d.length&&(f=this._getNode(d)))return{type:"label",node:f};return null},d.prototype._getNode=function(a){var b;return b=a.closest("li.jqtree_common"),0===b.length?null:b.data("node")},d.prototype._getNodeElementForNode=function(a){return a.isFolder()?new f(a,this):new m(a,this)},d.prototype._getNodeElement=function(a){var b;return b=this._getNode(a),b?this._getNodeElementForNode(b):null},d.prototype._contextmenu=function(b){var c,d;return c=a(b.target).closest("ul.jqtree-tree .jqtree-element"),c.length&&(d=this._getNode(c))?(b.preventDefault(),b.stopPropagation(),this._triggerEvent("tree.contextmenu",{node:d,click_event:b}),!1):void 0},d.prototype._saveState=function(){return this.options.saveState?this.save_state_handler.saveState():void 0},d.prototype._mouseCapture=function(a){return this.options.dragAndDrop?this.dnd_handler.mouseCapture(a):!1},d.prototype._mouseStart=function(a){return this.options.dragAndDrop?this.dnd_handler.mouseStart(a):!1},d.prototype._mouseDrag=function(a){var b;return this.options.dragAndDrop?(b=this.dnd_handler.mouseDrag(a),this.scroll_handler&&this.scroll_handler.checkScrolling(),b):!1},d.prototype._mouseStop=function(a){return this.options.dragAndDrop?this.dnd_handler.mouseStop(a):!1},d.prototype._triggerEvent=function(b,c){var d;return d=a.Event(b),a.extend(d,c),this.element.trigger(d),d},d.prototype.testGenerateHitAreas=function(a){return this.dnd_handler.current_item=this._getNodeElementForNode(a),this.dnd_handler.generateHitAreas(),this.dnd_handler.hit_areas},d.prototype._selectCurrentNode=function(){var a,b;return a=this.getSelectedNode(),a&&(b=this._getNodeElementForNode(a))?b.select():void 0},d.prototype._deselectCurrentNode=function(){var a;return a=this.getSelectedNode(),a?this.removeFromSelection(a):void 0},d}(k),r.register(i,"tree"),m=function(){function c(a,b){this.init(a,b)}return c.prototype.init=function(b,c){return this.node=b,this.tree_widget=c,b.element||(b.element=this.tree_widget.element),this.$element=a(b.element)},c.prototype.getUl=function(){return this.$element.children("ul:first")},c.prototype.getSpan=function(){return this.$element.children(".jqtree-element").find("span.jqtree-title")},c.prototype.getLi=function(){return this.$element},c.prototype.addDropHint=function(a){return a===n.INSIDE?new b(this.$element):new g(this.node,this.$element,a)},c.prototype.select=function(){return this.getLi().addClass("jqtree-selected")},c.prototype.deselect=function(){return this.getLi().removeClass("jqtree-selected")},c}(),f=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return B(c,a),c.prototype.open=function(a,b){var c,d;return null==b&&(b=!0),this.node.is_open?void 0:(this.node.is_open=!0,c=this.getButton(),c.removeClass("jqtree-closed"),c.html(""),c.append(this.tree_widget.renderer.opened_icon_element.cloneNode()),d=function(b){return function(){return b.getLi().removeClass("jqtree-closed"),a&&a(),b.tree_widget._triggerEvent("tree.open",{node:b.node})}}(this),b?this.getUl().slideDown("fast",d):(this.getUl().show(),d()))},c.prototype.close=function(a){var b,c;return null==a&&(a=!0),this.node.is_open?(this.node.is_open=!1,b=this.getButton(),b.addClass("jqtree-closed"),b.html(""),b.append(this.tree_widget.renderer.closed_icon_element.cloneNode()),c=function(a){return function(){return a.getLi().addClass("jqtree-closed"),a.tree_widget._triggerEvent("tree.close",{node:a.node})}}(this),a?this.getUl().slideUp("fast",c):(this.getUl().hide(),c())):void 0},c.prototype.getButton=function(){return this.$element.children(".jqtree-element").find("a.jqtree-toggler")},c.prototype.addDropHint=function(a){return this.node.is_open||a!==n.INSIDE?new g(this.node,this.$element,a):new b(this.$element)},c}(m),u=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},y=function(a,b){var c,d,e,f;for(c=e=0,f=a.length;f>e;c=++e)if(d=a[c],d===b)return c;return-1},v=function(a,b){return a.indexOf?a.indexOf(b):y(a,b)},this.Tree.indexOf=v,this.Tree._indexOf=y,w=function(a){return"number"==typeof a&&a%1===0},t=function(){var a,b,c,d,e;return a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},c=function(c){return a.lastIndex=0,a.test(c)?'"'+c.replace(a,function(a){var c;return c=b[a],"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'},d=function(a,b){var e,f,g,h,i,j,k;switch(i=b[a],typeof i){case"string":return c(i);case"number":return isFinite(i)?String(i):"null";
case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(e=j=0,k=i.length;k>j;e=++j)h=i[e],g[e]=d(e,i)||"null";return 0===g.length?"[]":"["+g.join(",")+"]"}for(f in i)Object.prototype.hasOwnProperty.call(i,f)&&(h=d(f,i),h&&g.push(c(f)+":"+h));return 0===g.length?"{}":"{"+g.join(",")+"}"}},e=function(a){return d("",{"":a})}},this.Tree.get_json_stringify_function=t,(null==this.JSON||null==this.JSON.stringify||"function"!=typeof this.JSON.stringify)&&(null==this.JSON&&(this.JSON={}),this.JSON.stringify=t()),o=function(){function b(a){this.tree_widget=a}return b.prototype.saveState=function(){var b;return b=JSON.stringify(this.getState()),this.tree_widget.options.onSetStateFromStorage?this.tree_widget.options.onSetStateFromStorage(b):this.supportsLocalStorage()?localStorage.setItem(this.getCookieName(),b):a.cookie?(a.cookie.raw=!0,a.cookie(this.getCookieName(),b,{path:"/"})):void 0},b.prototype.restoreState=function(){var a;return a=this.getStateFromStorage(),a?(this.setState(a),!0):!1},b.prototype.getStateFromStorage=function(){var a;return a=this._loadFromStorage(),a?this._parseState(a):null},b.prototype._parseState=function(b){var c;return c=a.parseJSON(b),c&&c.selected_node&&w(c.selected_node)&&(c.selected_node=[c.selected_node]),c},b.prototype._loadFromStorage=function(){return this.tree_widget.options.onGetStateFromStorage?this.tree_widget.options.onGetStateFromStorage():this.supportsLocalStorage()?localStorage.getItem(this.getCookieName()):a.cookie?(a.cookie.raw=!0,a.cookie(this.getCookieName())):null},b.prototype.getState=function(){var a,b;return a=function(a){return function(){var b;return b=[],a.tree_widget.tree.iterate(function(a){return a.is_open&&a.id&&a.hasChildren()&&b.push(a.id),!0}),b}}(this),b=function(a){return function(){var b;return function(){var a,c,d,e;for(d=this.tree_widget.getSelectedNodes(),e=[],a=0,c=d.length;c>a;a++)b=d[a],e.push(b.id);return e}.call(a)}}(this),{open_nodes:a(),selected_node:b()}},b.prototype.setState=function(a){var b,c,d,e,f,g,h;if(a&&(c=a.open_nodes,e=a.selected_node,this.tree_widget.tree.iterate(function(a){return function(a){return a.is_open=a.id&&a.hasChildren()&&v(c,a.id)>=0,!0}}(this)),e&&this.tree_widget.select_node_handler)){for(this.tree_widget.select_node_handler.clear(),h=[],f=0,g=e.length;g>f;f++)b=e[f],d=this.tree_widget.getNodeById(b),d?h.push(this.tree_widget.select_node_handler.addToSelection(d)):h.push(void 0);return h}},b.prototype.getCookieName=function(){return"string"==typeof this.tree_widget.options.saveState?this.tree_widget.options.saveState:"tree"},b.prototype.supportsLocalStorage=function(){var a;return a=function(){var a,b;if("undefined"==typeof localStorage||null===localStorage)return!1;try{b="_storage_test",sessionStorage.setItem(b,!0),sessionStorage.removeItem(b)}catch(c){return a=c,!1}return!0},null==this._supportsLocalStorage&&(this._supportsLocalStorage=a()),this._supportsLocalStorage},b.prototype.getNodeIdToBeSelected=function(){var a;return a=this.getStateFromStorage(),a&&a.selected_node?a.selected_node[0]:null},b}(),q=function(){function a(a){this.tree_widget=a,this.clear()}return a.prototype.getSelectedNode=function(){var a;return a=this.getSelectedNodes(),a.length?a[0]:!1},a.prototype.getSelectedNodes=function(){var a,b,c;if(this.selected_single_node)return[this.selected_single_node];c=[];for(a in this.selected_nodes)b=this.tree_widget.getNodeById(a),b&&c.push(b);return c},a.prototype.getSelectedNodesUnder=function(a){var b,c,d;if(this.selected_single_node)return a.isParentOf(this.selected_single_node)?[this.selected_single_node]:[];d=[];for(b in this.selected_nodes)c=this.tree_widget.getNodeById(b),c&&a.isParentOf(c)&&d.push(c);return d},a.prototype.isNodeSelected=function(a){return a.id?this.selected_nodes[a.id]:this.selected_single_node?this.selected_single_node.element===a.element:!1},a.prototype.clear=function(){return this.selected_nodes={},this.selected_single_node=null},a.prototype.removeFromSelection=function(a,b){if(null==b&&(b=!1),a.id){if(delete this.selected_nodes[a.id],b)return a.iterate(function(b){return function(c){return delete b.selected_nodes[a.id],!0}}(this))}else if(this.selected_single_node&&a.element===this.selected_single_node.element)return this.selected_single_node=null},a.prototype.addToSelection=function(a){return a.id?this.selected_nodes[a.id]=!0:this.selected_single_node=a},a}(),c=function(){function b(a){this.tree_widget=a,this.hovered_area=null,this.$ghost=null,this.hit_areas=[],this.is_dragging=!1,this.current_item=null}return b.prototype.mouseCapture=function(b){var c,d;return c=a(b.target),this.mustCaptureElement(c)?this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle(c)?null:(d=this.tree_widget._getNodeElement(c),d&&this.tree_widget.options.onCanMove&&(this.tree_widget.options.onCanMove(d.node)||(d=null)),this.current_item=d,null!==this.current_item):null},b.prototype.mouseStart=function(b){var c;return this.refresh(),c=a(b.target).offset(),this.drag_element=new d(this.current_item.node,b.page_x-c.left,b.page_y-c.top,this.tree_widget.element),this.is_dragging=!0,this.current_item.$element.addClass("jqtree-moving"),!0},b.prototype.mouseDrag=function(a){var b,c;return this.drag_element.move(a.page_x,a.page_y),b=this.findHoveredArea(a.page_x,a.page_y),c=this.canMoveToArea(b),c&&b?(b.node.isFolder()||this.stopOpenFolderTimer(),this.hovered_area!==b&&(this.hovered_area=b,this.mustOpenFolderTimer(b)?this.startOpenFolderTimer(b.node):this.stopOpenFolderTimer(),this.updateDropHint())):(this.removeHover(),this.removeDropHint(),this.stopOpenFolderTimer()),!0},b.prototype.mustCaptureElement=function(a){return!a.is("input,select")},b.prototype.canMoveToArea=function(a){var b;return a?this.tree_widget.options.onCanMoveTo?(b=n.getName(a.position),this.tree_widget.options.onCanMoveTo(this.current_item.node,a.node,b)):!0:!1},b.prototype.mouseStop=function(a){return this.moveItem(a),this.clear(),this.removeHover(),this.removeDropHint(),this.removeHitAreas(),this.current_item&&(this.current_item.$element.removeClass("jqtree-moving"),this.current_item=null),this.is_dragging=!1,!1},b.prototype.refresh=function(){return this.removeHitAreas(),this.current_item&&(this.generateHitAreas(),this.current_item=this.tree_widget._getNodeElementForNode(this.current_item.node),this.is_dragging)?this.current_item.$element.addClass("jqtree-moving"):void 0},b.prototype.removeHitAreas=function(){return this.hit_areas=[]},b.prototype.clear=function(){return this.drag_element.remove(),this.drag_element=null},b.prototype.removeDropHint=function(){return this.previous_ghost?this.previous_ghost.remove():void 0},b.prototype.removeHover=function(){return this.hovered_area=null},b.prototype.generateHitAreas=function(){var a;return a=new h(this.tree_widget.tree,this.current_item.node,this.getTreeDimensions().bottom),this.hit_areas=a.generate()},b.prototype.findHoveredArea=function(a,b){var c,d,e,f,g;if(d=this.getTreeDimensions(),a<d.left||b<d.top||a>d.right||b>d.bottom)return null;for(f=0,e=this.hit_areas.length;e>f;)if(g=f+e>>1,c=this.hit_areas[g],b<c.top)e=g;else{if(!(b>c.bottom))return c;f=g+1}return null},b.prototype.mustOpenFolderTimer=function(a){var b;return b=a.node,b.isFolder()&&!b.is_open&&a.position===n.INSIDE},b.prototype.updateDropHint=function(){var a;if(this.hovered_area)return this.removeDropHint(),a=this.tree_widget._getNodeElementForNode(this.hovered_area.node),this.previous_ghost=a.addDropHint(this.hovered_area.position)},b.prototype.startOpenFolderTimer=function(a){var b;return b=function(b){return function(){return b.tree_widget._openNode(a,b.tree_widget.options.slide,function(){return b.refresh(),b.updateDropHint()})}}(this),this.stopOpenFolderTimer(),this.open_folder_timer=setTimeout(b,this.tree_widget.options.openFolderDelay)},b.prototype.stopOpenFolderTimer=function(){return this.open_folder_timer?(clearTimeout(this.open_folder_timer),this.open_folder_timer=null):void 0},b.prototype.moveItem=function(a){var b,c,d,e,f,g;return this.hovered_area&&this.hovered_area.position!==n.NONE&&this.canMoveToArea(this.hovered_area)&&(d=this.current_item.node,g=this.hovered_area.node,e=this.hovered_area.position,f=d.parent,e===n.INSIDE&&(this.hovered_area.node.is_open=!0),b=function(a){return function(){return a.tree_widget.tree.moveNode(d,g,e),a.tree_widget.element.empty(),a.tree_widget._refreshElements()}}(this),c=this.tree_widget._triggerEvent("tree.move",{move_info:{moved_node:d,target_node:g,position:n.getName(e),previous_parent:f,do_move:b,original_event:a.original_event}}),!c.isDefaultPrevented())?b():void 0},b.prototype.getTreeDimensions=function(){var a;return a=this.tree_widget.element.offset(),{left:a.left,top:a.top,right:a.left+this.tree_widget.element.width(),bottom:a.top+this.tree_widget.element.height()+16}},b}(),s=function(){function b(a){this.tree=a}return b.prototype.iterate=function(){var b,c;return b=!0,(c=function(d){return function(e,f){var g,h,i,j,k,l,m,n;if(k=(e.is_open||!e.element)&&e.hasChildren(),e.element){if(g=a(e.element),!g.is(":visible"))return;b&&(d.handleFirstNode(e,g),b=!1),e.hasChildren()?e.is_open?d.handleOpenFolder(e,g)||(k=!1):d.handleClosedFolder(e,f,g):d.handleNode(e,f,g)}if(k){for(i=e.children.length,n=e.children,j=l=0,m=n.length;m>l;j=++l)h=n[j],j===i-1?c(e.children[j],null):c(e.children[j],e.children[j+1]);if(e.is_open)return d.handleAfterOpenFolder(e,f,g)}}}(this))(this.tree,null)},b.prototype.handleNode=function(a,b,c){},b.prototype.handleOpenFolder=function(a,b){},b.prototype.handleClosedFolder=function(a,b,c){},b.prototype.handleAfterOpenFolder=function(a,b,c){},b.prototype.handleFirstNode=function(a,b){},b}(),h=function(b){function c(a,b,d){c.__super__.constructor.call(this,a),this.current_node=b,this.tree_bottom=d}return B(c,b),c.prototype.generate=function(){return this.positions=[],this.last_top=0,this.iterate(),this.generateHitAreas(this.positions)},c.prototype.getTop=function(a){return a.offset().top},c.prototype.addPosition=function(a,b,c){var d;return d={top:c,node:a,position:b},this.positions.push(d),this.last_top=c},c.prototype.handleNode=function(a,b,c){var d;return d=this.getTop(c),a===this.current_node?this.addPosition(a,n.NONE,d):this.addPosition(a,n.INSIDE,d),b===this.current_node||a===this.current_node?this.addPosition(a,n.NONE,d):this.addPosition(a,n.AFTER,d)},c.prototype.handleOpenFolder=function(a,b){return a===this.current_node?!1:(a.children[0]!==this.current_node&&this.addPosition(a,n.INSIDE,this.getTop(b)),!0)},c.prototype.handleClosedFolder=function(a,b,c){var d;return d=this.getTop(c),a===this.current_node?this.addPosition(a,n.NONE,d):(this.addPosition(a,n.INSIDE,d),b!==this.current_node?this.addPosition(a,n.AFTER,d):void 0)},c.prototype.handleFirstNode=function(b,c){return b!==this.current_node?this.addPosition(b,n.BEFORE,this.getTop(a(b.element))):void 0},c.prototype.handleAfterOpenFolder=function(a,b,c){return a===this.current_node.node||b===this.current_node.node?this.addPosition(a,n.NONE,this.last_top):this.addPosition(a,n.AFTER,this.last_top)},c.prototype.generateHitAreas=function(a){var b,c,d,e,f,g;for(e=-1,b=[],c=[],f=0,g=a.length;g>f;f++)d=a[f],d.top!==e&&b.length&&(b.length&&this.generateHitAreasForGroup(c,b,e,d.top),e=d.top,b=[]),b.push(d);return this.generateHitAreasForGroup(c,b,e,this.tree_bottom),c},c.prototype.generateHitAreasForGroup=function(a,b,c,d){var e,f,g,h,i;for(i=Math.min(b.length,4),e=Math.round((d-c)/i),f=c,g=0;i>g;)h=b[g],a.push({top:f,bottom:f+e,node:h.node,position:h.position}),f+=e,g+=1;return null},c}(s),d=function(){function b(b,c,d,e){this.offset_x=c,this.offset_y=d,this.$element=a('<span class="jqtree-title jqtree-dragging">'+b.name+"</span>"),this.$element.css("position","absolute"),e.append(this.$element)}return b.prototype.move=function(a,b){return this.$element.offset({left:a-this.offset_x,top:b-this.offset_y})},b.prototype.remove=function(){return this.$element.remove()},b}(),g=function(){function b(b,c,d){this.$element=c,this.node=b,this.$ghost=a('<li class="jqtree_common jqtree-ghost"><span class="jqtree_common jqtree-circle"></span><span class="jqtree_common jqtree-line"></span></li>'),d===n.AFTER?this.moveAfter():d===n.BEFORE?this.moveBefore():d===n.INSIDE&&(b.isFolder()&&b.is_open?this.moveInsideOpenFolder():this.moveInside())}return b.prototype.remove=function(){return this.$ghost.remove()},b.prototype.moveAfter=function(){return this.$element.after(this.$ghost)},b.prototype.moveBefore=function(){return this.$element.before(this.$ghost)},b.prototype.moveInsideOpenFolder=function(){return a(this.node.children[0].element).before(this.$ghost)},b.prototype.moveInside=function(){return this.$element.after(this.$ghost),this.$ghost.addClass("jqtree-inside")},b}(),b=function(){function b(b){var c,d;c=b.children(".jqtree-element"),d=b.width()-4,this.$hint=a('<span class="jqtree-border"></span>'),c.append(this.$hint),this.$hint.css({width:d,height:c.height()-4})}return b.prototype.remove=function(){return this.$hint.remove()},b}(),p=function(){function b(a){this.tree_widget=a,this.previous_top=-1,this._initScrollParent()}return b.prototype._initScrollParent=function(){var b,c,d;return c=function(b){return function(){var c,d,e,f,g,h;if(c=["overflow","overflow-y"],(e=function(b){var d,e,f,g;for(e=0,f=c.length;f>e;e++)if(d=c[e],"auto"===(g=a.css(b,d))||"scroll"===g)return!0;return!1})(b.tree_widget.$el[0]))return b.tree_widget.$el;for(h=b.tree_widget.$el.parents(),f=0,g=h.length;g>f;f++)if(d=h[f],e(d))return a(d);return null}}(this),d=function(a){return function(){return a.scroll_parent_top=0,a.$scroll_parent=null}}(this),"fixed"===this.tree_widget.$el.css("position")&&d(),b=c(),b&&b.length&&"HTML"!==b[0].tagName?(this.$scroll_parent=b,this.scroll_parent_top=this.$scroll_parent.offset().top):d()},b.prototype.checkScrolling=function(){var a;return a=this.tree_widget.dnd_handler.hovered_area,a&&a.top!==this.previous_top?(this.previous_top=a.top,this.$scroll_parent?this._handleScrollingWithScrollParent(a):this._handleScrollingWithDocument(a)):void 0},b.prototype._handleScrollingWithScrollParent=function(a){var b;return b=this.scroll_parent_top+this.$scroll_parent[0].offsetHeight-a.bottom,20>b?(this.$scroll_parent[0].scrollTop+=20,this.tree_widget.refreshHitAreas(),this.previous_top=-1):a.top-this.scroll_parent_top<20?(this.$scroll_parent[0].scrollTop-=20,this.tree_widget.refreshHitAreas(),this.previous_top=-1):void 0},b.prototype._handleScrollingWithDocument=function(b){var c;return c=b.top-a(document).scrollTop(),20>c?a(document).scrollTop(a(document).scrollTop()-20):a(window).height()-(b.bottom-a(document).scrollTop())<20?a(document).scrollTop(a(document).scrollTop()+20):void 0},b.prototype.scrollTo=function(b){var c;return this.$scroll_parent?this.$scroll_parent[0].scrollTop=b:(c=this.tree_widget.$el.offset().top,a(document).scrollTop(b+c))},b.prototype.isScrolledIntoView=function(b){var c,d,e,f,g;return c=a(b),this.$scroll_parent?(g=0,f=this.$scroll_parent.height(),e=c.offset().top-this.scroll_parent_top,d=e+c.height()):(g=a(window).scrollTop(),f=g+a(window).height(),e=c.offset().top,d=e+c.height()),f>=d&&e>=g},b}(),j=function(){function b(b){this.tree_widget=b,b.options.keyboardSupport&&a(document).bind("keydown.jqtree",a.proxy(this.handleKeyDown,this))}var c,d,e,f;return d=37,f=38,e=39,c=40,b.prototype.deinit=function(){return a(document).unbind("keydown.jqtree")},b.prototype.handleKeyDown=function(b){var g,h,i,j,k,l,m;if(this.tree_widget.options.keyboardSupport){if(a(document.activeElement).is("textarea,input,select"))return!0;if(g=this.tree_widget.getSelectedNode(),m=function(b){return function(c){return c?(b.tree_widget.selectNode(c),b.tree_widget.scroll_handler&&!b.tree_widget.scroll_handler.isScrolledIntoView(a(c.element).find(".jqtree-element"))&&b.tree_widget.scrollToNode(c),!1):!0}}(this),i=function(a){return function(){return m(a.getNextNode(g))}}(this),l=function(a){return function(){return m(a.getPreviousNode(g))}}(this),k=function(a){return function(){return g.isFolder()&&!g.is_open?(a.tree_widget.openNode(g),!1):!0}}(this),j=function(a){return function(){return g.isFolder()&&g.is_open?(a.tree_widget.closeNode(g),!1):!0}}(this),!g)return!0;switch(h=b.which){case c:return i();case f:return l();case e:return k();case d:return j()}}},b.prototype.getNextNode=function(a,b){var c;return null==b&&(b=!0),b&&a.hasChildren()&&a.is_open?a.children[0]:a.parent?(c=a.getNextSibling(),c?c:this.getNextNode(a.parent,!1)):null},b.prototype.getPreviousNode=function(a){var b;return a.parent?(b=a.getPreviousSibling(),b?b.hasChildren()&&b.is_open?this.getLastChild(b):b:a.parent.parent?a.parent:null):null},b.prototype.getLastChild=function(a){var b;return a.hasChildren()?(b=a.children[a.children.length-1],b.hasChildren()&&b.is_open?this.getLastChild(b):b):null},b}()}).call(this)}.apply(a,arguments)})}(this),define("mockup-patterns-tree",["jquery","underscore","pat-base","mockup-utils","jqtree"],function(a,b,c,d){"use strict";var e=c.extend({name:"tree",trigger:".pat-tree",parser:"mockup",defaults:{dragAndDrop:!1,autoOpen:!1,selectable:!0,keyboardSupport:!0,onLoad:null},init:function(){var b=this;for(var c in b.options){var e=b.defaults[c];void 0!==e&&"boolean"==typeof e&&(b.options[c]=d.bool(b.options[c]))}if(b.options.dragAndDrop&&void 0===b.options.onCanMoveTo&&(b.options.onCanMoveTo=function(a,b,c){return void 0===b.folder||b.folder===!0}),b.options.data&&"string"==typeof b.options.data&&(b.options.data=a.parseJSON(b.options.data)),null!==b.options.onLoad){var f=a.extend({},b.options);a.getJSON(f.dataUrl,function(a){f.data=a,delete f.dataUrl,b.tree=b.$el.tree(f),b.options.onLoad(b)})}else b.tree=b.$el.tree(b.options)}});return e}),define("mockup-patterns-relateditems",["jquery","underscore","pat-base","mockup-patterns-select2","mockup-utils","mockup-patterns-tree","translate"],function(a,b,c,d,e,f,g){"use strict";var h=c.extend({name:"relateditems",trigger:".pat-relateditems",parser:"mockup",browsing:!1,currentPath:null,defaults:{vocabularyUrl:null,width:"100%",multiple:!0,tokenSeparators:[","," "],separator:",",orderable:!0,cache:!0,mode:"search",closeOnSelect:!1,basePath:"/",homeText:g("home"),folderTypes:["Folder"],selectableTypes:null,attributes:["UID","Title","portal_type","path","getIcon"],dropdownCssClass:"pattern-relateditems-dropdown",maximumSelectionSize:-1,resultTemplate:'<div class="pattern-relateditems-result pattern-relateditems-type-<%= portal_type %> <% if (selected) { %>pattern-relateditems-active<% } %>">  <a href="#" class="pattern-relateditems-result-select <% if (selectable) { %>selectable<% } %> contenttype-<%= portal_type.toLowerCase() %>">    <% if (typeof getIcon !== "undefined" && getIcon) { %><span class="pattern-relateditems-result-icon"><img src="<%= getIcon %>" /></span><% } %>    <span class="pattern-relateditems-result-title"><%= Title %></span>    <span class="pattern-relateditems-result-path"><%= path %></span>  </a>  <span class="pattern-relateditems-buttons">  <% if (folderish) { %>     <a class="pattern-relateditems-result-browse" href="#" data-path="<%= path %>"></a>   <% } %> </span></div>',resultTemplateSelector:null,selectionTemplate:'<span class="pattern-relateditems-item pattern-relateditems-type-<%= portal_type %>"> <% if (typeof getIcon !== "undefined" && getIcon) { %><span class="pattern-relateditems-result-icon"><img src="<%= getIcon %>" /></span><% } %> <span class="pattern-relateditems-item-title"><%= Title %></span> <span class="pattern-relateditems-item-path"><%= path %></span></span>',selectionTemplateSelector:null,breadCrumbsTemplate:'<span><span class="pattern-relateditems-tree"><a href="#" class="pattern-relateditems-tree-select"><span class="glyphicon glyphicon-indent-left"></span></a> <div class="tree-container"><div class="title-container"><a href="#" class="btn close pattern-relateditems-tree-cancel"><span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span></a><span class="select-folder-label">Select folder</span></div><div class="pat-tree" /></div></span><span class="pattern-relateditems-path-label"><%= searchText %></span><a class="crumb" href="/"><span class="glyphicon glyphicon-home"></span></a><%= items %></span></span>',breadCrumbsTemplateSelector:null,breadCrumbTemplate:'/<a href="<%= path %>" class="crumb"><%= text %></a>',breadCrumbTemplateSelector:null,escapeMarkup:function(a){return a},setupAjax:function(){var a=this;return a.query.valid?a.query.selectAjax():{}}},applyTemplate:function(c,d){var e,f=this;f.options[c+"TemplateSelector"]?(e=a(f.options[c+"TemplateSelector"]).html(),e||(e=f.options[c+"Template"])):e=f.options[c+"Template"];var g=a.extend(!0,{},f.options,d);return g._item=d,b.template(e)(g)},activateBrowsing:function(){var a=this;a.browsing=!0,a.setBreadCrumbs()},deactivateBrowsing:function(){var a=this;a.browsing=!1,a.setBreadCrumbs()},browseTo:function(a){var b=this;b.emit("before-browse"),b.currentPath=a,"/"===a&&"search"===b.options.mode?b.deactivateBrowsing():b.activateBrowsing(),b.$el.select2("close"),b.$el.select2("open"),b.emit("after-browse")},setBreadCrumbs:function(){var c,d=this,e=d.currentPath?d.currentPath:d.options.basePath;if("/"===e){var h="";"search"===d.options.mode&&(h="<em>"+g("entire site")+"</em>"),c=d.applyTemplate("breadCrumbs",{items:h,searchText:g("Search:")})}else{var i=e.split("/"),j="",k="";b.each(i,function(a){if(""!==a){var b={};j=j+"/"+a,b.text=a,b.path=j,k+=d.applyTemplate("breadCrumb",b)}}),c=d.applyTemplate("breadCrumbs",{items:k,searchText:g("Search:")})}var l=a(c);a("a.crumb",l).on("click",function(b){return b.preventDefault(),d.browseTo(a(this).attr("href")),!1});var m=a(".pattern-relateditems-tree-select",l),n=m.parent(),o=a(".tree-container",n),p=a(".pat-tree",n),q=null,r=new f(p,{data:[],dataFilter:function(a){var c=[];return b.each(a.results,function(a){var b={label:a.Title,id:a.UID,path:a.path,folder:-1!==d.options.folderTypes.indexOf(a.portal_type)};c.push(b)}),c},onCreateLi:function(a,b){a._loaded&&0===a.children.length&&b.find(".jqtree-title").append('<span class="tree-node-empty">'+g("(empty)")+"</span>"),b.append('<span class="pattern-relateditems-buttons"><a class="pattern-relateditems-result-browse" href="#"></a></span>'),b.find(".pattern-relateditems-result-browse").click(function(b){b.preventDefault(),d.currentPath=a.path,d.browseTo(d.currentPath),o.fadeOut()})}});r.$el.bind("tree.select",function(a){var b=a.node;b&&!b._loaded&&(d.currentPath=b.path,q=b,r.$el.tree("loadDataFromUrl",d.treeQuery.getUrl(),b,function(){r.$el.tree("openNode",b)}),b._loaded=!0)}),r.$el.bind("tree.dblclick",function(a){a.node&&(d.currentPath=a.node.path,d.browseTo(d.currentPath),o.fadeOut())}),r.$el.bind("tree.refresh",function(){q&&r.$el.tree("selectNode",q)}),a("a.pattern-relateditems-tree-cancel",o).click(function(a){return a.preventDefault(),o.fadeOut(),!1}),m.on("click",function(a){return a.preventDefault(),d.browsing=!0,d.currentPath="/",d.$el.select2("close"),o.fadeIn(),r.$el.tree("loadDataFromUrl",d.treeQuery.getUrl()),!1}),d.$el.on("select2-opening",function(){o.fadeOut()}),d.$browsePath.html(l)},selectItem:function(a){var b=this;b.emit("selecting");var c=b.$el.select2("data");c.push(a),b.$el.select2("data",c,!0),a.selected=!0,b.emit("selected")},deselectItem:function(a){var c=this;c.emit("deselecting");var d=c.$el.select2("data");b.each(d,function(b,c){b.UID===a.UID&&d.splice(c,1)}),c.$el.select2("data",d,!0),a.selected=!1,c.emit("deselected")},isSelectable:function(a){var c=this;return null===c.options.selectableTypes?!0:b.indexOf(c.options.selectableTypes,a.portal_type)>-1},init:function(){var c=this;c.query=new e.QueryHelper(a.extend(!0,{},c.options,{pattern:c})),c.treeQuery=new e.QueryHelper(a.extend(!0,{},c.options,{pattern:c,baseCriteria:[{i:"portal_type",o:"plone.app.querystring.operation.list.contains",v:c.options.folderTypes}]})),c.options.ajax=c.options.setupAjax.apply(c),c.$el.wrap('<div class="pattern-relateditems-container" />'),c.$container=c.$el.parents(".pattern-relateditems-container"),c.$container.width(c.options.width),d.prototype.initializeValues.call(c),d.prototype.initializeTags.call(c),c.options.formatSelection=function(a,b){return c.applyTemplate("selection",a)},d.prototype.initializeOrdering.call(c),c.options.formatResult=function(d){if(d.portal_type&&-1!==b.indexOf(c.options.folderTypes,d.portal_type)?d.folderish=!0:d.folderish=!1,d.selectable=c.isSelectable(d),void 0===d.selected){var e=c.$el.select2("data");d.selected=!1,b.each(e,function(a){a.UID===d.UID&&(d.selected=!0)})}var f=a(c.applyTemplate("result",d));return a(".pattern-relateditems-result-select",f).on("click",function(b){if(b.preventDefault(),a(this).is(".selectable")){var e=a(this).parents(".pattern-relateditems-result");if(e.is(".pattern-relateditems-active"))e.removeClass("pattern-relateditems-active"),c.deselectItem(d);else if(c.selectItem(d),e.addClass("pattern-relateditems-active"),c.options.maximumSelectionSize>0){var f=c.$select2.select2("data");f.length>=c.options.maximumSelectionSize&&c.$select2.select2("close")}}}),a(".pattern-relateditems-result-browse",f).on("click",function(b){b.preventDefault(),b.stopPropagation();var d=a(this).data("path");c.browseTo(d)}),a(f)},c.options.initSelection=function(b,d){var e=a(b).val();if(""!==e){var f=e.split(c.options.separator);c.query.search("UID","plone.app.querystring.operation.list.contains",f,function(a){var b=a.results.reduce(function(a,b){return a[b.UID]=b,a},{});d(f.map(function(a){return b[a]}).filter(function(a){return void 0!==a}))},!1)}},c.options.id=function(a){return a.UID},d.prototype.initializeSelect2.call(c),c.$browsePath=a('<span class="pattern-relateditems-path" />'),c.$container.prepend(c.$browsePath),"search"===c.options.mode?(c.deactivateBrowsing(),c.browsing=!1):(c.activateBrowsing(),c.browsing=!0),c.$el.on("select2-selecting",function(a){a.preventDefault()})}});return h}),define("mockup-patterns-autotoc",["jquery","pat-base"],function(a,b){"use strict";var c=b.extend({name:"autotoc",trigger:".pat-autotoc",parser:"mockup",defaults:{section:"section",levels:"h1,h2,h3",IDPrefix:"autotoc-item-",classTOCName:"autotoc-nav",classSectionName:"autotoc-section",classLevelPrefixName:"autotoc-level-",classActiveName:"active",scrollDuration:"slow",scrollEasing:"swing"},init:function(){var b=this;b.$toc=a("<nav/>").addClass(b.options.classTOCName),b.options.prependTo?b.$toc.prependTo(b.options.prependTo):b.options.appendTo?b.$toc.appendTo(b.options.appendTo):b.$toc.prependTo(b.$el),b.options.className&&b.$el.addClass(b.options.className),a(b.options.section,b.$el).addClass(b.options.classSectionName);var c=b.$el.hasClass("autotabs"),d=null;a(b.options.levels,b.$el).each(function(e){var f=a(this),g=f.prop("id")?f.prop("id"):f.parents(b.options.section).prop("id");(!g||a("#"+g).length>0)&&(g=b.options.IDPrefix+b.name+"-"+e),window.location.hash==="#"+g&&(d=g),a("<a/>").appendTo(b.$toc).text(f.text()).attr("id",g).attr("href","#"+g).addClass(b.options.classLevelPrefixName+b.getLevel(f)).on("click",function(d,e){d.stopPropagation(),d.preventDefault(),e||(e={doScroll:!0,skipHash:!1});var g=a(this);b.$toc.children("."+b.options.classActiveName).removeClass(b.options.classActiveName),b.$el.children("."+b.options.classActiveName).removeClass(b.options.classActiveName),a(d.target).addClass(b.options.classActiveName),f.parents(b.options.section).addClass(b.options.classActiveName),e.doScroll!==!1&&b.options.scrollDuration&&f&&!c&&a("body,html").animate({scrollTop:f.offset().top},b.options.scrollDuration,b.options.scrollEasing),0!==b.$el.parents(".plone-modal").size()&&b.$el.trigger("resize.plone-modal.patterns"),a(this).trigger("clicked"),e.skipHash||window.history&&window.history.pushState&&window.history.pushState({},"","#"+g.attr("id"))})}),d?a("a#"+d).trigger("click",{doScroll:!0,skipHash:!0}):b.$toc.find("a").first().trigger("click",{doScroll:!1,skipHash:!0})},getLevel:function(b){var c=0;return a.each(this.options.levels.split(","),function(a,d){return 1===b.filter(d).size()?(c=a+1,!1):void 0}),c}});return c}),define("text",["module"],function(a){"use strict";var b,c,d,e,f,g=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],h=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,i=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,j="undefined"!=typeof location&&location.href,k=j&&location.protocol&&location.protocol.replace(/\:/,""),l=j&&location.hostname,m=j&&(location.port||void 0),n={},o=a.config&&a.config()||{};return b={version:"2.0.12",strip:function(a){if(a){a=a.replace(h,"");var b=a.match(i);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:o.createXhr||function(){var a,b,c;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(b=0;3>b;b+=1){c=g[b];try{a=new ActiveXObject(c)}catch(d){}if(a){g=[c];break}}return a},parseName:function(a){var b,c,d,e=!1,f=a.indexOf("."),g=0===a.indexOf("./")||0===a.indexOf("../");return-1!==f&&(!g||f>1)?(b=a.substring(0,f),c=a.substring(f+1,a.length)):b=a,d=c||b,f=d.indexOf("!"),-1!==f&&(e="strip"===d.substring(f+1),d=d.substring(0,f),c?c=d:b=d),{moduleName:b,ext:c,strip:e}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,c,d,e){var f,g,h,i=b.xdRegExp.exec(a);return i?(f=i[2],g=i[3],g=g.split(":"),h=g[1],g=g[0],!(f&&f!==c||g&&g.toLowerCase()!==d.toLowerCase()||(h||g)&&h!==e)):!0},finishLoad:function(a,c,d,e){d=c?b.strip(d):d,o.isBuild&&(n[a]=d),e(d)},load:function(a,c,d,e){if(e&&e.isBuild&&!e.inlineText)return void d();o.isBuild=e&&e.isBuild;var f=b.parseName(a),g=f.moduleName+(f.ext?"."+f.ext:""),h=c.toUrl(g),i=o.useXhr||b.useXhr;return 0===h.indexOf("empty:")?void d():void(!j||i(h,k,l,m)?b.get(h,function(c){b.finishLoad(a,f.strip,c,d)},function(a){d.error&&d.error(a)}):c([g],function(a){b.finishLoad(f.moduleName+"."+f.ext,f.strip,a,d)}))},write:function(a,c,d,e){if(n.hasOwnProperty(c)){var f=b.jsEscape(n[c]);d.asModule(a+"!"+c,"define(function () { return '"+f+"';});\n")}},writeFile:function(a,c,d,e,f){var g=b.parseName(c),h=g.ext?"."+g.ext:"",i=g.moduleName+h,j=d.toUrl(g.moduleName+h)+".js";b.load(i,d,function(c){var d=function(a){return e(j,a)};d.asModule=function(a,b){return e.asModule(a,j,b)},b.write(a,i,d,f)},f)}},"node"===o.env||!o.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(c=require.nodeRequire("fs"),b.get=function(a,b,d){try{var e=c.readFileSync(a,"utf8");0===e.indexOf("\ufeff")&&(e=e.substring(1)),b(e)}catch(f){d&&d(f)}}):"xhr"===o.env||!o.env&&b.createXhr()?b.get=function(a,c,d,e){var f,g=b.createXhr();if(g.open("GET",a,!0),e)for(f in e)e.hasOwnProperty(f)&&g.setRequestHeader(f.toLowerCase(),e[f]);o.onXhr&&o.onXhr(g,a),g.onreadystatechange=function(b){var e,f;4===g.readyState&&(e=g.status||0,e>399&&600>e?(f=new Error(a+" HTTP status: "+e),f.xhr=g,d&&d(f)):c(g.responseText),o.onXhrComplete&&o.onXhrComplete(g,a))},g.send(null)}:"rhino"===o.env||!o.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?b.get=function(a,b){var c,d,e="utf-8",f=new java.io.File(a),g=java.lang.System.getProperty("line.separator"),h=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(f),e)),i="";try{for(c=new java.lang.StringBuffer,d=h.readLine(),d&&d.length()&&65279===d.charAt(0)&&(d=d.substring(1)),null!==d&&c.append(d);null!==(d=h.readLine());)c.append(g),c.append(d);i=String(c.toString())}finally{h.close()}b(i)}:("xpconnect"===o.env||!o.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(d=Components.classes,e=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),f="@mozilla.org/windows-registry-key;1"in d,b.get=function(a,b){var c,g,h,i={};
f&&(a=a.replace(/\//g,"\\")),h=new FileUtils.File(a);try{c=d["@mozilla.org/network/file-input-stream;1"].createInstance(e.nsIFileInputStream),c.init(h,1,0,!1),g=d["@mozilla.org/intl/converter-input-stream;1"].createInstance(e.nsIConverterInputStream),g.init(c,"utf-8",c.available(),e.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),g.readString(c.available(),i),g.close(),c.close(),b(i.value)}catch(j){throw new Error((h&&h.path||"")+": "+j)}}),b}),define("text!mockup-patterns-tinymce-url/templates/result.xml",[],function(){return'<div class="pattern-relateditems-result pattern-relateditems-type-<%= portal_type %> <% if (selected) { %>pattern-active<% } %>">\n  <a href="#" class="pattern-relateditems-result-select <% if (selectable) { %>selectable<% } %>">\n    <% if (!folderish) { %>\n    <span class="pattern-relateditems-result-image">\n      <img src="<%= generateImageUrl(_item, \'thumb\') %>" />\n    </span>\n    <% } %>\n    <span class="pattern-relateditems-result-title"><%= Title %></span>\n    <span class="pattern-relateditems-result-path"><%= path %></span>\n  </a>\n  <span class="pattern-relateditems-buttons">\n    <% if (folderish) { %>\n      <a class="pattern-relateditems-result-browse" href="#" data-path="<%= path %>"></a>\n    <% } %>\n  </span>\n</div>\n'}),define("text!mockup-patterns-tinymce-url/templates/selection.xml",[],function(){return'<span class="pattern-relateditems-item pattern-relateditems-type-<%= portal_type %>">\n <span class="pattern-relateditems-result-image">\n   <img src="<%= generateImageUrl(_item, \'thumb\') %>" />\n </span>\n <span class="pattern-relateditems-item-title"><%= Title %></span>\n <span class="pattern-relateditems-item-path"><%= path %></span>\n</span>\'\n'}),function(a){"function"==typeof define&&define.amd?define("dropzone",["jquery"],a):a(jQuery)}(function(a){var b={exports:{}};return function(){var c,d,e,f,g,h,i,j,k=[].slice,l={}.hasOwnProperty,m=function(a,b){function c(){this.constructor=a}for(var d in b)l.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};i=function(){},d=function(){function a(){}return a.prototype.addEventListener=a.prototype.on,a.prototype.on=function(a,b){return this._callbacks=this._callbacks||{},this._callbacks[a]||(this._callbacks[a]=[]),this._callbacks[a].push(b),this},a.prototype.emit=function(){var a,b,c,d,e,f;if(d=arguments[0],a=2<=arguments.length?k.call(arguments,1):[],this._callbacks=this._callbacks||{},c=this._callbacks[d])for(e=0,f=c.length;f>e;e++)b=c[e],b.apply(this,a);return this},a.prototype.removeListener=a.prototype.off,a.prototype.removeAllListeners=a.prototype.off,a.prototype.removeEventListener=a.prototype.off,a.prototype.off=function(a,b){var c,d,e,f,g;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(d=this._callbacks[a],!d)return this;if(1===arguments.length)return delete this._callbacks[a],this;for(e=f=0,g=d.length;g>f;e=++f)if(c=d[e],c===b){d.splice(e,1);break}return this},a}(),c=function(a){function b(a,d){var e,f,g;if(this.element=a,this.version=b.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(b.instances.push(this),this.element.dropzone=this,e=null!=(g=b.optionsForElement(this.element))?g:{},this.options=c({},this.defaultOptions,e,null!=d?d:{}),this.options.forceFallback||!b.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(f=this.getExistingFallback())&&f.parentNode&&f.parentNode.removeChild(f),this.options.previewsContainer!==!1&&(this.options.previewsContainer?this.previewsContainer=b.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(this.options.clickable===!0?this.clickableElements=[this.element]:this.clickableElements=b.getElements(this.options.clickable,"clickable")),this.init()}var c,e;return m(b,a),b.prototype.Emitter=d,b.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],b.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,filesizeBase:1e3,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,capture:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(a,b){return b()},init:function(){return i},forceFallback:!1,fallback:function(){var a,c,d,e,f,g;for(this.element.className=""+this.element.className+" dz-browser-not-supported",g=this.element.getElementsByTagName("div"),e=0,f=g.length;f>e;e++)a=g[e],/(^| )dz-message($| )/.test(a.className)&&(c=a,a.className="dz-message");return c||(c=b.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(c)),d=c.getElementsByTagName("span")[0],d&&(d.textContent=this.options.dictFallbackMessage),this.element.appendChild(this.getFallbackForm())},resize:function(a){var b,c,d;return b={srcX:0,srcY:0,srcWidth:a.width,srcHeight:a.height},c=a.width/a.height,b.optWidth=this.options.thumbnailWidth,b.optHeight=this.options.thumbnailHeight,null==b.optWidth&&null==b.optHeight?(b.optWidth=b.srcWidth,b.optHeight=b.srcHeight):null==b.optWidth?b.optWidth=c*b.optHeight:null==b.optHeight&&(b.optHeight=1/c*b.optWidth),d=b.optWidth/b.optHeight,a.height<b.optHeight||a.width<b.optWidth?(b.trgHeight=b.srcHeight,b.trgWidth=b.srcWidth):c>d?(b.srcHeight=a.height,b.srcWidth=b.srcHeight*d):(b.srcWidth=a.width,b.srcHeight=b.srcWidth/d),b.srcX=(a.width-b.srcWidth)/2,b.srcY=(a.height-b.srcHeight)/2,b},drop:function(a){return this.element.classList.remove("dz-drag-hover")},dragstart:i,dragend:function(a){return this.element.classList.remove("dz-drag-hover")},dragenter:function(a){return this.element.classList.add("dz-drag-hover")},dragover:function(a){return this.element.classList.add("dz-drag-hover")},dragleave:function(a){return this.element.classList.remove("dz-drag-hover")},paste:i,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(a){var c,d,e,f,g,h,i,j,k,l,m,n,o;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(a.previewElement=b.createElement(this.options.previewTemplate.trim()),a.previewTemplate=a.previewElement,this.previewsContainer.appendChild(a.previewElement),l=a.previewElement.querySelectorAll("[data-dz-name]"),f=0,i=l.length;i>f;f++)c=l[f],c.textContent=a.name;for(m=a.previewElement.querySelectorAll("[data-dz-size]"),g=0,j=m.length;j>g;g++)c=m[g],c.innerHTML=this.filesize(a.size);for(this.options.addRemoveLinks&&(a._removeLink=b.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),a.previewElement.appendChild(a._removeLink)),d=function(c){return function(d){return d.preventDefault(),d.stopPropagation(),a.status===b.UPLOADING?b.confirm(c.options.dictCancelUploadConfirmation,function(){return c.removeFile(a)}):c.options.dictRemoveFileConfirmation?b.confirm(c.options.dictRemoveFileConfirmation,function(){return c.removeFile(a)}):c.removeFile(a)}}(this),n=a.previewElement.querySelectorAll("[data-dz-remove]"),o=[],h=0,k=n.length;k>h;h++)e=n[h],o.push(e.addEventListener("click",d));return o}},removedfile:function(a){var b;return a.previewElement&&null!=(b=a.previewElement)&&b.parentNode.removeChild(a.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(a,b){var c,d,e,f;if(a.previewElement){for(a.previewElement.classList.remove("dz-file-preview"),f=a.previewElement.querySelectorAll("[data-dz-thumbnail]"),d=0,e=f.length;e>d;d++)c=f[d],c.alt=a.name,c.src=b;return setTimeout(function(b){return function(){return a.previewElement.classList.add("dz-image-preview")}}(this),1)}},error:function(a,b){var c,d,e,f,g;if(a.previewElement){for(a.previewElement.classList.add("dz-error"),"String"!=typeof b&&b.error&&(b=b.error),f=a.previewElement.querySelectorAll("[data-dz-errormessage]"),g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c.textContent=b);return g}},errormultiple:i,processing:function(a){return a.previewElement&&(a.previewElement.classList.add("dz-processing"),a._removeLink)?a._removeLink.textContent=this.options.dictCancelUpload:void 0},processingmultiple:i,uploadprogress:function(a,b,c){var d,e,f,g,h;if(a.previewElement){for(g=a.previewElement.querySelectorAll("[data-dz-uploadprogress]"),h=[],e=0,f=g.length;f>e;e++)d=g[e],"PROGRESS"===d.nodeName?h.push(d.value=b):h.push(d.style.width=""+b+"%");return h}},totaluploadprogress:i,sending:i,sendingmultiple:i,success:function(a){return a.previewElement?a.previewElement.classList.add("dz-success"):void 0},successmultiple:i,canceled:function(a){return this.emit("error",a,"Upload canceled.")},canceledmultiple:i,complete:function(a){return a._removeLink&&(a._removeLink.textContent=this.options.dictRemoveFile),a.previewElement?a.previewElement.classList.add("dz-complete"):void 0},completemultiple:i,maxfilesexceeded:i,maxfilesreached:i,queuecomplete:i,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>'},c=function(){var a,b,c,d,e,f,g;for(d=arguments[0],c=2<=arguments.length?k.call(arguments,1):[],f=0,g=c.length;g>f;f++){b=c[f];for(a in b)e=b[a],d[a]=e}return d},b.prototype.getAcceptedFiles=function(){var a,b,c,d,e;for(d=this.files,e=[],b=0,c=d.length;c>b;b++)a=d[b],a.accepted&&e.push(a);return e},b.prototype.getRejectedFiles=function(){var a,b,c,d,e;for(d=this.files,e=[],b=0,c=d.length;c>b;b++)a=d[b],a.accepted||e.push(a);return e},b.prototype.getFilesWithStatus=function(a){var b,c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;d>c;c++)b=e[c],b.status===a&&f.push(b);return f},b.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(b.QUEUED)},b.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(b.UPLOADING)},b.prototype.getActiveFiles=function(){var a,c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;d>c;c++)a=e[c],(a.status===b.UPLOADING||a.status===b.QUEUED)&&f.push(a);return f},b.prototype.init=function(){var a,c,d,e,f,g,h;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(b.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(d=function(a){return function(){return a.hiddenFileInput&&document.body.removeChild(a.hiddenFileInput),a.hiddenFileInput=document.createElement("input"),a.hiddenFileInput.setAttribute("type","file"),(null==a.options.maxFiles||a.options.maxFiles>1)&&a.hiddenFileInput.setAttribute("multiple","multiple"),a.hiddenFileInput.className="dz-hidden-input",null!=a.options.acceptedFiles&&a.hiddenFileInput.setAttribute("accept",a.options.acceptedFiles),null!=a.options.capture&&a.hiddenFileInput.setAttribute("capture",a.options.capture),a.hiddenFileInput.style.visibility="hidden",a.hiddenFileInput.style.position="absolute",a.hiddenFileInput.style.top="0",a.hiddenFileInput.style.left="0",a.hiddenFileInput.style.height="0",a.hiddenFileInput.style.width="0",document.body.appendChild(a.hiddenFileInput),a.hiddenFileInput.addEventListener("change",function(){var b,c,e,f;if(c=a.hiddenFileInput.files,c.length)for(e=0,f=c.length;f>e;e++)b=c[e],a.addFile(b);return d()})}}(this))(),this.URL=null!=(g=window.URL)?g:window.webkitURL,h=this.events,e=0,f=h.length;f>e;e++)a=h[e],this.on(a,this.options[a]);return this.on("uploadprogress",function(a){return function(){return a.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(a){return function(){return a.updateTotalUploadProgress()}}(this)),this.on("canceled",function(a){return function(b){return a.emit("complete",b)}}(this)),this.on("complete",function(a){return function(b){return 0===a.getUploadingFiles().length&&0===a.getQueuedFiles().length?setTimeout(function(){return a.emit("queuecomplete")},0):void 0}}(this)),c=function(a){return a.stopPropagation(),a.preventDefault?a.preventDefault():a.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(a){return function(b){return a.emit("dragstart",b)}}(this),dragenter:function(a){return function(b){return c(b),a.emit("dragenter",b)}}(this),dragover:function(a){return function(b){var d;try{d=b.dataTransfer.effectAllowed}catch(e){}return b.dataTransfer.dropEffect="move"===d||"linkMove"===d?"move":"copy",c(b),a.emit("dragover",b)}}(this),dragleave:function(a){return function(b){return a.emit("dragleave",b)}}(this),drop:function(a){return function(b){return c(b),a.drop(b)}}(this),dragend:function(a){return function(b){return a.emit("dragend",b)}}(this)}}],this.clickableElements.forEach(function(a){return function(c){return a.listeners.push({element:c,events:{click:function(d){return c!==a.element||d.target===a.element||b.elementInside(d.target,a.element.querySelector(".dz-message"))?a.hiddenFileInput.click():void 0}}})}}(this)),this.enable(),this.options.init.call(this)},b.prototype.destroy=function(){var a;return this.disable(),this.removeAllFiles(!0),(null!=(a=this.hiddenFileInput)?a.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,b.instances.splice(b.instances.indexOf(this),1)},b.prototype.updateTotalUploadProgress=function(){var a,b,c,d,e,f,g,h;if(d=0,c=0,a=this.getActiveFiles(),a.length){for(h=this.getActiveFiles(),f=0,g=h.length;g>f;f++)b=h[f],d+=b.upload.bytesSent,c+=b.upload.total;e=100*d/c}else e=100;return this.emit("totaluploadprogress",e,c,d)},b.prototype._getParamName=function(a){return"function"==typeof this.options.paramName?this.options.paramName(a):""+this.options.paramName+(this.options.uploadMultiple?"["+a+"]":"")},b.prototype.getFallbackForm=function(){var a,c,d,e;return(a=this.getExistingFallback())?a:(d='<div class="dz-fallback">',this.options.dictFallbackText&&(d+="<p>"+this.options.dictFallbackText+"</p>"),d+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',c=b.createElement(d),"FORM"!==this.element.tagName?(e=b.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>'),e.appendChild(c)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=e?e:c)},b.prototype.getExistingFallback=function(){var a,b,c,d,e,f;for(b=function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)if(b=a[c],/(^| )fallback($| )/.test(b.className))return b},f=["div","form"],d=0,e=f.length;e>d;d++)if(c=f[d],a=b(this.element.getElementsByTagName(c)))return a},b.prototype.setupEventListeners=function(){var a,b,c,d,e,f,g;for(f=this.listeners,g=[],d=0,e=f.length;e>d;d++)a=f[d],g.push(function(){var d,e;d=a.events,e=[];for(b in d)c=d[b],e.push(a.element.addEventListener(b,c,!1));return e}());return g},b.prototype.removeEventListeners=function(){var a,b,c,d,e,f,g;for(f=this.listeners,g=[],d=0,e=f.length;e>d;d++)a=f[d],g.push(function(){var d,e;d=a.events,e=[];for(b in d)c=d[b],e.push(a.element.removeEventListener(b,c,!1));return e}());return g},b.prototype.disable=function(){var a,b,c,d,e;for(this.clickableElements.forEach(function(a){return a.classList.remove("dz-clickable")}),this.removeEventListeners(),d=this.files,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.cancelUpload(a));return e},b.prototype.enable=function(){return this.clickableElements.forEach(function(a){return a.classList.add("dz-clickable")}),this.setupEventListeners()},b.prototype.filesize=function(a){var b,c,d,e,f,g,h,i;for(g=["TB","GB","MB","KB","b"],d=e=null,c=h=0,i=g.length;i>h;c=++h)if(f=g[c],b=Math.pow(this.options.filesizeBase,4-c)/10,a>=b){d=a/Math.pow(this.options.filesizeBase,4-c),e=f;break}return d=Math.round(10*d)/10,"<strong>"+d+"</strong> "+e},b.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},b.prototype.drop=function(a){var b,c;a.dataTransfer&&(this.emit("drop",a),b=a.dataTransfer.files,b.length&&(c=a.dataTransfer.items,c&&c.length&&null!=c[0].webkitGetAsEntry?this._addFilesFromItems(c):this.handleFiles(b)))},b.prototype.paste=function(a){var b,c;if(null!=(null!=a&&null!=(c=a.clipboardData)?c.items:void 0))return this.emit("paste",a),b=a.clipboardData.items,b.length?this._addFilesFromItems(b):void 0},b.prototype.handleFiles=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this.addFile(b));return e},b.prototype._addFilesFromItems=function(a){var b,c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)c=a[d],null!=c.webkitGetAsEntry&&(b=c.webkitGetAsEntry())?b.isFile?f.push(this.addFile(c.getAsFile())):b.isDirectory?f.push(this._addFilesFromDirectory(b,b.name)):f.push(void 0):null!=c.getAsFile&&(null==c.kind||"file"===c.kind)?f.push(this.addFile(c.getAsFile())):f.push(void 0);return f},b.prototype._addFilesFromDirectory=function(a,b){var c,d;return c=a.createReader(),d=function(a){return function(c){var d,e,f;for(e=0,f=c.length;f>e;e++)d=c[e],d.isFile?d.file(function(c){return a.options.ignoreHiddenFiles&&"."===c.name.substring(0,1)?void 0:(c.fullPath=""+b+"/"+c.name,a.addFile(c))}):d.isDirectory&&a._addFilesFromDirectory(d,""+b+"/"+d.name)}}(this),c.readEntries(d,function(a){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(a):void 0})},b.prototype.accept=function(a,c){return a.size>1024*this.options.maxFilesize*1024?c(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(a.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):b.isValidFile(a,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(c(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",a)):this.options.accept.call(this,a,c):c(this.options.dictInvalidFileType)},b.prototype.addFile=function(a){return a.upload={progress:0,total:a.size,bytesSent:0},this.files.push(a),a.status=b.ADDED,this.emit("addedfile",a),this._enqueueThumbnail(a),this.accept(a,function(b){return function(c){return c?(a.accepted=!1,b._errorProcessing([a],c)):(a.accepted=!0,b.options.autoQueue&&b.enqueueFile(a)),b._updateMaxFilesReachedClass()}}(this))},b.prototype.enqueueFiles=function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)b=a[c],this.enqueueFile(b);return null},b.prototype.enqueueFile=function(a){if(a.status!==b.ADDED||a.accepted!==!0)throw new Error("This file can't be queued because it has already been processed or was rejected.");return a.status=b.QUEUED,this.options.autoProcessQueue?setTimeout(function(a){return function(){return a.processQueue()}}(this),0):void 0},b.prototype._thumbnailQueue=[],b.prototype._processingThumbnail=!1,b.prototype._enqueueThumbnail=function(a){return this.options.createImageThumbnails&&a.type.match(/image.*/)&&a.size<=1024*this.options.maxThumbnailFilesize*1024?(this._thumbnailQueue.push(a),setTimeout(function(a){return function(){return a._processThumbnailQueue()}}(this),0)):void 0},b.prototype._processThumbnailQueue=function(){return this._processingThumbnail||0===this._thumbnailQueue.length?void 0:(this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(a){return function(){return a._processingThumbnail=!1,a._processThumbnailQueue()}}(this)))},b.prototype.removeFile=function(a){return a.status===b.UPLOADING&&this.cancelUpload(a),this.files=j(this.files,a),this.emit("removedfile",a),0===this.files.length?this.emit("reset"):void 0},b.prototype.removeAllFiles=function(a){var c,d,e,f;for(null==a&&(a=!1),f=this.files.slice(),d=0,e=f.length;e>d;d++)c=f[d],(c.status!==b.UPLOADING||a)&&this.removeFile(c);return null},b.prototype.createThumbnail=function(a,b){var c;return c=new FileReader,c.onload=function(d){return function(){return"image/svg+xml"===a.type?(d.emit("thumbnail",a,c.result),void(null!=b&&b())):d.createThumbnailFromUrl(a,c.result,b)}}(this),c.readAsDataURL(a)},b.prototype.createThumbnailFromUrl=function(a,b,c){var d;return d=document.createElement("img"),d.onload=function(b){return function(){var e,f,g,i,j,k,l,m;return a.width=d.width,a.height=d.height,g=b.options.resize.call(b,a),null==g.trgWidth&&(g.trgWidth=g.optWidth),null==g.trgHeight&&(g.trgHeight=g.optHeight),e=document.createElement("canvas"),f=e.getContext("2d"),e.width=g.trgWidth,e.height=g.trgHeight,h(f,d,null!=(j=g.srcX)?j:0,null!=(k=g.srcY)?k:0,g.srcWidth,g.srcHeight,null!=(l=g.trgX)?l:0,null!=(m=g.trgY)?m:0,g.trgWidth,g.trgHeight),i=e.toDataURL("image/png"),b.emit("thumbnail",a,i),null!=c?c():void 0}}(this),null!=c&&(d.onerror=c),d.src=b},b.prototype.processQueue=function(){var a,b,c,d;if(b=this.options.parallelUploads,c=this.getUploadingFiles().length,a=c,!(c>=b)&&(d=this.getQueuedFiles(),d.length>0)){if(this.options.uploadMultiple)return this.processFiles(d.slice(0,b-c));for(;b>a;){if(!d.length)return;this.processFile(d.shift()),a++}}},b.prototype.processFile=function(a){return this.processFiles([a])},b.prototype.processFiles=function(a){var c,d,e;for(d=0,e=a.length;e>d;d++)c=a[d],c.processing=!0,c.status=b.UPLOADING,this.emit("processing",c);return this.options.uploadMultiple&&this.emit("processingmultiple",a),this.uploadFiles(a)},b.prototype._getFilesWithXhr=function(a){var b,c;return c=function(){var c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;d>c;c++)b=e[c],b.xhr===a&&f.push(b);return f}.call(this)},b.prototype.cancelUpload=function(a){var c,d,e,f,g,h,i;if(a.status===b.UPLOADING){for(d=this._getFilesWithXhr(a.xhr),e=0,g=d.length;g>e;e++)c=d[e],c.status=b.CANCELED;for(a.xhr.abort(),f=0,h=d.length;h>f;f++)c=d[f],this.emit("canceled",c);this.options.uploadMultiple&&this.emit("canceledmultiple",d)}else((i=a.status)===b.ADDED||i===b.QUEUED)&&(a.status=b.CANCELED,this.emit("canceled",a),this.options.uploadMultiple&&this.emit("canceledmultiple",[a]));return this.options.autoProcessQueue?this.processQueue():void 0},e=function(){var a,b;return b=arguments[0],a=2<=arguments.length?k.call(arguments,1):[],"function"==typeof b?b.apply(this,a):b},b.prototype.uploadFile=function(a){return this.uploadFiles([a])},b.prototype.uploadFiles=function(a){var d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;for(w=new XMLHttpRequest,x=0,B=a.length;B>x;x++)d=a[x],d.xhr=w;p=e(this.options.method,a),u=e(this.options.url,a),w.open(p,u,!0),w.withCredentials=!!this.options.withCredentials,s=null,g=function(b){return function(){var c,e,f;for(f=[],c=0,e=a.length;e>c;c++)d=a[c],f.push(b._errorProcessing(a,s||b.options.dictResponseError.replace("{{statusCode}}",w.status),w));return f}}(this),t=function(b){return function(c){var e,f,g,h,i,j,k,l,m;if(null!=c)for(f=100*c.loaded/c.total,g=0,j=a.length;j>g;g++)d=a[g],d.upload={progress:f,total:c.total,bytesSent:c.loaded};else{for(e=!0,f=100,h=0,k=a.length;k>h;h++)d=a[h],(100!==d.upload.progress||d.upload.bytesSent!==d.upload.total)&&(e=!1),d.upload.progress=f,d.upload.bytesSent=d.upload.total;if(e)return}for(m=[],i=0,l=a.length;l>i;i++)d=a[i],m.push(b.emit("uploadprogress",d,f,d.upload.bytesSent));return m}}(this),w.onload=function(c){return function(d){var e;if(a[0].status!==b.CANCELED&&4===w.readyState){if(s=w.responseText,w.getResponseHeader("content-type")&&~w.getResponseHeader("content-type").indexOf("application/json"))try{s=JSON.parse(s)}catch(f){d=f,s="Invalid JSON response from server."}return t(),200<=(e=w.status)&&300>e?c._finished(a,s,d):g()}}}(this),w.onerror=function(c){return function(){return a[0].status!==b.CANCELED?g():void 0}}(this),r=null!=(G=w.upload)?G:w,r.onprogress=t,j={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&c(j,this.options.headers);for(h in j)i=j[h],w.setRequestHeader(h,i);if(f=new FormData,this.options.params){H=this.options.params;for(o in H)v=H[o],f.append(o,v)}for(y=0,C=a.length;C>y;y++)d=a[y],this.emit("sending",d,w,f);if(this.options.uploadMultiple&&this.emit("sendingmultiple",a,w,f),"FORM"===this.element.tagName)for(I=this.element.querySelectorAll("input, textarea, select, button"),z=0,D=I.length;D>z;z++)if(l=I[z],m=l.getAttribute("name"),n=l.getAttribute("type"),"SELECT"===l.tagName&&l.hasAttribute("multiple"))for(J=l.options,A=0,E=J.length;E>A;A++)q=J[A],q.selected&&f.append(m,q.value);else(!n||"checkbox"!==(K=n.toLowerCase())&&"radio"!==K||l.checked)&&f.append(m,l.value);for(k=F=0,L=a.length-1;L>=0?L>=F:F>=L;k=L>=0?++F:--F)f.append(this._getParamName(k),a[k],a[k].name);return w.send(f)},b.prototype._finished=function(a,c,d){var e,f,g;for(f=0,g=a.length;g>f;f++)e=a[f],e.status=b.SUCCESS,this.emit("success",e,c,d),this.emit("complete",e);return this.options.uploadMultiple&&(this.emit("successmultiple",a,c,d),this.emit("completemultiple",a)),this.options.autoProcessQueue?this.processQueue():void 0},b.prototype._errorProcessing=function(a,c,d){var e,f,g;for(f=0,g=a.length;g>f;f++)e=a[f],e.status=b.ERROR,this.emit("error",e,c,d),this.emit("complete",e);return this.options.uploadMultiple&&(this.emit("errormultiple",a,c,d),this.emit("completemultiple",a)),this.options.autoProcessQueue?this.processQueue():void 0},b}(d),c.version="4.0.1",c.options={},c.optionsForElement=function(a){return a.getAttribute("id")?c.options[e(a.getAttribute("id"))]:void 0},c.instances=[],c.forElement=function(a){if("string"==typeof a&&(a=document.querySelector(a)),null==(null!=a?a.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return a.dropzone},c.autoDiscover=!0,c.discover=function(){var a,b,d,e,f,g;for(document.querySelectorAll?d=document.querySelectorAll(".dropzone"):(d=[],a=function(a){var b,c,e,f;for(f=[],c=0,e=a.length;e>c;c++)b=a[c],/(^| )dropzone($| )/.test(b.className)?f.push(d.push(b)):f.push(void 0);return f},a(document.getElementsByTagName("div")),a(document.getElementsByTagName("form"))),g=[],e=0,f=d.length;f>e;e++)b=d[e],c.optionsForElement(b)!==!1?g.push(new c(b)):g.push(void 0);return g},c.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],c.isBrowserSupported=function(){var a,b,d,e,f;if(a=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(f=c.blacklistedBrowsers,d=0,e=f.length;e>d;d++)b=f[d],b.test(navigator.userAgent)&&(a=!1);else a=!1;else a=!1;return a},j=function(a,b){var c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)c=a[d],c!==b&&f.push(c);return f},e=function(a){return a.replace(/[\-_](\w)/g,function(a){return a.charAt(1).toUpperCase();
})},c.createElement=function(a){var b;return b=document.createElement("div"),b.innerHTML=a,b.childNodes[0]},c.elementInside=function(a,b){if(a===b)return!0;for(;a=a.parentNode;)if(a===b)return!0;return!1},c.getElement=function(a,b){var c;if("string"==typeof a?c=document.querySelector(a):null!=a.nodeType&&(c=a),null==c)throw new Error("Invalid `"+b+"` option provided. Please provide a CSS selector or a plain HTML element.");return c},c.getElements=function(a,b){var c,d,e,f,g,h,i,j;if(a instanceof Array){e=[];try{for(f=0,h=a.length;h>f;f++)d=a[f],e.push(this.getElement(d,b))}catch(k){c=k,e=null}}else if("string"==typeof a)for(e=[],j=document.querySelectorAll(a),g=0,i=j.length;i>g;g++)d=j[g],e.push(d);else null!=a.nodeType&&(e=[a]);if(null==e||!e.length)throw new Error("Invalid `"+b+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return e},c.confirm=function(a,b,c){return window.confirm(a)?b():null!=c?c():void 0},c.isValidFile=function(a,b){var c,d,e,f,g;if(!b)return!0;for(b=b.split(","),d=a.type,c=d.replace(/\/.*$/,""),f=0,g=b.length;g>f;f++)if(e=b[f],e=e.trim(),"."===e.charAt(0)){if(-1!==a.name.toLowerCase().indexOf(e.toLowerCase(),a.name.length-e.length))return!0}else if(/\/\*$/.test(e)){if(c===e.replace(/\/.*$/,""))return!0}else if(d===e)return!0;return!1},"undefined"!=typeof a&&null!==a&&(a.fn.dropzone=function(a){return this.each(function(){return new c(this,a)})}),"undefined"!=typeof b&&null!==b?b.exports=c:window.Dropzone=c,c.ADDED="added",c.QUEUED="queued",c.ACCEPTED=c.QUEUED,c.UPLOADING="uploading",c.PROCESSING=c.UPLOADING,c.CANCELED="canceled",c.ERROR="error",c.SUCCESS="success",g=function(a){var b,c,d,e,f,g,h,i,j,k;for(h=a.naturalWidth,g=a.naturalHeight,c=document.createElement("canvas"),c.width=1,c.height=g,d=c.getContext("2d"),d.drawImage(a,0,0),e=d.getImageData(0,0,1,g).data,k=0,f=g,i=g;i>k;)b=e[4*(i-1)+3],0===b?f=i:k=i,i=f+k>>1;return j=i/g,0===j?1:j},h=function(a,b,c,d,e,f,h,i,j,k){var l;return l=g(b),a.drawImage(b,c,d,e,f,h,i,j,k/l)},f=function(a,b){var c,d,e,f,g,h,i,j,k;if(e=!1,k=!0,d=a.document,j=d.documentElement,c=d.addEventListener?"addEventListener":"attachEvent",i=d.addEventListener?"removeEventListener":"detachEvent",h=d.addEventListener?"":"on",f=function(c){return"readystatechange"!==c.type||"complete"===d.readyState?(("load"===c.type?a:d)[i](h+c.type,f,!1),!e&&(e=!0)?b.call(a,c.type||c):void 0):void 0},g=function(){var a;try{j.doScroll("left")}catch(b){return a=b,void setTimeout(g,50)}return f("poll")},"complete"!==d.readyState){if(d.createEventObject&&j.doScroll){try{k=!a.frameElement}catch(l){}k&&g()}return d[c](h+"DOMContentLoaded",f,!1),d[c](h+"readystatechange",f,!1),a[c](h+"load",f,!1)}},c._autoDiscoverFunction=function(){return c.autoDiscover?c.discover():void 0},f(window,c._autoDiscoverFunction)}.call(this),b.exports}),define("text!mockup-patterns-upload-url/templates/upload.xml",[],function(){return'<div class="upload-container upload-multiple">\n    <h2 class="title"><%- _t("Upload here") %></h2>\n    <p class="help">\n        <%- _t(\'Drag and drop files from your computer onto the area below or click the "Browse" button.\') %>\n    </p>\n    <div class="upload-area">\n        <div class="fallback">\n            <input name="file" type="file" multiple />\n        </div>\n        <div class="dz-message"><p><%-_t("Drop files here...")%></p></div>\n        <div class="row browse-select">\n            <div class="col-md-9">\n                <input\n                    id="fakeUploadFile"\n                    placeholder="<%- _t("Choose File") %>"\n                    disabled="disabled"\n                    />\n            </div>\n            <div class="col-md-3">\n                <button\n                    type="button"\n                    class="btn btn-primary browse">\n                    Browse\n                </button>\n            </div>\n        </div>\n        <div class="upload-queue">\n            <div class="previews">\n            </div>\n            <div class="controls">\n                <div class="path">\n                    <label><%- _t("Upload to...") %></label>\n                    <p class="form-help">\n                        <%- _t("Select another destination folder or leave blank to add files to the current location.") %>\n                    </p>\n                    <input\n                        type="text"\n                        name="location"\n                        />\n                </div>\n                <div class="actions row">\n                    <div class="col-md-9">\n                        <div class="progress progress-striped active">\n                            <div class="progress-bar progress-bar-success"\n                                 role="progressbar"\n                                 aria-valuenow="0"\n                                 aria-valuemin="0"\n                                 aria-valuemax="100"\n                                 style="width: 0%">\n                                <span class="sr-only">40% Complete (success)</span>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="col-md-3 align-right">\n                        <button\n                            type="button"\n                            class="btn btn-primary upload-all">\n                            <%- _t("Upload") %>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("text!mockup-patterns-upload-url/templates/preview.xml",[],function(){return'<div class="row item form-inline">\n    <div class="col-md-1 action">\n        <button\n            type="button"\n            class="btn btn-danger btn-xs remove-item"\n            data-dz-remove=""\n            href="javascript:undefined;">\n            <span class="glyphicon glyphicon-remove"></span>\n        </button>\n    </div>\n    <div class="col-md-8 title">\n        <div class="dz-preview">\n          <div class="dz-details">\n            <div class="dz-filename"><span data-dz-name></span></div>\n          </div>\n          <div class="dz-error-message"><span data-dz-errormessage></span></div>\n        </div>\n        <div class="dz-progress">\n            <span class="dz-upload" data-dz-uploadprogress></span>\n        </div>\n    </div>\n    <div class="col-md-3 info">\n        <div class="dz-size" data-dz-size></div>\n        <img data-dz-thumbnail />\n    </div>\n</div>\n'}),define("mockup-patterns-upload",["jquery","underscore","pat-base","mockup-patterns-relateditems","dropzone","text!mockup-patterns-upload-url/templates/upload.xml","text!mockup-patterns-upload-url/templates/preview.xml","translate"],function(a,b,c,d,e,f,g,h){"use strict";e.autoDiscover=!1;var i=c.extend({name:"upload",trigger:".pat-upload",parser:"mockup",defaults:{showTitle:!0,url:null,className:"upload",wrap:!1,wrapperTemplate:'<div class="upload-wrapper"/>',fileaddedClassName:"dropping",useTus:!1,container:"",ajaxUpload:!0,paramName:"file",addRemoveLinks:!1,autoCleanResults:!0,previewsContainer:".previews",previewTemplate:null,maxFiles:null,maxFilesize:99999999,relatedItems:{attributes:["UID","Title","Description","getURL","portal_type","path","ModificationDate"],batchSize:20,basePath:"/",vocabularyUrl:null,width:500,maximumSelectionSize:1,selectableTypes:["Folder"]}},init:function(){var c=this,d=f;a(document).bind("paste",function(a){var b=a.originalEvent,d=b.clipboardData.items;if(d)for(var e=0;e<d.length;e++)if(-1!==d[e].type.indexOf("image")){var f=d[e].getAsFile();c.dropzone.addFile(f)}}),c.currentPath=c.options.currentPath,c.currentFile=0,d=b.template(d)({_t:h}),c.$el.addClass(c.options.className),c.$el.append(d),c.$progress=a(".progress-bar-success",c.$el),c.options.showTitle||c.$el.find("h2.title").hide(),c.options.ajaxUpload||(a(".fallback",this.$el).remove(),this.$el.hasClass(".upload-container")?this.$el.addClass("no-ajax-upload"):this.$el.closest(".upload-container").addClass("no-ajax-upload")),c.options.wrap&&(c.$el.wrap(c.options.wrapperTemplate),c.$el=c.$el.parent()),c.options.baseUrl&&c.options.relativePath?(c.$pathInput=a('input[name="location"]',c.$el),c.relatedItems=c.setupRelatedItems(c.$pathInput)):(a('input[name="location"]',c.$el).parent().remove(),c.relatedItems=null),c.$dropzone=a(".upload-area",c.$el),a("button.browse",c.$el).click(function(a){a.preventDefault(),a.stopPropagation(),(!c.options.maxFiles||c.dropzone.files.length<c.options.maxFiles)&&c.dropzone.hiddenFileInput.click()});var g=this.getDzoneOptions();try{c.dropzone=new e(c.$dropzone[0],g)}catch(i){throw window.DEBUG&&console.log(i),i}c.dropzone.on("maxfilesreached",function(){c.showHideControls()}),c.dropzone.on("addedfile",function(){c.showHideControls()}),c.dropzone.on("removedfile",function(){c.showHideControls()}),c.dropzone.on("success",function(b,d){var e;try{e=a.parseJSON(d)}catch(f){e=d}c.$el.trigger("uploadAllCompleted",{data:e,path_uid:c.$pathInput?c.$pathInput.val():null})}),c.options.autoCleanResults&&c.dropzone.on("complete",function(b){b.status===e.SUCCESS&&setTimeout(function(){a(b.previewElement).fadeOut()},3e3)}),c.dropzone.on("complete",function(a){a.status===e.SUCCESS&&1===c.dropzone.files.length&&c.showHideControls()}),c.dropzone.on("error",function(b,c,d){"undefined"!=typeof d&&403!==d.status&&a(".dz-error-message span",b.previewElement).html(h("The file transfer failed"))}),c.dropzone.on("totaluploadprogress",function(a){a=(100*(c.currentFile-1)+a)/(100*c.dropzone.files.length)*100,c.$progress.attr("aria-valuenow",a).css("width",a+"%")}),a(".upload-all",c.$el).click(function(a){a.preventDefault(),a.stopPropagation(),c.processUpload({finished:function(){c.$progress.attr("aria-valuenow",0).css("width","0%")}})}),c.options.clipboardfile&&c.dropzone.addFile(c.options.clipboardfile)},showHideControls:function(){var a=this;a._showHideTimeout&&clearTimeout(a._showHideTimeout),a._showHideTimeout=setTimeout(function(){a._showHideControls()},50)},_showHideControls:function(){var b=this,c=a(".controls",b.$el),d=a(".browse-select",b.$el),e=a(".dz-hidden-input");if(b.options.maxFiles&&(b.dropzone.files.length<b.options.maxFiles?(d.show(),e.prop("disabled",!1)):(d.hide(),e.prop("disabled",!0))),b.dropzone.files.length>0){c.fadeIn("slow");var f=b.dropzone.files[0];a(".dz-error-message span",f.previewElement).html("")}else c.fadeOut("slow")},pathJoin:function(){var a=[];return b.each(arguments,function(b){b&&("/"===b[0]&&(b=b.substring(1)),"/"===b[b.length-1]&&(b=b.substring(0,b.length-1)),a.push(b))}),a.join("/")},getUrl:function(){var a=this,b=a.options.url;if(!b)if(a.options.baseUrl&&a.options.relativePath)b=a.options.baseUrl,"/"!==b[b.length-1]&&(b+="/"),b+=a.pathJoin(a.currentPath,a.options.relativePath);else{var c=a.$el.parents("form");b=c.length>0?c.attr("action"):window.location.href}return b},getDzoneOptions:function(){var b=this;b.options.clickable=!0;var c=a.extend({},b.options);if(c.url=b.getUrl(),c.uploadMultiple=!1,delete c.wrap,delete c.wrapperTemplate,delete c.resultTemplate,delete c.autoCleanResults,delete c.fileaddedClassName,delete c.useTus,b.options.previewsContainer){var d=b.$el.find(b.options.previewsContainer);d.length>0&&(c.previewsContainer=d[0])}return c.autoProcessQueue=!1,c.previewTemplate=g,c},processUpload:function(a){function b(){d=!0,0===c.dropzone.files.length&&(d=!1);var a=c.dropzone.files[0];return d&&a.status===e.ERROR&&(a.status=e.QUEUED,d=!1),d?void(-1!==[e.SUCCESS,e.CANCELED].indexOf(a.status)?(c.dropzone.removeFile(a),b()):a.status!==e.UPLOADING?(f&&window.tus?c.handleTusUpload(a):(c.currentFile+=1,c.dropzone.processFile(a)),setTimeout(b,100)):setTimeout(b,100)):(c.$el.removeClass(g),void(void 0!==h&&"function"==typeof h&&h()))}a||(a={});var c=this,d=!1,f=c.options.useTus,g=c.options.fileaddedClassName,h=a.finished;c.currentFile=0,b()},handleTusUpload:function(b){var c=this,d=(a(b.previewElement),5242880);b.status=e.UPLOADING,window.tus.upload(b,{endpoint:c.dropzone.options.url,headers:{FILENAME:b.name},chunkSize:d}).fail(function(){window.DEBUG&&console.alert(h("Error uploading with TUS resumable uploads")),b.status=e.ERROR}).progress(function(a,b,d){var e=b/d*100;c.$progress.attr("aria-valuenow",e).css("width",e+"%"),c.$progress.html(h("uploading...")+"<br />"+c.formatBytes(b)+" / "+c.formatBytes(d))}).done(function(a,b){b.status=e.SUCCESS,c.dropzone.emit("success",b),c.dropzone.emit("complete",b)})},formatBytes:function(a){var b=Math.round(a/1024);if(1024>b)return b+" KiB";var c=Math.round(b/1024);return 1024>c?c+" MB":Math.round(c/1024)+" GB"},setPath:function(a){var b=this;b.currentPath=a,b.options.url=null,b.options.url=b.dropzone.options.url=b.getUrl()},setupRelatedItems:function(b){var c=this,e=c.options.relatedItems;c.options.initialFolder&&b.attr("value",c.options.initialFolder);var f=new d(b,e);return f.$el.on("change",function(){var b=a(this).select2("data"),d=null;b.length>0&&(d=b[0].path),c.setPath(d)}),f}});return i}),define("text!mockup-patterns-tinymce-url/templates/link.xml",[],function(){return'<div>\n  <div class="linkModal">\n    <h1><%- insertHeading %></h1>\n    <% if(upload){ %>\n    <p class="info">Specify the object to link to. It can be on this site already ("Internal"), an object you upload ("Upload"), from an external site ("External"), an email address ("Email"), or an anchor on this page ("Anchor").</p>\n    <% } %>\n\n    <div class="linkTypes pat-autotoc autotabs"\n         data-pat-autotoc="section:fieldset;levels:legend;IDPrefix:tinymce-autotoc-">\n\n      <fieldset class="linkType internal" data-linkType="internal">\n        <legend id="tinylink-internal">Internal</legend>\n        <div>\n          <div class="form-group main">\n            <!-- this gives the name to the "linkType" -->\n            <input type="text" name="internal" />\n          </div>\n        </div>\n      </fieldset>\n\n      <% if(upload){ %>\n      <fieldset class="linkType upload" data-linkType="upload">\n        <legend id="tinylink-upload">Upload</legend>\n        <div class="uploadify-me"></div>\n      </fieldset>\n      <% } %>\n\n      <fieldset class="linkType external" data-linkType="external">\n        <legend id="tinylink-external">External</legend>\n        <div class="form-group main">\n          <label for="external"><%- externalText %></label>\n          <input type="text" name="external" />\n        </div>\n      </fieldset>\n\n      <fieldset class="linkType email" data-linkType="email">\n        <legend id="tinylink-email">Email</legend>\n        <div class="form-inline">\n          <div class="form-group main">\n            <label><%- emailText %></label>\n            <input type="text" name="email" />\n          </div>\n          <div class="form-group">\n            <label><%- subjectText %></label>\n            <input type="text" name="subject" />\n          </div>\n        </div>\n      </fieldset>\n\n      <fieldset class="linkType anchor" data-linkType="anchor">\n        <legend id="tinylink-anchor">Anchor</legend>\n        <div>\n          <div class="form-group main">\n            <label>Select an anchor</label>\n            <div class="input-wrapper">\n              <select name="anchor" class="pat-select2" data-pat-select2="width:500px" />\n            </div>\n          </div>\n        </div>\n      </fieldset>\n\n    </div><!-- / tabs -->\n\n    <div class="common-controls">\n      <div class="form-group">\n        <label>Target</label>\n        <select name="target">\n          <% _.each(targetList, function(target){ %>\n            <option value="<%- target.value %>"><%- target.text %></option>\n          <% }); %>\n        </select>\n      </div>\n      <div class="form-group">\n        <label><%- titleText %></label>\n        <input type="text" name="title" />\n      </div>\n    </div>\n\n    <input type="submit" class="plone-btn" name="cancel" value="<%- cancelBtn %>" />\n    <input type="submit" class="plone-btn plone-btn-primary context" name="insert" value="<%- insertBtn %>" />\n  </div>\n</div>\n'}),define("text!mockup-patterns-tinymce-url/templates/image.xml",[],function(){return'<div>\n  <div class="linkModal">\n    <h1><%- insertHeading %></h1>\n    <% if(_.contains(linkTypes, \'uploadImage\')){ %>\n    <p class="info">Specify an image. It can be on this site already ("Internal Image"), an image you upload ("Upload"), or from an external site ("External Image").</p>\n    <% } %>\n\n    <div class="linkTypes pat-autotoc autotabs"\n         data-pat-autotoc="section:fieldset;levels:legend;IDPrefix:tinymce-autotoc-">\n\n        <% if(_.contains(linkTypes, \'image\')){ %>\n      <fieldset class="linkType image" data-linkType="image">\n        <legend id="tinylink-image">Internal Image</legend>\n        <div class="form-inline">\n          <div class="form-group main">\n            <input type="text" name="image" />\n          </div>\n          <div class="form-group scale">\n            <label><%- scaleText %></label>\n            <select name="scale">\n              <option value="">Original</option>\n                <% _.each(scales, function(scale){ %>\n                  <option value="<%- scale.part %>" <% if(scale.name === options.defaultScale){ %>selected<% } %> >\n                    <%- scale.label %>\n                  </option>\n                <% }); %>\n            </select>\n          </div>\n        </div>\n      </fieldset>\n        <% } %>\n\n      <% if(_.contains(linkTypes, \'uploadImage\')){ %>\n      <fieldset class="linkType uploadImage" data-linkType="uploadImage">\n        <legend id="tinylink-uploadImage">Upload</legend>\n        <div class="uploadify-me"></div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'externalImage\')){ %>\n      <fieldset class="linkType externalImage" data-linkType="externalImage">\n        <legend id="tinylink-externalImage">External Image</legend>\n        <div>\n          <div class="form-group main">\n            <label><%- externalImageText %></label>\n            <input type="text" name="externalImage" />\n          </div>\n        </div>\n      </fieldset>\n      <% } %>\n\n    </div><!-- / tabs -->\n\n    <div class="common-controls">\n      <div class="form-group title">\n        <label><%- titleText %></label>\n        <input type="text" name="title" />\n      </div>\n      <div class="form-group text">\n        <label><%- altText %></label>\n        <input type="text" name="alt" />\n      </div>\n      <div class="form-group align">\n        <label><%- imageAlignText %></label>\n        <select name="align">\n          <% _.each([\'inline\', \'right\', \'left\'], function(align){ %>\n              <option value="<%- align %>">\n              <%- align.charAt(0).toUpperCase() + align.slice(1) %>\n              </option>\n          <% }); %>\n        <select>\n      </div>\n    </div>\n\n    <input type="submit" class="plone-btn" name="cancel" value="<%- cancelBtn %>" />\n    <input type="submit" class="plone-btn plone-btn-primary context" name="insert" value="<%- insertBtn %>" />\n\n  </div>\n</div>\n'}),define("mockup-patterns-tinymce-url/js/links",["jquery","underscore","pat-registry","pat-base","mockup-patterns-relateditems","mockup-patterns-modal","tinymce","mockup-patterns-upload","text!mockup-patterns-tinymce-url/templates/link.xml","text!mockup-patterns-tinymce-url/templates/image.xml"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=d.extend({defaults:{linkModal:null},init:function(){this.linkModal=this.options.linkModal,this.tinypattern=this.options.tinypattern,this.tiny=this.tinypattern.tiny,this.dom=this.tiny.dom},getEl:function(){return this.$el.find("input")},value:function(){return this.getEl().val()},toUrl:function(){return this.value()},load:function(a){this.getEl().attr("value",this.tiny.dom.getAttrib(a,"data-val"))},set:function(a){this.getEl().attr("value",a)},attributes:function(){return{"data-val":this.value()}}}),l=k.extend({init:function(){k.prototype.init.call(this),this.getEl().on("change",function(){var b=a(this).val();if(!new RegExp("https?://").test(b)){var c=a(this).val().split("/")[0];-1!==c.indexOf(".")&&a(this).val("http://"+b)}})}}),m=k.extend({init:function(){k.prototype.init.call(this),this.getEl().addClass("pat-relateditems"),this.createRelatedItems()},getEl:function(){return this.$el.find("input:not(.select2-input)")},createRelatedItems:function(){this.relatedItems=new e(this.getEl(),this.linkModal.options.relatedItems)},value:function(){var a=this.getEl().select2("data");return a&&"object"==typeof a&&(a=a[0]),a},toUrl:function(){var a=this.value();return a?this.tinypattern.generateUrl(a):null},load:function(a){var b=this.tiny.dom.getAttrib(a,"data-val");b&&this.set(b)},set:function(a){var b=this.getEl();b.select2("destroy"),b.removeData("pattern-relateditems"),b.parent().replaceWith(b),b.attr("value",a),this.createRelatedItems()},attributes:function(){var a=this.value();return a?{"data-val":a.UID}:{}}}),n=k.extend({getDelegatedLinkType:function(){return"uploadImage"===this.linkModal.linkType?this.linkModal.linkTypes.image:this.linkModal.linkTypes.internal},toUrl:function(){return this.getDelegatedLinkType().toUrl()},attributes:function(){return this.getDelegatedLinkType().attributes()},set:function(a){return this.getDelegatedLinkType().set(a)},load:function(a){return this.getDelegatedLinkType().load(a)},value:function(){return this.getDelegatedLinkType().value()}}),o=m.extend({toUrl:function(){var a=this.value();return this.tinypattern.generateImageUrl(a,this.linkModal.$scale.val())}}),p=k.extend({toUrl:function(){var a=this,b=a.value();if(b){var c=a.getSubject(),d="mailto:"+b;return c&&(d+="?subject="+c),d}return null},load:function(a){k.prototype.load.apply(this,[a]),this.linkModal.$subject.val(this.tiny.dom.getAttrib(a,"data-subject"))},getSubject:function(){return this.linkModal.$subject.val()},attributes:function(){var a=k.prototype.attributes.call(this);return a["data-subject"]=this.getSubject(),a}}),q=k.extend({init:function(){k.prototype.init.call(this),this.$select=this.$el.find("select"),this.anchorNodes=[],this.anchorData=[],this.populate()},value:function(){var a=this.$select.select2("data");return a&&"object"==typeof a&&(a=a.id),a},populate:function(){var b=this;b.$select.find("option").remove(),b.anchorNodes=[],b.anchorData=[];var c,d,e,f,g,h=b.tiny.dom.select("a.mceItemAnchor,img.mceItemAnchor,a.mce-item-anchor,img.mce-item-anchor");for(d=0;d<h.length;d+=1)c=h[d],f=b.tiny.dom.getAttrib(c,"name"),f||(f=b.tiny.dom.getAttrib(c,"id")),""!==f&&(b.anchorNodes.push(c),b.anchorData.push({name:f,title:f}));if(h=b.tiny.dom.select(b.linkModal.options.anchorSelector),h.length>0)for(d=0;d<h.length;d+=1)if(c=h[d],g=a(c).text().replace(/^\s+|\s+$/g,""),""!==g){f=g.toLowerCase().substring(0,1024),f=f.replace(/[^a-z0-9]/g,"-");var i=!1;for(e=0;e<b.anchorNodes.length;e+=1){var j=b.anchorData[e];if(j.name===f){i=!0,j.title=g;break}}i||(b.anchorData.push({name:f,title:g,newAnchor:!0}),b.anchorNodes.push(c))}if(b.anchorNodes.length>0)for(d=0;d<b.anchorData.length;d+=1){var k=b.anchorData[d];b.$select.append('<option value="'+d+'">'+k.title+"</option>")}else b.$select.append("<option>No anchors found..</option>")},getIndex:function(a){for(var b=0;b<this.anchorData.length;b+=1){var c=this.anchorData[b];if(c.name===a)return b}return 0},toUrl:function(){var a=this.value();if(a){var b=parseInt(a,10),c=this.anchorNodes[b],d=this.anchorData[b];return d.newAnchor&&(c.innerHTML='<a name="'+d.name+'" class="mce-item-anchor"></a>'+c.innerHTML),"#"+d.name}return null},set:function(a){var b=this.getIndex(a);this.$select.select2("data",""+b)}});g.PluginManager.add("ploneimage",function(a){a.addButton("ploneimage",{icon:"image",tooltip:"Insert/edit image",onclick:a.settings.addImageClicked,stateSelector:"img:not([data-mce-object])"}),a.addMenuItem("ploneimage",{icon:"image",text:"Insert image",onclick:a.settings.addImageClicked,context:"insert",prependToContext:!0})}),g.PluginManager.add("plonelink",function(a){a.addButton("plonelink",{icon:"link",tooltip:"Insert/edit link",shortcut:"Ctrl+K",onclick:a.settings.addLinkClicked,stateSelector:"a[href]"}),a.addButton("unlink",{icon:"unlink",tooltip:"Remove link(s)",cmd:"unlink",stateSelector:"a[href]"}),a.addShortcut("Ctrl+K","",a.settings.addLinkClicked),a.addMenuItem("plonelink",{icon:"link",text:"Insert link",shortcut:"Ctrl+K",onclick:a.settings.addLinkClicked,stateSelector:"a[href]",context:"insert",prependToContext:!0})});var r=d.extend({name:"linkmodal",trigger:".pat-linkmodal",defaults:{anchorSelector:"h1,h2,h3",linkTypes:[],initialLinkType:"internal",text:{insertHeading:"Insert Link"},linkTypeClassMapping:{internal:m,upload:n,external:l,email:p,anchor:q,image:o,uploadImage:n,externalImage:k}},linkTypeTemplateMapping:{internal:i,upload:i,external:i,email:i,anchor:i,image:j,uploadImage:j,externalImage:j},template:function(a){return b.template(this.linkTypeTemplateMapping[this.linkType])(a)},init:function(){var a=this;a.tinypattern=a.options.tinypattern,a.tinypattern.options.anchorSelector&&(a.options.anchorSelector=a.tinypattern.options.anchorSelector),a.tiny=a.tinypattern.tiny,a.dom=a.tiny.dom,a.linkType=a.options.initialLinkType,a.linkTypes={},a.modal=c.patterns["plone-modal"].init(a.$el,{html:a.generateModalHtml(),content:null,buttons:".plone-btn"}),a.modal.on("shown",function(b){a.modalShown.apply(a,[b])})},generateModalHtml:function(){return this.template({options:this.options,upload:this.options.upload,text:this.options.text,insertHeading:this.options.text.insertHeading,linkTypes:this.options.linkTypes,externalText:this.options.text.external,emailText:this.options.text.email,subjectText:this.options.text.subject,targetList:this.options.targetList,titleText:this.options.text.title,externalImageText:this.options.text.externalImage,altText:this.options.text.alt,imageAlignText:this.options.text.imageAlign,scaleText:this.options.text.scale,scales:this.options.scales,cancelBtn:this.options.text.cancelBtn,insertBtn:this.options.text.insertBtn})},isImageMode:function(){return-1!==["image","uploadImage","externalImage"].indexOf(this.linkType)},initElements:function(){var c=this;c.$target=a('select[name="target"]',c.modal.$modal),c.$button=a('.plone-modal-footer input[name="insert"]',c.modal.$modal),c.$title=a('input[name="title"]',c.modal.$modal),c.$subject=a('input[name="subject"]',c.modal.$modal),c.$alt=a('input[name="alt"]',c.modal.$modal),c.$align=a('select[name="align"]',c.modal.$modal),c.$scale=a('select[name="scale"]',c.modal.$modal),b.each(c.options.linkTypes,function(b){var d=a(".linkType."+b+" .main",c.modal.$modal);c.linkTypes[b]=new c.options.linkTypeClassMapping[b](d,{linkModal:c,tinypattern:c.tinypattern})}),a(".autotoc-nav a",c.modal.$modal).click(function(){var d=a("fieldset.linkType",c.modal.$modal).eq(a(this).index()),e=d[0].className.split(/\s+/);b.each(e,function(a){-1!==b.indexOf(c.options.linkTypes,a)&&(c.linkType=a)})})},getLinkUrl:function(){return this.linkTypes[this.linkType].toUrl()},getValue:function(){return this.linkTypes[this.linkType].value()},updateAnchor:function(b){var c=this,d=c.$target.val(),e=c.$title.val(),f=a.extend(!0,{},{title:e?e:null,target:d?d:null,"data-linkType":c.linkType,href:b},c.linkTypes[c.linkType].attributes());c.tiny.execCommand("mceInsertLink",!1,f)},focusElement:function(a){this.tiny.focus(),this.tiny.selection.select(a),this.tiny.nodeChanged()},updateImage:function(b){function c(a){a.onload=a.onerror=function(){a.onload=a.onerror=null,d.focusElement(a)}}var d=this,e=d.$title.val(),f=a.extend(!0,{},{src:b,title:e?e:null,alt:d.$alt.val(),"class":"image-"+d.$align.val(),"data-linkType":d.linkType,"data-scale":d.$scale.val()},d.linkTypes[d.linkType].attributes());d.imgElm&&!d.imgElm.getAttribute("data-mce-object")?(f.width=d.dom.getAttrib(d.imgElm,"width"),f.height=d.dom.getAttrib(d.imgElm,"height")):d.imgElm=null,d.imgElm?d.dom.setAttribs(d.imgElm,f):(f.id="__mcenew",d.tiny.insertContent(d.dom.createHTML("img",f)),d.imgElm=d.dom.get("__mcenew"),d.dom.setAttrib(d.imgElm,"id",null)),c(d.imgElm),d.imgElm.complete&&d.focusElement(d.imgElm)},modalShown:function(b){var c=this;c.initElements(),c.initData(),c.options.upload&&(c.$upload=a(".uploadify-me",c.modal.$modal),c.options.upload.relatedItems=a.extend(!0,{},c.options.relatedItems),c.options.upload.relatedItems.selectableTypes=c.options.folderTypes,c.$upload.addClass("pat-upload").patternUpload(c.options.upload),c.$upload.on("uploadAllCompleted",function(b,d){c.linkTypes.image?(c.linkTypes.image.set(d.data.UID),a("#tinylink-image",c.modal.$modal).trigger("click")):(c.linkTypes.internal.set(d.data.UID),a("#tinylink-internal",c.modal.$modal).trigger("click"))})),c.$button.off("click").on("click",function(a){a.preventDefault(),a.stopPropagation(),c.linkType=c.modal.$modal.find("fieldset.active").data("linktype");var b=c.getLinkUrl();b&&(c.isImageMode()?c.updateImage(b):c.updateAnchor(b),c.hide())}),a('.plone-modal-footer input[name="cancel"]',c.modal.$modal).click(function(a){a.preventDefault(),c.hide()})},show:function(){this.modal.show()},hide:function(){this.modal.hide()},initData:function(){var b=this;b.selection=b.tiny.selection,b.tiny.focus();var c=b.imgElm=b.selection.getNode();b.anchorElm=b.dom.getParent(c,"a[href]");var d;if(b.isImageMode()){if("IMG"!==b.imgElm.nodeName&&b.anchorElm){var e=b.anchorElm.getElementsByTagName("img");e.length>0&&(b.imgElm=e[0],b.focusElement(b.imgElm))}if("IMG"!==b.imgElm.nodeName&&(b.imgElm=null),b.imgElm){var f=b.dom.getAttrib(b.imgElm,"src");if(b.$title.val(b.dom.getAttrib(b.imgElm,"title")),b.$alt.val(b.dom.getAttrib(b.imgElm,"alt")),d=b.dom.getAttrib(b.imgElm,"data-linktype")){b.linkType=d,b.linkTypes[b.linkType].load(b.imgElm);var g=b.dom.getAttrib(b.imgElm,"data-scale");g&&b.$scale.val(g),a("#tinylink-"+b.linkType,b.modal.$modal).trigger("click")}else f&&b.guessImageLink(f);for(var h=b.dom.getAttrib(b.imgElm,"class"),i=h.split(" "),j=0;j<i.length;j+=1){var k=i[j];-1!==k.indexOf("image-")&&b.$align.val(k.replace("image-",""))}}}else if(b.anchorElm){b.focusElement(b.anchorElm);var l="";l=b.dom.getAttrib(b.anchorElm,"href"),b.$target.val(b.dom.getAttrib(b.anchorElm,"target")),b.$title.val(b.dom.getAttrib(b.anchorElm,"title")),d=b.dom.getAttrib(b.anchorElm,"data-linktype"),d?(b.linkType=d,b.linkTypes[b.linkType].load(b.anchorElm),a("#tinylink-"+b.linkType,b.modal.$modal).trigger("click")):l&&b.guessAnchorLink(l)}},guessImageLink:function(a){-1!==a.indexOf(this.options.prependToScalePart)?(this.linkType="image",this.$scale.val(this.tinypattern.getScaleFromUrl(a)),this.linkTypes.image.set(this.tinypattern.stripGeneratedUrl(a))):(this.linkType="externalImage",this.linkTypes.externalImage.set(a))},guessAnchorLink:function(a){if(this.options.prependToUrl&&-1!==a.indexOf(this.options.prependToUrl))this.linkType="internal",this.linkTypes.internal.set(this.tinypattern.stripGeneratedUrl(a));else if(-1!==a.indexOf("mailto:")){this.linkType="email";var b=a.substring("mailto:".length,a.length),c=b.split("?subject=");this.linkTypes.email.set(c[0]),c.length>1&&this.$subject.val(decodeURIComponent(c[1]))}else"#"===a[0]?(this.linkType="anchor",this.linkTypes.anchor.set(a.substring(1))):(this.linkType="external",this.linkTypes.external.set(a))},setSelectElement:function(a,b){a.find("option:selected").prop("selected",!1),b&&a.find('option[value="'+b+'"]').prop("selected",!0)},reinitialize:function(){this.modal.options.html=this.generateModalHtml()}});return r}),define("mockup-patterns-tinymce",["jquery","underscore","pat-base","mockup-patterns-relateditems","mockup-patterns-modal","tinymce","mockup-patterns-autotoc","text!mockup-patterns-tinymce-url/templates/result.xml","text!mockup-patterns-tinymce-url/templates/selection.xml","mockup-utils","mockup-patterns-tinymce-url/js/links","mockup-i18n","translate","tinymce-modern-theme","tinymce-advlist","tinymce-anchor","tinymce-autolink","tinymce-autoresize","tinymce-autosave","tinymce-bbcode","tinymce-charmap","tinymce-code","tinymce-colorpicker","tinymce-contextmenu","tinymce-directionality","tinymce-emoticons","tinymce-fullpage","tinymce-fullscreen","tinymce-hr","tinymce-image","tinymce-importcss","tinymce-insertdatetime","tinymce-layer","tinymce-legacyoutput","tinymce-link","tinymce-lists","tinymce-media","tinymce-nonbreaking","tinymce-noneditable","tinymce-pagebreak","tinymce-paste","tinymce-preview","tinymce-print","tinymce-save","tinymce-searchreplace","tinymce-spellchecker","tinymce-tabfocus","tinymce-table","tinymce-template","tinymce-textcolor","tinymce-textpattern","tinymce-visualblocks","tinymce-visualchars","tinymce-wordcount","tinymce-compat3x"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){
"use strict";var n=c.extend({name:"tinymce",trigger:".pat-tinymce",parser:"mockup",defaults:{upload:{uploadMultiple:!1,maxFiles:1,showTitle:!1},relatedItems:{attributes:["UID","Title","Description","getURL","portal_type","path","ModificationDate","getIcon"],batchSize:20,basePath:"/",vocabularyUrl:null,width:500,maximumSelectionSize:1,placeholder:m("Search for item on site...")},text:{insertBtn:m("Insert"),cancelBtn:m("Cancel"),insertHeading:m("Insert link"),title:m("Title"),internal:m("Internal"),external:m("External URL (can be relative within this site or absolute if it starts with http:// or https://)"),email:m("Email Address"),anchor:m("Anchor"),subject:m("Email Subject (optional)"),image:m("Image"),imageAlign:m("Align"),scale:m("Size"),alt:m("Alternative Text"),externalImage:m("External Image URL (can be relative within this site or absolute if it starts with http:// or https://)")},loadingBaseUrl:"../../../bower_components/tinymce-builded/js/tinymce/",prependToUrl:"",appendToUrl:"",linkAttribute:"path",prependToScalePart:"/imagescale/",appendToScalePart:"",appendToOriginalScalePart:"",defaultScale:"large",scales:m("Listing (16x16):listing,Icon (32x32):icon,Tile (64x64):tile,Thumb (128x128):thumb,Mini (200x200):mini,Preview (400x400):preview,Large (768x768):large"),targetList:[{text:m("Open in this window / frame"),value:""},{text:m("Open in new window"),value:"_blank"},{text:m("Open in parent window / frame"),value:"_parent"},{text:m("Open in top frame (replaces all frames)"),value:"_top"}],imageTypes:["Image"],folderTypes:["Folder","Plone Site"],tiny:{content_css:"../../../bower_components/tinymce-builded/js/tinymce/skins/lightgray/content.min.css",theme:"-modern",plugins:["advlist","autolink","lists","charmap","print","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","contextmenu","paste","plonelink","ploneimage"],menubar:"edit table format tools view insert",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | unlink plonelink ploneimage",height:400},inline:!1},addLinkClicked:function(){var b=this;if(null===b.linkModal){var c=a("<div/>").insertAfter(b.$el),d=["internal","upload","external","email","anchor"];b.options.upload||d.splice(1,1),b.linkModal=new k(c,a.extend(!0,{},b.options,{tinypattern:b,linkTypes:d})),b.linkModal.show()}else b.linkModal.reinitialize(),b.linkModal.show()},addImageClicked:function(){var b=this;if(null===b.imageModal){var c=["image","uploadImage","externalImage"];b.options.upload||c.splice(1,1);var d=a.extend(!0,{},b.options,{tinypattern:b,linkTypes:c,initialLinkType:"image",text:{insertHeading:m("Insert Image")},relatedItems:{baseCriteria:[{i:"portal_type",o:"plone.app.querystring.operation.list.contains",v:b.options.imageTypes.concat(b.options.folderTypes)}],selectableTypes:b.options.imageTypes,resultTemplate:h,selectionTemplate:i}}),e=a("<div/>").insertAfter(b.$el);b.imageModal=new k(e,d),b.imageModal.show()}else b.imageModal.reinitialize(),b.imageModal.show()},generateUrl:function(a){var b=this,c=a[b.options.linkAttribute];return b.options.prependToUrl+c+b.options.appendToUrl},generateImageUrl:function(a,b){var c=this,d=c.generateUrl(a);if(""!==b){for(var e=b,f=0;f<c.options.scales.length;f+=1)c.options.scales[f].name===b&&(e=c.options.scales[f].part);d=d+c.options.prependToScalePart+e+c.options.appendToScalePart}else d+=c.options.appendToOriginalScalePart;return d},stripGeneratedUrl:function(a){var b=this;if(a=a.split(b.options.prependToScalePart,2)[0],b.options.prependToUrl){var c=a.split(b.options.prependToUrl,2);2===c.length&&(a=c[1])}return b.options.appendToUrl&&(a=a.split(b.options.appendToUrl)[0]),a},getScaleFromUrl:function(a){var b=this,c=a.split(b.options.prependToScalePart);return 2!==c.length?null:(a=b.options.appendToScalePart?c[1].split(b.options.appendToScalePart)[0]:c[1],-1!==a.indexOf("/image_")&&(a=a.split("/image_")[1]),a)},initLanguage:function(b){var c=this,d=new l,e=d.currentLanguage;"en-us"!==e&&"en"!==c.options.tiny.language?(f.baseURL=c.options.loadingBaseUrl,a.ajax({url:f.baseURL+"/langs/"+e+".js",method:"GET",cache:"true",success:function(){c.options.tiny.language=e,b()},error:function(){e=e.split("_")>1?e.split("_")[0]:e.split("-")>1?e.split("-")[0]:e+"_"+e.toUpperCase(),a.ajax({url:f.baseURL+"/langs/"+e+".js",method:"GET",cache:"true",success:function(){c.options.tiny.language=e,b()},error:function(){b()}})}})):b()},init:function(){var a=this;a.linkModal=a.imageModal=a.uploadModal=a.pasteModal=null;var c=j.setId(a.$el),d=a.options.tiny;a.options.inline===!0&&(a.options.tiny.inline=!0),a.tinyId=a.options.inline?c+"-editable":c,d.selector="#"+a.tinyId,d.addLinkClicked=function(){a.addLinkClicked.apply(a,[])},d.addImageClicked=function(b){a.addImageClicked.apply(a,[b])},d.skin=!1,a.options.relatedItems.generateImageUrl=function(b,c){return a.generateImageUrl.apply(a,[b,c])},d.init_instance_callback=function(b){(void 0===a.tiny||null===a.tiny)&&(a.tiny=b)},a.initLanguage(function(){"string"==typeof a.options.scales&&(a.options.scales=b.map(a.options.scales.split(","),function(a){var a=a.split(":");return{part:a[1],name:a[1],label:a[0]}})),"string"==typeof a.options.folderTypes&&(a.options.folderTypes=a.options.folderTypes.split(",")),"string"==typeof a.options.imageTypes&&(a.options.imageTypes=a.options.imageTypes.split(",")),a.options.inline===!0&&(a.$el.after('<div id="'+a.tinyId+'">'+a.$el.val()+"</div>"),a.$el.hide()),f.init(d),a.tiny=f.get(a.tinyId);var c=a.$el.parents("form");c.on("submit",function(){a.options.inline===!0?a.$el.val(a.tiny.getContent()):a.tiny.save()})})},destroy:function(){this.tiny&&(this.options.inline===!0&&(this.$el.val(this.tiny.getContent()),a("#"+this.tinyId).remove(),this.$el.show()),this.tiny.destroy(),this.tiny=void 0)}});return n}),define("mosaic-url/mosaic.tile",["jquery","pat-logger","underscore","mockup-utils","mockup-patterns-tinymce","pat-registry","tinymce"],function(a,b,c,d,e,f){"use strict";var g=b.getLogger("pat-mosaic"),h=function(b){var c=this;c.$el=a(b),c.$el.is(".mosaic-tile")||(c.$el=c.$el.parents(".mosaic-tile")),c.$el.children(".mosaic-tile-content").off("blur").on("blur",function(){var b=c.getType();if("plone.app.standardtiles.rawhtml"===b){var e=c.getEditUrl();e&&a.ajax({url:e,method:"POST",data:{"plone.app.standardtiles.rawhtml.content":c.$el.children(".mosaic-tile-content").html(),_authenticator:d.getAuthenticator(),"buttons.save":"Save"}})}})};return h.prototype.getEditUrl=function(){var b=this.getUrl();return(b=b.replace(/@@/,"@@edit-tile/"))?(b.match(/^\.\/.*/)&&(b=a.mosaic.options.context_url+b.replace(/^\./,"")),b):void 0},h.prototype.getUrl=function(){var b=this.$el.find(".tileUrl").html();if(!b){var c=this.$el.find("[data-tileUrl]");c.size()>0&&(b=c.attr("data-tileUrl"))}return b||(b=this.$el.find("[data-tile]").attr("data-tile")),b&&(b=b.replace(a.mosaic.options.context_url,"./"),b=b.replace(/^\.\/\//,"./"),a.mosaic.hasContentLayout?-1===b.indexOf("X-Tile-Persistent")&&(b+=-1===b.indexOf("?")?"?":"&",b+="X-Tile-Persistent=yes"):-1!==b.indexOf("X-Tile-Persistent")&&(b=b.replace("X-Tile-Persistent=yes","").replace("&&","&"))),b},h.prototype.getType=function(){var b="",c=this.$el,d=c.attr("class"),e=[];return d&&(e=c.attr("class").split(" "),a(e).each(function(){var a;a=this.match(/^mosaic-([\w.\-]+)-tile$/),null!==a&&"selected"!==a[1]&&"new"!==a[1]&&"read-only"!==a[1]&&"helper"!==a[1]&&"original"!==a[1]&&(b=a[1])})),b||g.error("Could not find tile type on element with classes: "+e.join(", ")),b},h.prototype.getConfig=function(){for(var b,c=this.getType(),d=0;d<a.mosaic.options.tiles.length;d+=1){for(var e=!1,f=a.mosaic.options.tiles[d],h=0;h<f.tiles.length;h+=1){if("field"===f.tiles[h].tile_type){var i=f.tiles[h].widget.split(".");switch(i=i[i.length-1]){case"TextWidget":case"TextFieldWidget":case"TextAreaWidget":case"TextAreaFieldWidget":case"TextLinesWidget":case"TextLinesFieldWidget":case"WysiwygWidget":case"WysiwygFieldWidget":case"RichTextWidget":case"RichTextFieldWidget":f.tiles[h].settings=!1;break;default:f.tiles[h].settings=!0}}if(f.tiles[h].name===c){b=f.tiles[h],e=!0;break}}if(e)break}return b?b:void g.error("Could not load tile config for tile type: "+c)},h.prototype.getHtmlBody=function(){var b="",c="",d=this.$el.attr("class").split(" ");c=this.getType(),d=a(d).filter(function(){switch(this){case"mosaic-new-tile":case"mosaic-helper-tile":case"mosaic-original-tile":case"mosaic-selected-tile":return!1;default:return!0}}).toArray();var e=this.getConfig();switch(e.tile_type){case"text":b+='          <div class="'+d.join(" ")+'">\n',b+='          <div class="mosaic-tile-content">\n',b+=this.$el.children(".mosaic-tile-content").html().replace(/^\s+|\s+$/g,"")+"\n",b+="          </div>\n",b+="          </div>\n";break;case"app":b+='          <div class="'+d.join(" ")+'">\n',b+='          <div class="mosaic-tile-content">\n',b+='          <div data-tile="'+this.getUrl()+'"></div>\n',b+="          </div>\n",b+="          </div>\n";break;case"field":b+='          <div class="'+d.join(" ")+'">\n',b+='          <div class="mosaic-tile-content">\n';var f="./@@plone.app.standardtiles.field?field="+c;b+='          <div data-tile="'+f+'"></div>\n',b+="          </div>\n",b+="          </div>\n",this.saveForm()}return b},h.prototype.isRichText=function(a){return void 0===a&&(a=this.getConfig()),a&&this.$el.hasClass("mosaic-read-only-tile")===!1&&!this.$el.hasClass("mosaic-tile-loading")&&("text"===a.tile_type&&a.rich_text||"app"===a.tile_type&&a.rich_text||"field"===a.tile_type&&a.read_only===!1&&("z3c.form.browser.text.TextWidget"===a.widget||"z3c.form.browser.text.TextFieldWidget"===a.widget||"z3c.form.browser.textarea.TextAreaWidget"===a.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===a.widget||"z3c.form.browser.textlines.TextLinesWidget"===a.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===a.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===a.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===a.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===a.widget||"plone.app.widgets.dx.RichTextWidget"===a.widget))?!0:!1},h.prototype.initialize=function(){var b=this.getConfig();b&&b.read_only&&this.$el.addClass("mosaic-read-only-tile"),this.isRichText()&&this.setupWysiwyg(),this.$el.prepend(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-inner-border"))),b&&this.$el.prepend(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-label").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-label-content").html(b.label)).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-label-left"))),this.makeMovable(),b&&b.settings&&this.$el.hasClass("mosaic-read-only-tile")===!1&&this.$el.prepend(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-info-icon"));var d=this;c.each(["top","bottom","right","left"],function(b){d.$el.prepend(a(a.mosaic.document.createElement("div")).addClass("mosaic-divider mosaic-divider-"+b).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-divider-dot")))})},h.prototype.makeMovable=function(){this.$el.hasClass("movable")&&a.mosaic.options.canChangeLayout&&!a.mosaic.hasContentLayout&&this.$el.prepend(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-drag-handle"))},h.prototype.initializeContent=function(){var b,c,d,e,f,g=this,h=a("body",a.mosaic.document).attr("data-base-url");h||(h=a("head > base",a.mosaic.document).attr("href"));var i=this.getUrl(),j=this.getConfig();if(j)if("field"===j.tile_type){switch(e="","IDublinCore-title"===j.name?(c='<h1 class="documentFirstHeading">',d="</h1>"):"IDublinCore-description"===j.name?(c='<p class="documentDescription">',d="</p>"):(c="<div>",d="</div>"),j.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":e=c+a("#"+j.id).find("input").attr("value")+d;break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":f=a("#"+j.id).find("textarea").val().split("\n"),e+=c;for(var k=0;k<f.length;k+=1)e+=f[k]+"<br/>";e+=d;break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":e=a("#"+j.id).find("textarea").val();break;default:e='<div class="discreet">Placeholder for field:<br/><b>'+j.label+"</b></div>"}g.fillContent(e)}else j&&(g.$el.addClass("mosaic-tile-loading"),b=h?[h,i].join("/").replace(/\/+\.\//g,"/"):i,a.ajax({type:"GET",url:b,success:function(c){g.$el.removeClass("mosaic-tile-loading"),c=a.mosaic.getDomTreeFromHtml(c),a.mosaic.addHeadTags(i,c);var d=c.find(".temp_body_tag").html();g.fillContent(d,b);var e=g.getType();"plone.app.standardtiles.rawhtml"===e&&g.setupWysiwyg()},error:function(){g.$el.removeClass("mosaic-tile-loading")}}))},h.prototype.fillContent=function(a,b){var c=this.$el.find("[data-tile]").parent();c.html(a),f.scan(c);var d=this.$el.children(".mosaic-tile-content");b&&d.size()>0&&d.attr("data-tileUrl",b.replace(/&/gim,"&amp;"))},h.prototype.select=function(){if(this.$el.hasClass("mosaic-selected-tile")===!1&&this.$el.hasClass("mosaic-read-only-tile")===!1){var b=a(".mosaic-selected-tile",a.mosaic.document);if(1===b.size()){var c=new h(b);c.blur()}this.$el.addClass("mosaic-selected-tile"),this.focus()}},h.prototype._change=function(){a.mosaic.options.toolbar.trigger("selectedtilechange"),a.mosaic.options.panels.mosaicSetResizeHandleLocation(),this.saveForm()},h.prototype.blur=function(){this.$el.removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),this._change()},h.prototype.focus=function(){this.$el.children(".mosaic-tile-content").focus(),this._change()},h.prototype.saveForm=function(){var b,c,d,e,f=this.getType(),g=this.getConfig();if(g&&"field"===g.tile_type&&g.read_only===!1&&("z3c.form.browser.text.TextWidget"===g.widget||"z3c.form.browser.text.TextFieldWidget"===g.widget||"z3c.form.browser.textarea.TextAreaWidget"===g.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===g.widget||"z3c.form.browser.textlines.TextLinesWidget"===g.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===g.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===g.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===g.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===g.widget||"plone.app.widgets.dx.RichTextWidget"===g.widget))switch(g.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":var h=a(".mosaic-panel .mosaic-"+f+"-tile",a.mosaic.document);h.size()>1&&(h=h.filter(function(){return a(".mosaic-tile-control",this).length>0}));var i=h.find(".mosaic-tile-content > *").text();a("#"+g.id).find("input").attr("value",i);break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":d="",e="IDublinCore-description"===g.name?" ":"\n",a(".mosaic-panel .mosaic-"+f+"-tile",a.mosaic.document).find(".mosaic-tile-content > *").each(function(){d+=a(this).html().replace(/<br[^>]*>/gi,e).replace(/^\s+|\s+$/g,"")+e}),d=d.replace(/^\s+|\s+$/g,""),a("#"+g.id).find("textarea").val(d);break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":b=a(document.getElementById(g.id)).find("textarea").attr("id"),c=tinymce.get(b),c&&(c.setContent(a(".mosaic-"+f+"-tile",a.mosaic.document).find(".mosaic-tile-content").html()),a(document.getElementById(g.id)).find("textarea").val(c.getContent()))}},h.prototype.setupWysiwyg=function(){var b,c=this.$el.find(".mosaic-tile-content");try{c.data("pattern-tinymce").destroy(),c.removeData("pattern-tinymce")}catch(d){}for(var f=1+Math.floor(1e5*Math.random());a("#mosaic-rich-text-init-"+f,a.mosaic.document).length>0;)f=1+Math.floor(1e5*Math.random());var g="mosaic-rich-text-init-"+f;c.attr("id",g),c.siblings(".mosaic-rich-text-toolbar").remove(),c.before(a('<div class="mosaic-rich-text-toolbar"></div>').attr("id",c.attr("id")+"-panel"));var i,j,k,l,m,n,o=this.getType();for(i=a.mosaic.options.default_available_actions,k=0;k<a.mosaic.options.tiles.length;k+=1)for(j=a.mosaic.options.tiles[k],l=0;l<j.tiles.length;l+=1)j.tiles[l].name===o&&(i=i.concat(j.tiles[l].available_actions));for(m=[],k=0;k<a.mosaic.options.richtext_toolbar.length;k+=1){for(j=a.mosaic.options.richtext_toolbar[k],l=0;l<j.actions.length;l+=1)a.inArray(j.actions[l].name,i)>-1&&m.push(j.actions[l].action);m.length&&"|"!=m[m.length-1]&&m.push("|")}for(m.length&&"|"==m[m.length-1]&&m.pop(),n=[],k=0;k<a.mosaic.options.richtext_contextmenu.length;k+=1){for(j=a.mosaic.options.richtext_contextmenu[k],l=0;l<j.actions.length;l+=1)a.inArray(j.actions[l].name,i)>-1&&n.push(j.actions[l].action);n.length&&"|"!=n[n.length-1]&&n.push("|")}n.length&&"|"==n[n.length-1]&&n.pop();var p=function(){0===c.text().replace(/^\s+|\s+$/g,"").length?c.addClass("mosaic-tile-content-empty"):c.removeClass("mosaic-tile-content-empty")};a("body").removeAttr("data-pat-tinymce"),b=new e(c,a.extend(!0,{},a.mosaic.options.tinymce,{inline:!1,tiny:{body_id:g,selector:"#"+g,inline:!0,fixed_toolbar_container:"#"+g+"-panel",menubar:!1,toolbar:m.join(" ")||!1,statusbar:!1,contextmenu:n.join(" ")||!1,plugins:a.mosaic.options.tinymce.tiny.plugins.concat(n.length?["contextmenu"]:[]),setup:function(b){b.on("focus",function(b){if(b.target.id){var c=a("#"+b.target.id).parents(".mosaic-tile").first();if(c.size()>0){var d=new h(c);d.select()}}}),b.on("change",p),p()}}})),c.addClass("mosaic-rich-text")},h.validTile=function(b){var c=a(b);return c.is(".mosaic-tile")?!0:c.parents(".mosaic-tile").size()>0?!0:!1},h}),define("mosaic-url/mosaic.panel",["jquery","pat-logger","underscore"],function(a,b,c){"use strict";var d=b.getLogger("pat-mosaic"),e=function(b){this.$el=a(b)};return e.prototype.initialize=function(b){var c,d=this.$el.attr("data-panel"),e=a("[data-panel="+d+"]",a.mosaic.document);"content"===d&&0===e.length&&a("#"+d,a.mosaic.document).each(function(){e=a(this),e.attr("data-panel",d)}),"content"===d?(c=e.attr("id"),0===a(".mosaic-original-content",a.mosaic.document).size()?(e.before(a(document.createElement("div")).attr("id",c).attr("class",e.attr("class")).addClass("mosaic-panel").attr("data-panel","content").html(b.find("[data-panel="+d+"]").html())),e.removeAttr("data-panel").removeAttr("id").addClass("mosaic-original-content")):e.replaceWith(a(document.createElement("div")).attr("id",c).attr("class",e.attr("class")).addClass("mosaic-panel").attr("data-panel","content").html(b.find("[data-panel="+d+"]").html()))):(e.attr("class",b.find("[data-panel="+d+"]").attr("class")),e.addClass("mosaic-panel"),e.html(b.find("[data-panel="+d+"]").html()))},e.prototype.prefill=function(){this.$el.hasClass("mosaic-panel")||(d.info(a(this)),a(this).addClass("mosaic-panel"),a(this).children().wrap(a('<div class="mosaic-grid-row"><div class="mosaic-grid-cell mosaic-width-full mosaic-position-leftmost"><div class="movable removable mosaic-tile mosaic-text-tile"><div class="mosaic-tile-content"></div></div></div></div>')))},e}),define("mosaic-url/mosaic.layout",["jquery","mosaic-url/mosaic.tile","mockup-patterns-modal","pat-logger","underscore","pat-registry"],function(a,b,c,d,e,f){"use strict";function g(a){switch(a){case 25:return"mosaic-width-quarter";case 33:return"mosaic-width-third";case 50:return"mosaic-width-half";case 66:case 67:return"mosaic-width-two-thirds";case 75:return"mosaic-width-three-quarters";case 100:return"mosaic-width-full"}return"mosaic-width-full"}function h(a){switch(a){case 0:return"mosaic-position-leftmost";case 25:return"mosaic-position-quarter";case 33:return"mosaic-position-third";case 50:return"mosaic-position-half";case 66:case 67:return"mosaic-position-two-thirds";case 75:return"mosaic-position-three-quarters"}return"mosaic-position-leftmost"}return"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.layout={widthClasses:["mosaic-width-quarter","mosaic-width-third","mosaic-width-half","mosaic-width-two-thirds","mosaic-width-three-quarters","mosaic-width-full"],positionClasses:["mosaic-position-leftmost","mosaic-position-quarter","mosaic-position-third","mosaic-position-half","mosaic-position-two-thirds","mosaic-position-three-quarters"]},a.fn.mosaicLayout=function(){var d=function(c){if(27===c.keyCode){var d=a(".mosaic-original-tile",a.mosaic.document);d.length>0?d.each(function(){a(this).addClass("mosaic-drag-cancel"),a(this).hasClass("mosaic-helper-tile-new")?a(document).trigger("mousedown"):a(document).trigger("mouseup")}):a(".mosaic-selected-tile",a.mosaic.document).each(function(){var a=new b(this);a.blur()}),a(".mosaic-resize-handle-helper",a.mosaic.document).each(function(){a(this).parents("[data-panel]").removeClass("mosaic-panel-resizing"),a(this).parent().removeClass("mosaic-row-resizing"),a(this).parent().children(".mosaic-resize-placeholder").remove(),a(this).remove()}),a.mosaic.overlay.app&&a.mosaic.overlay.app.hide()}};a(a.mosaic.document).off("keydown").on("keydown",d);var e=function(b){var c;if(b.target?c=b.target:b.srcElement&&(c=b.srcElement),!(a(c).parents(".mce-panel").length>0)){0===a(c).parents(".mosaic-tile").length&&0===a(c).parents(".mosaic-toolbar").length&&(a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),a.mosaic.options.toolbar.trigger("selectedtilechange"),a.mosaic.options.panels.mosaicSetResizeHandleLocation());var d=a(".mosaic-helper-tile-new",a.mosaic.document);d.length>0&&d.each(function(){a(this).mosaicHandleDragEnd()})}};a(a.mosaic.document).off("mousedown").on("mousedown",e);var i=function(b){a(".mosaic-helper-tile-new",a.mosaic.document).each(function(){var c=a(this).parent().offset();a(this).css("top",b.pageY+3-c.top),a(this).css("left",b.pageX+3-c.left)}),a(".mosaic-resize-handle-helper",a.mosaic.document).each(function(){var c,d,e=a(this),f=e.parent(),i=parseFloat(b.pageX-f.offset().left-4),j=i/e.data("row_width")*100,k=25,l=1e3;if(a([25,33,50,67,75]).each(function(){d=Math.abs(this-j),l>d&&(k=this,l=d)}),2===e.data("nr_of_columns"))e.data("column_sizes").split(" ")[0]!==k&&(f.children(".mosaic-resize-placeholder").each(function(b){0===b?a(this).removeClass(a.mosaic.layout.widthClasses.join(" ")).addClass(g(parseInt(k,10))):(a(this).removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(a.mosaic.layout.widthClasses.join(" ")).addClass(g(parseInt(100-k,10))).addClass(h(parseInt(k,10)).replace("position","resize")),e.removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(h(parseInt(k,10)).replace("position","resize")))}),a(this).data("column_sizes",k+" "+(100-k)));else{var m=a(this).data("resize_handle_index");if(1===m){if(e.data("column_sizes").split(" ")[a(this).data("resize_handle_index")-1]!==k&&parseInt(k,10)<=50)switch(c=f.children(".mosaic-resize-placeholder"),c.removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(a.mosaic.layout.widthClasses.join(" ")),e.removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(h(parseInt(k,10)).replace("position","resize")),parseInt(k,10)){case 25:a(c.get(0)).addClass(h(0).replace("position","resize")+" "+g(25)),a(c.get(1)).addClass(h(25).replace("position","resize")+" "+g(50)),a(c.get(2)).addClass(h(75).replace("position","resize")+" "+g(25)),e.data("column_sizes","25 50 25");break;case 33:a(c.get(0)).addClass(h(0).replace("position","resize")+" "+g(33)),a(c.get(1)).addClass(h(33).replace("position","resize")+" "+g(33)),a(c.get(2)).addClass(h(66).replace("position","resize")+" "+g(33)),e.data("column_sizes","33 33 33");break;case 50:a(c.get(0)).addClass(h(0).replace("position","resize")+" "+g(50)),a(c.get(1)).addClass(h(50).replace("position","resize")+" "+g(25)),a(c.get(2)).addClass(h(75).replace("position","resize")+" "+g(25)),e.data("column_sizes","50 25 25")}}else if(e.data("column_sizes").split(" ")[a(this).data("resize_handle_index")]!==100-k&&parseInt(k,10)>=50)switch(c=f.children(".mosaic-resize-placeholder"),c.removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(a.mosaic.layout.widthClasses.join(" ")),e.removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(h(parseInt(k,10)).replace("position","resize")),parseInt(k,10)){case 50:a(c.get(0)).addClass(h(0).replace("position","resize")+" "+g(25)),a(c.get(1)).addClass(h(25).replace("position","resize")+" "+g(25)),a(c.get(2)).addClass(h(50).replace("position","resize")+" "+g(50)),e.data("column_sizes","25 25 50");break;case 66:case 67:a(c.get(0)).addClass(h(0).replace("position","resize")+" "+g(33)),a(c.get(1)).addClass(h(33).replace("position","resize")+" "+g(33)),a(c.get(2)).addClass(h(66).replace("position","resize")+" "+g(33)),e.data("column_sizes","33 33 33");break;case 75:a(c.get(0)).addClass(h(0).replace("position","resize")+" "+g(25)),a(c.get(1)).addClass(h(25).replace("position","resize")+" "+g(50)),a(c.get(2)).addClass(h(75).replace("position","resize")+" "+g(25)),e.data("column_sizes","25 50 25")}}})};a(a.mosaic.document).off("mousemove").on("mousemove",i),a(a.mosaic.document).off("dragover").on("dragover",i);var j=function(c){a(".mosaic-resize-handle-helper",a.mosaic.document).each(function(){var c=a(this).parents("[data-panel]"),d=a(this).data("column_sizes").split(" ");a(this).parent().children(".mosaic-grid-cell").each(function(b){for(var c=0,e=0;b>e;e+=1)c+=parseInt(d[e],10);a(this).removeClass(a.mosaic.layout.positionClasses.join(" ")).removeClass(a.mosaic.layout.widthClasses.join(" ")).addClass(h(c)+" "+g(parseInt(d[b],10)))}),c.removeClass("mosaic-panel-resizing"),a(this).parent().removeClass("mosaic-row-resizing"),a(this).parent().children(".mosaic-resize-placeholder").remove(),a(this).parent().mosaicSetResizeHandles(),c.mosaicSetResizeHandleLocation();var e=c.find(".mosaic-selected-tile");if(e.size()>0){var f=new b(e);f.focus()}a(this).remove()})};a(a.mosaic.document).off("mouseup").on("mouseup",j);var k=function(b){if(a(this).parents("[data-panel]").hasClass("mosaic-panel-dragging")&&(a(".mosaic-selected-divider",a.mosaic.document).removeClass("mosaic-selected-divider"),a(this).hasClass("mosaic-original-tile")===!1&&a(this).hasClass("mosaic-tile-align-left")===!1&&a(this).hasClass("mosaic-tile-align-right")===!1)){var c=a(this).mosaicGetDirection(b),d=a(this).children(".mosaic-divider-"+c);if("left"===c||"right"===c){var e=d.parent().parent().parent();e.children(".mosaic-grid-cell").length>1?(d.height(e.height()+5),d.css("top",e.offset().top-d.parent().offset().top-5)):(d.height(d.parent().height()+5),d.css("top",-5))}d.addClass("mosaic-selected-divider")}};a(a.mosaic.document).off("mousemove",".mosaic-tile").on("mousemove",".mosaic-tile",k),a(a.mosaic.document).off("dragover",".mosaic-tile").on("dragover",".mosaic-tile",k),a(a.mosaic.document).off("click",".mosaic-tile").on("click",".mosaic-tile",function(){var a=new b(this);a.select()}),a(a.mosaic.document).off("click",".mosaic-info-icon").on("click",".mosaic-info-icon",function(){var d=new b(a(this).parents(".mosaic-tile")),e=d.getConfig();if("app"===e.tile_type){var g=d.getEditUrl();a(this).parents(".mosaic-tile").addClass("mosaic-edited-tile"),a.mosaic.overlay.app=new c(a(".mosaic-toolbar"),{ajaxUrl:g,loadLinksWithinModal:!0,buttons:'.formControls > input[type="submit"], .actionButtons > input[type="submit"]'}),a.mosaic.overlay.app.$el.off("after-render"),a.mosaic.overlay.app.on("after-render",function(b){a('input[name*="cancel"]',a.mosaic.overlay.app.$modal).off("click").on("click",function(){a.mosaic.overlay.app.hide(),a.mosaic.overlay.app=null,a(".mosaic-edited-tile",a.mosaic.document).removeClass("mosaic-edited-tile")}),a.mosaic.hasContentLayout&&a("form",a.mosaic.overlay.app.$modal).append(a('<input type="hidden" name="X-Tile-Persistent" value="yes" />'))}),a.mosaic.overlay.app.show(),a.mosaic.overlay.app.$el.off("formActionSuccess"),a.mosaic.overlay.app.on("formActionSuccess",function(b,c,e,g,h){var i=g.getResponseHeader("X-Tile-Url"),j=a.mosaic.getDomTreeFromHtml(c);if(i){a.mosaic.removeHeadTags(i),a.mosaic.addHeadTags(i,j);var k=j.find(".temp_body_tag").html(),l=a(".mosaic-edited-tile .mosaic-tile-content",a.mosaic.document);l.html(k),d.fillContent(k,i),f.scan(l),a.mosaic.overlay.app.hide(),a.mosaic.overlay.app=null}a(".mosaic-edited-tile",a.mosaic.document).removeClass("mosaic-edited-tile")})}else a.mosaic.overlay.open("field",e)});var l=this.length;return this.each(function(c){var d=a(this);if(d.find(".mosaic-tile").each(function(){new b(this).initialize()}),d.find(".mosaic-tile").mosaicAddDrag(),d.mosaicAddEmptyRows(),d.children(".mosaic-grid-row").mosaicSetResizeHandles(),c===l-1){var e=0,f=0;a.mosaic.options.panels.each(function(b){a(this).width()>e&&(e=a(this).width(),f=b)});var g=a.mosaic.options.panels.eq(f).find(".mosaic-tile:first");if(g.size()>0){var h=new b(g);h.select()}}})},a.fn.mosaicAddMouseMoveEmptyRow=function(){return this.each(function(){a(this).mousemove(function(){var b=a(this).parents("[data-panel]");b.hasClass("mosaic-panel-dragging")&&(a(".mosaic-selected-divider",a.mosaic.document).removeClass("mosaic-selected-divider"),a(this).children("div").addClass("mosaic-selected-divider"))})})},a.fn.mosaicAddEmptyRows=function(){return this.each(function(){a(this).find(".mosaic-grid-row").each(function(b){a(this).children(".mosaic-grid-cell").length>1&&(0===b&&a(this).before(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(a(a.mosaic.document.createElement("div")).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow()),(0===a(this).nextAll(".mosaic-grid-row").length||a(this).next().children(".mosaic-grid-cell").length>1)&&a(this).after(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(a(a.mosaic.document.createElement("div")).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow()))}),0===a(this).find(".mosaic-grid-row").length&&a(this).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(a(a.mosaic.document.createElement("div")).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow())})},a.fn.mosaicGetWidthClass=function(){var b;for(b in a.mosaic.layout.widthClasses)if(a.mosaic.layout.widthClasses.hasOwnProperty(b)&&a(this).hasClass(a.mosaic.layout.widthClasses[b]))return a.mosaic.layout.widthClasses[b];for(b in a.mosaic.layout.widthClasses)if(a.mosaic.layout.widthClasses.hasOwnProperty(b)&&a(this).hasClass(a.mosaic.layout.widthClasses[b].replace("position","resize")))return a.mosaic.layout.widthClasses[b];
return a.mosaic.layout.widthClasses[0]},a.fn.mosaicGetPositionClass=function(){var b;for(b in a.mosaic.layout.positionClasses)if(a(this).hasClass(a.mosaic.layout.positionClasses[b]))return a.mosaic.layout.positionClasses[b];for(b in a.mosaic.layout.positionClasses)if(a(this).hasClass(a.mosaic.layout.positionClasses[b].replace("position","resize")))return a.mosaic.layout.positionClasses[b];return a.mosaic.layout.positionClasses[0]},a.fn.mosaicAddDrag=function(){return this.each(function(){var b=a(this),c=function(b){var c=a(".mosaic-helper-tile",a.mosaic.document),d=c.parents("[data-panel]").offset();c.css("top",b.pageY+3-d.top),c.css("left",b.pageX+3-d.left)},d=function(){var b=a(".mosaic-helper-tile",a.mosaic.document);a(a.mosaic.document).unbind("mousemove",c).unbind("mouseup",d),b.mosaicHandleDragEnd(),b.remove()};return b.each(function(){b.find("div.mosaic-drag-handle").unbind("mousedown").bind("mousedown",function(b){var e=b.pageX,f=b.pageY,g=function(b){if(Math.max(Math.abs(e-b.pageX),Math.abs(f-b.pageY))>=1){a.mosaic.options.panels.addClass("mosaic-panel-dragging"),a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur();var h=a(b.target).parents(".mosaic-tile"),i=h.clone(!0);h.addClass("mosaic-original-tile"),h.parents("[data-panel]").append(i),i.css({width:h.width(),position:"absolute",opacity:.5}).addClass("mosaic-helper-tile"),a(a.mosaic.document).mousemove(c),a(a.mosaic.document).mouseup(d),a(a.mosaic.document).unbind("mousemove",g)}};a(a.mosaic.document).bind("mousemove",g),a(a.mosaic.document).bind("mouseup",function(){a(a.mosaic.document).unbind("mousemove",g)})})})})},a.fn.mosaicHandleDragEnd=function(){a(this).parents("[data-panel]");a.mosaic.options.panels.removeClass("mosaic-panel-dragging mosaic-panel-dragging-new");var c=a(".mosaic-selected-divider",a.mosaic.document),d=c.parent(),f="";e.each(["top","bottom","left","right"],function(a){c.hasClass("mosaic-divider-"+a)&&(f=a)}),c.removeClass("mosaic-selected-divider");var g=a(".mosaic-helper-tile-new",a.mosaic.document).length>0,h=a(".mosaic-original-tile",a.mosaic.document);if((0===c.length||d.hasClass("mosaic-helper-tile"))&&h.addClass("mosaic-drag-cancel"),h.hasClass("mosaic-drag-cancel"))h.removeClass("mosaic-drag-cancel"),a.mosaic.options.panels.find(".mosaic-empty-row").remove(),g||h.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");else if(d.hasClass("mosaic-empty-row"))d.removeClass("mosaic-empty-row").attr("class",h.parents(".mosaic-grid-row").first().attr("class")).unbind("mousemove"),d.children(".mosaic-grid-cell").children("div").remove(),d.children(".mosaic-grid-cell").append(h.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile")),a(".mosaic-empty-row",a.mosaic.document).remove();else if(d.hasClass("mosaic-tile")===!1)a(".mosaic-empty-row",a.mosaic.document).remove(),g||h.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");else if(4!==d.parent().parent().children(".mosaic-grid-cell").length||"left"!==f&&"right"!==f){if(a(".mosaic-empty-row",a.mosaic.document).remove(),"top"===f)d.before(h.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"));else if("bottom"===f)d.after(h.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"));else if("left"===f||"right"===f)if(1===d.parent().parent().children(".mosaic-grid-cell").length){var i=d.prevAll();i.length>0&&(d.parent().parent().before(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(a(i.get().reverse()).clone(!0).mosaicAddDrag()))),i.remove());var j=d.nextAll();j.length>0&&(d.parent().parent().after(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(j.clone(!0).mosaicAddDrag()))),j.remove()),d.parent().removeClass(a.mosaic.layout.widthClasses.join(" ")).removeClass(a.mosaic.layout.positionClasses.join(" ")).addClass("mosaic-width-half"),"left"===f?d.parent().addClass("mosaic-position-half").before(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-leftmost").append(h.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))):d.parent().addClass("mosaic-position-leftmost").after(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-half").append(h.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))),d.parent().parent().mosaicSetResizeHandles()}else"left"===f?d.parent().before(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell").append(h.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))):d.parent().after(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell").append(h.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))),d.parent().parent().mosaicSetColumnSizes(),d.parent().parent().mosaicSetResizeHandles()}else a(".mosaic-empty-row",a.mosaic.document).remove(),g||h.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");var k=h.parent().parent();a(".mosaic-original-tile",a.mosaic.document).remove(),k.mosaicCleanupRow(),a.mosaic.options.panels.mosaicAddEmptyRows();var l=a(".mosaic-new-tile",a.mosaic.document);l.removeClass("mosaic-new-tile");var m=new b(l);a(".mosaic-rich-text",l).size()>0&&m.setupWysiwyg(),g&&m.select()},a.fn.mosaicSetColumnSizes=function(){return this.each(function(){var b=a(this).children(".mosaic-grid-cell").length;a(this).children(".mosaic-grid-cell").each(function(c){switch(a(this).removeClass(a.mosaic.layout.widthClasses.join(" ")).removeClass(a.mosaic.layout.positionClasses.join(" ")),b){case 1:a(this).addClass("mosaic-width-full mosaic-position-leftmost");break;case 2:switch(c){case 0:a(this).addClass("mosaic-width-half mosaic-position-leftmost");break;case 1:a(this).addClass("mosaic-width-half mosaic-position-half")}break;case 3:switch(c){case 0:a(this).addClass("mosaic-width-third mosaic-position-leftmost");break;case 1:a(this).addClass("mosaic-width-third mosaic-position-third");break;case 2:a(this).addClass("mosaic-width-third mosaic-position-two-thirds")}break;case 4:switch(c){case 0:a(this).addClass("mosaic-width-quarter mosaic-position-leftmost");break;case 1:a(this).addClass("mosaic-width-quarter mosaic-position-quarter");break;case 2:a(this).addClass("mosaic-width-quarter mosaic-position-half");break;case 3:a(this).addClass("mosaic-width-quarter mosaic-position-three-quarters")}}})})},a.fn.mosaicSetResizeHandles=function(){return this.each(function(){a(this).children(".mosaic-resize-handle").remove();var b=a(this).children(".mosaic-grid-cell").length;switch(b){case 2:a(this).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-one "+a(a(this).children(".mosaic-grid-cell").get(1)).mosaicGetPositionClass().replace("position","resize")));break;case 3:a(this).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-one "+a(a(this).children(".mosaic-grid-cell").get(1)).mosaicGetPositionClass().replace("position","resize"))),a(this).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-two "+a(a(this).children(".mosaic-grid-cell").get(2)).mosaicGetPositionClass().replace("position","resize")))}a(this).children(".mosaic-resize-handle").mousedown(function(){var b=[];a(this).parent().children(".mosaic-grid-cell").each(function(){switch(a(this).mosaicGetWidthClass()){case"mosaic-width-half":b.push("50");break;case"mosaic-width-quarter":b.push("25");break;case"mosaic-width-third":b.push("33");break;case"mosaic-width-two-thirds":b.push("66");break;case"mosaic-width-three-quarters":b.push("75")}a(this).parent().append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-placeholder "+a(this).mosaicGetWidthClass()+" "+a(this).mosaicGetPositionClass().replace("position","resize")).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-placeholder-inner-border")))});var c=1;return a(this).hasClass("mosaic-resize-handle-two")&&(c=2),a(this).parent().append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-helper").addClass(a(this).mosaicGetPositionClass().replace("position","resize")).data("row_width",a(this).parent().width()).data("nr_of_columns",a(this).parent().children(".mosaic-grid-cell").length).data("column_sizes",b.join(" ")).data("resize_handle_index",c)),a(this).parents("[data-panel]").addClass("mosaic-panel-resizing"),a(this).parent().addClass("mosaic-row-resizing"),a(".mosaic-selected-tile",a.mosaic.document).children(".mosaic-tile-content").blur(),!1})})},a.fn.mosaicCleanupRow=function(){return this.each(function(){var b=a(this);if(b.children(".mosaic-grid-cell").each(function(){0===a(this).children().length&&(a(this).remove(),b.mosaicSetColumnSizes())}),0===b.find(".mosaic-tile").length){var c=b;if(b.nextAll(".mosaic-grid-row").length>0)b=b.next(".mosaic-grid-row");else{if(!(b.prevAll(".mosaic-grid-row").length>0))return void b.remove();b=b.prev(".mosaic-grid-row")}c.remove()}b.prevAll(".mosaic-grid-row").length>0&&1===b.children(".mosaic-grid-cell").length&&1===b.prev().children(".mosaic-grid-cell").length&&(b.children(".mosaic-grid-cell").prepend(b.prev().children(".mosaic-grid-cell").children(".mosaic-tile").clone(!0).mosaicAddDrag()),b.prev().remove()),b.nextAll(".mosaic-grid-row").length>0&&1===b.children(".mosaic-grid-cell").length&&1===b.next().children(".mosaic-grid-cell").length&&(b.children(".mosaic-grid-cell").append(b.next().children(".mosaic-grid-cell").children(".mosaic-tile").clone(!0).mosaicAddDrag()),b.next().remove()),b.mosaicSetResizeHandles()})},a.fn.mosaicSetResizeHandleLocation=function(){var b=a(this);b.children(".mosaic-grid-row").each(function(){var b=a(this),c=b.children(".mosaic-grid-cell");(2===c.length||3===c.length)&&(b.children(".mosaic-resize-handle").removeClass("mosaic-resize-handle-left mosaic-resize-handle-center mosaic-resize-handle-right"),a(c.get(0)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(b.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-left"),b.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-center")):a(c.get(1)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(b.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-right"),b.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-left")):3===c.length&&a(c.get(2)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(b.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-center"),b.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-right")):(b.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-center"),b.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-center")))})},a.fn.mosaicGetDirection=function(b){var c=parseFloat(a(this).width()),d=parseFloat(a(this).height()),e=parseFloat(b.pageX-a(this).offset().left-c/2),f=parseFloat(b.pageY-a(this).offset().top-d/2),g=c/2,h=d/2;return 0>e?0>f?-1*g/(-1*h)>e/f?"top":"left":-1*g/h>e/f?"left":"bottom":0>f?1*g/(-1*h)>e/f?"right":"top":g/h>e/f?"bottom":"right"},a.mosaic.disableEditHtmlSource=function(){a(".mosaic-rich-text-textarea",a.mosaic.document).each(function(){var c,d;d=a(this).val(),c=a(this).parent(),c.html(d);var e=new b(a(this).parent());e.setupWysiwyg()})},a.mosaic.addAppTile=function(b,c){a.mosaic.overlay.app&&a.mosaic.overlay.app.hide(),a.ajax({type:"GET",url:c,success:function(d){d=a.mosaic.getDomTreeFromHtml(d),a.mosaic.addHeadTags(c,d),a.mosaic.addTile(b,d.find(".temp_body_tag").html(),c)}})},a.mosaic.addAppTileHTML=function(b,c,d){var e;e=a.mosaic.getDomTreeFromHtml(c),a.mosaic.addHeadTags(d,e),a.mosaic.addTile(b,e.find(".temp_body_tag").html(),d)},a.mosaic.editAppTile=function(b){a.mosaic.overlay.close(),window.parent.focus(),a.ajax({type:"GET",url:b,success:function(c){c=a.mosaic.getDomTreeFromHtml(c),a.mosaic.removeHeadTags(b),a.mosaic.addHeadTags(b,c);var d=a(".mosaic-selected-tile .mosaic-tile-content",a.mosaic.document);d.html(c.find(".temp_body_tag").html()),d.attr("data-tileUrl",b.replace(/&/gim,"&amp;"))}})},a.mosaic.addTile=function(c,d,e){a.mosaic.options.panels.addClass("mosaic-panel-dragging mosaic-panel-dragging-new"),a(a.mosaic.options.panels.get(0)).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-leftmost").append(a(a.mosaic.document.createElement("div")).addClass("movable removable mosaic-tile mosaic-"+c+"-tile").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-content").attr("data-tileUrl",e&&e.replace(/&/gim,"&amp;")).html(d)).addClass("mosaic-helper-tile mosaic-helper-tile-new mosaic-original-tile"))));var f=a.mosaic.options.panels.find(".mosaic-helper-tile-new"),g=0;a.mosaic.options.panels.each(function(){a(this).width()>g&&(g=a(this).width())}),f.width()<g/4?f.width(g/4):f.width(f.width()),new b(f).initialize()},a.mosaic.getDefaultValue=function(b){var c,d,e,f;switch("IDublinCore-title"===b.name?(e='<h1 class="documentFirstHeading">',f="</h1>"):"IDublinCore-description"===b.name?(e='<p class="documentDescription">',f="</p>"):(e="<div>",f="</div>"),b.tile_type){case"field":switch(b.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":return e+a("#"+b.id,a.mosaic.document).find("input").attr("value")+f;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":for(var g=a("#"+b.id,a.mosaic.document).find("textarea").val().split("\n"),h="",i=0;i<g.length;i+=1)h+=g[i]+"<br/>";return e+h+f;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":return c=a("#"+b.id).find("textarea").attr("id"),d=tinymce.get(c),d?d.getContent():"";default:return'<div class="discreet">Placeholder for field:<br/><b>'+b.label+"</b></div>"}break;default:return b.default_value}},a.mosaic.getPageContent=function(){var c,d=1,e=12,f="",g="",h="";return a.mosaic.disableEditHtmlSource(),f+="  <body>\n",a("[data-panel]",a.mosaic.document).each(function(){h=a(this).attr("data-panel"),f+='    <div data-panel="'+h+'">\n',a(this).children(".mosaic-grid-row").each(function(){a(this).hasClass("mosaic-empty-row")===!1&&(g=a(this).attr("class"),f+='      <div class="'+g+'"\n',f+='           data-grid=\'{"type": "row"}\'>\n',a(this).children(".mosaic-grid-cell").each(function(){switch(a(this).mosaicGetPositionClass()){case"mosaic-position-leftmost":d=1;break;case"mosaic-position-quarter":d=4;break;case"mosaic-position-third":d=5;break;case"mosaic-position-half":d=7;break;case"mosaic-position-two-thirds":d=9;break;case"mosaic-position-three-quarters":d=10}switch(a(this).mosaicGetWidthClass()){case"mosaic-width-half":e=6;break;case"mosaic-width-quarter":e=3;break;case"mosaic-width-third":e=4;break;case"mosaic-width-two-thirds":e=8;break;case"mosaic-width-three-quarters":e=9;break;case"mosaic-width-full":e=12}f+='        <div class="'+a(this).attr("class")+'"\n',f+='             data-grid=\'{"type": "cell", "info":{"xs": "true", "sm": "true", "lg": "true", "pos": {"x": '+d+', "width": '+e+"}}}'>\n",a(this).children(".mosaic-tile").each(function(){var a=new b(this);f+=a.getHtmlBody()}),f+="        </div>\n"}),f+="      </div>\n")}),f+="    </div>\n"}),f+="  </body>\n",c='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" data-layout="'+a.mosaic.options.layout+'">\n',c+=f,c+="</html>\n"},a.mosaic.saveTileFormData=function(){a("[data-panel]",a.mosaic.document).each(function(){a(this).find(".mosaic-tile").each(function(){var a=new b(this);a.saveForm()})})},a.mosaic.saveLayoutToForm=function(){a.mosaic.saveTileFormData();var b=a("#form-widgets-ILayoutAware-content, [name='form.widgets.ILayoutAware.content']");a.mosaic.hasContentLayout?b.val(""):b.val(a.mosaic.getPageContent())},{Tile:b}}),define("mosaic-url/mosaic.toolbar",["jquery","mosaic-url/mosaic.tile","mosaic-url/mosaic.layout"],function(a,b){"use strict";function c(b,c){var e;void 0!==typeof c.menu&&c.menu?c.icon?(e=a(document.createElement("label")),b.append(e.addClass("mosaic-icon-menu mosaic-icon-menu-"+d(c.name)+" mosaic-icon").html(c.label).attr("title",c.label).append(a(document.createElement("select")).addClass("mosaic-menu-"+d(c.name)).data("action",c.action).change(function(){a(this).mosaicExecAction()}).each(function(){var b,e,f;for(b in c.items)if(void 0!==c.items[b].items){a(this).append(a(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+d(c.items[b].value)).attr("label",c.items[b].label)),e=a(this).find(".mosaic-option-group-"+d(c.items[b].value));for(f in c.items[b].items)e.append(a(document.createElement("option")).attr("value",c.items[b].items[f].value).addClass("mosaic-option mosaic-option-"+d(c.items[b].items[f].value)).html(c.items[b].items[f].label))}else a(this).append(a(document.createElement("option")).attr("value",c.items[b].value).addClass("mosaic-option mosaic-option-"+d(c.items[b].value)).html(c.items[b].label))})))):(e=a(document.createElement("select")),b.append(e.addClass("mosaic-menu mosaic-menu-"+c.name.replace(/_/g,"-")).data("action",c.action).change(function(){a(this).mosaicExecAction()}).each(function(){var b,e,f;for(b=0;b<c.items.length;b+=1)if(void 0!==c.items[b].items){a(this).append(a(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+d(c.items[b].value)).attr("label",c.items[b].label)),e=a(this).find(".mosaic-option-group-"+d(c.items[b].value));for(f in c.items[b].items)e.append(a(document.createElement("option")).attr("value",c.items[b].items[f].value).addClass("mosaic-option mosaic-option-"+d(c.items[b].items[f].value)).html(c.items[b].items[f].label))}else a(this).append(a(document.createElement("option")).attr("value",c.items[b].value).addClass("mosaic-option mosaic-option-"+d(c.items[b].value)).html(c.items[b].label))}))):(e=a(document.createElement("button")),b.append(e.addClass("mosaic-button mosaic-button-"+d(c.name)+(c.icon?" mosaic-icon":"")).html(c.label).attr("title",c.label).attr("type","button").data("action",c.action).mousedown(function(){a(this).mosaicExecAction()}))),a.mosaic.actionManager.actions[c.name]&&(a.mosaic.actionManager.actions[c.name].visible()||e.hide())}"undefined"==typeof a.mosaic&&(a.mosaic={});var d=function(a){return a.replace(/(_|\.|\/)/g,"-")};a.fn._mosaicToolbarLayoutEditor=function(b){a(".mosaic-toolbar-secondary-functions",this).show();var e,f,g,h;if(void 0!==a.mosaic.options.formats)for(e=0;e<a.mosaic.options.formats.length;e+=1){for(g=a.mosaic.options.formats[e],b.primary_actions.append(a(document.createElement("fieldset")).addClass("mosaic-button-group mosaic-button-group-"+d(g.name))),h=b.primary_actions.children(".mosaic-button-group-"+g.name.replace(/_/g,"-")),f=0;f<g.actions.length;f+=1)g.actions[f].favorite&&c(h,g.actions[f]);0===h.children().length&&h.remove()}if(void 0!==a.mosaic.options.tiles){var i=b.secondary_actions.find(".mosaic-menu-insert");for(e=0;e<a.mosaic.options.tiles.length;e+=1){for(g=a.mosaic.options.tiles[e],i.append(a(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+d(g.name)).attr("label",g.label)),h=b.secondary_actions.find(".mosaic-option-group-"+d(g.name)),f=0;f<g.tiles.length;f+=1){var j=g.tiles[f];h.append(a(document.createElement("option")).addClass("mosaic-option mosaic-option-"+d(j.name)).attr("value",j.name).html(j.label))}0===h.children().length&&h.remove()}}if(void 0!==a.mosaic.options.formats){var k=b.secondary_actions.find(".mosaic-menu-format");for(e=0;e<a.mosaic.options.formats.length;e+=1){for(g=a.mosaic.options.formats[e],k.append(a(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+d(g.name)).attr("label",g.label)),h=b.secondary_actions.find(".mosaic-option-group-"+d(g.name)),f=0;f<g.actions.length;f+=1){var l=g.actions[f];l.favorite===!1&&h.append(a(document.createElement("option")).addClass("mosaic-option mosaic-option-"+d(l.name)).attr("value",l.name).html(l.label).data("action",l.action))}0===h.children().length&&h.remove()}}},a.fn.mosaicToolbar=function(){return this.each(function(){var e,f,g,h,i,j,k,l,m,n;e=a(this),e.html(""),e.append(a(document.createElement("div")).addClass("mosaic-inline-toolbar")),e=e.children(".mosaic-inline-toolbar"),e.append(a(document.createElement("div")).addClass("mosaic-toolbar-content")),f=e.children(".mosaic-toolbar-content"),g={},f.append(a(document.createElement("div")).addClass("mosaic-toolbar-primary-functions")),g.primary_actions=f.children(".mosaic-toolbar-primary-functions"),f.append(a(document.createElement("div")).addClass("mosaic-toolbar-secondary-functions")),g.secondary_actions=f.children(".mosaic-toolbar-secondary-functions");for(h in g)for(i=0;i<a.mosaic.options[h].length;i+=1)if(void 0===a.mosaic.options[h][i].actions)c(g[h],a.mosaic.options[h][i]);else for(j=a.mosaic.options[h][i],g[h].append(a(document.createElement("fieldset")).addClass("mosaic-button-group mosaic-button-group-"+d(a.mosaic.options[h][i].name))),k=g[h].children(".mosaic-button-group-"+d(a.mosaic.options[h][i].name)),l=0;l<j.actions.length;l+=1)c(k,j.actions[l]);e._mosaicToolbarLayoutEditor(g),a.mosaic.hasContentLayout&&a(".mosaic-toolbar-secondary-functions",this).hide(),m=function(){var b;parseInt(a(window).scrollTop(),10)>parseInt(e.parent().offset().top,10)?e.hasClass("mosaic-inline-toolbar")&&(b=e.offset().left,e.width(e.width()).css({left:b,"margin-left":"0px"}).removeClass("mosaic-inline-toolbar").addClass("mosaic-external-toolbar").parent().height(e.height())):e.hasClass("mosaic-external-toolbar")&&e.css({width:"",left:"","margin-left":""}).removeClass("mosaic-external-toolbar").addClass("mosaic-inline-toolbar").parent().css("height","")},a(window).bind("scroll",m),n=function(){var c,d,e,f,g,h;a.mosaic.disableEditHtmlSource(),c=a(this);var i=a(".mosaic-selected-tile",a.mosaic.document);if(i.length>0){var j=new b(i);d=j.getType()}for(e=a.mosaic.options.default_available_actions,f=0;f<a.mosaic.options.tiles.length;f+=1)for(g=a.mosaic.options.tiles[f],h=0;h<g.tiles.length;h+=1)g.tiles[h].name===d&&(e=e.concat(g.tiles[h].available_actions));i.hasClass("removable")||(e=a(e).filter(function(){return"remove"!==this})),c.find(".mosaic-option-group").show(),c.find(".mosaic-button").hide(),c.find(".mosaic-menu").hide(),c.find(".mosaic-icon-menu").hide(),c.find(".mosaic-menu-format").find(".mosaic-option").hide().attr("disabled","disabled"),a(c.find(".mosaic-menu-format").find(".mosaic-option").get(0)).show().removeAttr("disabled"),a(e).each(function(b,d){(!a.mosaic.actionManager.actions[d]||a.mosaic.actionManager.actions[d].visible())&&(c.find(".mosaic-button-"+d).show(),c.find(".mosaic-icon-menu-"+d).show(),c.find(".mosaic-menu-"+d).show(),c.find(".mosaic-option-"+d).show().removeAttr("disabled"))}),c.find(".mosaic-menu-insert").children(".mosaic-option-group-fields").children().each(function(){0===a.mosaic.options.panels.find(".mosaic-"+a(this).attr("value")+"-tile").length?a(this).show().removeAttr("disabled"):a(this).hide().attr("disabled","disabled")}),c.find(".mosaic-option-group").each(function(){0===a(this).children(":enabled").length&&a(this).hide()}),a(".mosaic-menu, .mosaic-icon-menu",a.mosaic.document).each(function(){1===a(this).find(".mosaic-option:enabled").length&&a(this).hide()})},a(".mosaic-button-remove").hover(function(){a(".mosaic-selected-tile .mosaic-tile-content").addClass("mosaic-remove-target")},function(){a(".mosaic-selected-tile .mosaic-tile-content").removeClass("mosaic-remove-target")}),a(this).bind("selectedtilechange",n),a(this).trigger("selectedtilechange"),a(".mosaic-menu").each(function(){a(this).select2({width:"style",dropdownCssClass:"mosaic-dropdown mosaic-dropdown-"+a(this).data("action"),dropdownAutoWidth:!0,minimumResultsForSearch:99})});var o=(new Date).getTime();a(this).on("selectedtilechange",function(){a.mosaic.overlay.app||(new Date).getTime()-o>2e3&&(a.mosaic.saveLayoutToForm(),a("#form-widgets-ILayoutAware-content, [name='form.widgets.ILayoutAware.content']").blur(),o=(new Date).getTime())})})}}),define("mosaic-url/mosaic.actions",["jquery","mockup-patterns-modal","mosaic-url/mosaic.tile","mockup-utils"],function(a,b,c,d){"use strict";"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.actionManager={actions:[],shortcuts:[]},a.mosaic.registerAction=function(b,c){c=a.extend({exec:function(){},shortcut:{ctrl:!1,alt:!1,shift:!1,key:""},visible:function(a){return!0},undoable:!1},c),a.mosaic.actionManager.actions[b]=c,""!==c.shortcut.key&&(c.shortcut.charCode=c.shortcut.key.toUpperCase().charCodeAt(0),c.shortcut.action=b,a.mosaic.actionManager.shortcuts.push(c.shortcut))},a.fn.mosaicExecAction=function(){return this.each(function(){if(""!==a(this).data("action")){var b=a.mosaic.actionManager;b.actions[a(this).data("action")].exec(this),b.actions[a(this).data("action")].undoable&&a.mosaic.undo.snapshot()}})},a.mosaic.fixWebkitSpan=function(){var b=a(".Apple-style-span",a.mosaic.document);b.after(b.html()),b.remove()},a.mosaic.getPrefixedClassName=function(a){return a.indexOf("-")>-1?"mosaic-"+a:"mosaic"+a.charAt(0).toUpperCase()+a.slice(1)},a.mosaic.initActions=function(){a.mosaic.registerAction("tile-toggle-class",{exec:function(){var b;arguments.length>0&&arguments[0].value&&(b=a.mosaic.getPrefixedClassName(arguments[0].value),a(".mosaic-selected-tile",a.mosaic.document).toggleClass(b))}}),a.mosaic.registerAction("tile-remove-format",{exec:function(){var b,c,d,e,f;for(b=0;b<a.mosaic.options.formats.length;b++)for(d=a.mosaic.options.formats[b],c=0;c<d.actions.length;c++)e=d.actions[c],"tile"===e.category&&(f=a.mosaic.getPrefixedClassName(e.name),a(".mosaic-selected-tile",a.mosaic.document).removeClass(f))}}),a.mosaic.registerAction("row-toggle-class",{exec:function(){var b;arguments.length>0&&arguments[0].value&&(b=a.mosaic.getPrefixedClassName(arguments[0].value),a(".mosaic-selected-tile",a.mosaic.document).parents(".mosaic-grid-row").first().toggleClass(b))}}),a.mosaic.registerAction("row-remove-format",{exec:function(){var b,c,d,e,f;for(b=0;b<a.mosaic.options.formats.length;b++)for(d=a.mosaic.options.formats[b],c=0;c<d.actions.length;c++)e=d.actions[c],"row"===e.category&&(f=a.mosaic.getPrefixedClassName(e.name),a(".mosaic-selected-tile",a.mosaic.document).parents(".mosaic-grid-row").first().removeClass(f))}}),a.mosaic.registerAction("tile-align-block",{exec:function(){a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-tile-align-right").removeClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"b"}}),a.mosaic.registerAction("tile-align-left",{exec:function(){a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-tile-align-right").addClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"l"}}),a.mosaic.registerAction("tile-align-right",{exec:function(){a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-tile-align-left").addClass("mosaic-tile-align-right")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"r"}}),a.mosaic.registerAction("save",{exec:function(){a.mosaic.options.toolbar.trigger("selectedtilechange"),a.mosaic.saveLayoutToForm(),a("#form-buttons-save").click()},shortcut:{ctrl:!0,alt:!1,shift:!1,key:"s"}}),a.mosaic.registerAction("cancel",{exec:function(){a("#form-buttons-cancel").click()}}),a.mosaic.registerAction("html",{exec:function(){var b,c,d;b=a(".mosaic-selected-tile",a.mosaic.document).children(".mosaic-tile-content"),0===b.find(".mosaic-rich-text-textarea").length&&(c=b.html(),d=b.height(),b.empty(),b.prepend(a(a.mosaic.document.createElement("textarea")).addClass("mosaic-rich-text-textarea").html(a.trim(c)).height(d)))}}),a.mosaic.registerAction("undo",{exec:function(){a.mosaic.undo.undo()}}),a.mosaic.registerAction("redo",{exec:function(){a.mosaic.undo.redo()}}),a.mosaic.registerAction("properties",{exec:function(){a.mosaic.overlay.open("all")}}),a.mosaic.registerAction("customizelayout",{exec:function(){a.mosaic.setSelectedContentLayout(""),a(".mosaic-toolbar-secondary-functions").show(),a(".mosaic-button-customizelayout").hide(),a(".mosaic-panel .mosaic-tile",a.mosaic.document).each(function(){var a=new c(this);a.makeMovable(),a.$el.mosaicAddDrag()})},visible:function(){return a.mosaic.hasContentLayout&&a.mosaic.options.canChangeLayout}}),a.mosaic.registerAction("changelayout",{exec:function(){var b=a.mosaic.hasContentLayout;b||(b=confirm("Changing your will destroy all existing custom layout settings you have in place. Are you sure you want to continue?")),b&&a.mosaic.selectLayout()},visible:function(){return a.mosaic.options.available_layouts.length>0}}),a.mosaic.registerAction("add-tile",{exec:function(){var c=new b(a(".mosaic-toolbar"),{ajaxUrl:a.mosaic.options.context_url+"/@@add-tile?form.button.Create=Create"});c.show()}}),a.mosaic.registerAction("format",{exec:function(b){a(b).find("[value="+a(b).val()+"]").mosaicExecAction(),a(b).select2("val","none")}}),a.mosaic.registerAction("remove",{exec:function(b){a(".mosaic-selected-tile",a.mosaic.document).each(function(){var b=new c(this),d=b.getConfig();if("app"===d.tile_type){var e=b.getUrl();a.mosaic.removeHeadTags(e);var f=e.split("?")[0];f=f.split("@@");var g=f[1].split("/");f=f[0]+"@@delete-tile/"+g[0]+"/"+g[1],f.match(/^\.\/.*/)&&(f=a.mosaic.options.context_url+f.replace(/^\./,"")),a.ajax({type:"GET",url:f,success:function(b){var c=a(b).find('[name="_authenticator"]').val();a.ajax({type:"POST",url:f,data:{"buttons.delete":"Delete",_authenticator:c},success:function(a){}})}})}a.mosaic.options.panels.find(".mosaic-empty-row").remove();var h=a(this).parent().parent();b.saveForm(),a(this).remove(),a.mosaic.undo.snapshot(),h.mosaicCleanupRow(),a.mosaic.options.panels.mosaicAddEmptyRows(),a.mosaic.options.toolbar.trigger("selectedtilechange"),a.mosaic.options.toolbar.mosaicSetResizeHandleLocation()})},visible:function(){return!a.mosaic.hasContentLayout}}),a.mosaic.registerAction("insert",{exec:function(c){var e,f,g,h,i;if("none"===a(c).val())return!1;for(g=a(c).val(),a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),a.mosaic.options.panels.trigger("selectedtilechange"),
h=0;h<a.mosaic.options.tiles.length;h+=1)for(f=a.mosaic.options.tiles[h],i=0;i<f.tiles.length;i+=1)f.tiles[i].name===g&&(e=f.tiles[i]);if("app"===e.tile_type){var j=!0;d.loading.show(),a.ajax({type:"GET",url:a.mosaic.options.context_url+"/@@add-tile?tiletype="+g+"&form.button.Create=Create",success:function(c,e){d.loading.hide();var f,h,i,k;f=a(c),h=f.find("#add_tile").attr("action"),i=f.find('[name="_authenticator"]').val(),k=function(c){a.mosaic.overlay.app=new b(a(".mosaic-toolbar"),{html:c,loadLinksWithinModal:!0,buttons:'.formControls > input[type="submit"], .actionButtons > input[type="submit"]'}),a.mosaic.overlay.app.$el.off("after-render"),a.mosaic.overlay.app.on("after-render",function(b){j&&(a(".field.error",a.mosaic.overlay.app.$modal).removeClass("error"),a(".fieldErrorBox,.portalMessage",a.mosaic.overlay.app.$modal).remove(),j=!1),a('input[name*="cancel"]',a.mosaic.overlay.app.$modal).off("click").on("click",function(){a.mosaic.overlay.app.hide(),a.mosaic.overlay.app=null})}),a.mosaic.overlay.app.show(),a.mosaic.overlay.app.$el.off("formActionSuccess"),a.mosaic.overlay.app.on("formActionSuccess",function(b,c,d,e){var f=e.getResponseHeader("X-Tile-Url");f&&(a.mosaic.addAppTileHTML(g,c,f),a.mosaic.overlay.app.hide(),a.mosaic.overlay.app=null)})},a("form .required",f).filter(function(){var b=a(this).parents(".field").first().find("input, select, textarea").not('[type="hidden"]').last().val();return null===b||0==b.length}).length>0?k(c):h&&a("form",f).ajaxSubmit({type:"POST",url:h,data:{"buttons.save":"Save",_authenticator:i},success:function(b,c,d){var e=d.getResponseHeader("X-Tile-Url");e?a.mosaic.addAppTileHTML(g,b,e):k(b)}})}})}else a.mosaic.addTile(g,a.mosaic.getDefaultValue(e));return a(c).select2("val","none"),!0}}),a(document).keypress(function(b){var c="";return a(a.mosaic.actionManager.shortcuts).each(function(){b.ctrlKey!==this.ctrl&&(-1===navigator.userAgent.toLowerCase().indexOf("macintosh")||b.metaKey!==this.ctrl)||b.altKey!==this.alt&&void 0!==b.altKey||b.shiftKey!==this.shift||!b.charCode||String.fromCharCode(b.charCode).toUpperCase().charCodeAt(0)!==this.charCode||(c=this.action)}),""!==c?(a.mosaic.actionManager.actions[c].exec(),a.mosaic.actionManager.actions[c].undoable&&a.mosaic.undo.snapshot(),!1):!0})}}),define("mosaic-url/mosaic.core",["jquery","pat-logger","mockup-patterns-modal","underscore","mosaic-url/mosaic.tile","mosaic-url/mosaic.panel","mosaic-url/mosaic.toolbar","mosaic-url/mosaic.layout","mosaic-url/mosaic.actions"],function(a,b,c,d,e,f){"use strict";b.getLogger("pat-mosaic");"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.loaded=!1,a.mosaic.selectLayoutTemplate=d.template('<div><h1>Select Layout</h1><div class="mosaic-select-layout"><ul><% _.each(available_layouts, function(layout){ var screenshot = layout.screenshot;if(!screenshot){screenshot = "++resource++plone.app.mosaic.images/default-layout-screenshot.png";} %><li><a href="#" data-value="<%- layout.path %>"><p><%- layout.title %></p><img src="<%- screenshot %>"></a></li><% }); %></ul></div><div class="buttons"><!-- <button class="plone-btn plone-btn-default">Select</button> --></div></div>'),a.mosaic.initialized=function(){a.mosaic.loaded||(a.mosaic.loaded=!0,a.mosaic.undo.snapshot())},a.mosaic.init=function(b){b=a.extend({url:window.document.location.href,type:"",ignore_context:!1},b),a.mosaic.document=window.document;var c;a.mosaic.initActions(),c=b.url.match(/^([\w#!:.?+=&%@!\-\/]+)\/edit$/),c&&(b.url=c[1]),c=b.url.match(/^([\w#:.?=%@!\-\/]+)\/\+\+add\+\+([\w#!:.?+=&%@!\-\/]+)$/),c&&(b.url=c[1],b.type=c[2],b.ignore_context=!0),a.mosaic.options=b.data,a.mosaic.options.url=b.url,a.mosaic.options.ignore_context=b.ignore_context,a.mosaic.options.tileheadelements=[],a.mosaic.hasContentLayout=!0;var d=a.mosaic.getSelectedContentLayout();if(d)a.mosaic.applyLayout(d);else{var e=a(a.mosaic.options.customContentLayout_field_selector).val();if(e){var f=a.mosaic.getDomTreeFromHtml(e);"no-layout"===f.attr("id")?a.mosaic.selectLayout(!0):(a.mosaic.hasContentLayout=!1,a.mosaic._init(f))}else a.mosaic.selectLayout(!0)}},a.mosaic.getSelectedContentLayout=function(){return a(a.mosaic.options.contentLayout_field_selector).val()},a.mosaic.setSelectedContentLayout=function(b){return b?(a.mosaic.hasContentLayout=!0,a(".mosaic-toolbar-secondary-functions",a.mosaic.document).hide()):a.mosaic.hasContentLayout=!1,a(a.mosaic.options.contentLayout_field_selector).attr("value",b)},a.mosaic._initPanels=function(b){a.mosaic.options.layout=b.attr("data-layout"),a("[data-panel] [data-panel]",a.mosaic.document).removeAttr("data-panel"),b.find("[data-panel]").each(function(){var a=new f(this);a.initialize(b)}),a("[data-panel]",a.mosaic.document).each(function(){var a=new f(this);a.prefill()}),a.mosaic.options.panels=a(".mosaic-panel",a.mosaic.document),a.mosaic.options.panels.find("[data-tile]").each(function(){if(e.validTile(this)){var b=new e(a(this).parent());b.initializeContent()}})},a.mosaic._init=function(b){a.mosaic._initPanels(b),a(".mosaic-original-content",a.mosaic.document).mosaicOverlay(),a("body").prepend(a(document.createElement("div")).addClass("mosaic-toolbar")),a.mosaic.options.toolbar=a(".mosaic-toolbar"),a.mosaic.options.toolbar.mosaicToolbar(),a.mosaic.options.panels.mosaicLayout(),a("*",a.mosaic.document).each(function(){var b;b=a(this),"block"===b.css("display")&&(b.hasClass("mosaic-panel")||b.hasClass("mosaic-toolbar")||b.hasClass("mosaic-notifications")||b.hasClass("mosaic-modal-wrapper")||"edit-zone"===b.attr("id")||0===b.parents(".mosaic-panel, .mosaic-toolbar").length&&0===b.find(".mosaic-panel, .mosaic-toolbar").length&&0!==b.parent().find(".mosaic-panel, .mosaic-toolbar").length&&b.addClass("mosaic-blur"))}),a.mosaic.undo.init(),a("body").addClass("mosaic-enabled"),a.mosaic.initialized()},a.mosaic.applyLayout=function(b,c){void 0===c&&(c=function(){}),a.ajax({url:a.mosaic.options.context_url+"/"+b}).done(function(c){var d=a.mosaic.getDomTreeFromHtml(c);a.mosaic.setSelectedContentLayout(b),a.mosaic.loaded?(a.mosaic._initPanels(d),a.mosaic.options.panels.mosaicLayout()):a.mosaic._init(d)})},a.mosaic.selectLayout=function(b){if(void 0!==b&&b&&1===a.mosaic.options.available_layouts.length){var e=a.mosaic.options.available_layouts[0],f="++contentlayout++"+e.directory+"/"+e.file;return void a.mosaic.applyLayout(f)}if(0===a.mosaic.options.available_layouts.length)return void a.mosaic.applyLayout("++contentlayout++default/basic.html");var g=a("<div/>").appendTo("body"),h=new c(g,{html:a.mosaic.selectLayoutTemplate(a.mosaic.options),content:null,buttons:".plone-btn"});h.on("shown",function(){a("li a",h.$modal).off("click").on("click",function(b){b.preventDefault();var c,e=a(this).attr("data-value");d.each(a.mosaic.options.available_layouts,function(a){a.path===e&&(c=a)});var f="++contentlayout++"+c.directory+"/"+c.file;h.hide(),a.mosaic.applyLayout(f)})}),h.show()},a.mosaic.getDomTreeFromHtml=function(b){return b=b.replace(/<!DOCTYPE[\w\s\- .\/\":]+>/,""),b=b.replace(/<html>/,'<div class="temp_html_tag">'),b=b.replace(/<\/html>/,"</div>"),b=b.replace(/<html\s/,'<div class="temp_html_tag" '),b=b.replace(/<\/html\s/,"</div "),b=b.replace(/<head>/,'<div class="temp_head_tag">'),b=b.replace(/<\/head>/,"</div>"),b=b.replace(/<head\s/,'<div class="temp_head_tag" '),b=b.replace(/<\/head\s/,"</div "),b=b.replace(/<body>/,'<div class="temp_body_tag">'),b=b.replace(/<\/body>/,"</div>"),b=b.replace(/<body\s/,'<div class="temp_body_tag" '),b=b.replace(/<\/body\s/,"</div "),a(a(b)[0])},a.mosaic.removeHeadTags=function(b){var c,d,e,f;if(b=b.split("?")[0],b=b.split("@@"),c=b[1].split("/"),b=b[0]+"@@delete-tile?type="+c[0]+"&id="+c[1]+"&confirm=true",d=c[0].replace(/\./g,"-")+"-"+c[1],e=a.mosaic.options.tileheadelements[d])for(f=0;f<e.length;f+=1)a(e[f],a.mosaic.document).remove();a.mosaic.options.tileheadelements[d]=[]},a.mosaic.addHeadTags=function(b,c){var d,e;b=b.split("?")[0],b=b.split("@@"),d=b[1].split("/"),e=d[0].replace(/\./g,"-")+"-"+d[1],a.mosaic.options.tileheadelements[e]=[],c.find(".temp_head_tag").children().each(function(){a.mosaic.options.tileheadelements[e].push(this),a("head",a.mosaic.document).append(this)})}}),define("mosaic-url/mosaic.upload",["jquery"],function($){"use strict";"undefined"==typeof $.mosaic&&($.mosaic={}),$.mosaic.initUpload=function(){$(".mosaic-panel",$.mosaic.document).bind("dragover",function(a){0===$(".mosaic-panel-dragging",$.mosaic.document).length&&($(".mosaic-selected-tile",$.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),$.mosaic.options.toolbar.trigger("selectedtilechange"),$.mosaic.options.panels.mosaicSetResizeHandleLocation(),$.mosaic.addTile("image",'<img src="++resource++plone.app.mosaic.images/files.png" border="0" />'))}),document.addEventListener("drop",function(event){var dt,first,i,files,newtile,file,img,tile,xhr,boundary,data;for(dt=event.dataTransfer,files=dt.files,event.stopPropagation(),event.preventDefault(),$($.mosaic.document).trigger("mousedown"),first=!0,i=0;i<files.length;i+=1)file=files.item(i),0===file.mediaType.indexOf("image")?(first?(img=$(".mosaic-selected-tile",$.mosaic.document).children(".mosaic-tile-content").children("img"),tile=$(".mosaic-selected-tile",$.mosaic.document),first=!1):(newtile=$($.mosaic.document.createElement("div")).addClass("movable removable mosaic-tile mosaic-image-tile").append($($.mosaic.document.createElement("div")).addClass("mosaic-tile-content").append($($.mosaic.document.createElement("img")).attr("border",0))),$(".mosaic-selected-tile",$.mosaic.document).after(newtile),newtile.mosaicInitTile(),newtile.mosaicAddDrag(),img=newtile.children(".mosaic-tile-content").children("img"),tile=newtile),tile.append($($.mosaic.document.createElement("div")).addClass("mosaic-tile-uploadprogress")),img.get(0).src=file.getAsDataURL(),xhr=new XMLHttpRequest,xhr.upload.log=img,xhr.addEventListener("load",function(event){var response=eval("("+event.target.responseText+")");1===response.status?$.plone.notify({type:"error",title:"Error",message:response.message,sticky:!0}):$(event.target.upload.log).attr({src:response.url,alt:response.title}).parents(".mosaic-tile").children(".mosaic-tile-uploadprogress").fadeOut("slow",function(){$(this).remove()})},!1),xhr.upload.addEventListener("error",function(a){$.plone.notify({type:"error",title:"Error",message:"Error uploading file: "+a,sticky:!0})},!1),boundary="AJAX---------------------------AJAX",xhr.open("POST",$.mosaic.options.url+"/@@mosaic-upload",!0),xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+boundary),data="--"+boundary+"\r\n",data+="Content-Disposition: form-data; ",data+='name="uploadfile"; ',data+='filename="'+file.fileName+'"\r\n',data+="Content-Type: "+file.mediaType,data+="\r\n\r\n",data+=file.getAsBinary()+"\r\n",data+="--"+boundary+"--\r\n",xhr.sendAsBinary(data)):$.plone.notify({type:"warning",title:"Warning",message:"The filetype of file "+file.fileName+" is unsupported",sticky:!0});first&&$(".mosaic-button.remove").mosaicExecAction()},!1)}}),define("mosaic-url/mosaic.editor",["jquery"],function(a){"use strict";"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.editor={},a.mosaic.execCommand=function(a,b,c){tinymce.activeEditor&&tinymce.activeEditor.execCommand(a,b,c)},a.mosaic.editor.applyFormat=function(a){tinymce.activeEditor&&tinyMCE.activeEditor.formatter.apply(a)},a.mosaic.editor.registerFormat=function(a,b){tinymce.activeEditor&&tinymce.activeEditor.formatter.register(a,b)}}),define("mosaic-url/mosaic.undo",["jquery"],function(a){"use strict";"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.undo=function(){},a.mosaic.undo.init=function(){function b(b){for(var c=0;c<b.length;c+=1)a("#"+b[c].target,a.mosaic.document).html(b[c].source)}a.mosaic.undo.undoManager=new a.mosaic.undo.UndoManager(10,b)},a.mosaic.undo.snapshot=function(){var b=[];a(".mosaic-panel",a.mosaic.document).each(function(){b.push({target:a(this).attr("id"),source:a(this).html()})}),"undefined"==typeof a.mosaic.undo.undoManager&&a.mosaic.undo.init(),a.mosaic.undo.undoManager.add(b)},a.mosaic.undo.hasInitial=function(){return a.mosaic.undo.undoManager.stack.size()>0?!0:!1},a.mosaic.undo.undo=function(){a.mosaic.undo.undoManager.undo()},a.mosaic.undo.redo=function(){a.mosaic.undo.undoManager.redo()},a.mosaic.undo.Stack=function(a){"undefined"==typeof a?this.maxsize=10:this.maxsize=a,this.stack=[]},a.mosaic.undo.Stack.prototype.size=function(){return this.stack.length},a.mosaic.undo.Stack.prototype.add=function(a){this.stack.length>=this.maxsize&&this.stack.pop(),this.stack.unshift(a)},a.mosaic.undo.Stack.prototype.get=function(a){return this.stack[a]},a.mosaic.undo.UndoManager=function(b,c,d){this.stack=new a.mosaic.undo.Stack(b),this.pointer=0,this.handler=c,"undefined"!=typeof d&&this.stack.add(d)},a.mosaic.undo.UndoManager.prototype.add=function(a){this.stack.add(a)},a.mosaic.undo.UndoManager.prototype.undo=function(){var a=this.stack.get(this.pointer+1);a&&(this.handler(a),this.pointer+=1)},a.mosaic.undo.UndoManager.prototype.redo=function(){var a=this.stack.get(this.pointer-1);a&&(this.handler(a),this.pointer-=1)}}),define("mosaic-url/mosaic.overlay",["jquery"],function(a){"use strict";"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.overlay={},a.fn.mosaicOverlay=function(){return this.each(function(){var b=a(this);a(document.body,a.mosaic.document).append(b),b.addClass("mosaic-overlay");var c=a('<div class="mosaic-modal-wrapper" />');b.wrap(c),a(document.body,a.mosaic.document).prepend(a(document.createElement("div")).addClass("mosaic-overlay-blocker"))})},a.mosaic.overlay.open=function(b,c){var d,e,f,g,h,i,j,k;if(a(".mosaic-modal-wrapper").show().addClass("active"),a(".mosaic-overlay-blocker").show(),a("body").addClass("plone-modal-open"),d=a(".mosaic-overlay").find("form"),0===a(".mosaic-overlay-ok-button").length&&(a(".mosaic-overlay .formControls").children("input").hide(),a(".mosaic-overlay .formControls").append(a(document.createElement("input")).attr({type:"button",value:"Close"}).addClass("button-field context mosaic-overlay-ok-button").click(function(){a.mosaic.overlay.close()})),a(".mosaic-overlay").prepend(a(document.createElement("button")).attr({title:"Close"}).addClass("mosaic-overlay-close").html("&times;").click(function(){a.mosaic.overlay.close()}))),"all"===b){for(e=d.find("nav"),e.removeClass("mosaic-hidden"),d.find("fieldset").children().removeClass("mosaic-hidden"),d.find("fieldset").removeClass("active"),e.find("a").removeClass("active"),d.find(a.mosaic.options.customContentLayout_selector).addClass("mosaic-hidden"),d.find(a.mosaic.options.contentLayout_selector).addClass("mosaic-hidden"),a(".mosaic-IDublinCore-title-tile").size()>0?d.find("#formfield-form-widgets-IDublinCore-title").addClass("mosaic-hidden"):d.find("#formfield-form-widgets-IDublinCore-title").removeClass("mosaic-hidden"),a(".mosaic-IDublinCore-description-tile").size()>0?d.find("#formfield-form-widgets-IDublinCore-description").addClass("mosaic-hidden"):d.find("#formfield-form-widgets-IDublinCore-description").removeClass("mosaic-hidden"),g=0;g<a.mosaic.options.tiles.length;g+=1)"fields"===a.mosaic.options.tiles[g].name&&(f=a.mosaic.options.tiles[g]);for(g=0;g<f.tiles.length;g+=1)i=f.tiles[g],0!==a.mosaic.options.panels.find(".mosaic-"+i.name+"-tile").length&&a(a.mosaic.document.getElementById(i.id)).addClass("mosaic-hidden");d.find("fieldset").each(function(){0===a(this).children("div:not(.mosaic-hidden)").length&&a("a[href=#fieldsetlegend-"+a(this).attr("id").split("-")[1]+"]").addClass("mosaic-hidden")}),h=e.children(":not(.mosaic-hidden)"),h.eq(0).addClass("active");var l=d.find("#fieldset-"+h.eq(0).attr("href").split("-")[1]);0===l.size()&&(l=d.find("fieldset:not(.mosaic-hidden)").eq(0)),l.addClass("active")}else"field"===b&&(j=a("#"+c.id),k=j.parents("fieldset"),d.find("fieldset").hide(),k.show(),k.children().addClass("mosaic-hidden"),j.removeClass("mosaic-hidden"),d.find("nav").addClass("mosaic-hidden"))},a.mosaic.overlay.close=function(){a(".mosaic-modal-wrapper").hide().removeClass("active"),a(".mosaic-overlay-blocker").hide(),a("body").removeClass("plone-modal-open")}}),window.DEBUG=!0,require(["jquery","mockup-patterns-base","mosaic-url/mosaic.core","mosaic-url/mosaic.layout","mosaic-url/mosaic.toolbar","mosaic-url/mosaic.actions","mosaic-url/mosaic.upload","mosaic-url/mosaic.editor","mosaic-url/mosaic.undo","mosaic-url/mosaic.overlay"],function(a,b){"use strict";var c=b.extend({name:"layout",trigger:".pat-layout",parser:"mockup",defaults:{attribute:"class"},init:function(){var b=this;b.options.data.$el=b.$el,a.mosaic.init({data:b.options.data})}});return c}),define("/opt/plone/src/plone.app.mosaic/src/plone/app/mosaic/browser/static/js/mosaic.pattern.js",function(){});
//# sourceMappingURL=plone-mosaic.js.map